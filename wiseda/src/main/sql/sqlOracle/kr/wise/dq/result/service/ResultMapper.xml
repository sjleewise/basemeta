<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.dq.result.service.ResultMapper" >
	<resultMap id="BaseResultMap" type="kr.wise.dq.result.service.ResultVO">
		<result column="UPP_DQI_LNM"  property="uppDqiLnm"  jdbcType="VARCHAR"  />
		<result column="DQI_LNM"      property="dqiLnm"     jdbcType="VARCHAR"  />
		
		<result column="UPP_DQI_LNM"  property="cntName"    jdbcType="VARCHAR"  />
		<result column="TOT_CNT"      property="totCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_CNT"      property="errCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_RATE"     property="errRate"    jdbcType="VARCHAR"  />
		<result column="NO_EXE"       property="noExe"      jdbcType="VARCHAR"  />
		<result column="COL_CNT"      property="colCnt"     jdbcType="VARCHAR"  />
		<result column="TBL_CNT"      property="tblCnt"     jdbcType="VARCHAR"  />
		<result column="SUM_RATE"     property="sumRate"    jdbcType="VARCHAR"  />
		
		<result column="ANA_STR_DTM"  property="anaStrDtm"  jdbcType="VARCHAR"  />
		<result column="ANA_END_DTM"  property="anaEndDtm"  jdbcType="VARCHAR"  />
		
		<result column="ERR_SQL"  property="errSql"  jdbcType="CLOB"  />
		<result column="DBC_TBL_KOR_NM"  property="dbcTblKorNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_KOR_NM"  property="dbcColKorNm"  jdbcType="VARCHAR"  />
		<result column="PRF_KND_CD"  property="prfKndCd"  jdbcType="VARCHAR"  />
		<result column="PRF_TYP"  property="prfTyp"  jdbcType="VARCHAR"  />
		<result column="PRF_NM"  property="prfNm"  jdbcType="VARCHAR"  />
		<result column="PRF_ID"  property="prfId"  jdbcType="VARCHAR"  />
		<result column="PRF_YN"  property="prfYn"  jdbcType="VARCHAR"  />
		<result column="DATA_TYPE"  property="dataType"  jdbcType="VARCHAR"  />
		<result column="EXP_YN"  property="expYn"  jdbcType="VARCHAR"  />
		<result column="EXP_RSN_CNTN"  property="expRsnCntn"  jdbcType="VARCHAR"  />
		
		<result column="DB_SCH_PNM"  property="dbSchPnm"  jdbcType="VARCHAR"  />
		<result column="DB_SCH_LNM"  property="dbSchLnm"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_NM"  property="dbcTblNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_NM"  property="dbcColNm"  jdbcType="VARCHAR"  />
		
		<result column="STND_RATE"     property="stndRate"    jdbcType="VARCHAR"  />
		<result column="GOAL"     property="goal"    jdbcType="VARCHAR"  />
		
		<result column="PDM_TBL_PNM"     property="pdmTblPnm"    jdbcType="VARCHAR"  />
		<result column="PDM_COL_PNM"     property="pdmColPnm"    jdbcType="VARCHAR"  />
		<result column="DATA_TYPE"     property="dataType"    jdbcType="VARCHAR"  />
		<result column="GAP_STATUS"     property="gapStatus"    jdbcType="VARCHAR"  />
		
		<result column="SDITM_LNM"     property="sditmLnm"    jdbcType="VARCHAR"  />
		<result column="SDITM_PNM"     property="sditmPnm"    jdbcType="VARCHAR"  />
		<result column="OBJ_DESCN"     property="objDescn"    jdbcType="VARCHAR"  />
		<result column="INFOTP_LNM"     property="infotpLnm"    jdbcType="VARCHAR"  />
		
		<result column="DMN_LNM"     property="dmnLnm"    jdbcType="VARCHAR"  />
		<result column="DMN_PNM"     property="dmnPnm"    jdbcType="VARCHAR"  />
		<result column="OBJ_DESCN"     property="objDescn"    jdbcType="VARCHAR"  />
		<result column="DATA_LEN"     property="dataLen"    jdbcType="VARCHAR"  />
		<result column="DATA_SCAL"     property="dataScal"    jdbcType="VARCHAR"  />
		
		<result column="SIGMA"     property="sigma"    jdbcType="VARCHAR"  />
	</resultMap>
  
	<resultMap id="DataResultMap" type="kr.wise.dq.result.service.ResultDataVO">
		<result column="DQI_LNM"      property="dqiLnm"     jdbcType="VARCHAR"  />
		<result column="ANA_CNT"      property="anaCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_CNT"      property="errCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_RATE"     property="errRate"    jdbcType="VARCHAR"  />
		<result column="PRF_KND_CD"  property="prfKndCd"  jdbcType="VARCHAR"  />
		<result column="PRF_NM"  property="prfNm"  jdbcType="VARCHAR"  />
		<result column="PRF_ID"  property="prfId"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_NM"  property="dbcTblNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_NM"  property="dbcColNm"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_KOR_NM"  property="dbcTblKorNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_KOR_NM"  property="dbcColKorNm"  jdbcType="VARCHAR"  />
		
		<result column="RNG"  property="rng" jdbcType="VARCHAR" />
		<result column="DTM"  property="dtm" jdbcType="VARCHAR" />
		<result column="REL"  property="rel" jdbcType="VARCHAR" />
		<result column="PTR"  property="ptr" jdbcType="VARCHAR" />
		<result column="EFVA" property="efva" jdbcType="VARCHAR" />
		<result column="UNQ"  property="unq" jdbcType="VARCHAR" />
		
		<result column="ERR_SQL"  property="errSql"  jdbcType="CLOB"  />
		
		<result column="COL_CNT" property="colCnt" jdbcType="DECIMAL" />
		
		<result column="COL_NM1" property="colNm1" jdbcType="VARCHAR" />
		<result column="COL_NM2" property="colNm2" jdbcType="VARCHAR" />
		<result column="COL_NM3" property="colNm3" jdbcType="VARCHAR" />
		<result column="COL_NM4" property="colNm4" jdbcType="VARCHAR" />
		<result column="COL_NM5" property="colNm5" jdbcType="VARCHAR" />
		<result column="COL_NM6" property="colNm6" jdbcType="VARCHAR" />
		<result column="COL_NM7" property="colNm7" jdbcType="VARCHAR" />
		<result column="COL_NM8" property="colNm8" jdbcType="VARCHAR" />
		<result column="COL_NM9" property="colNm9" jdbcType="VARCHAR" />
		<result column="COL_NM10" property="colNm10" jdbcType="VARCHAR" />
		
		<result column="COL_NM11" property="colNm11" jdbcType="VARCHAR" />
		<result column="COL_NM12" property="colNm12" jdbcType="VARCHAR" />
		<result column="COL_NM13" property="colNm13" jdbcType="VARCHAR" />
		<result column="COL_NM14" property="colNm14" jdbcType="VARCHAR" />
		<result column="COL_NM15" property="colNm15" jdbcType="VARCHAR" />
		<result column="COL_NM16" property="colNm16" jdbcType="VARCHAR" />
		<result column="COL_NM17" property="colNm17" jdbcType="VARCHAR" />
		<result column="COL_NM18" property="colNm18" jdbcType="VARCHAR" />
		<result column="COL_NM19" property="colNm19" jdbcType="VARCHAR" />
		<result column="COL_NM20" property="colNm20" jdbcType="VARCHAR" />
		
		<result column="COL_NM21" property="colNm21" jdbcType="VARCHAR" />
		<result column="COL_NM22" property="colNm22" jdbcType="VARCHAR" />
		<result column="COL_NM23" property="colNm23" jdbcType="VARCHAR" />
		<result column="COL_NM24" property="colNm24" jdbcType="VARCHAR" />
		<result column="COL_NM25" property="colNm25" jdbcType="VARCHAR" />
		<result column="COL_NM26" property="colNm26" jdbcType="VARCHAR" />
		<result column="COL_NM27" property="colNm27" jdbcType="VARCHAR" />
		<result column="COL_NM28" property="colNm28" jdbcType="VARCHAR" />
		<result column="COL_NM29" property="colNm29" jdbcType="VARCHAR" />
		<result column="COL_NM30" property="colNm30" jdbcType="VARCHAR" />
		
		<result column="COL_NM31" property="colNm31" jdbcType="VARCHAR" />
		<result column="COL_NM32" property="colNm32" jdbcType="VARCHAR" />
		<result column="COL_NM33" property="colNm33" jdbcType="VARCHAR" />
		<result column="COL_NM34" property="colNm34" jdbcType="VARCHAR" />
		<result column="COL_NM35" property="colNm35" jdbcType="VARCHAR" />
		<result column="COL_NM36" property="colNm36" jdbcType="VARCHAR" />
		<result column="COL_NM37" property="colNm37" jdbcType="VARCHAR" />
		<result column="COL_NM38" property="colNm38" jdbcType="VARCHAR" />
		<result column="COL_NM39" property="colNm39" jdbcType="VARCHAR" />
		<result column="COL_NM40" property="colNm40" jdbcType="VARCHAR" />
		
		<result column="COL_NM41" property="colNm41" jdbcType="VARCHAR" />
		<result column="COL_NM42" property="colNm42" jdbcType="VARCHAR" />
		<result column="COL_NM43" property="colNm43" jdbcType="VARCHAR" />
		<result column="COL_NM44" property="colNm44" jdbcType="VARCHAR" />
		<result column="COL_NM45" property="colNm45" jdbcType="VARCHAR" />
		<result column="COL_NM46" property="colNm46" jdbcType="VARCHAR" />
		<result column="COL_NM47" property="colNm47" jdbcType="VARCHAR" />
		<result column="COL_NM48" property="colNm48" jdbcType="VARCHAR" />
		<result column="COL_NM49" property="colNm49" jdbcType="VARCHAR" />
		<result column="COL_NM50" property="colNm50" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="MultiDimResultMap" type="kr.wise.dq.result.service.MultiDimVO" extends="kr.wise.dq.bizrule.service.WamBrResultMapper.BaseResultMap">
	    <id column="BR_ID" property="brId" jdbcType="VARCHAR" />
	    <result column="BR_NM" property="brNm" jdbcType="VARCHAR" />
	    <result column="DB_CONN_TRG_ID" property="dbConnTrgId" jdbcType="VARCHAR" />
	    <result column="DB_SCH_ID" property="dbSchId" jdbcType="VARCHAR" />
	    <result column="DB_SCH_LNM" property="dbSchLnm" jdbcType="VARCHAR" />
	    <result column="DB_SCH_PNM" property="dbSchPnm" jdbcType="VARCHAR" />
	    <result column="DBC_TBL_NM" property="dbcTblNm" jdbcType="VARCHAR" />
	    <result column="DBC_COL_NM" property="dbcColNm" jdbcType="VARCHAR" />
	
	    <result column="BR_CRGP_USER_ID" property="brCrgpUserId" jdbcType="VARCHAR" />
	    <result column="BR_CRGP_USER_NM" property="brCrgpUserNm" jdbcType="VARCHAR" />
	    <result column="AGR_NV" property="agrNv" jdbcType="DECIMAL" />
	    <result column="GL_NV" property="glNv" jdbcType="DECIMAL" />
	    <result column="USE_YN" property="useYn" jdbcType="VARCHAR" />
	    <result column="TGT_DB_CONN_TRG_ID" property="tgtDbConnTrgId" jdbcType="VARCHAR" />
	    <result column="TGT_DB_CONN_TRG_PNM" property="tgtDbConnTrgPnm" jdbcType="VARCHAR" />
	    <result column="TGT_DB_SCH_ID" property="tgtDbSchId" jdbcType="VARCHAR" />
	    <result column="TGT_DBC_TBL_NM" property="tgtDbcTblNm" jdbcType="VARCHAR" />
	    <result column="TGT_DBC_COL_NM" property="tgtDbcColNm" jdbcType="VARCHAR" />
	    <result column="TGT_KEY_DBC_COL_NM" property="tgtKeyDbcColNm" jdbcType="VARCHAR" />
	    <result column="TGT_KEY_DBC_COL_VAL" property="tgtKeyDbcColVal" jdbcType="VARCHAR" />
	    <result column="TGT_VRF_JOIN_CD" property="tgtVrfJoinCd" jdbcType="VARCHAR" />
	    
	    <result column="DB_CONN_TRG_PNM" property="dbConnTrgPnm" jdbcType="VARCHAR" />
	    <result column="DB_CONN_TRG_LNM" property="dbConnTrgLnm" jdbcType="VARCHAR" />
	    <result column="DQI_ID" property="dqiId" jdbcType="VARCHAR" />
	    <result column="DQI_LNM" property="dqiLnm" jdbcType="VARCHAR" />
	    <result column="UPP_DQI_LNM" property="uppDqiLnm" jdbcType="VARCHAR" />
	    <result column="CTQ_ID" property="ctqId" jdbcType="VARCHAR" />
	    <result column="CTQ_LNM" property="ctqLnm" jdbcType="VARCHAR" />
	    <result column="BASE_DTTM" property="baseDttm" jdbcType="VARCHAR" />
	    <result column="ANA_DGR_DISP" property="anaDgrDisp" jdbcType="VARCHAR" />
	    <result column="ER_RATE" property="erRate" jdbcType="VARCHAR" />
	    <result column="DPMO" property="dpmo" jdbcType="VARCHAR" />
	    <result column="SIGMA" property="sigma" jdbcType="VARCHAR" />
	    <result column="ER_YN" property="erYn" jdbcType="VARCHAR" />
	    
	    <result column="ANA_JOB_ID" property="anaJobId" jdbcType="VARCHAR" />
	    <result column="ANA_JOB_NM" property="anaJobNm" jdbcType="VARCHAR" />
	    <result column="ANA_KND_CD" property="anaKndCd" jdbcType="VARCHAR" />
	    
	    <result column="SHD_JOB_ID" property="shdJobId" jdbcType="VARCHAR" />
	    <result column="ETC_JOB_NM" property="etcJobNm" jdbcType="VARCHAR" />
	    
	    <result column="ANA_TYP" property="anaTyp" jdbcType="VARCHAR" />
	    <result column="WEIGHT" property="weight" jdbcType="DECIMAL" />
	    <result column="GOAL" property="goal" jdbcType="DECIMAL" />
	    <result column="ANA_DGR_DISP" property="anaDgrDisp" jdbcType="DECIMAL" />
	    <result column="ARCH_RATE" property="archRate" jdbcType="DECIMAL" />
	    
	    <result column="ANA_CNT" property="anaCnt" jdbcType="VARCHAR" />
	    
	    <result column="ANA_CNT2" property="anaCnt2" jdbcType="VARCHAR" />
	    <result column="ER_CNT2" property="erCnt2" jdbcType="DECIMAL" />
	    <result column="ER_RATE2" property="erRate2" jdbcType="VARCHAR" />
	    <result column="ANA_CNT3" property="anaCnt3" jdbcType="VARCHAR" />
	    <result column="ER_CNT3" property="erCnt3" jdbcType="DECIMAL" />
	    <result column="ER_RATE3" property="erRate3" jdbcType="VARCHAR" />
	    
	    
	  </resultMap>
	  
	  

<select id="selectResultList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
  SELECT CASE WHEN B.NO = 1 THEN A.UPP_DQI_LNM ELSE '값진단종합결과' END AS UPP_DQI_LNM 
       , CASE WHEN B.NO = 1 THEN A.DQI_LNM END AS DQI_LNM
       , SUM(A.TBL_CNT ) AS TBL_CNT    
	   , SUM(A.COL_CNT ) AS COL_CNT 
       , SUM(A.ERR_CNT ) AS ERR_CNT 
       , NVL(ROUND(SUM(A.ERR_CNT ) / NULLIF(SUM(A.TOT_CNT ),0) * 100, 4),0) AS ERR_RATE 
       , SUM(A.TOT_CNT ) AS TOT_CNT 
       , SUM(A.NO_EXE  ) AS NO_EXE 
  	   , CASE WHEN B.NO = 2 THEN NULL ELSE SUM(A.SUM_RATE) END AS SUM_RATE
  	   , ROUND(100 - (SUM(A.ERR_CNT ) / NULLIF(SUM(A.TOT_CNT ),0) * 100), 4) AS STND_RATE
  	   , MAX(A.GOAL) AS GOAL
  	   , CASE WHEN B.NO = 1 THEN TO_CHAR (ROUND (WDQ_FC_SIGMA (WDQ_FC_DPMO (SUM(A.ERR_CNT), SUM(A.TOT_CNT))),2)) END AS SIGMA
    FROM (
  SELECT DQI.UPP_DQI_LNM AS UPP_DQI_LNM
	   , DQI.DQI_LNM
	   , S.TBL_CNT
	   , S.COL_CNT
       , S.ERR_CNT
       , S.ERR_RATE
       , S.TOT_CNT
       , S.NO_EXE
  	   , ROUND(S.ERR_RATE * 100 / SUM(S.ERR_RATE) OVER (),2) AS SUM_RATE
  	   , DQI.GOAL
  	   , ANA_STR_DTM
  	   , ANA_END_DTM
  	 FROM 
  	   (SELECT B.DQI_LNM AS UPP_DQI_LNM   
	         , A.DQI_LNM
	         , A.GOAL
	      FROM WAM_DQI A
	           INNER JOIN WAM_DQI B
	              ON B.DQI_ID = A.UPP_DQI_ID
	     WHERE 1 = 1        
  	   ) DQI
  	   LEFT JOIN    	    
  	   (  	   
	   SELECT UPP_DQI_LNM
	        , DQI_LNM
			, COUNT(DISTINCT DB_CONN_TRG_PNM||DB_SCH_PNM||DBC_TBL_NM) AS TBL_CNT
			, COUNT(DISTINCT DB_CONN_TRG_PNM||DB_SCH_PNM||DBC_TBL_NM||DBC_COL_NM) AS COL_CNT
		    , SUM(ESN_ER_CNT)            AS ERR_CNT
		    , ROUND((SUM(ESN_ER_CNT) / NULLIF(SUM(ANA_CNT),0)) * 100, 2) AS ERR_RATE
		    , SUM(ANA_CNT)               AS TOT_CNT
		    , COUNT(ANA_STR_DTM)         AS NO_EXE
		    , GOAL
		    , ANA_STR_DTM
			, ANA_END_DTM
		FROM (		     
			    SELECT A.PRF_ID
					 , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , A.ANA_END_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM   
					 , B.DBC_TBL_NM
					 , B.OBJ_NM AS DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / NULLIF(A.ANA_CNT,0) * 100, 4) AS ER_RATE
					 , 'PT01' AS PRF_KND_CD
					 , DQI.GOAL
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						  ON B.REG_TYP_CD IN ('C', 'U')
						 AND B.PRF_ID = A.PRF_ID
						 AND B.PRF_KND_CD IN ('PC02', 'PC03', 'PC04', 'PC05')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   LEFT JOIN WAM_PRF_DQI_MAP E
						 ON E.PRF_ID = B.PRF_ID
					   LEFT JOIN WAM_DQI DQI
						 ON E.DQI_ID = DQI.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U') 
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
				 WHERE  1 = 1  
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )   
				   AND NVL(EX.EXP_YN,'N')='N'     
				   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="searchBgnDe != null and searchBgnDe != ''" >
			       		<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
				    </if>
				    <if test="searchEndDe != null and searchEndDe != ''" >
				       <![CDATA[  AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
				    </if>
				UNION ALL
				SELECT A.PRF_ID
					 , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , A.ANA_END_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM   
					 , B.DBC_TBL_NM AS DBC_TBL_NM
					 , B.OBJ_NM AS DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / NULLIF(A.ANA_CNT,0) * 100, 4) AS ER_RATE
					 , 'PT01' AS PRF_KND_CD
					 , DQI.GOAL
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						  ON B.REG_TYP_CD IN ('C', 'U')
						 AND B.PRF_ID = A.PRF_ID
						 AND B.PRF_KND_CD = 'PT01'
				--	   INNER JOIN WAM_PRF_REL_COL COL
				--	      ON COL.PRF_ID = B.PRF_ID
				--		 AND COL.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
				--		 AND C.DB_SCH_ID = RCOL.CH_TBL_DBC_SCH_ID
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
					   LEFT JOIN WAM_PRF_DQI_MAP E
						 ON E.PRF_ID = B.PRF_ID
					   LEFT JOIN WAM_DQI DQI
						 ON E.DQI_ID = DQI.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U') 
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
				 WHERE  1 = 1  
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )   
				   AND NVL(EX.EXP_YN,'N')='N'     
				   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="searchBgnDe != null and searchBgnDe != ''" >
			       		<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
				    </if>
				    <if test="searchEndDe != null and searchEndDe != ''" >
				       <![CDATA[  AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
				    </if>
				UNION ALL
				SELECT A.PRF_ID
					 , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , A.ANA_END_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM   
					 , B.DBC_TBL_NM
					 , B.OBJ_NM AS DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / NULLIF(A.ANA_CNT,0) * 100, 4) AS ER_RATE
					 , 'PT01' AS PRF_KND_CD
					 , DQI.GOAL
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						  ON B.REG_TYP_CD IN ('C', 'U')
						 AND B.PRF_ID = A.PRF_ID
						 AND B.PRF_KND_CD = 'PT02'
				--	   INNER JOIN WAM_PRF_UNQ_COL COL
				--	      ON COL.PRF_ID = B.PRF_ID
				--		 AND COL.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   LEFT JOIN WAM_PRF_DQI_MAP E
						 ON E.PRF_ID = B.PRF_ID
					   LEFT JOIN WAM_DQI DQI
						 ON E.DQI_ID = DQI.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U') 
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
				 WHERE  1 = 1  
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )   
				   AND NVL(EX.EXP_YN,'N')='N'     
				   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="searchBgnDe != null and searchBgnDe != ''" >
			       		<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
				    </if>
				    <if test="searchEndDe != null and searchEndDe != ''" >
				       <![CDATA[  AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
				    </if>
			    UNION ALL     
				SELECT A.BR_ID
				     , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , A.ANA_END_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM
					 , B.DBC_TBL_NM
					 , B.DBC_COL_NM
					 , A.ANA_CNT
					 , A.ER_CNT AS ESN_ER_CNT
					 , ROUND(A.ER_CNT / NULLIF(A.ANA_CNT,0) * 100, 4) AS ER_RATE
					 , 'BR' AS PRF_KND_CD
					 , DQI.GOAL
				  FROM WAM_BR_RESULT A
					   INNER JOIN WAM_BR_MSTR B
						  ON B.BR_ID = A.BR_ID
						 AND B.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   LEFT JOIN WAM_BR_DQI_MAP M
					     ON M.BR_ID = B.BR_ID	 
					   LEFT JOIN WAM_DQI DQI
						 ON DQI.DQI_ID = M.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
				 WHERE  1 = 1     
				   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
													  FROM WAM_BR_RESULT
													GROUP BY BR_ID 
													)
		           AND NVL(EX.EXP_YN,'N')='N'     
					<if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
					</if>
					<if test="searchBgnDe != null  and searchBgnDe != ''" >
			       		<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
				    </if>
				    <if test="searchEndDe != null  and searchEndDe != ''" >
				       <![CDATA[  AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
				    </if>       
		 ) X
		 GROUP BY UPP_DQI_LNM
		        , DQI_LNM
		        , GOAL
		        , ANA_STR_DTM
		        , ANA_END_DTM
      ) S
      ON DQI.DQI_LNM = S.DQI_LNM 		        
 WHERE 1 = 1
 ) A
 LEFT JOIN
 (SELECT 1 AS NO FROM DUAL
   UNION
  SELECT 2 AS NO FROM DUAL 
 ) B
 ON 1 = 1
 WHERE 1 = 1
 GROUP BY CASE WHEN B.NO = 1 THEN A.UPP_DQI_LNM ELSE '값진단종합결과' END
        , CASE WHEN B.NO = 1 THEN A.DQI_LNM END     
        , B.NO
  ORDER BY B.NO
          ,UPP_DQI_LNM
          ,DQI_LNM
<!--          , CASE WHEN DQI_LNM = '관계키'  THEN 1 -->
<!--                 WHEN DQI_LNM = '필수값'  THEN 2 -->
<!--                 WHEN DQI_LNM = '금액'   THEN 3 -->
<!--                 WHEN DQI_LNM = '날짜'   THEN 4 -->
<!--                 WHEN DQI_LNM = '수량'   THEN 5 -->
<!--                 WHEN DQI_LNM = '여부'   THEN 6 -->
<!--                 WHEN DQI_LNM = '율'    THEN 7 -->
<!--                 WHEN DQI_LNM = '코드'   THEN 8 -->
<!--                 WHEN DQI_LNM = '계산 및 집계'  THEN 9 -->
<!--                 WHEN DQI_LNM = '시간순서'  THEN 10 -->
<!--                 WHEN DQI_LNM = '컬럼 간 논리관계'  THEN 11 -->
<!--                 WHEN DQI_LNM = '명칭'  THEN 12 -->
<!--                 WHEN DQI_LNM = '번호'  THEN 13 -->
<!--             END  -->
 
</select>

<select id="selectDtm" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT MIN(STR_DTM) AS ANA_STR_DTM
	      ,MAX(END_DTM) AS ANA_END_DTM
	  FROM (
	  (SELECT MIN(A.ANA_STR_DTM) AS STR_DTM
	     , MAX(A.ANA_END_DTM) AS END_DTM
	  FROM WAM_PRF_RESULT A
	       INNER JOIN WAM_PRF_MSTR B
	          ON B.REG_TYP_CD IN ('C', 'U')
	         AND B.PRF_ID = A.PRF_ID
	       INNER JOIN WAA_DB_SCH C
	          ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	         AND C.REG_TYP_CD IN ('C', 'U')
	         AND C.DB_SCH_ID = B.DB_SCH_ID 
	       INNER JOIN WAA_DB_CONN_TRG D
	          ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	         AND D.REG_TYP_CD IN ('C', 'U')
	         AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
	       LEFT JOIN WAM_PRF_DQI_MAP E
	         ON E.PRF_ID = B.PRF_ID
	       LEFT JOIN WAM_DQI DQI
	         ON E.DQI_ID = DQI.DQI_ID 
	        AND DQI.REG_TYP_CD IN ('C', 'U')
	       LEFT JOIN WAM_DQI U
	         ON U.DQI_ID = DQI.UPP_DQI_ID
	        AND U.REG_TYP_CD IN ('C', 'U') 
	       LEFT JOIN WAA_EXP_TBL EX          
		     ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		    AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
	                                       FROM WAM_PRF_RESULT
	                                      GROUP BY PRF_ID 
	                                     )
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="searchBgnDe != null and searchBgnDe != ''" >
			<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		</if>
		<if test="searchEndDe != null and searchEndDe != ''">
		    <![CDATA[  AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		</if>    
		)
	  UNION ALL
	  (SELECT MIN(A.ANA_STR_DTM) AS STR_DTM
	     , MAX(A.ANA_END_DTM) AS END_DTM
	  FROM WAM_BR_RESULT A
	       INNER JOIN WAM_BR_MSTR B
	          ON B.BR_ID = A.BR_ID
	         AND B.REG_TYP_CD IN ('C', 'U')
	       INNER JOIN WAA_DB_SCH C
	          ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	         AND C.REG_TYP_CD IN ('C', 'U')
	         AND C.DB_SCH_ID = B.DB_SCH_ID 
	       INNER JOIN WAA_DB_CONN_TRG D
	          ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	         AND D.REG_TYP_CD IN ('C', 'U')
	         AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
	       LEFT JOIN WAM_BR_DQI_MAP M
	         ON M.BR_ID = B.BR_ID	 
	       LEFT JOIN WAM_DQI DQI
	         ON DQI.DQI_ID = M.DQI_ID 
	        AND DQI.REG_TYP_CD IN ('C', 'U')
	       LEFT JOIN WAM_DQI U
	         ON U.DQI_ID = DQI.UPP_DQI_ID
	        AND U.REG_TYP_CD IN ('C', 'U')
	       LEFT JOIN WAA_EXP_TBL EX          
			 ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1    
	   AND NVL(EX.EXP_YN, 'N') = 'N' 
	   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
	                                      FROM WAM_BR_RESULT
	                                    GROUP BY BR_ID 
	                                    )
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="searchBgnDe != null and searchBgnDe != ''" >
	    <![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	   </if>
	   <if test="searchEndDe != null and searchEndDe != ''">
	    <![CDATA[  AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	   </if>    
		)
	  )
</select>

<select id="selectTotCnt" resultType="java.math.BigDecimal" parameterType="kr.wise.dq.result.service.ResultVO">
SELECT COUNT(*) AS TOT_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_PRF_MSTR PRF
    ON PRF.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND PRF.DB_SCH_ID = SCH.DB_SCH_ID
   AND PRF.PRF_KND_CD != 'PC01'
  LEFT OUTER JOIN WAM_PRF_RESULT PRFR
    ON PRFR.PRF_ID = PRF.PRF_ID
  LEFT OUTER JOIN WAM_BR_MSTR BR
    ON BR.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND BR.DB_SCH_ID = SCH.DB_SCH_ID
  LEFT OUTER JOIN WAM_BR_RESULT BRR
    ON BRR.BR_ID = BR.BR_ID
 WHERE DB.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
   AND DB.REG_TYP_CD IN ('C', 'U')
   AND (PRFR.PRF_ID, PRFR.ANA_STR_DTM) IN (SELECT 
   												PRF_ID, 
   												MAX(ANA_STR_DTM)
	                                       FROM WAM_PRF_RESULT
	                                       GROUP BY PRF_ID 
	                                      )
   AND (BRR.BR_ID, BRR.ANA_STR_DTM) IN (SELECT 
   												BR_ID, 
   												MAX(ANA_STR_DTM)
	                                       FROM WAM_BR_RESULT
	                                       GROUP BY BR_ID 
	                                    )
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR SCH.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (PRF.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR PRF.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
   	AND (BR.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR BR.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (PRF.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR PRF.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
   	AND (BR.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR BR.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="searchBgnDe != null and searchBgnDe != ''" >
	<![CDATA[ AND TO_DATE(PRFR.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
   </if>
   <if test="searchEndDe != null and searchEndDe != ''">
    <![CDATA[  AND TO_DATE(PRFR.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
   </if>
   <if test="searchBgnDe != null and searchBgnDe != ''" >
    <![CDATA[ AND TO_DATE(BRR.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
   </if>
   <if test="searchEndDe != null and searchEndDe != ''">
    <![CDATA[  AND TO_DATE(BRR.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
   </if>
</select>

<select id="selectRunCnt" resultType="java.math.BigDecimal" parameterType="kr.wise.dq.result.service.ResultVO">
SELECT SUM(RUN_CNT) AS TOT_CNT 
  FROM ( 
SELECT COUNT(*) AS RUN_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_PRF_MSTR PRF
    ON PRF.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND PRF.DB_SCH_ID = SCH.DB_SCH_ID
   AND PRF.PRF_KND_CD != 'PC01'
  INNER JOIN WAM_PRF_RESULT PR
    ON PR.PRF_ID = PRF.PRF_ID
  INNER JOIN (SELECT PRF_ID, MAX(ANA_STR_DTM) AS ANA_STR_DTM
                         FROM WAM_PRF_RESULT
                       GROUP BY PRF_ID ) R1
           ON R1.PRF_ID = PR.PRF_ID
          AND R1.ANA_STR_DTM = PR.ANA_STR_DTM
 WHERE DB.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR SCH.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (PRF.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR PRF.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (PRF.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR PRF.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="searchBgnDe != null and searchBgnDe != ''" >
	<![CDATA[ AND TO_DATE(PR.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
   </if>
   <if test="searchEndDe != null and searchEndDe != ''">
    <![CDATA[  AND TO_DATE(PR.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
   </if>
UNION ALL
SELECT COUNT(*) AS RUN_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_BR_MSTR BR
    ON BR.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND BR.DB_SCH_ID = SCH.DB_SCH_ID
 INNER JOIN WAM_BR_RESULT BRES
    ON BRES.BR_ID = BR.BR_ID
 INNER JOIN (SELECT BR_ID, MAX(ANA_STR_DTM) AS ANA_STR_DTM
                         FROM WAM_BR_RESULT
                       GROUP BY BR_ID ) R2
           ON R2.BR_ID = BRES.BR_ID
          AND R2.ANA_STR_DTM = BRES.ANA_STR_DTM
 WHERE DB.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR SCH.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (BR.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR BR.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (BR.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR BR.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
   </if>
   <if test="searchBgnDe != null and searchBgnDe != ''" >
	<![CDATA[ AND TO_DATE(BRES.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
   </if>
   <if test="searchEndDe != null and searchEndDe != ''">
    <![CDATA[  AND TO_DATE(BRES.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
   </if>
   )
</select>

<select id="selectTblList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	-- SHEET 2 테이블목록
	-- 번호	 SCHEMA	 테이블	         테이블(한글)	    수집여부	진단여부	제외사유	    관련 검토기준
	-- 1	OO_USER	 AA_AAA_BBBB	자료실 조회 기록	Y	     N	    미사용테이블	
	
	SELECT DISTINCT A.DB_SCH_PNM AS DB_SCH_PNM
	    --  ,A.DB_SCH_LNM AS DB_SCH_LNM
	      ,B.DBC_TBL_NM AS DBC_TBL_NM
	      ,NVL(B.DBC_TBL_KOR_NM, B.DBC_TBL_NM) AS DBC_TBL_KOR_NM
	      ,NVL(E.EXP_YN, 'N') AS EXP_YN
	      ,CASE WHEN (D.PRF_ID IS NULL AND G.BR_ID IS NULL) 
	            THEN 'N' 
	            ELSE 'Y'
	            END AS PRF_YN
	      ,E.EXP_RSN_CNTN AS EXP_RSN_CNTN
	    --  ,'' AS DESCN
	  FROM WAA_DB_SCH A
	 INNER JOIN WAT_DBC_TBL B
	    ON B.DB_SCH_ID = A.DB_SCH_ID
	  LEFT OUTER JOIN WAM_PRF_MSTR C
	    ON C.DB_SCH_ID = B.DB_SCH_ID
	   AND C.DBC_TBL_NM = B.DBC_TBL_NM
	   AND C.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_PRF_RESULT D
	    ON D.PRF_ID = C.PRF_ID
	  LEFT OUTER JOIN WAM_PRF_DQI_MAP PDQIMAP
	    ON PDQIMAP.PRF_ID = C.PRF_ID
	  LEFT OUTER JOIN WAM_BR_MSTR F
	    ON F.DB_SCH_ID = B.DB_SCH_ID
	   AND F.DBC_TBL_NM = B.DBC_TBL_NM
	   AND F.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_BR_RESULT G
	    ON G.BR_ID = F.BR_ID
	  LEFT OUTER JOIN WAM_BR_DQI_MAP BDQIMAP
	    ON BDQIMAP.BR_ID = F.BR_ID
	  LEFT OUTER JOIN WAA_EXP_TBL E
	    ON E.DB_SCH_ID = B.DB_SCH_ID
	   AND E.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE 1=1
	 	AND C.PRF_KND_CD != 'PC01'
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND A.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (A.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR A.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   
	   AND ((TO_DATE(D.ANA_STR_DTM) BETWEEN TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') AND TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1)
	   OR (TO_DATE(G.ANA_STR_DTM) BETWEEN TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') AND TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1))
	   
	 ORDER BY A.DB_SCH_PNM, B.DBC_TBL_NM
</select>

<select id="selectDmnRule" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	-- SHEET 3 도메인규칙
	-- 번호	테이블명	                    한글테이블명	컬럼명	        한글컬럼명	데이터타입	검증유형	도메인	검증기준ID	검증기준명	검증형식	            분류코드	          제외데이터	제외데이터 구분자	도메인 검토내역	관련 검토기준	제외사유
	-- 1	NEWS_USER.BATCH_JOB_INFO	배치 잡 정보	BJI_STAT_CODE	상태	        CHAR(1)	    코드	    코드	    A10024	    공통코드		                    batch_job_status
	-- 2	NEWS_USER.BATCH_JOB_INFO	배치 잡 정보	BJI_REGI_DATE	등록일	    DATE(7)	    날짜	    날짜	    A10008	    년월일시분초	YYYYMMDDHH24MISS						
	
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,A.OBJ_NM AS DBC_COL_NM
	      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,E.DATA_TYPE || '(' || E.DATA_LEN || ')' AS DATA_TYPE
	      ,GET_CMCD_DTL_NM('PRF_KND_CD', A.PRF_KND_CD) AS PRF_KND_CD
	      ,DQI.DQI_LNM AS DQI_LNM
	      ,A.PRF_ID AS PRF_ID
	      ,A.PRF_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	   --   ,'' AS 분류코드
	   --   ,'' AS 제외데이터
	   --   ,'' AS 제외데이터_구분자
	   --   ,'' AS 도메인_검토내역
	   --   ,'' AS 관련_검토기준
	   --   ,'' AS 제외사유
	  FROM WAM_PRF_MSTR A
	 INNER JOIN WAM_PRF_RESULT B
	    ON B.PRF_ID = A.PRF_ID
	  LEFT OUTER JOIN WAM_PRF_DQI_MAP WPDM
	    ON WPDM.PRF_ID = B.PRF_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	  LEFT JOIN WAA_EXP_TBL EX          
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND A.PRF_KND_CD != 'PC01'
	   AND DQI.DQI_LNM IS NOT NULL
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR E.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	   </if>
	 ORDER BY  A.PRF_ID
	 		  ,A.PRF_NM
	 		  ,D.DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM
		      ,E.DBC_COL_NM
		      ,E.DBC_COL_KOR_NM
	UNION ALL
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,A.DBC_COL_NM AS DBC_COL_NM
	      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,E.DATA_TYPE || '(' || E.DATA_LEN || ')' AS DATA_TYPE
	      ,'업무규칙' AS PRF_KND_CD
	      ,DQI.DQI_LNM AS DQI_LNM
	      ,A.BR_ID AS PRF_ID
	      ,A.BR_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	    --  ,'' AS 분류코드
	    --  ,'' AS 제외데이터
	    --  ,'' AS 제외데이터_구분자
	    --  ,'' AS 도메인_검토내역
	    --  ,'' AS 관련_검토기준
	    --  ,'' AS 제외사유
	  FROM WAM_BR_MSTR A
	 INNER JOIN WAM_BR_RESULT B
	    ON B.BR_ID = A.BR_ID
	  LEFT OUTER JOIN WAM_BR_DQI_MAP WPDM
	    ON WPDM.BR_ID = B.BR_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	   AND E.DBC_COL_NM = A.DBC_COL_NM
	  LEFT JOIN WAA_EXP_TBL EX          
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND DQI.DQI_LNM IS NOT NULL
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR B.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR E.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	   </if>
	 ORDER BY  A.BR_ID
	 		  ,A.BR_NM
	 		  ,D.DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM
		      ,E.DBC_COL_NM
		      ,E.DBC_COL_KOR_NM
</select>

<select id="selectExecList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	-- SHEET 4 실행목록
	-- 번호	테이블명	                    컬럼명	        검증유형	검증기준ID	검증기준명	 검증형식	                        실행여부
	-- 1	NEWS_USER.BATCH_JOB_INFO	BJI_SERVER_ID	참조	    C99999	    참조값	     NEWS_USER.BATCH_SERVER_INFO	Y
	-- 2	NEWS_USER.BATCH_JOB_INFO	BJI_APPL_DATE	날짜	    A10008	    년월일시분초	 YYYYMMDDHH24MISS	            Y
	SELECT DISTINCT *
	  FROM (
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,CASE WHEN A.PRF_KND_CD = 'PT01' THEN (SELECT LISTAGG(RCOL.CH_TBL_DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
												     FROM WAM_PRF_MSTR M
												    INNER JOIN WAM_PRF_REL_COL RCOL
												       ON RCOL.PRF_ID = M.PRF_ID
												    WHERE M.PRF_KND_CD = 'PT01'
												      AND B.PRF_ID = M.PRF_ID
												    GROUP BY M.PRF_ID)
	            WHEN A.PRF_KND_CD = 'PT02' THEN (SELECT LISTAGG(UCOL.DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
													  FROM WAM_PRF_MSTR M
													 INNER JOIN WAM_PRF_UNQ_COL UCOL
													    ON UCOL.PRF_ID = M.PRF_ID
													 WHERE M.PRF_KND_CD = 'PT02'
													   AND B.PRF_ID = M.PRF_ID
													 GROUP BY M.PRF_ID)
				ELSE A.OBJ_NM
			END AS DBC_COL_NM
	      ,GET_CMCD_DTL_NM('PRF_KND_CD', A.PRF_KND_CD) AS PRF_KND_CD
	      ,A.PRF_ID AS PRF_ID
	      ,A.PRF_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	      ,CASE WHEN B.PRF_ID IS NOT NULL
	            THEN CASE WHEN WPDM.PRF_ID IS NOT NULL
	                      THEN 'Y'
	                      ELSE 'N' END
	            ELSE 'N' END AS PRF_YN
	  FROM WAM_PRF_MSTR A
	  LEFT OUTER JOIN WAM_PRF_RESULT B
	    ON B.PRF_ID = A.PRF_ID
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	  LEFT JOIN WAA_EXP_TBL EX
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAM_PRF_DQI_MAP WPDM
	    ON WPDM.PRF_ID = A.PRF_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	 WHERE 1=1
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND PRF_KND_CD != 'PC01'
	   AND DQI.DQI_LNM IS NOT NULL
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR E.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="searchBgnDe != null and searchBgnDe != ''" >
		<![CDATA[ AND TO_DATE(B.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	   </if>
	   <if test="searchEndDe != null and searchEndDe != ''">
	    <![CDATA[  AND TO_DATE(B.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	   </if>
	UNION ALL
		    SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,B.DBC_COL_NM AS DBC_COL_NM
				,GET_CMCD_DTL_NM('CD_TYP_CD', E.CD_TYP_CD) AS PRF_KND_CD
				,E.CD_RULE_ID AS PRF_ID
				,E.CD_RULE_NM AS PRF_NM
				,'코드' AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAA_COL_RULE_REL B
					  ON B.RULE_REL_ID = A.PRF_ID
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
				   INNER JOIN WAA_CD_RULE E
					  ON E.CD_RULE_ID = B.VRFC_ID  		  
				  LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
			 WHERE  1 = 1  
	           AND NVL(EX.EXP_YN,'N')='N'
			   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="searchBgnDe != null and searchBgnDe != ''" >
				<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
			   </if>
			   <if test="searchEndDe != null and searchEndDe != ''">
			    <![CDATA[  AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
			   </if>
		    UNION ALL     
			SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,B.OBJ_NM AS DBC_COL_NM
				,'참조무결성' AS PRF_KND_CD 
				,B.PRF_ID AS PRF_ID
				,B.PRF_NM AS PRF_NM
				,'관계키' AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN					 
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAM_PRF_MSTR B
					 ON B.PRF_ID = A.PRF_ID
					 AND B.REG_TYP_CD IN ('C', 'U')
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID					   
					LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
			 WHERE  1 = 1  
			   AND B.PRF_KND_CD = 'PT01'
	           AND NVL(EX.EXP_YN,'N')='N'  
	           <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="searchBgnDe != null and searchBgnDe != ''" >
				<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
			   </if>
			   <if test="searchEndDe != null and searchEndDe != ''">
			    <![CDATA[  AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
			   </if>
	UNION ALL			   
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,A.DBC_COL_NM AS DBC_COL_NM
	      ,'업무규칙' AS PRF_KND_CD
	      ,A.BR_ID AS PRF_ID
	      ,A.BR_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	      ,CASE WHEN B.BR_ID IS NOT NULL
	            THEN CASE WHEN WPDM.BR_ID IS NOT NULL
	                      THEN 'Y'
	                      ELSE 'N' END
	            ELSE 'N' END AS PRF_YN
	  FROM WAM_BR_MSTR A
	  LEFT OUTER JOIN WAM_BR_RESULT B
	    ON B.BR_ID = A.BR_ID
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	  LEFT JOIN WAA_EXP_TBL EX          
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAM_BR_DQI_MAP WPDM
	    ON WPDM.BR_ID = A.BR_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	 WHERE 1=1
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND DQI.DQI_LNM IS NOT NULL
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR E.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="searchBgnDe != null and searchBgnDe != ''" >
		<![CDATA[ AND TO_DATE(B.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	   </if>
	   <if test="searchEndDe != null and searchEndDe != ''">
	    <![CDATA[  AND TO_DATE(B.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	   </if>
	 ORDER BY  PRF_ID
	 		  ,PRF_NM
	 		  ,DBC_TBL_NM
		      ,DBC_COL_NM
      )
</select>

<select id="selectErrList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
<!-- 	SHEET 5 오류목록 -->
<!-- 	번호	진단유형	진단룰명	진단테이블(영문)	        진단테이블(한글)	진단칼럼(영문)	 진단칼럼(한글)	전체건수	오류건수	오류율(%)	오류추정건수 SQL -->
<!-- 	1	여부	    여부10	NEWS_USER.CONN_GROUP_IN	연계 유입업체	    CGI_FLAG_ENABLE	 사용여부	        77	    5	    6.49	 -->
<!-- 	2	여부	    여부10	NEWS_USER.CONN_GROUP_IN	연계 유입업체	    CGI_STDXML_YN	 표준XML사용여부	77	    1	    1.30 -->
	SELECT DISTINCT *
	  FROM (
	SELECT DQI.DQI_LNM
		 , GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
		 , B.DBC_TBL_NM AS DBC_TBL_NM
		 , TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		 , COL.DBC_COL_NM AS DBC_COL_NM
		 , COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		 , A.ANA_CNT AS TOT_CNT
		 , A.ESN_ER_CNT AS ERR_CNT
		 ,CASE WHEN A.ANA_CNT= 0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD IN ('PC02', 'PC03', 'PC04', 'PC05')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
		     AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
		      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
		     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
		     AND COL.DBC_COL_NM = B.OBJ_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
		      ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
		      ON E.DQI_ID = DQI.DQI_ID 
		     AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
		      ON U.DQI_ID = DQI.UPP_DQI_ID
		     AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
		      ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		     AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND A.ESN_ER_CNT > 0
	   AND DQI.DQI_LNM IS NOT NULL
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (COL.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR COL.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="searchBgnDe != null and searchBgnDe != ''" >
		 <![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	    </if>
	    <if test="searchEndDe != null and searchEndDe != ''">
	     <![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	    </if>
		
		UNION ALL
		SELECT DQI.DQI_LNM
			 , GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
			 , B.DBC_TBL_NM AS DBC_TBL_NM
			 , TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
			 , (SELECT LISTAGG(RCOL.CH_TBL_DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_REL_COL RCOL
				    ON RCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT01'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
			 , '' AS DBC_COL_KOR_NM
			 , A.ANA_CNT AS TOT_CNT
			 , A.ESN_ER_CNT AS ERR_CNT
			 ,CASE WHEN A.ANA_CNT= 0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD = 'PT01'
	--	   INNER JOIN WAM_PRF_REL_COL RCOL
	--	      ON RCOL.PRF_ID = B.PRF_ID
	--		 AND RCOL.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID
	--		 AND C.DB_SCH_ID = RCOL.CH_TBL_DBC_SCH_ID
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	--		 AND TBL.DBC_TBL_NM = RCOL.CH_TBL_DBC_TBL_NM
	--	   INNER JOIN WAT_DBC_COL COL
	--	      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
	--		 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	--		 AND COL.DBC_COL_NM = RCOL.CH_TBL_DBC_COL_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
			  ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
			  ON E.DQI_ID = DQI.DQI_ID 
			 AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
			  ON U.DQI_ID = DQI.UPP_DQI_ID
			 AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND A.ESN_ER_CNT > 0
	   AND DQI.DQI_LNM IS NOT NULL
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="searchBgnDe != null and searchBgnDe != ''" >
		 <![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	    </if>
	    <if test="searchEndDe != null and searchEndDe != ''">
	     <![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	    </if>
		
					    UNION ALL     
			    SELECT '코드' AS DQI_LNM
					  ,B.VRFC_NM AS PRF_KND_CD
					  ,B.DBC_TBL_NM AS DBC_TBL_NM
					  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
					  ,B.DBC_COL_NM AS DBC_COL_NM
					  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
					  ,A.ANA_CNT AS TOT_CNT
					  ,A.ESN_ER_CNT AS ERR_CNT
					  ,CASE WHEN A.ANA_CNT= 0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAA_COL_RULE_REL B
						  ON B.RULE_REL_ID = A.PRF_ID
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   INNER JOIN WAT_DBC_TBL TBL
                          ON TBL.DB_SCH_ID = C.DB_SCH_ID
						 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
					   INNER JOIN WAT_DBC_COL COL
                          ON COL.DB_SCH_ID = TBL.DB_SCH_ID
						 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
                         AND COL.DBC_TBL_NM = B.DBC_TBL_NM
                         AND COL.DBC_COL_NM = B.DBC_COL_NM
					   INNER JOIN WAA_CD_RULE E
						  ON E.CD_RULE_ID = B.VRFC_ID  		  
					  LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
				 WHERE  1 = 1  
		           AND NVL(EX.EXP_YN,'N')='N'
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )
				<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (COL.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR COL.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="searchBgnDe != null and searchBgnDe != ''" >
			    <![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
			   </if>
		       <if test="searchEndDe != null and searchEndDe != ''">
		        <![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		       </if>
			    UNION ALL     
				SELECT '관계키' AS DQI_LNM
					  ,'참조무결성' AS PRF_KND_CD
					  ,B.DBC_TBL_NM AS DBC_TBL_NM
					  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
					  ,B.OBJ_NM AS DBC_COL_NM
					  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
					  ,A.ANA_CNT AS TOT_CNT
					  ,A.ESN_ER_CNT AS ERR_CNT
					  ,CASE WHEN A.ANA_CNT= 0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						 ON B.PRF_ID = A.PRF_ID
						 AND B.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
					   INNER JOIN WAT_DBC_TBL TBL
                          ON TBL.DB_SCH_ID = C.DB_SCH_ID
						 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
					   INNER JOIN WAT_DBC_COL COL
                          ON COL.DB_SCH_ID = TBL.DB_SCH_ID
						 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
                         AND COL.DBC_TBL_NM = B.DBC_TBL_NM
                         AND COL.DBC_COL_NM = B.OBJ_NM
						LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
				 WHERE  1 = 1  
				   AND B.PRF_KND_CD = 'PT01'
		           AND NVL(EX.EXP_YN,'N')='N'
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )
				<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (COL.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR COL.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="searchBgnDe != null and searchBgnDe != ''" >
		    	 <![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		       </if>
		       <if test="searchEndDe != null and searchEndDe != ''">
		        <![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		       </if>
				UNION ALL
		SELECT DQI.DQI_LNM
			 , GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
			 , B.DBC_TBL_NM AS DBC_TBL_NM
			 , TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
			 , (SELECT LISTAGG(UCOL.DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_UNQ_COL UCOL
				    ON UCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT02'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
			 , '' AS DBC_COL_KOR_NM
			 , A.ANA_CNT AS TOT_CNT
			 , A.ESN_ER_CNT AS ERR_CNT
			 ,CASE WHEN A.ANA_CNT= 0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD = 'PT02'
	--	   INNER JOIN WAM_PRF_UNQ_COL COL
	--	      ON COL.PRF_ID = B.PRF_ID
	--		 AND COL.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
		     AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	--	   INNER JOIN WAT_DBC_COL COL
	--	      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
	--	     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	--	     AND COL.DBC_COL_NM = B.OBJ_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
			  ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
			  ON E.DQI_ID = DQI.DQI_ID 
			 AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
			  ON U.DQI_ID = DQI.UPP_DQI_ID
			 AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND A.ESN_ER_CNT > 0
	   AND DQI.DQI_LNM IS NOT NULL
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="searchBgnDe != null and searchBgnDe != ''" >
		 <![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	    </if>
	    <if test="searchEndDe != null and searchEndDe != ''">
	     <![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	    </if>
		UNION ALL
		SELECT DQI.DQI_LNM AS DQI_LNM
		      ,'업무규칙' AS PRF_KND_CD
		      ,A.DBC_TBL_NM AS DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		      ,A.DBC_COL_NM AS DBC_COL_NM
		      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		      ,B.ANA_CNT AS TOT_CNT
		      ,B.ER_CNT AS ERR_CNT
		      ,CASE WHEN B.ANA_CNT= 0 THEN 0 ELSE ROUND(B.ER_CNT*100/B.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_BR_MSTR A
		 INNER JOIN WAM_BR_RESULT B
		    ON B.BR_ID = A.BR_ID
		   AND B.ER_CNT > 0
		 INNER JOIN WAA_DB_SCH C
		    ON C.DB_SCH_ID = A.DB_SCH_ID
		   AND C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		   AND C.REG_TYP_CD IN ('C', 'U')
		 INNER JOIN WAT_DBC_TBL D
		    ON D.DB_SCH_ID = C.DB_SCH_ID
		   AND D.DBC_TBL_NM = A.DBC_TBL_NM
		 INNER JOIN WAT_DBC_COL E
		    ON E.DB_SCH_ID = D.DB_SCH_ID
		   AND E.DBC_TBL_NM = D.DBC_TBL_NM
		   AND E.DBC_COL_NM = A.DBC_COL_NM
		  LEFT OUTER JOIN WAM_BR_DQI_MAP F
		    ON F.BR_ID = A.BR_ID
		   AND F.REG_TYP_CD IN ('C', 'U')
		  LEFT OUTER JOIN WAM_DQI DQI
		    ON DQI.DQI_ID = F.DQI_ID
		   AND DQI.REG_TYP_CD IN ('C', 'U')
		  LEFT JOIN WAA_EXP_TBL EX          
		    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
		   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
		 WHERE A.REG_TYP_CD IN ('C', 'U')
		   AND NVL(EX.EXP_YN, 'N') = 'N'
		   AND (B.BR_ID, B.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
									   FROM WAM_BR_RESULT
									  GROUP BY BR_ID 
									 )
		   AND DQI.DQI_LNM IS NOT NULL
		   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchId != null and dbSchId != ''" >
		   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchPnm != null and dbSchPnm != ''" >
		   	AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		   </if>
		   <if test="dbcTblNm != null and dbcTblNm != ''" >
		   	AND (D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		   </if>
		   <if test="dbcColNm != null and dbcColNm != ''" >
		   	AND (E.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR E.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		   </if>
		   <if test="searchBgnDe != null and searchBgnDe != ''" >
			<![CDATA[ AND TO_DATE(B.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		   </if>
		   <if test="searchEndDe != null and searchEndDe != ''">
		    <![CDATA[ AND TO_DATE(B.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		   </if>
		 ORDER BY  DBC_TBL_NM
			      ,DBC_TBL_KOR_NM
			      ,DBC_COL_NM
			      ,DBC_COL_KOR_NM
		)
</select>

<select id="selectErrListByDqi" resultMap="DataResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT DQI.DQI_LNM
		  ,B.PRF_ID
		  ,B.PRF_NM
		  ,TBL.DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM
		  ,COL.DBC_COL_NM
		  ,COL.DBC_COL_KOR_NM
		  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
		  ,NVL(A.ANA_CNT, 0) AS ANA_CNT
		  ,NVL(A.ESN_ER_CNT, 0) AS ERR_CNT
		  ,CASE WHEN A.ANA_CNT= 0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD IN ('PC02', 'PC03', 'PC04', 'PC05')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
		     AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
		      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
		     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
		     AND COL.DBC_COL_NM = B.OBJ_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
		      ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
		      ON E.DQI_ID = DQI.DQI_ID 
		     AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
		      ON U.DQI_ID = DQI.UPP_DQI_ID
		     AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
		      ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		     AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (COL.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR COL.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="searchBgnDe != null and searchBgnDe != ''" >
			<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		</if>
		<if test="searchEndDe != null and searchEndDe != ''">
			<![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		</if>
		UNION ALL
		SELECT DQI.DQI_LNM
			  ,B.PRF_ID
			  ,B.PRF_NM
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  , (SELECT LISTAGG(RCOL.CH_TBL_DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_REL_COL RCOL
				    ON RCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT01'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
			  ,'' AS DBC_COL_KOR_NM
			  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
			  ,NVL(A.ANA_CNT, 0) AS ANA_CNT
			  ,NVL(A.ESN_ER_CNT, 0) AS ERR_CNT
			  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD = 'PT01'
	--	   INNER JOIN WAM_PRF_REL_COL RCOL
	--	      ON RCOL.PRF_ID = B.PRF_ID
	--		 AND RCOL.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	--	   INNER JOIN WAT_DBC_COL COL
	--	      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
	--		 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	--		 AND COL.DBC_COL_NM = RCOL.CH_TBL_DBC_COL_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
			  ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
			  ON E.DQI_ID = DQI.DQI_ID 
			 AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
			  ON U.DQI_ID = DQI.UPP_DQI_ID
			 AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="searchBgnDe != null and searchBgnDe != ''" >
			<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		</if>
		<if test="searchEndDe != null and searchEndDe != ''">
			<![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		</if>
		UNION ALL
		SELECT DQI.DQI_LNM
			  ,B.PRF_ID
			  ,B.PRF_NM
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  , (SELECT LISTAGG(UCOL.DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_UNQ_COL UCOL
				    ON UCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT02'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
			  ,'' AS DBC_COL_KOR_NM
			  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
			  ,NVL(A.ANA_CNT, 0) AS ANA_CNT
			  ,NVL(A.ESN_ER_CNT, 0) AS ERR_CNT
			  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD = 'PT02'
	--	   INNER JOIN WAM_PRF_UNQ_COL COL
	--	      ON COL.PRF_ID = B.PRF_ID
	--		 AND COL.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
		     AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	--	   INNER JOIN WAT_DBC_COL COL
	--	      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
	--	     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	--	     AND COL.DBC_COL_NM = B.OBJ_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
			  ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
			  ON E.DQI_ID = DQI.DQI_ID 
			 AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
			  ON U.DQI_ID = DQI.UPP_DQI_ID
			 AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		</if>
		<if test="searchBgnDe != null and searchBgnDe != ''" >
			<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		</if>
		<if test="searchEndDe != null and searchEndDe != ''">
			<![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		</if>
		UNION ALL
		SELECT DQI.DQI_LNM AS DQI_LNM
		      ,A.BR_ID AS PRF_ID
		      ,A.BR_NM AS PRF_NM
		      ,A.DBC_TBL_NM AS DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		      ,A.DBC_COL_NM AS DBC_COL_NM
		      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		      ,'업무규칙' AS PRF_KND_CD
		      ,NVL(B.ANA_CNT, 0) AS ANA_CNT
		      ,NVL(B.ER_CNT, 0) AS ERR_CNT
		      ,CASE WHEN B.ANA_CNT=0 THEN 0 ELSE ROUND(B.ER_CNT*100/B.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_BR_MSTR A
		 INNER JOIN WAM_BR_RESULT B
		    ON B.BR_ID = A.BR_ID
		 INNER JOIN WAA_DB_SCH C
		    ON C.DB_SCH_ID = A.DB_SCH_ID
		   AND C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		   AND C.REG_TYP_CD IN ('C', 'U')
		 INNER JOIN WAT_DBC_TBL D
		    ON D.DB_SCH_ID = C.DB_SCH_ID
		   AND D.DBC_TBL_NM = A.DBC_TBL_NM
		 INNER JOIN WAT_DBC_COL E
		    ON E.DB_SCH_ID = D.DB_SCH_ID
		   AND E.DBC_TBL_NM = D.DBC_TBL_NM
		   AND E.DBC_COL_NM = A.DBC_COL_NM
		  LEFT OUTER JOIN WAM_BR_DQI_MAP F
		    ON F.BR_ID = A.BR_ID
		   AND F.REG_TYP_CD IN ('C', 'U')
		  LEFT OUTER JOIN WAM_DQI DQI
		    ON DQI.DQI_ID = F.DQI_ID
		   AND DQI.REG_TYP_CD IN ('C', 'U')
		  LEFT JOIN WAA_EXP_TBL EX          
		    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
		   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
		 WHERE A.REG_TYP_CD IN ('C', 'U')
		   AND NVL(EX.EXP_YN, 'N') = 'N'
		   AND (B.BR_ID, B.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
									   FROM WAM_BR_RESULT
									  GROUP BY BR_ID 
									 )
		   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
		   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchId != null and dbSchId != ''" >
		   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchPnm != null and dbSchPnm != ''" >
		   	AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
		   </if>
		   <if test="dbcTblNm != null and dbcTblNm != ''" >
		   	AND (D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
		   </if>
		   <if test="dbcColNm != null and dbcColNm != ''" >
		   	AND (E.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR E.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
		   </if>
		   <if test="searchBgnDe != null and searchBgnDe != ''" >
			<![CDATA[ AND TO_DATE(B.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		   </if>
		   <if test="searchEndDe != null and searchEndDe != ''">
			<![CDATA[ AND TO_DATE(B.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		   </if>
		 ORDER BY  DBC_TBL_NM
			      ,DBC_TBL_KOR_NM
			      ,DBC_COL_NM
			      ,DBC_COL_KOR_NM
</select>

<select id="selectErrDataMaxColCnt" resultMap="DataResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
		SELECT DISTINCT *
		  FROM (
			SELECT PERR.COL_CNT
			     , B.PRF_KND_CD
			     , B.PRF_ID
			  FROM WAM_PRF_RESULT A
			   INNER JOIN WAM_PRF_MSTR B
				  ON B.REG_TYP_CD IN ('C', 'U')
				 AND B.PRF_ID = A.PRF_ID
				 AND B.PRF_KND_CD = 'PT01'
			   INNER JOIN WAM_PRF_ERR_DATA PERR
				  ON PERR.PRF_ID = B.PRF_ID
				 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
				LEFT JOIN WAM_PRF_DQI_MAP E
				  ON E.PRF_ID = B.PRF_ID
				LEFT JOIN WAM_DQI DQI
				  ON E.DQI_ID = DQI.DQI_ID 
				 AND DQI.REG_TYP_CD IN ('C', 'U')
				LEFT JOIN WAM_DQI U
				  ON U.DQI_ID = DQI.UPP_DQI_ID
				 AND U.REG_TYP_CD IN ('C', 'U') 
				LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
		 WHERE  1 = 1  
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )   
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
		   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
				AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			</if>
			<if test="dbSchId != null and dbSchId != ''" >
				AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			</if>
			<if test="dbSchPnm != null and dbSchPnm != ''" >
				AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
			</if>
			<if test="dbcTblNm != null and dbcTblNm != ''" >
				AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
			</if>
			<if test="dbcColNm != null and dbcColNm != ''" >
				AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
			</if>
		    <if test="searchBgnDe != null and searchBgnDe != ''" >
				<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		    </if>
		    <if test="searchEndDe != null and searchEndDe != ''">
		    	<![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		    </if>
			UNION ALL
			SELECT PERR.COL_CNT
			     , B.PRF_KND_CD
			     , B.PRF_ID
			  FROM WAM_PRF_RESULT A
			   INNER JOIN WAM_PRF_MSTR B
				  ON B.REG_TYP_CD IN ('C', 'U')
				 AND B.PRF_ID = A.PRF_ID
				 AND B.PRF_KND_CD = 'PT02'
			   INNER JOIN WAM_PRF_ERR_DATA PERR
				  ON PERR.PRF_ID = B.PRF_ID
				 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
				LEFT JOIN WAM_PRF_DQI_MAP E
				  ON E.PRF_ID = B.PRF_ID
				LEFT JOIN WAM_DQI DQI
				  ON E.DQI_ID = DQI.DQI_ID 
				 AND DQI.REG_TYP_CD IN ('C', 'U')
				LEFT JOIN WAM_DQI U
				  ON U.DQI_ID = DQI.UPP_DQI_ID
				 AND U.REG_TYP_CD IN ('C', 'U') 
				LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
		 WHERE  1 = 1  
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
		   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
				AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			</if>
			<if test="dbSchId != null and dbSchId != ''" >
				AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			</if>
			<if test="dbSchPnm != null and dbSchPnm != ''" >
				AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
			</if>
			<if test="dbcTblNm != null and dbcTblNm != ''" >
				AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
			</if>
			<if test="dbcColNm != null and dbcColNm != ''" >
				AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
			</if>
		    <if test="searchBgnDe != null and searchBgnDe != ''" >
				<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
		    </if>
		    <if test="searchEndDe != null and searchEndDe != ''">
		    	<![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
		    </if>
			UNION ALL
			SELECT BERR.COL_CNT
			     , 'BR' AS PRF_KND_CD
			     , A.BR_ID AS PRF_ID
			  FROM WAM_BR_MSTR A
			 INNER JOIN WAM_BR_RESULT B
				ON B.BR_ID = A.BR_ID
			 INNER JOIN WAM_BR_ERR_DATA BERR
				ON BERR.BR_ID = A.BR_ID
			   AND BERR.ANA_STR_DTM = B.ANA_STR_DTM
			 INNER JOIN WAA_DB_SCH C
				ON C.DB_SCH_ID = A.DB_SCH_ID
			   AND C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
			   AND C.REG_TYP_CD IN ('C', 'U')
			 INNER JOIN WAT_DBC_TBL D
				ON D.DB_SCH_ID = C.DB_SCH_ID
			   AND D.DBC_TBL_NM = A.DBC_TBL_NM
			 INNER JOIN WAT_DBC_COL E
				ON E.DB_SCH_ID = D.DB_SCH_ID
			   AND E.DBC_TBL_NM = D.DBC_TBL_NM
			   AND E.DBC_COL_NM = A.DBC_COL_NM
			  LEFT OUTER JOIN WAM_BR_DQI_MAP F
				ON F.BR_ID = A.BR_ID
			   AND F.REG_TYP_CD IN ('C', 'U')
			  LEFT OUTER JOIN WAM_DQI DQI
				ON DQI.DQI_ID = F.DQI_ID
			   AND DQI.REG_TYP_CD IN ('C', 'U')
			  LEFT JOIN WAA_EXP_TBL EX          
				ON EX.DB_SCH_ID  = A.DB_SCH_ID  
			   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
			 WHERE A.REG_TYP_CD IN ('C', 'U')
			   AND (B.BR_ID, B.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
											   FROM WAM_BR_RESULT
											  GROUP BY BR_ID 
											 )
			   AND NVL(EX.EXP_YN, 'N') = 'N'
			   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
			   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
				AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
				AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
				AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
				AND (D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
				AND (E.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR E.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
			   </if>
			   <if test="searchBgnDe != null and searchBgnDe != ''" >
				<![CDATA[ AND TO_DATE(B.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
			   </if>
			   <if test="searchEndDe != null and searchEndDe != ''">
			   	<![CDATA[ AND TO_DATE(B.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
			   </if>
		)
</select>

<select id="selectErrDataByDqi" resultMap="DataResultMap" parameterType="map">
<!-- SELECT DISTINCT * -->
<!--   FROM ( -->
	SELECT DQI.DQI_LNM
	  ,B.PRF_ID
	  ,B.PRF_NM
	  ,TBL.DBC_TBL_NM
	  ,TBL.DBC_TBL_KOR_NM
	  ,COL.DBC_COL_NM
	  ,COL.DBC_COL_KOR_NM
	  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
	  ,PERR.COL_NM1 AS COL_NM1
	  ,TO_CHAR(NVL(PERR.COL_NM2, 0)) AS ERR_CNT
  FROM WAM_PRF_RESULT A
	   INNER JOIN WAM_PRF_MSTR B
		  ON B.REG_TYP_CD IN ('C', 'U')
		 AND B.PRF_ID = A.PRF_ID
		 AND B.PRF_KND_CD IN ('PC02', 'PC03', 'PC04', 'PC05')
	   INNER JOIN WAM_PRF_ERR_DATA PERR
		  ON PERR.PRF_ID = B.PRF_ID
		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
		 AND PERR.ESN_ER_DATA_SNO > 0
	   INNER JOIN WAA_DB_SCH C
		  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		 AND C.REG_TYP_CD IN ('C', 'U')
		 AND C.DB_SCH_ID = B.DB_SCH_ID 
	   INNER JOIN WAA_DB_CONN_TRG D
		  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		 AND D.REG_TYP_CD IN ('C', 'U')
		 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
	   INNER JOIN WAT_DBC_TBL TBL
		  ON TBL.DB_SCH_ID = C.DB_SCH_ID
		 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	   INNER JOIN WAT_DBC_COL COL
		  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
		 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
		 AND COL.DBC_COL_NM = B.OBJ_NM
		LEFT JOIN WAM_PRF_DQI_MAP E
		  ON E.PRF_ID = B.PRF_ID
		LEFT JOIN WAM_DQI DQI
		  ON E.DQI_ID = DQI.DQI_ID 
		 AND DQI.REG_TYP_CD IN ('C', 'U')
		LEFT JOIN WAM_DQI U
		  ON U.DQI_ID = DQI.UPP_DQI_ID
		 AND U.REG_TYP_CD IN ('C', 'U') 
		LEFT JOIN WAA_EXP_TBL EX          
		  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
 WHERE  1 = 1  
   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
									   FROM WAM_PRF_RESULT
									  GROUP BY PRF_ID 
									 )   
   AND NVL(EX.EXP_YN,'N')='N'
   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
   <if test="prfId != null and prfId != ''">
   		AND B.PRF_ID = #{prfId, jdbcType=VARCHAR}
   </if>
   <if test="notIn != null and notIn != '' and (prfId == null or prfId == '')">
   		AND B.PRF_ID NOT IN (${notIn})
   </if>
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchId != null and dbSchId != ''" >
		AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchPnm != null and dbSchPnm != ''" >
		AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="dbcTblNm != null and dbcTblNm != ''" >
		AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="dbcColNm != null and dbcColNm != ''" >
		AND (COL.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR COL.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="searchBgnDe != null and searchBgnDe != ''" >
		<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	</if>
	<if test="searchEndDe != null and searchEndDe != ''">
		<![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	</if>
	UNION ALL
	SELECT DQI.DQI_LNM
		  ,B.PRF_ID
		  ,B.PRF_NM
		  ,TBL.DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM
		  , (SELECT LISTAGG(RCOL.CH_TBL_DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_REL_COL RCOL
				    ON RCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT01'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
		  ,'' AS DBC_COL_KOR_NM
		  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
		  ,${pcolnm}
	  FROM WAM_PRF_RESULT A
	   INNER JOIN WAM_PRF_MSTR B
		  ON B.REG_TYP_CD IN ('C', 'U')
		 AND B.PRF_ID = A.PRF_ID
		 AND B.PRF_KND_CD = 'PT01'
	   INNER JOIN WAM_PRF_ERR_DATA PERR
		  ON PERR.PRF_ID = B.PRF_ID
		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
		 AND PERR.ESN_ER_DATA_SNO > 0
	   INNER JOIN WAA_DB_SCH C
		  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		 AND C.REG_TYP_CD IN ('C', 'U')
		 AND C.DB_SCH_ID = B.DB_SCH_ID
	   INNER JOIN WAA_DB_CONN_TRG D
		  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		 AND D.REG_TYP_CD IN ('C', 'U')
		 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
	   INNER JOIN WAT_DBC_TBL TBL
		  ON TBL.DB_SCH_ID = C.DB_SCH_ID
		 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		LEFT JOIN WAM_PRF_DQI_MAP E
		  ON E.PRF_ID = B.PRF_ID
		LEFT JOIN WAM_DQI DQI
		  ON E.DQI_ID = DQI.DQI_ID 
		 AND DQI.REG_TYP_CD IN ('C', 'U')
		LEFT JOIN WAM_DQI U
		  ON U.DQI_ID = DQI.UPP_DQI_ID
		 AND U.REG_TYP_CD IN ('C', 'U') 
		LEFT JOIN WAA_EXP_TBL EX          
		  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
 WHERE  1 = 1  
   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
									   FROM WAM_PRF_RESULT
									  GROUP BY PRF_ID 
									 )   
   AND NVL(EX.EXP_YN,'N')='N'
   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
   <if test="prfId != null and prfId != ''">
   		AND B.PRF_ID = #{prfId, jdbcType=VARCHAR}
   </if>
   <if test="notIn != null and notIn != '' and (prfId == null or prfId == '')">
   		AND B.PRF_ID NOT IN (${notIn})
   </if>
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchId != null and dbSchId != ''" >
		AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchPnm != null and dbSchPnm != ''" >
		AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="dbcTblNm != null and dbcTblNm != ''" >
		AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="dbcColNm != null and dbcColNm != ''" >
		AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="searchBgnDe != null and searchBgnDe != ''" >
		<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	</if>
	<if test="searchEndDe != null and searchEndDe != ''">
		<![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	</if>
	UNION ALL
	SELECT DQI.DQI_LNM
		  ,B.PRF_ID
		  ,B.PRF_NM
		  ,TBL.DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM
		  , (SELECT LISTAGG(UCOL.DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_UNQ_COL UCOL
				    ON UCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT02'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
		  ,'' AS DBC_COL_KOR_NM
		  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
		  ,${pcolnm}
	  FROM WAM_PRF_RESULT A
	   INNER JOIN WAM_PRF_MSTR B
		  ON B.REG_TYP_CD IN ('C', 'U')
		 AND B.PRF_ID = A.PRF_ID
		 AND B.PRF_KND_CD = 'PT02'
	   INNER JOIN WAM_PRF_ERR_DATA PERR
		  ON PERR.PRF_ID = B.PRF_ID
		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
		 AND PERR.ESN_ER_DATA_SNO > 0
	   INNER JOIN WAA_DB_SCH C
		  ON C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		 AND C.REG_TYP_CD IN ('C', 'U')
		 AND C.DB_SCH_ID = B.DB_SCH_ID 
	   INNER JOIN WAA_DB_CONN_TRG D
		  ON D.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		 AND D.REG_TYP_CD IN ('C', 'U')
		 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
	   INNER JOIN WAT_DBC_TBL TBL
		  ON TBL.DB_SCH_ID = C.DB_SCH_ID
		 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		LEFT JOIN WAM_PRF_DQI_MAP E
		  ON E.PRF_ID = B.PRF_ID
		LEFT JOIN WAM_DQI DQI
		  ON E.DQI_ID = DQI.DQI_ID 
		 AND DQI.REG_TYP_CD IN ('C', 'U')
		LEFT JOIN WAM_DQI U
		  ON U.DQI_ID = DQI.UPP_DQI_ID
		 AND U.REG_TYP_CD IN ('C', 'U') 
		LEFT JOIN WAA_EXP_TBL EX          
		  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
 WHERE  1 = 1  
   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
									   FROM WAM_PRF_RESULT
									  GROUP BY PRF_ID 
									 )
   AND NVL(EX.EXP_YN,'N')='N'
   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
   <if test="prfId != null and prfId != ''">
   		AND B.PRF_ID = #{prfId, jdbcType=VARCHAR}
   </if>
   <if test="notIn != null and notIn != '' and (prfId == null or prfId == '')">
   		AND B.PRF_ID NOT IN (${notIn})
   </if>
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchId != null and dbSchId != ''" >
		AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchPnm != null and dbSchPnm != ''" >
		AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="dbcTblNm != null and dbcTblNm != ''" >
		AND (TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR TBL.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="dbcColNm != null and dbcColNm != ''" >
		AND (B.OBJ_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR B.OBJ_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	</if>
	<if test="searchBgnDe != null and searchBgnDe != ''" >
		<![CDATA[ AND TO_DATE(A.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	</if>
	<if test="searchEndDe != null and searchEndDe != ''">
		<![CDATA[ AND TO_DATE(A.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	</if>
	UNION ALL
	SELECT DQI.DQI_LNM
	      ,A.BR_ID
	      ,A.BR_NM
	      ,D.DBC_TBL_NM
	      ,D.DBC_TBL_KOR_NM
	      ,E.DBC_COL_NM
	      ,E.DBC_COL_KOR_NM
	      ,'업무규칙' AS PRF_KND_CD
	      ,${bcolnm}
	      ,TO_CHAR( (SELECT  COUNT(COL_NM1)  AS ERR_CNT
	      FROM(SELECT NVL(COL_NM1, 0) AS COL_NM1 FROM WAM_BR_ERR_DATA BERR
	      INNER JOIN WAM_BR_MSTR A
	      ON BERR.BR_ID = A.BR_ID
	   AND BERR.ER_DATA_SNO > 0
	   WHERE A.BR_ID = #{prfId, jdbcType=VARCHAR} ) )
	   ) AS ERR_CNT
	  FROM WAM_BR_MSTR A
	 INNER JOIN WAM_BR_RESULT B
		ON B.BR_ID = A.BR_ID
	 INNER JOIN WAM_BR_ERR_DATA BERR
		ON BERR.BR_ID = A.BR_ID
	   AND BERR.ANA_STR_DTM = B.ANA_STR_DTM
	   AND BERR.ER_DATA_SNO > 0
	 INNER JOIN WAA_DB_SCH C
		ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	   AND C.REG_TYP_CD IN ('C', 'U')
	 INNER JOIN WAT_DBC_TBL D
		ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	 INNER JOIN WAT_DBC_COL E
		ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	   AND E.DBC_COL_NM = A.DBC_COL_NM
	  LEFT OUTER JOIN WAM_BR_DQI_MAP F
		ON F.BR_ID = A.BR_ID
	   AND F.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
		ON DQI.DQI_ID = F.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	  LEFT JOIN WAA_EXP_TBL EX          
		ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND (B.BR_ID, B.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
									   FROM WAM_BR_RESULT
									  GROUP BY BR_ID 
									 )
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
	   <if test="prfId != null and prfId != ''">
   		AND A.BR_ID = #{prfId, jdbcType=VARCHAR}
   		</if>
   		<if test="notIn != null and notIn != '' and (prfId == null or prfId == '')">
   		AND A.BR_ID NOT IN (${notIn})
   		</if>
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
		AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
		AND (C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR}),'%') OR C.DB_SCH_PNM LIKE CONCAT(CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
		AND (D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR}),'%') OR D.DBC_TBL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
		AND (E.DBC_COL_NM LIKE CONCAT(CONCAT('%',#{dbcColNm,jdbcType=VARCHAR}),'%') OR E.DBC_COL_NM LIKE CONCAT(CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR})),'%'))
	   </if>
	   <if test="searchBgnDe != null and searchBgnDe != ''" >
		<![CDATA[ AND TO_DATE(B.ANA_STR_DTM) >= TO_DATE(#{searchBgnDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') ]]>
	   </if>
	   <if test="searchEndDe != null and searchEndDe != ''">
		<![CDATA[ AND TO_DATE(B.ANA_END_DTM) <  TO_DATE(#{searchEndDe,jdbcType=VARCHAR}, 'YYYY-MM-DD') + 1 ]]>
	   </if>
	 ORDER BY  DBC_TBL_NM
			  ,DBC_TBL_KOR_NM
			  ,DBC_COL_NM
			  ,DBC_COL_KOR_NM
<!--       ) -->
</select>

<select id="getDqiLnmLst" resultType="String">
	SELECT DQI_LNM
	  FROM WAM_DQI
	 WHERE UPP_DQI_ID IS NOT NULL
	   AND DQI_LVL = (SELECT MAX(DQI_LVL) AS DQI_LVL FROM WAM_DQI)
	 ORDER BY UPP_DQI_ID
</select>


<select id="selectStndDtm" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT MIN(DB.STR_DTM) AS ANA_STR_DTM
	     , SYSDATE AS ANA_END_DTM
	  FROM WAA_DB_CONN_TRG DB
	 INNER JOIN WAA_DB_SCH SCH
	    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
	   AND SCH.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	   AND SCH.REG_TYP_CD IN ('C', 'U')
	 WHERE 1=1
	   AND DB.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	   AND DB.REG_TYP_CD IN ('C', 'U')
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (SCH.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR SCH.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
</select>

<select id="selectModelDtm" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT SYSDATE AS ANA_END_DTM
	      ,MIN(RQST_DTM) AS ANA_STR_DTM
	  FROM WDQM_PDM_TBL
	 WHERE 1=1
	  <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (PDM_TBL_PNM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR PDM_TBL_LNM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
</select>

<select id="selectSditmTblList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT AA.PDM_TBL_PNM, AA.PDM_COL_PNM, WAT_DATA_TYPE AS DATA_TYPE
		, LTRIM(CASE 
			        WHEN AA.SDITM_LNM IS NULL THEN '표준용어에 존재하지 않는 컬럼명 입니다.'
			          WHEN AA.WAT_DATA_TYPE != AA.WDQM_DATA_TYPE THEN '데이터타입이 일치하지 않습니다.'
			          ELSE '표준을 준수하였습니다.'
			         END )  AS GAP_STATUS
	FROM
	(	SELECT /*+ LEADING(D A) */  
				  SCH.DB_SCH_PNM||'.'||A.DBC_TBL_NM AS PDM_TBL_PNM
				  , B.DBC_COL_NM               AS PDM_COL_PNM
				  , B.ORD 
				  , CASE WHEN B.DATA_LEN IS NULL 
			         THEN B.DATA_TYPE
			         ELSE (CASE WHEN B.DATA_PNT IS NOT NULL AND B.DATA_PNT != 0 
			                    THEN B.DATA_TYPE||'('||B.DATA_LEN||','||B.DATA_PNT||')' 
			                    ELSE B.DATA_TYPE||'('||B.DATA_LEN||')'
			                     END )
			         END AS WAT_DATA_TYPE
			      , CASE WHEN D.DATA_LEN IS NULL 
			         THEN D.DATA_TYPE
			         ELSE (CASE WHEN D.DATA_SCAL IS NOT NULL
			                    THEN D.DATA_TYPE||'('||D.DATA_LEN||','||D.DATA_SCAL||')' 
			                    ELSE D.DATA_TYPE||'('||D.DATA_LEN||')'
			                     END )
			         END AS WDQM_DATA_TYPE
			      , C.SDITM_LNM
		FROM WAA_DB_CONN_TRG DB
		 INNER JOIN WAA_DB_SCH SCH
		   ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		   AND SCH.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
		   AND SCH.REG_TYP_CD IN ('C', 'U')
		 INNER JOIN WAT_DBC_TBL A
		   ON A.DB_SCH_ID = SCH.DB_SCH_ID
		   AND A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		INNER JOIN WAT_DBC_COL B
		  ON B.DBC_TBL_NM = A.DBC_TBL_NM 
		 AND B.DB_SCH_ID = A.DB_SCH_ID
		LEFT JOIN WDQM_SDITM C
		  ON C.SDITM_PNM = RTRIM(REPLACE(B.DBC_COL_NM,'_0123456789','')) 
		 AND C.REG_TYP_CD IN ('C', 'U')
		LEFT JOIN WDQM_DMN D
		   ON D.DMN_PNM = C.DMN_PNM
		  AND D.REG_TYP_CD IN ('C', 'U')
		WHERE 1 = 1   
		  AND DB.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
		 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		 </if>
		 <if test="dbSchId != null and dbSchId != ''" >
			AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		 </if>
		 <if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (SCH.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR SCH.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		 </if>
	   	  
	) AA		      
	ORDER BY AA.PDM_TBL_PNM, AA.PDM_COL_PNM, AA.ORD
</select>

<select id="selectSditmList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT A.SDITM_LNM, A.SDITM_PNM, A.OBJ_DESCN, B.INFOTP_LNM 
	FROM WDQM_SDITM A
	LEFT OUTER JOIN WAA_INFO_TYPE B
	 ON A.INFOTP_ID = B.INFOTP_ID 
	 AND B.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
	WHERE A.REG_TYP_CD IN ('C','U')
</select>

<select id="selectDmnList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT A.DMN_LNM, A.DMN_PNM, A.OBJ_DESCN, A.DATA_TYPE, A.DATA_LEN, A.DATA_SCAL 
	FROM WDQM_DMN A
	WHERE A.REG_TYP_CD IN ('C','U')
</select>

<select id="selectModelStatus" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT SYSDATE AS ANA_END_DTM
	      ,MIN(RQST_DTM) AS ANA_STR_DTM
	  FROM WDQM_PDM_TBL
	 WHERE 1=1
	  <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (PDM_TBL_PNM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR PDM_TBL_LNM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
</select>

<select id="selectMultiDimLst" resultMap="MultiDimResultMap" parameterType="kr.wise.dq.result.service.MultiDimVO">
	SELECT A.DB_CONN_TRG_ID
	      ,A.DB_CONN_TRG_PNM
	      ,A.DB_SCH_ID
	      ,A.DB_SCH_PNM
	      ,A.BR_ID
	      ,A.BR_NM
	      ,A.DBC_TBL_NM
	      ,A.DQI_LNM
	      ,A.UPP_DQI_LNM
	      ,A.CTQ_LNM
	      ,A.BIZ_AREA_LNM
	      ,A.ANA_CNT
	      ,A.ER_CNT
	      ,A.ER_RATE
	      ,B.ANA_CNT AS ANA_CNT2
	      ,B.ER_CNT  AS ER_CNT2
	      ,B.ER_RATE AS ER_RATE2
	      ,C.ANA_CNT AS ANA_CNT3
	      ,C.ER_CNT  AS ER_CNT3
	      ,C.ER_RATE AS ER_RATE3
	  FROM (
	(SELECT A.DB_CONN_TRG_ID
	      ,A.DB_CONN_TRG_PNM
	      ,B.DB_SCH_ID
	      ,B.DB_SCH_PNM
	      ,C.BR_ID
	      ,C.BR_NM
	      ,C.DBC_TBL_NM
	      ,D.ANA_DGR
	      ,D.ANA_CNT
	      ,D.ER_CNT
	      ,CASE WHEN NVL(D.ANA_CNT, 0) = 0
	            THEN '0'
	            ELSE RTRIM(TO_CHAR(ROUND((D.ER_CNT/D.ANA_CNT), 2), 'FM9990.99'), '.')
	            END AS ER_RATE
	      ,DQI.DQI_LNM
	      ,UPP_DQI.DQI_LNM AS UPP_DQI_LNM
	      ,CTQ.CTQ_LNM
	      ,G.BIZ_AREA_LNM
	  FROM WAA_DB_CONN_TRG A
	 INNER JOIN WAA_DB_SCH B
	    ON B.DB_CONN_TRG_ID = A.DB_CONN_TRG_ID
	   AND B.REG_TYP_CD IN ('C', 'U')
	   AND B.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	 INNER JOIN WAM_BR_MSTR C
	    ON C.DB_SCH_ID = B.DB_SCH_ID
	 INNER JOIN WAM_BR_RESULT D
	    ON D.BR_ID = C.BR_ID
	 INNER JOIN WAM_BR_DQI_MAP E
	    ON E.BR_ID = C.BR_ID
	 INNER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = E.DQI_ID
	  LEFT OUTER JOIN WAM_DQI UPP_DQI
	    ON UPP_DQI.DQI_ID = DQI.UPP_DQI_ID
	  LEFT OUTER JOIN WAM_BR_CTQ_MAP F
	    ON F.BR_ID = C.BR_ID
	  LEFT OUTER JOIN WAM_CTQ CTQ
	    ON CTQ.CTQ_ID = F.CTQ_ID
	  LEFT OUTER JOIN WAM_BIZ_AREA G
	    ON G.BIZ_AREA_ID = C.BIZ_AREA_ID
	  LEFT OUTER JOIN WAA_USER U
	    ON U.USER_ID = C.BR_CRGP_USER_ID
	   AND U.REG_TYP_CD IN ('C','U')
	   AND U.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	  LEFT OUTER JOIN WAA_DEPT DEPT
	    ON DEPT.DEPT_ID = U.DEPT_ID
	   AND DEPT.REG_TYP_CD IN ('C', 'U')
	   AND DEPT.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND A.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	   AND D.ANA_DGR IS NOT NULL
	   AND D.ANA_DGR = (SELECT CASE WHEN MAX(SUBQ.ANA_DGR) >= 3 THEN MAX(SUBQ.ANA_DGR)-2 WHEN MAX(SUBQ.ANA_DGR) = 2 THEN 1 WHEN MAX(SUBQ.ANA_DGR) = 1 THEN 1 ELSE NULL END AS ANA_DGR FROM WAM_BR_RESULT SUBQ WHERE SUBQ.BR_ID = D.BR_ID)) A
	LEFT OUTER JOIN
	(SELECT A.DB_CONN_TRG_ID
	      ,A.DB_CONN_TRG_PNM
	      ,B.DB_SCH_ID
	      ,B.DB_SCH_PNM
	      ,C.BR_ID
	      ,C.BR_NM
	      ,C.DBC_TBL_NM
	      ,D.ANA_DGR
	      ,D.ANA_CNT
	      ,D.ER_CNT
	      ,CASE WHEN NVL(D.ANA_CNT, 0) = 0
	            THEN '0'
	            ELSE RTRIM(TO_CHAR(ROUND((D.ER_CNT/D.ANA_CNT), 2), 'FM9990.99'), '.')
	            END AS ER_RATE
	      ,DQI.DQI_LNM
	      ,UPP_DQI.DQI_LNM AS UPP_DQI_LNM
	      ,CTQ.CTQ_LNM
	      ,G.BIZ_AREA_LNM
	  FROM WAA_DB_CONN_TRG A
	 INNER JOIN WAA_DB_SCH B
	    ON B.DB_CONN_TRG_ID = A.DB_CONN_TRG_ID
	   AND B.REG_TYP_CD IN ('C', 'U')
	   AND B.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	 INNER JOIN WAM_BR_MSTR C
	    ON C.DB_SCH_ID = B.DB_SCH_ID
	 INNER JOIN WAM_BR_RESULT D
	    ON D.BR_ID = C.BR_ID
	 INNER JOIN WAM_BR_DQI_MAP E
	    ON E.BR_ID = C.BR_ID
	 INNER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = E.DQI_ID
	  LEFT OUTER JOIN WAM_DQI UPP_DQI
	    ON UPP_DQI.DQI_ID = DQI.UPP_DQI_ID
	  LEFT OUTER JOIN WAM_BR_CTQ_MAP F
	    ON F.BR_ID = C.BR_ID
	  LEFT OUTER JOIN WAM_CTQ CTQ
	    ON CTQ.CTQ_ID = F.CTQ_ID
	  LEFT OUTER JOIN WAM_BIZ_AREA G
	    ON G.BIZ_AREA_ID = C.BIZ_AREA_ID
	  LEFT OUTER JOIN WAA_USER U
	    ON U.USER_ID = C.BR_CRGP_USER_ID
	   AND U.REG_TYP_CD IN ('C','U')
	   AND U.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	  LEFT OUTER JOIN WAA_DEPT DEPT
	    ON DEPT.DEPT_ID = U.DEPT_ID
	   AND DEPT.REG_TYP_CD IN ('C', 'U')
	   AND DEPT.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND A.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	   AND D.ANA_DGR IS NOT NULL
	   AND D.ANA_DGR = (SELECT CASE WHEN MAX(SUBQ.ANA_DGR) >= 3 THEN MAX(SUBQ.ANA_DGR)-1 WHEN MAX(SUBQ.ANA_DGR) = 2 THEN 2 ELSE NULL END AS ANA_DGR FROM WAM_BR_RESULT SUBQ WHERE SUBQ.BR_ID = D.BR_ID)) B
	ON B.BR_ID = A.BR_ID
	LEFT OUTER JOIN
	(SELECT A.DB_CONN_TRG_ID
	      ,A.DB_CONN_TRG_PNM
	      ,B.DB_SCH_ID
	      ,B.DB_SCH_PNM
	      ,C.BR_ID
	      ,C.BR_NM
	      ,C.DBC_TBL_NM
	      ,D.ANA_DGR
	      ,D.ANA_CNT
	      ,D.ER_CNT
	      ,CASE WHEN NVL(D.ANA_CNT, 0) = 0
	            THEN '0'
	            ELSE RTRIM(TO_CHAR(ROUND((D.ER_CNT/D.ANA_CNT), 2), 'FM9990.99'), '.')
	            END AS ER_RATE
	      ,DQI.DQI_LNM
	      ,UPP_DQI.DQI_LNM AS UPP_DQI_LNM
	      ,CTQ.CTQ_LNM
	      ,G.BIZ_AREA_LNM
	  FROM WAA_DB_CONN_TRG A
	 INNER JOIN WAA_DB_SCH B
	    ON B.DB_CONN_TRG_ID = A.DB_CONN_TRG_ID
	   AND B.REG_TYP_CD IN ('C', 'U')
	   AND B.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	 INNER JOIN WAM_BR_MSTR C
	    ON C.DB_SCH_ID = B.DB_SCH_ID
	 INNER JOIN WAM_BR_RESULT D
	    ON D.BR_ID = C.BR_ID
	 INNER JOIN WAM_BR_DQI_MAP E
	    ON E.BR_ID = C.BR_ID
	 INNER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = E.DQI_ID
	  LEFT OUTER JOIN WAM_DQI UPP_DQI
	    ON UPP_DQI.DQI_ID = DQI.UPP_DQI_ID
	  LEFT OUTER JOIN WAM_BR_CTQ_MAP F
	    ON F.BR_ID = C.BR_ID
	  LEFT OUTER JOIN WAM_CTQ CTQ
	    ON CTQ.CTQ_ID = F.CTQ_ID
	  LEFT OUTER JOIN WAM_BIZ_AREA G
	    ON G.BIZ_AREA_ID = C.BIZ_AREA_ID
	  LEFT OUTER JOIN WAA_USER U
	    ON U.USER_ID = C.BR_CRGP_USER_ID
	   AND U.REG_TYP_CD IN ('C','U')
	   AND U.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	  LEFT OUTER JOIN WAA_DEPT DEPT
	    ON DEPT.DEPT_ID = U.DEPT_ID
	   AND DEPT.REG_TYP_CD IN ('C', 'U')
	   AND DEPT.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND A.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
	   AND D.ANA_DGR IS NOT NULL
	   AND D.ANA_DGR = (SELECT CASE WHEN MAX(SUBQ.ANA_DGR) >= 3 THEN MAX(SUBQ.ANA_DGR) ELSE NULL END FROM WAM_BR_RESULT SUBQ WHERE SUBQ.BR_ID = D.BR_ID) ) C
	ON C.BR_ID = B.BR_ID
	)
	<!-- <if test="brNm != null">
		AND C.BR_NM = #{brNm, jdbcType=VARCHAR}   		
	</if>
	<if test="bizAreaLnm != null">
		AND G.BIZ_AREA_LNM = #{bizAreaLnm, jdbcType=VARCHAR}   		
	</if>
	<if test="dqiLnm != null">
		AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}   		
	</if>
	<if test="dbConnTrgPnm != null">
		AND A.DB_CONN_TRG_PNM = #{dbConnTrgPnm, jdbcType=VARCHAR}   		
	</if> -->
	<!-- <if test="brNm != null">
		AND DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}   		
	</if>
	<if test="brNm != null">
		AND DBC_COL_NM = #{dbcColNm, jdbcType=VARCHAR}   		
	</if>
	<if test="brNm != null">
		AND BIZ_AREA_LNM = #{bizAreaLnm, jdbcType=VARCHAR}   		
	</if> -->   
	 ORDER BY BIZ_AREA_LNM, UPP_DQI_LNM, DQI_LNM, DB_CONN_TRG_ID, DB_SCH_ID, BR_ID
</select>

<select id="selectMultiDimLstTop5" resultMap="MultiDimResultMap">
	SELECT DB_CONN_TRG_PNM
	      ,DBC_TBL_NM
	      ,ANA_CNT
	      ,ER_CNT
	      ,ER_RATE
	  FROM 
		(SELECT A.DB_CONN_TRG_ID
		      ,A.DB_CONN_TRG_PNM
		      ,B.DB_SCH_ID
		      ,B.DB_SCH_PNM
		      ,C.BR_ID
		      ,C.BR_NM
		      ,C.DBC_TBL_NM
		      ,D.ANA_DGR
		      ,D.ANA_CNT
		      ,D.ER_CNT
		      ,CASE WHEN NVL(D.ANA_CNT, 0) = 0
		            THEN '0'
		            ELSE RTRIM(TO_CHAR(ROUND((D.ER_CNT/D.ANA_CNT), 2), 'FM9990.99'), '.')
		            END AS ER_RATE
		      ,DQI.DQI_LNM
		      ,UPP_DQI.DQI_LNM
		      ,CTQ.CTQ_LNM
		      ,G.BIZ_AREA_LNM
		  FROM WAA_DB_CONN_TRG A
		 INNER JOIN WAA_DB_SCH B
		    ON B.DB_CONN_TRG_ID = A.DB_CONN_TRG_ID
		   AND B.REG_TYP_CD IN ('C', 'U')
		   AND B.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		 INNER JOIN WAM_BR_MSTR C
		    ON C.DB_SCH_ID = B.DB_SCH_ID
		 INNER JOIN WAM_BR_RESULT D
		    ON D.BR_ID = C.BR_ID
		 INNER JOIN WAM_BR_DQI_MAP E
		    ON E.BR_ID = C.BR_ID
		 INNER JOIN WAM_DQI DQI
		    ON DQI.DQI_ID = E.DQI_ID
		  LEFT OUTER JOIN WAM_DQI UPP_DQI
		    ON UPP_DQI.DQI_ID = DQI.UPP_DQI_ID
		  LEFT OUTER JOIN WAM_BR_CTQ_MAP F
		    ON F.BR_ID = C.BR_ID
		  LEFT OUTER JOIN WAM_CTQ CTQ
		    ON CTQ.CTQ_ID = F.CTQ_ID
		  LEFT OUTER JOIN WAM_BIZ_AREA G
		    ON G.BIZ_AREA_ID = C.BIZ_AREA_ID
		 WHERE A.REG_TYP_CD IN ('C', 'U')
		   AND A.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
		   AND D.ANA_DGR IS NOT NULL
		)
	WHERE ROWNUM <![CDATA[ < ]]> 6 
	ORDER BY ER_RATE DESC
</select>

</mapper>