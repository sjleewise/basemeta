<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.sysinf.daSharp.service.DasMartMapper" >
  <resultMap id="BaseResultMap" type="kr.wise.meta.model.service.WaqPdmTbl">
    <id column="PDM_TBL_ID" property="pdmTblId" jdbcType="VARCHAR" />
<!--     <result column="ENTITY_ID" property="entityId" jdbcType="DECIMAL" /> -->
    <result column="PDM_TBL_PNM" property="pdmTblPnm" jdbcType="VARCHAR" />
    <result column="PDM_TBL_LNM" property="pdmTblLnm" jdbcType="VARCHAR" />
<!--     <result column="PDM_COL_PNM" property="pdmColPnm" jdbcType="VARCHAR" /> -->
<!--     <result column="PDM_COL_LNM" property="pdmColLnm" jdbcType="VARCHAR" /> -->
    <result column="SUBJ_ID" property="subjId" jdbcType="VARCHAR" />
    <result column="SUBJ_LNM" property="subjLnm" jdbcType="VARCHAR" />
    <result column="STD_APL_YN" property="stdAplYn" jdbcType="VARCHAR" />
    <result column="PART_TBL_YN" property="partTblYn" jdbcType="VARCHAR" />
    <result column="DW_TRG_TBL_YN" property="dwTrgTblYn" jdbcType="VARCHAR" />
    <result column="CRG_USER_ID" property="crgUserId" jdbcType="VARCHAR" />
    <result column="CRG_USER_NM" property="crgUserNm" jdbcType="VARCHAR" />
<!--     <result column="RQST_NO" property="rqstNo" jdbcType="VARCHAR" /> -->
<!--     <result column="RQST_SNO" property="rqstSno" jdbcType="DECIMAL" /> -->
	<result column="RQST_DCD" property="rqstDcd" jdbcType="VARCHAR" />
    <result column="OBJ_DESCN" property="objDescn" jdbcType="VARCHAR" />
<!--     <result column="OBJ_VERS" property="objVers" jdbcType="DECIMAL" /> -->
<!--     <result column="REG_TYP_CD" property="regTypCd" jdbcType="VARCHAR" /> -->
<!--     <result column="FRS_RQST_DTM" property="frsRqstDtm" jdbcType="TIMESTAMP" /> -->
<!--     <result column="FRS_RQST_USER_ID" property="frsRqstUserId" jdbcType="VARCHAR" /> -->
<!--     <result column="FRS_RQST_USER_NM" property="frsRqstUserNm" jdbcType="VARCHAR" /> -->
<!--     <result column="RQST_DTM" property="rqstDtm" jdbcType="TIMESTAMP" /> -->
<!--     <result column="RQST_USER_ID" property="rqstUserId" jdbcType="VARCHAR" /> -->
<!--     <result column="RQST_USER_NM" property="rqstUserNm" jdbcType="VARCHAR" /> -->
<!--     <result column="APRV_DTM" property="aprvDtm" jdbcType="TIMESTAMP" /> -->
<!--     <result column="APRV_USER_ID" property="aprvUserId" jdbcType="VARCHAR" /> -->
<!--     <result column="APRV_USER_NM" property="aprvUserNm" jdbcType="VARCHAR" /> -->
    <result column="CTD_FCY" property="ctdFcy" jdbcType="VARCHAR" />
    <result column="DEL_CRI" property="delCri" jdbcType="VARCHAR" />
    <result column="DEL_MTD" property="delMtd" jdbcType="VARCHAR" />
    <result column="BCK_FCY" property="bckFcy" jdbcType="VARCHAR" />
    <result column="INIT_SIZE" property="initSize" jdbcType="VARCHAR" />
    <result column="INC_SIZE" property="incSize" jdbcType="VARCHAR" />
    <result column="INIT_CNT" property="initCnt" jdbcType="VARCHAR" />
    <result column="INC_CNT" property="incCnt" jdbcType="VARCHAR" />
    <result column="TOT_CNT" property="totCnt" jdbcType="VARCHAR" />
<!--     <result column="SYS_AREA_ID" property="sysAreaId" jdbcType="VARCHAR" /> -->
    <result column="MDL_LNM" property="mdlLnm" jdbcType="VARCHAR" />
    <result column="UPP_SUBJ_ID" property="uppSubjId" jdbcType="VARCHAR" />
    <result column="UPP_SUBJ_LNM" property="uppSubjLnm" jdbcType="VARCHAR" />
<!--     <result column="STR_DTM" jdbcType="TIMESTAMP" property="strDtm" /> -->
<!--     <result column="EXP_DTM" jdbcType="TIMESTAMP" property="expDtm" /> -->
<!--     <result column="SUBJ_LVL" property="subjLvl" jdbcType="VARCHAR" /> -->
    <result column="BF_PDM_TBL_PNM" property="bfPdmTblPnm" jdbcType="VARCHAR" />
<!--     <result column="DATA_TYPE " property="dataType" jdbcType="VARCHAR" /> -->
<!--     <result column="SUBJ_LVL" property="Level" jdbcType="INTEGER" /> -->
    <result column="FULL_PATH" property="fullPath" jdbcType="VARCHAR" />
    <result column="IBS_STATUS" property="ibsStatus" jdbcType="VARCHAR" />
    <result column="PDM_REG_YN" property="pdmRegYn" jdbcType="VARCHAR" />
    <result column="MART_TBL_ID" property="martTblId" jdbcType="VARCHAR" />
    <result column="SPECIAL_REMARK" property="specialRemark" jdbcType="VARCHAR" />
    <result column="DATAPROCESSDEF" property="dataProcessDef" jdbcType="VARCHAR" />
    <result column="SUBTYPESET_ATTR_YN" property="subtypesetAttrYn" jdbcType="VARCHAR" />
    <result column="TABLE_TYPE" property="tableType" jdbcType="VARCHAR" />
    <result column="MART_ENTITY_ID" property="martEntityId" jdbcType="VARCHAR" />
    <result column="HIS_TYPE" property="hisType" jdbcType="VARCHAR" />
    <result column="SUB_NM" property="subNm" jdbcType="VARCHAR" />
    
  </resultMap>
  
  <resultMap id="DasColResult" type="kr.wise.meta.model.service.WaqPdmCol">
    <result column="RQST_NO" property="rqstNo" jdbcType="VARCHAR" />
    <result column="RQST_SNO" property="rqstSno" jdbcType="DECIMAL" />
    <result column="RQST_DTL_SNO" property="rqstDtlSno" jdbcType="DECIMAL" />
    <result column="PDM_COL_ID" property="pdmColId" jdbcType="VARCHAR" />
    <result column="PDM_COL_PNM" property="pdmColPnm" jdbcType="VARCHAR" />
    <result column="PDM_COL_LNM" property="pdmColLnm" jdbcType="VARCHAR" />
    <result column="BF_PDM_COL_PNM" property="bfPdmColPnm" jdbcType="VARCHAR" />
    <result column="RQST_DCD" property="rqstDcd" jdbcType="VARCHAR" />
<!--     <result column="VRF_CD" property="vrfCd" jdbcType="VARCHAR" /> -->
<!--     <result column="VRF_RMK" property="vrfRmk" jdbcType="VARCHAR" /> -->
    <result column="PDM_TBL_ID" property="pdmTblId" jdbcType="VARCHAR" />
    <result column="PDM_TBL_PNM" property="pdmTblPnm" jdbcType="VARCHAR" />
    <result column="MDL_LNM" property="mdlLnm" jdbcType="VARCHAR" />
    <result column="UPP_SUBJ_LNM" property="uppSubjLnm" jdbcType="VARCHAR" />
    <result column="SUBJ_ID" property="subjId" jdbcType="VARCHAR" />
    <result column="SUBJ_LNM" property="subjLnm" jdbcType="VARCHAR" />
    <result column="SDITM_ID" property="sditmId" jdbcType="VARCHAR" />
    <result column="COL_ORD" property="colOrd" jdbcType="DECIMAL" />
    <result column="DATA_TYPE" property="dataType" jdbcType="VARCHAR" />
    <result column="DATA_LEN" property="dataLen" jdbcType="DECIMAL" />
    <result column="DATA_SCAL" property="dataScal" jdbcType="DECIMAL" />
    <result column="PK_YN" property="pkYn" jdbcType="VARCHAR" />
    <result column="PK_ORD" property="pkOrd" jdbcType="DECIMAL" />
    <result column="NONUL_YN" property="nonulYn" jdbcType="VARCHAR" />
    <result column="DEFLT_VAL" property="defltVal" jdbcType="VARCHAR" />
    <result column="OBJ_DESCN" property="objDescn" jdbcType="VARCHAR" />
    <result column="PSI_YN" property="psiYn" jdbcType="VARCHAR" />
    <result column="ENC_YN" property="encYn" jdbcType="VARCHAR" />
    <result column="CODE_ID" property="codeId" jdbcType="VARCHAR" />
    <result column="FK_INFO" property="fkInfo" jdbcType="VARCHAR" />
    <result column="FK_NM" property="fkNm" jdbcType="VARCHAR" />
    <result column="ORGN_KEY_YN" property="orgnKeyYn" jdbcType="VARCHAR" />
    <result column="DIS_DIV_YN" property="disDivYn" jdbcType="VARCHAR" />
    <result column="SUB_COL_NM" property="subColNm" jdbcType="VARCHAR" />
    <result column="MART_TBL_ID" property="martTblId" jdbcType="VARCHAR" />
<!--     <result column="OBJ_VERS" property="objVers" jdbcType="DECIMAL" /> -->
<!--     <result column="REG_TYP_CD" property="regTypCd" jdbcType="VARCHAR" /> -->
<!--     <result column="FRS_RQST_DTM" property="frsRqstDtm" jdbcType="TIMESTAMP" /> -->
<!--     <result column="FRS_RQST_USER_ID" property="frsRqstUserId" jdbcType="VARCHAR" /> -->
<!--     <result column="RQST_DTM" property="rqstDtm" jdbcType="TIMESTAMP" /> -->
<!--     <result column="RQST_USER_ID" property="rqstUserId" jdbcType="VARCHAR" /> -->
<!--     <result column="APRV_DTM" property="aprvDtm" jdbcType="TIMESTAMP" /> -->
<!--     <result column="APRV_USER_ID" property="aprvUserId" jdbcType="VARCHAR" /> -->
	<result column="IBS_STATUS" property="ibsStatus" jdbcType="VARCHAR" />
	<result column="AK_YN" property="akYn" jdbcType="VARCHAR" />
  </resultMap>
      
   <resultMap id="DasRelResult" type="kr.wise.meta.model.service.WaqPdmRel">
    <id column="RQST_SNO" property="rqstSno" jdbcType="VARCHAR" />
    <id column="RQST_DCD" property="rqstDcd" jdbcType="VARCHAR" />
    <id column="PDM_REL_PNM" property="pdmRelPnm" jdbcType="VARCHAR" />
    <id column="PA_ENTY_PNM" property="paEntyPnm" jdbcType="VARCHAR" />
    <id column="PA_ATTR_PNM" property="paAttrPnm" jdbcType="VARCHAR" />
    <id column="CH_ENTY_PNM" property="chEntyPnm" jdbcType="VARCHAR" />
    <id column="CH_ATTR_PNM" property="chAttrPnm" jdbcType="VARCHAR" />
    <id column="BF_PDM_REL_PNM" property="bfPdmRelPnm" jdbcType="VARCHAR" />
    <id column="BF_PA_ENTY_PNM" property="bfPaEntyPnm" jdbcType="VARCHAR" />
    <id column="BF_PA_ATTR_PNM" property="bfPaAttrPnm" jdbcType="VARCHAR" />
    <id column="BF_CH_ENTY_PNM" property="bfChEntyPnm" jdbcType="VARCHAR" />
    <id column="BF_CH_ATTR_PNM" property="bfChAttrPnm" jdbcType="VARCHAR" />
    <result column="PDM_REL_ID" property="pdmRelId" jdbcType="VARCHAR" />
    <result column="PDM_REL_LNM" property="pdmRelLnm" jdbcType="VARCHAR" />
    <result column="REL_TYP_CD" property="relTypCd" jdbcType="VARCHAR" />
    <result column="CRD_TYP_CD" property="crdTypCd" jdbcType="VARCHAR" />
    <result column="PA_OPT_TYP_CD" property="paOptTypCd" jdbcType="VARCHAR" />
    <result column="PA_SUBJ_ID" property="paSubjId" jdbcType="VARCHAR" />
    <result column="PA_SUBJ_PNM" property="paSubjPnm" jdbcType="VARCHAR" />
    <result column="PA_ENTY_ID" property="paEntyId" jdbcType="VARCHAR" />
    <result column="PA_ATTR_ID" property="paAttrId" jdbcType="VARCHAR" />
    <result column="CH_SUBJ_ID" property="chSubjId" jdbcType="VARCHAR" />
    <result column="CH_SUBJ_PNM" property="chSubjPnm" jdbcType="VARCHAR" />
    <result column="CH_ENTY_ID" property="chEntyId" jdbcType="VARCHAR" />
    <result column="CH_ATTR_ID" property="chAttrId" jdbcType="VARCHAR" />
  </resultMap>
  
	<resultMap id="DasTblResultMap" type="kr.wise.meta.model.service.WaqPdmTbl">
		<result column="CATEGORY_ID" 			property="category_id" 				jdbcType="VARCHAR" />
		<result column="MODEL_ID" 				property="model_id" 				jdbcType="VARCHAR" />
		<result column="SUBJECTAREA_ID" 		property="subjectarea_id" 			jdbcType="VARCHAR" />
		<result column="ENTITY_ID" 				property="entity_id" 				jdbcType="VARCHAR" />
		<!-- <result column="ATTRIBUTE_ID" 			property="attribute_id" 			jdbcType="VARCHAR" /> -->
		<result column="CATEGORY_NAME" 			property="category_name" 			jdbcType="VARCHAR" />
		<result column="MODEL_NAME" 			property="model_name" 				jdbcType="VARCHAR" />
		<result column="SUBJ_ID" 				property="subjId" 					jdbcType="VARCHAR" />
		<result column="FULL_PATH" 				property="fullPath" 				jdbcType="VARCHAR" />
		<result column="SUBJECTAREA_NAME" 		property="subjectarea_name" 		jdbcType="VARCHAR" />
		<!-- <result column="ENTITY_OWNER_NAME" 		property="entity_owner_name" 		jdbcType="VARCHAR" /> -->
		<result column="ENTITY_NAME" 			property="entity_name" 				jdbcType="VARCHAR" />
		<result column="ENTITY_NAME_PHYSICAL" 	property="entity_name_physical" 	jdbcType="VARCHAR" />
		<result column="ENEITY_NAME_LOGICAL" 	property="entity_name_logical" 		jdbcType="VARCHAR" />
		<result column="RQST_DCD" 				property="rqstDcd" 					jdbcType="VARCHAR" />
		<result column="REG_TYP_CD" 			property="regTypCd" 				jdbcType="VARCHAR" />
		<result column="PDM_TBL_PNM" 			property="pdmTblPnm" 				jdbcType="VARCHAR" />
		<result column="PDM_TBL_LNM" 			property="pdmTblLnm" 				jdbcType="VARCHAR" />
		<!-- <result column="MDL_TBL_TYP_CD" 		property="mdl_tbl_typ_cd" 			jdbcType="VARCHAR" /> -->
		<result column="OBJ_DESCN" 				property="objDescn" 				jdbcType="VARCHAR" />
<!-- 		<result column="ENTITY_LOGICAL_YN" 		property="entity_logical_yn" 		jdbcType="VARCHAR" /> -->
		<result column="IBS_STATUS" 			property="ibsStatus" 				jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="DasColResultMap" type="kr.wise.meta.model.service.WaqPdmCol">
	    <result column="RQST_NO" property="rqstNo" jdbcType="VARCHAR" />
	    <result column="RQST_SNO" property="rqstSno" jdbcType="DECIMAL" />
	    <result column="RQST_DTL_SNO" property="rqstDtlSno" jdbcType="DECIMAL" />
	    <result column="PDM_COL_ID" property="pdmColId" jdbcType="VARCHAR" />
	    <result column="PDM_COL_PNM" property="pdmColPnm" jdbcType="VARCHAR" />
	    <result column="PDM_COL_LNM" property="pdmColLnm" jdbcType="VARCHAR" />
	    <result column="BF_PDM_COL_PNM" property="bfPdmColPnm" jdbcType="VARCHAR" />
	    <result column="RQST_DCD" property="rqstDcd" jdbcType="VARCHAR" />
	    <result column="PDM_TBL_ID" property="pdmTblId" jdbcType="VARCHAR" />
	    <result column="PDM_TBL_PNM" property="pdmTblPnm" jdbcType="VARCHAR" />
	    <result column="MDL_LNM" property="mdlLnm" jdbcType="VARCHAR" />
	    <result column="UPP_SUBJ_LNM" property="uppSubjLnm" jdbcType="VARCHAR" />
	    <result column="SUBJ_ID" property="subjId" jdbcType="VARCHAR" />
	    <result column="SUBJ_LNM" property="subjLnm" jdbcType="VARCHAR" />
	    <result column="SDITM_ID" property="sditmId" jdbcType="VARCHAR" />
	    <result column="COL_ORD" property="colOrd" jdbcType="DECIMAL" />
	    <result column="DATA_TYPE" property="dataType" jdbcType="VARCHAR" />
	    <result column="DATA_LEN" property="dataLen" jdbcType="DECIMAL" />
	    <result column="DATA_SCAL" property="dataScal" jdbcType="DECIMAL" />
	    <result column="PK_YN" property="pkYn" jdbcType="VARCHAR" />
	    <result column="PK_ORD" property="pkOrd" jdbcType="DECIMAL" />
	    <result column="NONUL_YN" property="nonulYn" jdbcType="VARCHAR" />
	    <result column="DEFLT_VAL" property="defltVal" jdbcType="VARCHAR" />
	    <result column="OBJ_DESCN" property="objDescn" jdbcType="VARCHAR" />
	    <result column="PSI_YN" property="psiYn" jdbcType="VARCHAR" />
	    <result column="ENC_YN" property="encYn" jdbcType="VARCHAR" />
	    <result column="CODE_ID" property="codeId" jdbcType="VARCHAR" />
	    <result column="FK_INFO" property="fkInfo" jdbcType="VARCHAR" />
	    <result column="FK_NM" property="fkNm" jdbcType="VARCHAR" />
	    <result column="ORGN_KEY_YN" property="orgnKeyYn" jdbcType="VARCHAR" />
	    <result column="DIS_DIV_YN" property="disDivYn" jdbcType="VARCHAR" />
	    <result column="SUB_COL_NM" property="subColNm" jdbcType="VARCHAR" />
	    <result column="MART_TBL_ID" property="martTblId" jdbcType="VARCHAR" />
		<result column="IBS_STATUS" property="ibsStatus" jdbcType="VARCHAR" />
		<result column="AK_YN" property="akYn" jdbcType="VARCHAR" />
	  </resultMap>
  
  <select id="selectMartList" resultMap="DasTblResultMap" parameterType="kr.wise.meta.model.service.WaqPdmTbl">
   	   -- DA# MART의 테이블 조회
	   SELECT NULL AS CATEGORY_ID
		      ,NULL AS MODEL_ID
			  ,TBL.SUBJECTID AS SUBJECTAREA_ID
			  ,TBL.TABLEID AS ENTITY_ID
			  ,NULL AS ATTRIBUTE_ID
			  ,NULL AS CATEGORY_NAME
			  ,NULL AS MODEL_NAME
			  ,#{subjId,jdbcType=VARCHAR} AS SUBJ_ID
<!-- 			  ,#{subjLnm,jdbcType=VARCHAR} AS FULL_PATH -->
			  ,TBL.SUBJECTNAME AS SUBJECTAREA_NAME
			  ,NULL AS ENTITY_OWNER_NAME
			  ,TBL.TAB_ENG_NM AS ENTITY_NAME
			  ,TBL.TAB_ENG_NM AS ENTITY_NAME_PHYSICAL
			  ,TBL.TAB_KOR_NM AS ENEITY_NAME_LOGICAL
			  ,'CU' AS RQST_DCD
			  ,CASE WHEN M.PDM_TBL_ID IS NOT NULL THEN 'U' ELSE 'C' END REG_TYP_CD
			  ,TBL.TAB_ENG_NM AS PDM_TBL_PNM
			  ,TBL.TAB_KOR_NM AS PDM_TBL_LNM
			  ,NULL AS MDL_TBL_TYP_CD
			  ,TBL.TABDEF AS OBJ_DESCN
<!-- 			  ,'Y' AS ENTITY_LOGICAL_YN -->
			  ,'I' AS IBS_STATUS
			  ,M.STD_APL_YN
		  FROM PIIDAS01.DA#V_TABLE TBL
		 INNER JOIN PIIDAS01.DA#V_SUBJECTAREA SUBJ
		    ON SUBJ.SUBJECTID = TBL.SUBJECTID
		   AND SUBJ.LVL = 3
		  LEFT OUTER JOIN PIIWME01.WAM_PDM_TBL M
		    ON M.PDM_TBL_PNM = TBL.TAB_ENG_NM
		   AND M.SUBJ_ID = #{subjId,jdbcType=VARCHAR}
		 WHERE TBL.SUBJECTNAME = #{subjLnm,jdbcType=VARCHAR}
   </select>
   
   <select id="selectDasColListbyTblId" resultMap="DasColResultMap" parameterType="kr.wise.meta.model.service.WaqPdmTbl">
		SELECT 'CU' AS RQST_DCD
			  ,#{rqstNo,jdbcType=VARCHAR} AS RQST_NO
			  ,#{rqstSno,jdbcType=VARCHAR} AS RQST_SNO
			  ,#{pdmTblPnm,jdbcType=VARCHAR} AS PDM_TBL_PNM
			  ,COL.COL_ENG_NM AS PDM_COL_PNM
			  ,COL.COL_KOR_NM AS PDM_COL_LNM
			  ,COL.DATATYPE AS DATA_TYPE
			  ,COL.COLUMN_LENGTH AS DATA_LEN
			  ,COL.COL_SEQ AS COL_ORD
			  ,COL.PK_YN AS PK_YN
			  ,CASE WHEN COL.PK_YN = 'Y' THEN COL.PK_SEQ ELSE NULL END AS PK_ORD
			  ,CASE WHEN COL.PK_YN = 'N'
			        THEN 'N'
			        WHEN COL.NULL_YN = 'Y' -- V_COLUMN 널 여부
			        THEN 'N'               -- 화면에 찍히는 널 여부
			        WHEN COL.NULL_YN IS NULL
			        THEN 'N'
			        ELSE 'Y'
			        END AS NONUL_YN
			  ,COL.DEFAULT_VALUE AS DEFLT_VAL
			  ,COL.COLDEF AS OBJ_DESCN
		  FROM PIIDAS01.DA#V_COLUMN COL
		 WHERE COL.SUBJECTID = #{subjectarea_id,jdbcType=VARCHAR}
		   AND COL.TABLEID = #{entity_id,jdbcType=VARCHAR}
	</select>
   
   <select id="selectMartListTst" resultMap="DasTblResultMap" parameterType="kr.wise.meta.model.service.WaqPdmTbl">
   	   -- DA# MART의 테이블 조회
	   SELECT NULL AS CATEGORY_ID
		      ,NULL AS MODEL_ID
			  ,TBL.SUBJECTID AS SUBJECTAREA_ID
			  ,TBL.TABLEID AS ENTITY_ID
			  ,NULL AS ATTRIBUTE_ID
			  ,NULL AS CATEGORY_NAME
			  ,NULL AS MODEL_NAME
			  ,#{subjId,jdbcType=VARCHAR} AS SUBJ_ID
			  ,#{subjLnm,jdbcType=VARCHAR} AS FULL_PATH
			  ,TBL.SUBJECTNAME AS SUBJECTAREA_NAME
			  ,NULL AS ENTITY_OWNER_NAME
			  ,TBL.TAB_ENG_NM AS ENTITY_NAME
			  ,TBL.TAB_ENG_NM AS ENTITY_NAME_PHYSICAL
			  ,TBL.TAB_KOR_NM AS ENEITY_NAME_LOGICAL
			  ,'CU' AS RQST_DCD
			  ,CASE WHEN M.PDM_TBL_ID IS NOT NULL THEN 'U' ELSE 'C' END REG_TYP_CD
			  ,TBL.TAB_ENG_NM AS PDM_TBL_PNM
			  ,TBL.TAB_KOR_NM AS PDM_TBL_LNM
			  ,NULL AS MDL_TBL_TYP_CD
			  ,TBL.TABDEF AS OBJ_DESCN
			  ,'Y' AS ENTITY_LOGICAL_YN
			  ,'I' AS IBS_STATUS
			  ,M.STD_APL_YN
		  FROM DA#V_TABLE TBL
		  LEFT OUTER JOIN WAM_PDM_TBL M
		    ON M.PDM_TBL_PNM = TBL.TAB_ENG_NM
		   AND M.SUBJ_ID = #{subjId,jdbcType=VARCHAR}
   </select>
   
   <select id="selectDasColListbyTblIdTst" resultMap="DasColResultMap" parameterType="kr.wise.meta.model.service.WaqPdmTbl">
		SELECT 'CU' AS RQST_DCD
			  ,#{rqstNo,jdbcType=VARCHAR} AS RQST_NO
			  ,#{rqstSno,jdbcType=VARCHAR} AS RQST_SNO
			  ,#{pdmTblPnm,jdbcType=VARCHAR} AS PDM_TBL_PNM
			  ,COL.COL_ENG_NM AS PDM_COL_PNM
			  ,COL.COL_KOR_NM AS PDM_COL_LNM
			  ,COL.DATATYPE AS DATA_TYPE
			  ,COL.COL_SEQ AS COL_ORD
			  ,COL.PK_YN AS PK_YN
			  ,COL.PK_SEQ AS PK_ORD
			  ,COL.DEFAULT_VALUE AS DEFLT_VAL
			  ,COL.COLDEF AS OBJ_DESCN
		  FROM DA#V_COLUMN COL
		 WHERE COL.SUBJECTID = #{subjectarea_id,jdbcType=VARCHAR}
		   AND COL.TABLEID = #{entity_id,jdbcType=VARCHAR}
	</select>
   
   <select id="selectMartListOld" resultMap="BaseResultMap" parameterType="kr.wise.meta.model.service.WaqPdmTbl">
   --DA# MART의 테이블 조회
   SELECT Z.*
<!--          ,DECODE(PDM.PDM_TBL_LNM,NULL, 'C', 'U') AS PDM_REG_YN -->
<!--          ,SUBJ.STD_APL_YN  -->
   FROM (
      SELECT B.DATA_MODEL_NAME        AS DATAMODEL_NM
	     , B.ROOT_SUBJECT_NAME      AS PRIMARY_SUBJ_NM
	     , B.SUB_SUBJECT_NAME       AS SUBJ_NM     
	     , A.TABLEID           AS MART_TBL_ID
	     , A.SUBJECTID         AS SUBJ_ID
	     , A.PARENT_SUBJECTID AS UPP_SUBJ_ID
	     , A.APP_START_DATE
	     , A.APP_END_DATE
	     , TRIM(A.TAB_KOR_NM)       AS PDM_TBL_LNM
	     , TRIM(A.TAB_ENG_NM)       AS PDM_TBL_PNM
	   <![CDATA[  , B.DATA_MODEL_NAME ||CASE WHEN  TRIM(B.ROOT_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.ROOT_SUBJECT_NAME ELSE '' END ||
	       CASE WHEN TRIM(B.SUB_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.SUB_SUBJECT_NAME ELSE '' END AS FULL_PATH]]>
	     , DBMS_LOB.SUBSTR(A.TABDEF,1000) AS OBJ_DESCN
	     , DBMS_LOB.SUBSTR(SPECIAL_REMARK ,1000) as SPECIAL_REMARK
	     , DBMS_LOB.SUBSTR(DATAPROCESSDEF ,1000) as DATAPROCESSDEF
	     , A.REFENTID AS MART_ENTITY_ID
	  FROM MODEL_NG.DA#V_TABLE A
	       INNER JOIN 
	       (SELECT 0 AS DEPTH, SUBJECTNAME AS DATA_MODEL_NAME, ' ' AS ROOT_SUBJECT_NAME, ' ' AS SUB_SUBJECT_NAME, SUBJECTID, PARENT_SUBJECTID
	          FROM MODEL_NG.DA#V_SUBJECTAREA
	         WHERE LVL = 1
	        UNION ALL
	        SELECT 1 AS DEPTH, PARENT_SUBJECTNAME AS DATA_MODEL_NAME, SUBJECTNAME AS ROOT_SUBJECT_NAME, ' ' AS SUB_SUBJECT_NAME, SUBJECTID, PARENT_SUBJECTID
	          FROM MODEL_NG.DA#V_SUBJECTAREA
	         WHERE LVL = 2
	        UNION ALL
	        SELECT 2 AS DEPTH, B.PARENT_SUBJECTNAME AS DATA_MODEL_NAME, A.PARENT_SUBJECTNAME AS ROOT_SUBJECT_NAME, A.SUBJECTNAME AS SUB_SUBJECT_NAME, A.SUBJECTID, A.PARENT_SUBJECTID
	          FROM MODEL_NG.DA#V_SUBJECTAREA A
	               INNER JOIN MODEL_NG.DA#V_SUBJECTAREA B
	                  ON A.PARENT_SUBJECTID = B.SUBJECTID
	                 AND B.LVL = 2
	         WHERE A.LVL = 3
	        ) B
	       ON A.SUBJECTID = B.SUBJECTID   
	 WHERE 1 = 1 
	   AND A.REFTABTYPE!='참조테이블'
	   AND A.TAB_KOR_NM NOT LIKE '[' || '%'
	   AND B.DATA_MODEL_NAME IN ('운영계','정보계')
	    <if test="mdlLnm!=null">
	    AND B.DATA_MODEL_NAME = #{mdlLnm}            
	    </if>
	    <if test="uppSubjLnm!=null">
	    AND B.ROOT_SUBJECT_NAME = #{uppSubjLnm}         
	    </if>
	   <if test="subjLnm!=null">
	    AND B.SUB_SUBJECT_NAME = #{subjLnm}         
	   </if>
<!-- 	   <if test="subjId!=null"> -->
<!-- 	   	 AND (B.DATA_MODEL_NAME ||CASE WHEN  TRIM(B.ROOT_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.ROOT_SUBJECT_NAME ELSE '' END || -->
<!-- 	          CASE WHEN TRIM(B.SUB_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.SUB_SUBJECT_NAME ELSE '' END  LIKE '%'||#{subjId}||'%' -->
<!-- 	          ) -->
<!--        </if>   -->
<!--        <if test="uppSubjId!=null and subjId==null"> -->
<!-- 	   	 AND (B.DATA_MODEL_NAME ||CASE WHEN  TRIM(B.ROOT_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.ROOT_SUBJECT_NAME ELSE '' END || -->
<!-- 	          CASE WHEN TRIM(B.SUB_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.SUB_SUBJECT_NAME ELSE '' END  LIKE '%'||#{uppSubjId}||'%' -->
<!-- 	          ) -->
<!--        </if> -->
<!--         <if test="mdlId!=null and uppSubjId==null and subjId==null"> -->
<!-- 	   	 AND (B.DATA_MODEL_NAME ||CASE WHEN  TRIM(B.ROOT_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.ROOT_SUBJECT_NAME ELSE '' END || -->
<!-- 	          CASE WHEN TRIM(B.SUB_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.SUB_SUBJECT_NAME ELSE '' END  LIKE '%'||#{mdlId}||'%' -->
<!-- 	          ) -->
<!--        </if>     -->
         <if test="subjLnm!=null">
	   	 AND (B.DATA_MODEL_NAME ||CASE WHEN  TRIM(B.ROOT_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.ROOT_SUBJECT_NAME ELSE '' END ||
	          CASE WHEN TRIM(B.SUB_SUBJECT_NAME) IS NOT NULL THEN '>'|| B.SUB_SUBJECT_NAME ELSE '' END  LIKE '%'||#{subjLnm}||'%'
	          )
       </if>  
        <if test="pdmTblLnm!=null">
<!--          AND (TRIM(A.TAB_KOR_NM) LIKE '%'||#{pdmTblLnm}||'%' OR TRIM(A.TAB_ENG_NM)  LIKE '%'||#{pdmTblLnm}||'%') -->
              AND (TRIM(A.TAB_KOR_NM) ${searchCond} #{pdmTblLnm} 
                OR TRIM(A.TAB_ENG_NM) ${searchCond} #{pdmTblLnm})
        </if>
        ) Z  
        
<!--         LEFT OUTER JOIN META_NG.WAA_SUBJ SUBJ -->
<!--         <![CDATA[ON SUBJ.FULL_PATH = Z.DATAMODEL_NM||CASE WHEN TRIM(Z.PRIMARY_SUBJ_NM) IS NOT NULL  -->
<!--                                                      THEN '>'||Z.PRIMARY_SUBJ_NM||  -->
<!--                                                      CASE WHEN  TRIM(Z.SUBJ_NM) IS NOT NULL THEN '>'|| Z.SUBJ_NM ELSE '' END END]]> -->
<!--         AND SUBJ.EXP_DTM = TO_DATE('99991231', 'YYYYMMDD') -->
<!--         AND REG_TYP_CD IN ('C', 'U') -->
<!--         LEFT OUTER JOIN META_NG.WAM_PDM_TBL PDM -->
<!--         ON  SUBJ.SUBJ_ID = PDM.SUBJ_ID -->
<!--         AND PDM.PDM_TBL_LNM = Z.PDM_TBL_LNM -->
<!--         <if test="regTypCd!=null"> -->
<!--         <where> -->
<!--          <if test='regTypCd=="C"'> -->
<!--             PDM.PDM_TBL_LNM IS NULL -->
<!--           </if> -->
<!--           <if test='regTypCd=="U"'> -->
<!--             PDM.PDM_TBL_LNM IS NOT NULL -->
<!--           </if> -->
<!--         </where> -->
<!--         </if> -->
        ORDER BY Z.FULL_PATH, Z.PDM_TBL_PNM
   </select>
   
   <select id="selectmartlistadd" parameterType="map" resultMap="BaseResultMap">
  	--DA# 마트 테이블 추가대상 조회... 추가용
   SELECT  RQST_NO
	      , 'I' AS IBS_STATUS
	      ,MAX(MART_TBL_ID) AS MART_TBL_ID
	      ,TRIM(PDM_TBL_LNM) AS PDM_TBL_LNM
	      ,TRIM(PDM_TBL_PNM) AS PDM_TBL_PNM
	      ,MAX(OBJ_DESCN) AS  OBJ_DESCN
	      --, MAX(UDP_ROW_BAK_FCY) AS BCK_FCY
	      , '' AS DEL_CRI
	      , '' AS DEL_MTD
	      --, MAX(UDP_ROW_DEL_FCY_UNIT)
	      --, MAX(UDP_ROW_CTD_FCY) AS CTD_FCY
	      --, MAX(UDP_ROW_CTD_FCY_UNIT)
	      , 'CU' AS RQST_DCD
	      , MDL_LNM, UPP_SUBJ_LNM, SUBJ_LNM
	      <![CDATA[  ,MDL_LNM ||CASE WHEN  TRIM(UPP_SUBJ_LNM) IS NOT NULL THEN '>'|| UPP_SUBJ_LNM ELSE '' END ||
	       CASE WHEN TRIM(SUBJ_LNM) IS NOT NULL THEN '>'|| SUBJ_LNM ELSE '' END AS FULL_PATH]]>
          --, MAX(초기건수), 
          ,MAX(INIT_CNT) AS INIT_CNT --초기건수
          ,MAX(HIS_TYPE) AS HIS_TYPE --이력유형
          --, MAX(월증가량)
          --, MAX(INC_CNT) AS INC_CNT
          ,MAX(TABLE_PERIOD) AS CTD_FCY --발생주기 --보관주기
          ,MAX(MONTHLY_ROWS) AS INC_CNT --예상발생량 --증가량월
          ,MAX(ADMIN_TERMS)  AS BCK_FCY --보존기간 --보존기한
          ,MAX(TOTAL_ROWS)   AS TOT_CNT --최대예상저장량  --총건수 
          ,MAX(SPECIAL_REMARK) AS SPECIAL_REMARK  --특이사항
          ,MAX(DATAPROCESSDEF) AS DATAPROCESSDEF  --데이터처리형식
          ,MAX(SUBTYPESET_ATTR_YN) AS SUBTYPESET_ATTR_YN  --서브타입존재여부
          ,MAX(TABLE_TYPE) AS TABLE_TYPE  --테이블타입
          ,MAX(MART_ENTITY_ID) AS MART_ENTITY_ID --마트엔터티아이디
          ,MAX(SUB_NM) AS SUB_NM --보조명
	  FROM (
                SELECT  DISTINCT #{reqmst.rqstNo} AS RQST_NO
                 , B.DATA_MODEL_NAME        AS MDL_LNM
        	     , B.ROOT_SUBJECT_NAME      AS UPP_SUBJ_LNM
        	     , B.SUB_SUBJECT_NAME       AS SUBJ_LNM     
        	     , A.TABLEID           AS MART_TBL_ID
        	     , A.SUBJECTID
        	     , A.PARENT_SUBJECTID
        	     , A.APP_START_DATE
        	     , A.APP_END_DATE
        	     , TRIM(A.TAB_KOR_NM)       AS PDM_TBL_LNM
        	     , TRIM(A.TAB_ENG_NM)       AS PDM_TBL_PNM
        	    -- , B.DATA_MODEL_NAME ||'|'|| B.ROOT_SUBJECT_NAME ||'|'|| B.SUB_SUBJECT_NAME  ||'|'|| A.TAB_KOR_NM AS FULL_PATH
        	     , DBMS_LOB.SUBSTR(A.TABDEF,4000) AS OBJ_DESCN
                 --,NVL(C.초기건수, D.초기건수) AS 초기건수
                 ,C.INIT_CNT AS INIT_CNT
                 ,C.HIS_TYPE AS HIS_TYPE
                 --,NVL(C.월증가량,D.월증가량) AS 월증가량
                 --,NVL(C.INC_CNT,D.INC_CNT) AS INC_CNT
                 ,A.TABLE_PERIOD 
                 ,A.MONTHLY_ROWS 
                 ,A.ADMIN_TERMS 
                 ,A.TOTAL_ROWS 
<!--                  , SUBSTR(DBMS_LOB.SUBSTR(SPECIAL_REMARK ,50000),4000) as SPECIAL_REMARK -->
<!-- 	             , SUBSTR(DBMS_LOB.SUBSTR(DATAPROCESSDEF ,50000),4000) as DATAPROCESSDEF -->
<!--                  ,DBMS_LOB.SUBSTR(SPECIAL_REMARK ,4000) as SPECIAL_REMARK -->
                 ,TO_CHAR(TRIM(SUBSTR(SPECIAL_REMARK,0,2500))) AS SPECIAL_REMARK
<!--                  ,DBMS_LOB.SUBSTR(DATAPROCESSDEF ,4000) as DATAPROCESSDEF -->
	             ,TO_CHAR(TRIM(SUBSTR(DATAPROCESSDEF,0,2500))) AS DATAPROCESSDEF
	             ,J.SUBTYPESET_ATTR_YN  --서브타입 존재여부
	             ,A.TABLE_TYPE --테이블타입           
	             ,A.REFENTID AS MART_ENTITY_ID
	             ,A.ALT_NM AS SUB_NM --보조명
<!--                  ,(SELECT E.ALT_NM FROM MODEL_NG.DA#V_ENTITY E -->
<!--                    WHERE E.ENTITYID =A.REFENTID) AS SUB_NM  -->
        	  FROM MODEL_NG.DA#V_TABLE A
        	       INNER JOIN 
        	       (SELECT 0 AS DEPTH, SUBJECTNAME AS DATA_MODEL_NAME, ' ' AS ROOT_SUBJECT_NAME, ' ' AS SUB_SUBJECT_NAME, SUBJECTID, PARENT_SUBJECTID
        	          FROM MODEL_NG.DA#V_SUBJECTAREA
        	         WHERE LVL = 1
        	        UNION ALL
        	        SELECT 1 AS DEPTH, PARENT_SUBJECTNAME AS DATA_MODEL_NAME, SUBJECTNAME AS ROOT_SUBJECT_NAME, ' ' AS SUB_SUBJECT_NAME, SUBJECTID, PARENT_SUBJECTID
        	          FROM MODEL_NG.DA#V_SUBJECTAREA
        	         WHERE LVL = 2
        	        UNION ALL
        	        SELECT 2 AS DEPTH, B.PARENT_SUBJECTNAME AS DATA_MODEL_NAME, A.PARENT_SUBJECTNAME AS ROOT_SUBJECT_NAME, A.SUBJECTNAME AS SUB_SUBJECT_NAME, A.SUBJECTID, A.PARENT_SUBJECTID
        	          FROM MODEL_NG.DA#V_SUBJECTAREA A
        	               INNER JOIN MODEL_NG.DA#V_SUBJECTAREA B
        	                  ON A.PARENT_SUBJECTID = B.SUBJECTID
        	                 AND B.LVL = 2
        	         WHERE A.LVL = 3
        	        ) B
        	       ON A.SUBJECTID = B.SUBJECTID   
        	      AND A.PARENT_SUBJECTID = B.PARENT_SUBJECTID  
                LEFT OUTER JOIN (  
                                      SELECT NVL(MAX(INIT_CNT),MAX(INIT_CNT_DEF_VAL)) AS INIT_CNT
                                           ,NVL(MAX(HIS_TYPE),MAX(HIS_TYPE_DEF_VAL)) AS HIS_TYPE
                                           ,ENTITYID 
                                     FROM (
                                          SELECT 
                                                 DECODE(UDP_NM ,'초기적재량',UDP_VAL) AS INIT_CNT
                                                ,DECODE(UDP_NM ,'초기적재량',UDP_DEF_VAL) AS INIT_CNT_DEF_VAL
                                                ,DECODE(UDP_NM ,'이력유형',UDP_VAL) AS HIS_TYPE
                                                ,DECODE(UDP_NM ,'이력유형',UDP_DEF_VAL)  AS HIS_TYPE_DEF_VAL 
                                                ,ENTITYID  
                                          from MODEL_NG.DA#V_UDP_ENTITY
                                         WHERE ENTITYID IN
                                          <foreach collection="list" item="item" open="(" separator="," close=")">
              	  		                  #{item.martEntityId,jdbcType=VARCHAR}                                               
              	 		                  </foreach>    
                                         )
                                     GROUP BY ENTITYID     
                                 ) C
               ON A.REFENTID = C.ENTITYID 
<!--               LEFT OUTER JOIN (        -->
<!--                                         SELECT '초기건수' AS UDPNAME1 -->
<!--                                               ,DECODE(A.UDPNAME,'초기건수',A.DEFAULTVAL) AS INIT_CNT -->
<!--                                               ,'월증가량' AS UDPNAME2 -->
<!--                                               ,DECODE(A.UDPNAME,'월증가량',A.DEFAULTVAL) AS INC_CNT -->
<!--                                               ,A.REFAREAID  -->
<!--                                         FROM MODEL_NG.DA_UDPDEF A                                  -->
<!--                                         WHERE A.EXPIREDDATE ='99999999999999' -->
<!--                                         AND A.CLASSID = '0002'                                         -->
<!--                                  ) D -->
<!--               ON D.REFAREAID = A.SUBJECTID -->
              LEFT OUTER JOIN (SELECT MAX(J.SUBTYPESET_ATTR_YN) SUBTYPESET_ATTR_YN, J.ENTITYID 
                               FROM MODEL_NG.DA#V_ATTRIBUTE J
              	 		       WHERE J.ENTITYID IN 
                               <foreach collection="list" item="item" open="(" separator="," close=")">
              	  		       #{item.martEntityId,jdbcType=VARCHAR}                                               
              	 		       </foreach>              	 		               
                               GROUP BY J.ENTITYID
                               ) J
              ON A.REFENTID   = J.ENTITYID      
        	 WHERE 1 = 1 
              AND  A.TABLEID IN
              			<foreach collection="list" item="item" open="(" separator="," close=")">
              <!-- 	  		#{item.pdmTblLnm} -->                                            
              	  		#{item.martTblId,jdbcType=VARCHAR}                                               
              	 		</foreach>                                                             
      )
<!--       WHERE MDL_LNM IN ('운영계', '정보계') -->
      GROUP BY RQST_NO,  MDL_LNM, UPP_SUBJ_LNM, SUBJ_LNM, PDM_TBL_LNM, PDM_TBL_PNM		
  </select>
  
  <select id="selectDasColListbyTblIdOld" resultMap="DasColResult" parameterType="kr.wise.meta.model.service.WaqPdmTbl">
  --DA# 엔티티ID에 해당하는 컬럼 리스트 조회
    SELECT DISTINCT #{rqstNo,jdbcType=VARCHAR} AS RQST_NO,    
			  #{rqstSno} AS RQST_SNO,
			 'CU' AS RQST_DCD
     	     , B.ROOT_SUBJECTNAME   AS MDL_LNM
     	     , B.PARENT_SUBJECTNAME AS UPP_SUBJ_LNM
     	     , B.SUBJECTNAME        AS SUBJ_LNM
     	     , A.TAB_KOR_NM         AS PDM_TBL_LNM
     	     , UPPER(A.TAB_ENG_NM)  AS PDM_TBL_PNM
     	     , TRIM(C.COL_KOR_NM)         AS PDM_COL_LNM
     	     , TRIM(UPPER(C.COL_ENG_NM))  AS PDM_COL_PNM
     	     , C.COL_SEQ            AS COL_ORD
     	     , C.PK_YN              AS PK_YN
<!--      	     , CASE WHEN C.PK_YN = 'Y' THEN C.PK_SEQ END AS PK_ORD -->
             , CASE WHEN C.PK_YN = 'Y' THEN C.COL_SEQ END AS PK_ORD
     	     , C.FK_YN              AS FK_YN
              , DATATYPE AS DATA_TYPE          
              , TO_NUMBER(REGEXP_SUBSTR(C.COLUMN_LENGTH,'[^,]+',1,1)) AS DATA_LEN
              , TO_NUMBER(REGEXP_SUBSTR(C.COLUMN_LENGTH,'[^,]+',1,2)) AS DATA_SCAL             
     	      , DECODE(C.PK_YN, 'Y', 'Y',DECODE(C.NULL_YN,'Y','N', 'Y'))         AS NONUL_YN
     	      , C.DEFAULT_VALUE        AS DEFLT_VAL
     	      , DBMS_LOB.SUBSTR(C.COLDEF,1000) AS OBJ_DESCN
              ,NVL(D.PSI_YN,'N') AS PSI_YN
              ,NVL(D.ENC_YN,'N') AS ENC_YN
              ,D.CODE_ID AS CODE_ID
              ,NVL(D.DIS_DIV_YN,'N') AS DIS_DIV_YN--파기분리여부
<!--               ,RC.REFPARENT_TBL_ENG_NM||DECODE(RC.REFPARENT_TBL_ENG_NM,NULL,'','.')||RC.REFPARENT_COL_ENG_NM AS FK_INFO -->
<!--               ,RC.PDM_REL_PNM AS FK_NM -->
              ,RC.FK_INFO AS FK_INFO
              ,NULL  AS FK_NM
              ,C.ORIGINAL_KEY_YN AS ORGN_KEY_YN  --본질식별자
<!--               ,NULL AS SUB_COL_NM  -->
              ,C.ALT_NM AS SUB_COL_NM --컬럼보조명
     	 FROM MODEL_NG.DA#V_TABLE A
     	      INNER JOIN (
     	        SELECT X.SUBJECTNAME
     	              ,X.SUBJECTID
     	              ,X.PARENT_SUBJECTID  
     	              ,CASE LVL WHEN 1 THEN X.SUBJECTNAME ELSE X.PARENT_SUBJECTNAME END AS PARENT_SUBJECTNAME
     	              ,CASE LVL
     	                 WHEN 1 THEN X.SUBJECTNAME
     	                 WHEN 2 THEN X.PARENT_SUBJECTNAME
     	                 ELSE Y.PARENT_SUBJECTNAME
     	               END AS ROOT_SUBJECTNAME
     	          FROM MODEL_NG.DA#V_SUBJECTAREA X
     	               LEFT OUTER JOIN (
     	                 SELECT PARENT_SUBJECTNAME, PARENT_SUBJECTID, SUBJECTID
     	                   FROM MODEL_NG.DA#V_SUBJECTAREA
     	                  WHERE LVL = 2
     	               ) Y
     	                 ON X.PARENT_SUBJECTID = Y.SUBJECTID
     	      ) B
     	        ON A.SUBJECTID = B.SUBJECTID
     	       AND A.PARENT_SUBJECTID = B.PARENT_SUBJECTID  
     	      INNER JOIN MODEL_NG.DA#V_COLUMN C
     	         ON A.TABLEID = C.TABLEID
     	        AND C.COL_SEQ > 0
              LEFT OUTER JOIN ( SELECT '데이터변환여부' AS UDPNAME1
                                       ,MAX(PSI_YN) AS PSI_YN
                                       ,'암호화여부' AS UDPNAME2  
                                       ,MAX(ENC_YN) AS ENC_YN
                                       ,'클래스ID' AS UDPNAME3 
                                       ,MAX(CODE_ID) AS CODE_ID
                                       ,'파기분리여부' AS UDPNAME4 
                                       ,MAX(DIS_DIV_YN) AS DIS_DIV_YN
                                       ,ATTRIBUTEID AS ATTRIBUTEID
                                FROM (
                                      SELECT DECODE(UDP_NM,'데이터변환여부',TRIM(UDP_VAL)) AS PSI_YN
                                             , DECODE(UDP_NM,'암호화여부',TRIM(UDP_VAL)) AS ENC_YN
                                             , DECODE(UDP_NM,'클래스ID',TRIM(UDP_VAL)) AS CODE_ID
                                             , DECODE(UDP_NM,'파기분리여부',TRIM(UDP_VAL)) AS DIS_DIV_YN
                                            ,ATTRIBUTEID 
<!--                                       FROM MODEL_NG.DA#V_UDP_ATTRIBUTE -->
<!-- 뷰에서는 ORDER BY 때문에 속도가 안나와서 쿼리 직접입력 -->
                                       FROM (SELECT A.SUBJECTNAME, A.PARENT_SUBJECTNAME, E.ENTITY_NM, A.ATTRIBUTE_NM,
                                             A.UDPNAME UDP_NM,
                                             CASE WHEN A.TYPEID = '0006' THEN B.UDPVALUE
                                             ELSE DECODE( B.UDPVALUE, NULL, A.DEFAULTVAL, B.UDPVALUE ) END UDP_VAL,
                                             A.SUBJECTID, A.MODELID, A.ENTITYID, A.ATTRIBUTEID, A.UDPID,
                                             A.DEFAULTVAL UDP_DEF_VAL
                                             FROM ( SELECT A.SUBJECTNAME, A.PARENT_SUBJECTNAME, A.SUBJECTID, A.MODELID,
                                                          A.ENTITYID, A.ATTRIBUTEID, D.UDPID, D.TYPEID, A.ATTRIBUTE_NM,
                                                          D.DISPORD, D.UDPNAME, DECODE(INSTR(D.DEFAULTVAL, '^^^'), 0 , D.DEFAULTVAL, SUBSTR(D.DEFAULTVAL, '1', INSTR(D.DEFAULTVAL, '^^^')-1) ) DEFAULTVAL
                                                   FROM MODEL_NG.DA#V_ATTRIBUTE A, MODEL_NG.DA_UDPDEF D
                                                   WHERE D.REFAREAID = A.MODELID
                                                   AND D.EXPIREDDATE = '99999999999999'
                                                   AND D.CLASSID = '0003' ) A, MODEL_NG.DA_UDPVALUE B, MODEL_NG.DA#V_ENTITY E
                                            WHERE A.ATTRIBUTEID = B.OBJID(+)
                                            AND A.UDPID = B.UDPID(+)
                                            AND B.EXPIREDDATE(+) = '99999999999999'
                                            AND A.ENTITYID = E.ENTITYID(+)
                                            )
                                      WHERE ENTITYID = #{martEntityId,jdbcType=VARCHAR}                                                     
                                     )
                                 GROUP BY ATTRIBUTEID 
                                 ) D
               ON C.ATTRIBUTEID  = D.ATTRIBUTEID  
                LEFT OUTER JOIN (
                                      SELECT Z.CHILDENTID
                                           ,Z.REFCHILD_COLID
                                              ,SUBSTR(XMLAGG(XMLELEMENT(x, ',',RELID||'.'||Z.PARENT_TAB_ENG_NM||'.'||Z.REFPARENT_COL_ENG_NM) ORDER BY Z.PARENT_TAB_ENG_NM).Extract('//text()'),2) AS FK_INFO
                                     FROM MODEL_NG.DA#V_RELATIONSHIP_COLS Z
                                     WHERE Z.CHILDENTID = #{martTblId,jdbcType=VARCHAR}
                                     GROUP BY Z.CHILDENTID,Z.REFCHILD_COLID 
                                    ) RC
                   ON RC.CHILDENTID =  A.TABLEID  
                  AND RC.REFCHILD_COLID = C.COLUMNID
              	WHERE 1 = 1	 
                  AND A.TABLEID  = #{martTblId,jdbcType=VARCHAR}
                  AND C.COL_ENG_NM IS NOT NULL
                  AND C.COL_KOR_NM IS NOT NULL
  </select>
   <insert id="insertDasColListbyTblIdsDirect" parameterType="map">
  --DA# 엔티티ID에 해당하는 컬럼 리스트 테이블에 직접 인서트(속도문제)
   INSERT INTO META_NG.WAQ_PDM_COL  
   (                      
       RQST_NO
       ,RQST_SNO
       ,RQST_DTL_SNO
       ,RQST_DCD
       ,MDL_LNM
       ,UPP_SUBJ_LNM
       ,SUBJ_LNM
       ,PDM_TBL_PNM
       ,PDM_COL_LNM
       ,PDM_COL_PNM
       ,COL_ORD
       ,PK_YN
       ,PK_ORD
<!--        ,FK_YN -->
       ,DATA_TYPE
       ,DATA_LEN
       ,DATA_SCAL
       ,NONUL_YN
       ,DEFLT_VAL
       ,OBJ_DESCN
       ,PSI_YN
       ,ENC_YN
       ,CODE_ID
       ,DIS_DIV_YN
       ,FK_INFO
       ,FK_NM
       ,ORGN_KEY_YN
       ,SUB_COL_NM
       ,RQST_USER_ID
<!--         ,FRS_RQST_USER_ID -->
       )                  
           SELECT DISTINCT #{reqmst.rqstNo,jdbcType=VARCHAR} AS RQST_NO    
<!-- 			 ,#{rqstSno} AS RQST_SNO -->
			 , DENSE_RANK() OVER (PARTITION BY #{reqmst.rqstNo,jdbcType=VARCHAR} ORDER BY C.TABLEID) +70000 AS RQST_SNO --임시로 RQST_SNO넣고 나중에 업데이트
			 , COL_SEQ RQST_DTL_SNO
			 , 'CU' AS RQST_DCD
		     , B.ROOT_SUBJECTNAME   AS MDL_LNM
     	     , B.PARENT_SUBJECTNAME AS UPP_SUBJ_LNM
     	     , B.SUBJECTNAME        AS SUBJ_LNM
     	     , UPPER(A.TAB_ENG_NM)  AS PDM_TBL_PNM
     	     , TRIM(C.COL_KOR_NM)         AS PDM_COL_LNM
     	     , TRIM(UPPER(C.COL_ENG_NM))  AS PDM_COL_PNM
     	     , C.COL_SEQ            AS COL_ORD
     	     , C.PK_YN              AS PK_YN
     	     , CASE WHEN C.PK_YN = 'Y' THEN C.PK_SEQ END AS PK_ORD
<!--      	     , C.FK_YN              AS FK_YN -->
              , DATATYPE AS DATA_TYPE          
              , TO_NUMBER(REGEXP_SUBSTR(C.COLUMN_LENGTH,'[^,]+',1,1)) AS DATA_LEN
              , TO_NUMBER(REGEXP_SUBSTR(C.COLUMN_LENGTH,'[^,]+',1,2)) AS DATA_SCAL             
     	      , DECODE(C.PK_YN, 'Y', 'Y',DECODE(C.NULL_YN,'Y','N', 'Y'))         AS NONUL_YN
     	      , C.DEFAULT_VALUE        AS DEFLT_VAL
     	      , DBMS_LOB.SUBSTR(C.COLDEF,1000) AS OBJ_DESCN
              ,NVL(D.PSI_YN,'N') AS PSI_YN
              ,NVL(D.ENC_YN,'N') AS ENC_YN
              ,D.CODE_ID AS CODE_ID
              ,NVL(D.DIS_DIV_YN,'Y') --파기분리여부
<!--               ,RC.REFPARENT_TBL_ENG_NM||DECODE(RC.REFPARENT_TBL_ENG_NM,NULL,'','.')||RC.REFPARENT_COL_ENG_NM AS FK_INFO -->
<!--               ,RC.PDM_REL_PNM AS FK_NM -->
              ,RC.FK_INFO AS FK_INFO
              ,NULL  AS FK_NM
              ,C.ORIGINAL_KEY_YN AS ORGN_KEY_YN  --본질식별자
<!--               ,NULL AS SUB_COL_NM  -->
              ,C.ALT_NM AS SUB_COL_NM --컬럼보조명
              ,#{reqmst.rqstUserId,jdbcType=VARCHAR} AS RQST_USER_ID 
<!--               ,#{reqmst.frsRqstUserId} AS FRS_RQST_USER_ID  -->
     	 FROM MODEL_NG.DA#V_TABLE A
     	      INNER JOIN (
     	        SELECT X.SUBJECTNAME
     	              ,X.SUBJECTID
     	              ,X.PARENT_SUBJECTID  
     	              ,CASE LVL WHEN 1 THEN X.SUBJECTNAME ELSE X.PARENT_SUBJECTNAME END AS PARENT_SUBJECTNAME
     	              ,CASE LVL
     	                 WHEN 1 THEN X.SUBJECTNAME
     	                 WHEN 2 THEN X.PARENT_SUBJECTNAME
     	                 ELSE Y.PARENT_SUBJECTNAME
     	               END AS ROOT_SUBJECTNAME
     	          FROM MODEL_NG.DA#V_SUBJECTAREA X
     	               LEFT OUTER JOIN (
     	                 SELECT PARENT_SUBJECTNAME, PARENT_SUBJECTID, SUBJECTID
     	                   FROM MODEL_NG.DA#V_SUBJECTAREA
     	                  WHERE LVL = 2
     	               ) Y
     	                 ON X.PARENT_SUBJECTID = Y.SUBJECTID
     	      ) B
     	        ON A.SUBJECTID = B.SUBJECTID
     	       AND A.PARENT_SUBJECTID = B.PARENT_SUBJECTID  
     	      INNER JOIN MODEL_NG.DA#V_COLUMN C
     	         ON A.TABLEID = C.TABLEID
     	        AND C.COL_SEQ > 0
              LEFT OUTER JOIN ( SELECT '데이터변환여부' AS UDPNAME1
                                       ,MAX(PSI_YN) AS PSI_YN
                                       ,'암호화여부' AS UDPNAME2  
                                       ,MAX(ENC_YN) AS ENC_YN
                                       ,'클래스ID' AS UDPNAME3 
                                       ,MAX(CODE_ID) AS CODE_ID
                                       ,'파기분리여부' AS UDPNAME4 
                                       ,MAX(DIS_DIV_YN) AS DIS_DIV_YN
                                       ,ATTRIBUTEID AS ATTRIBUTEID
                                FROM (
                                      SELECT DECODE(UDP_NM,'데이터변환여부',TRIM(UDP_VAL)) AS PSI_YN
                                             , DECODE(UDP_NM,'암호화여부',TRIM(UDP_VAL)) AS ENC_YN
                                             , DECODE(UDP_NM,'클래스ID',TRIM(UDP_VAL)) AS CODE_ID
                                             , DECODE(UDP_NM,'파기분리여부',TRIM(UDP_VAL)) AS DIS_DIV_YN
                                            ,ATTRIBUTEID 
<!--                                       FROM MODEL_NG.DA#V_UDP_ATTRIBUTE -->
<!-- 뷰에서는 ORDER BY 때문에 속도가 안나와서 쿼리 직접입력 -->
                                       FROM (SELECT A.SUBJECTNAME, A.PARENT_SUBJECTNAME, E.ENTITY_NM, A.ATTRIBUTE_NM,
                                             A.UDPNAME UDP_NM,
                                             CASE WHEN A.TYPEID = '0006' THEN B.UDPVALUE
                                             ELSE DECODE( B.UDPVALUE, NULL, A.DEFAULTVAL, B.UDPVALUE ) END UDP_VAL,
                                             A.SUBJECTID, A.MODELID, A.ENTITYID, A.ATTRIBUTEID, A.UDPID,
                                             A.DEFAULTVAL UDP_DEF_VAL
                                             FROM ( SELECT A.SUBJECTNAME, A.PARENT_SUBJECTNAME, A.SUBJECTID, A.MODELID,
                                                          A.ENTITYID, A.ATTRIBUTEID, D.UDPID, D.TYPEID, A.ATTRIBUTE_NM,
                                                          D.DISPORD, D.UDPNAME, DECODE(INSTR(D.DEFAULTVAL, '^^^'), 0 , D.DEFAULTVAL, SUBSTR(D.DEFAULTVAL, '1', INSTR(D.DEFAULTVAL, '^^^')-1) ) DEFAULTVAL
                                                   FROM MODEL_NG.DA#V_ATTRIBUTE A, MODEL_NG.DA_UDPDEF D
                                                   WHERE D.REFAREAID = A.MODELID
                                                   AND D.EXPIREDDATE = '99999999999999'
                                                   AND D.CLASSID = '0003' ) A, MODEL_NG.DA_UDPVALUE B, MODEL_NG.DA#V_ENTITY E
                                            WHERE A.ATTRIBUTEID = B.OBJID(+)
                                            AND A.UDPID = B.UDPID(+)
                                            AND B.EXPIREDDATE(+) = '99999999999999'
                                            AND A.ENTITYID = E.ENTITYID(+)
                                            )
                                      WHERE ENTITYID  IN <foreach collection="list" item="item" open="(" separator="," close=")">
              	  		                                 #{item.martEntityId,jdbcType=VARCHAR}                                                     
              	 		                                 </foreach>                                                      
                                     )
                                 GROUP BY ATTRIBUTEID 
                                 ) D
               ON C.ATTRIBUTEID  = D.ATTRIBUTEID  
                LEFT OUTER JOIN (
                                      SELECT Z.CHILDENTID
                                           ,Z.REFCHILD_COLID
                                             ,SUBSTR(XMLAGG(XMLELEMENT(x, ',',RELID||'.'||Z.PARENT_TAB_ENG_NM||'.'||Z.REFPARENT_COL_ENG_NM) ORDER BY Z.PARENT_TAB_ENG_NM).Extract('//text()'),2) AS FK_INFO
                                           
                                     FROM MODEL_NG.DA#V_RELATIONSHIP_COLS Z
                                     WHERE Z.CHILDENTID IN	
                                     <foreach collection="list" item="item" open="(" separator="," close=")">
              	  		             #{item.martTblId,jdbcType=VARCHAR}                                                     
              	 		             </foreach>             
                                     GROUP BY Z.CHILDENTID,Z.REFCHILD_COLID
                                    ) RC
                   ON RC.CHILDENTID =  A.TABLEID  
                  AND RC.REFCHILD_COLID = C.COLUMNID
              	WHERE 1 = 1	 
                  AND A.TABLEID IN   <foreach collection="list" item="item" open="(" separator="," close=")">
              	  		             #{item.martTblId,jdbcType=VARCHAR}                                                     
              	 		             </foreach>           
                  AND C.COL_ENG_NM IS NOT NULL
                  AND C.COL_KOR_NM IS NOT NULL
  </insert>
  
  
  
  <select id="selectDasMartRelLst" resultMap="DasRelResult" parameterType="kr.wise.meta.model.service.WaqPdmTbl" >
SELECT  #{rqstNo} AS RQST_NO
      , #{rqstSno} AS RQST_SNO
      ,'CU' AS RQST_DCD
<!--       ,MDL_LNM,UPP_SUBJ_LNM,SUBJ_LNM -->
      ,NVL(PDM_REL_PNM, 'FK_'||CH_ENTY_PNM||'_'||TO_CHAR(ROW_NUMBER() 
       OVER(ORDER BY CH_ENTY_PNM,CH_ENTY_LNM ,CH_ATTR_PNM, CH_ATTR_LNM,PA_ENTY_PNM
      ,PA_ENTY_LNM,PA_ATTR_PNM ,PA_ATTR_LNM))) AS PDM_REL_PNM
      ,CH_SUBJ_PNM
      ,CH_ENTY_PNM
      ,CH_ENTY_LNM 
      ,CH_ATTR_PNM
      ,CH_ATTR_LNM
      ,PA_SUBJ_PNM
      ,PA_ENTY_PNM
      ,PA_ENTY_LNM
      ,PA_ATTR_PNM
      ,PA_ATTR_LNM
      ,REL_TYP_CD
      ,PA_OPT_TYP_CD
      ,CRD_TYP_CD
   FROM (   
			SELECT 
			        R.RELNAME AS PDM_REL_PNM, --릴레이션 이름
                    B.ROOT_SUBJECTNAME||'>'||B.PARENT_SUBJECTNAME||'>'||B.SUBJECTNAME AS PA_SUBJ_PNM,
                    C.ROOT_SUBJECTNAME||'>'||C.PARENT_SUBJECTNAME||'>'||C.SUBJECTNAME AS CH_SUBJ_PNM,
            	    RC.PARENT_TAB_KOR_NM AS PA_ENTY_LNM,
            	    RC.PARENT_TAB_ENG_NM AS PA_ENTY_PNM, 
            	    RC.PARENT_TAB_KOR_NM AS PARENT_TAB_KNM,
            	    RC.PARENT_TAB_ENG_NM AS PARENT_TAB_ENM,
            	    RC.CHILD_TAB_KOR_NM AS CH_ENTY_LNM,
            	    RC.CHILD_TAB_ENG_NM AS CH_ENTY_PNM,
            	    RC.REFPARENT_COL_KOR_NM AS PA_ATTR_LNM,
            	    RC.REFPARENT_COL_ENG_NM AS PA_ATTR_PNM,    
            	    RC.REFCHILD_COL_KOR_NM AS CH_ATTR_LNM,
            	    RC.REFCHILD_COL_ENG_NM AS CH_ATTR_PNM,
            	    R.RELID AS RELATION_ID,
            	    ROWNUM AS DTL_SEQ,
            	    CASE WHEN IDEN_YN='Y' THEN 'I' ELSE 'N' END AS REL_TYP_CD,
                    R.GEN_FK_CONST,
                    CASE WHEN PARENT_OPTIONALITY = 'OPTIONAL' THEN 'NA' ELSE 'NN' END AS PA_OPT_TYP_CD,
                    R.CHILD_OPTIONALITY,
                    R.PARENT_CARDINALITY,
                    R.CHILD_CARDINALITY,
                    CASE WHEN PARENT_CARDINALITY = '1' AND CHILD_CARDINALITY = 'M' 
                          AND PARENT_OPTIONALITY ='OPTIONAL' AND CHILD_OPTIONALITY='OPTIONAL'
                    THEN 'ZER' 
                    WHEN PARENT_CARDINALITY = '1' AND CHILD_CARDINALITY = 'M' 
                     AND PARENT_OPTIONALITY ='OPTIONAL' AND CHILD_OPTIONALITY='MANDATORY'
                    THEN 'ONE' 
                    WHEN PARENT_CARDINALITY = '1' AND CHILD_CARDINALITY = '1' 
                     AND PARENT_OPTIONALITY ='OPTIONAL' AND CHILD_OPTIONALITY='OPTIONAL'
                    THEN 'ZOO' 
                    WHEN PARENT_CARDINALITY = '1' AND CHILD_CARDINALITY = '1' 
                     AND PARENT_OPTIONALITY ='MANDATORY' AND CHILD_OPTIONALITY='MANDATORY'
                    THEN 'EXA' END AS CRD_TYP_CD
            	FROM MODEL_NG.DA#V_RELATIONSHIP R
                INNER JOIN MODEL_NG.DA#V_TABLE Z
                ON R.PARENTENTID = Z.TABLEID 
                INNER JOIN MODEL_NG.DA#V_TABLE N
                ON R.CHILDENTID = N.TABLEID
            	    INNER JOIN (
            		         SELECT X.SUBJECTNAME
            		               ,X.SUBJECTID
            		               ,CASE LVL WHEN 1 THEN X.SUBJECTNAME ELSE X.PARENT_SUBJECTNAME END AS PARENT_SUBJECTNAME
            		               ,CASE LVL
            		                  WHEN 1 THEN X.SUBJECTNAME
            		                  WHEN 2 THEN X.PARENT_SUBJECTNAME
            		                  ELSE Y.PARENT_SUBJECTNAME
            		                END AS ROOT_SUBJECTNAME
            		           FROM MODEL_NG.DA#V_SUBJECTAREA X
            		                LEFT OUTER JOIN (
            		                  SELECT PARENT_SUBJECTNAME, PARENT_SUBJECTID, SUBJECTID
            		                    FROM MODEL_NG.DA#V_SUBJECTAREA
            		                   WHERE LVL = 2
            		                ) Y
            		                  ON X.PARENT_SUBJECTID = Y.SUBJECTID
            		       ) B
            	    ON Z.SUBJECTID= B.SUBJECTID -- PARENT SUBJAREA
                     INNER JOIN (
            		         SELECT X.SUBJECTNAME
            		               ,X.SUBJECTID
            		               ,CASE LVL WHEN 1 THEN X.SUBJECTNAME ELSE X.PARENT_SUBJECTNAME END AS PARENT_SUBJECTNAME
            		               ,CASE LVL
            		                  WHEN 1 THEN X.SUBJECTNAME
            		                  WHEN 2 THEN X.PARENT_SUBJECTNAME
            		                  ELSE Y.PARENT_SUBJECTNAME
            		                END AS ROOT_SUBJECTNAME
            		           FROM MODEL_NG.DA#V_SUBJECTAREA X
            		                LEFT OUTER JOIN (
            		                  SELECT PARENT_SUBJECTNAME, PARENT_SUBJECTID, SUBJECTID
            		                    FROM MODEL_NG.DA#V_SUBJECTAREA
            		                   WHERE LVL = 2
            		                ) Y
            		                  ON X.PARENT_SUBJECTID = Y.SUBJECTID
            		       ) C
                    ON N.SUBJECTID = C.SUBJECTID -- CHILD_TAB_SUBJECTID
            	   INNER JOIN (SELECT Z.RELID, 
                                    Z.CHILDENTID ,
                                    Z.PARENT_TAB_KOR_NM,
                                    Z.PARENT_TAB_ENG_NM,
                                    Z.CHILD_TAB_KOR_NM,
                                    Z.CHILD_TAB_ENG_NM,
                                    Z.REFPARENT_COLID,
                                    Z.REFPARENT_COL_KOR_NM,
                                    Z.REFPARENT_COL_ENG_NM,
                                    Z.REFCHILD_COLID,
                                    Z.REFCHILD_COL_KOR_NM ,
                                    Z.REFCHILD_COL_ENG_NM
                                    FROM MODEL_NG.DA#V_RELATIONSHIP_COLS Z
                                    WHERE Z.CHILDENTID  = #{martTblId}
                                    ) RC
                    ON  RC.RELID = R.RELID   
            	  WHERE 1=1 
            	  AND N.TABLEID  = #{martTblId}
            	 <if test="subjLnm!=null">
	              AND (B.ROOT_SUBJECTNAME ||CASE WHEN  TRIM(B.PARENT_SUBJECTNAME) IS NOT NULL THEN '>'|| B.PARENT_SUBJECTNAME ELSE '' END ||
	              CASE WHEN TRIM(B.SUBJECTNAME) IS NOT NULL THEN '>'|| B.SUBJECTNAME ELSE '' END  LIKE '%'||#{subjLnm}||'%'
	              )
                 </if>
            		AND R.PARENT_TAB_ENG_NM IS NOT NULL
                    AND R.CHILD_TAB_ENG_NM IS NOT NULL
            		AND R.PARENT_TAB_ENG_NM NOT LIKE '[%'
            		AND R.CHILD_TAB_ENG_NM NOT LIKE '[%'
            		AND R.PARENT_TAB_KOR_NM NOT LIKE '[%'
            		AND R.CHILD_TAB_KOR_NM NOT LIKE '[%'
            	  ORDER BY C.ROOT_SUBJECTNAME,C.PARENT_SUBJECTNAME,C.SUBJECTNAME) A    
     WHERE 1 = 1
GROUP BY  PA_SUBJ_PNM,CH_SUBJ_PNM,PDM_REL_PNM ,CH_ENTY_PNM,CH_ENTY_LNM ,CH_ATTR_PNM, CH_ATTR_LNM,PA_ENTY_PNM ,PA_ENTY_LNM,PA_ATTR_PNM ,PA_ATTR_LNM, REL_TYP_CD,PA_OPT_TYP_CD,CRD_TYP_CD
 ORDER BY CH_ENTY_PNM, PDM_REL_PNM
</select>
    
 <select id="selectDasColListbyTblIds" resultMap="DasColResult" parameterType="map">
  --DA# 엔티티ID에 해당하는 컬럼 리스트 조회
    SELECT  
<!--              DISTINCT #{reqmst.rqstNo,jdbcType=VARCHAR} AS RQST_NO     -->
             #{reqmst.rqstNo,jdbcType=VARCHAR} AS RQST_NO
<!-- 			  #{rqstSno} AS RQST_SNO, -->
             , DENSE_RANK() OVER (PARTITION BY #{reqmst.rqstNo,jdbcType=VARCHAR} ORDER BY C.TABLEID) +70000 AS RQST_SNO --임시로 RQST_SNO넣고 나중에 업데이트
             , DENSE_RANK() OVER (PARTITION BY C.TABLEID ORDER BY C.COL_SEQ) AS RQST_DTL_SNO --테이블별 시퀀스
             , A.TABLEID AS MART_TBL_ID
			 , 'CU' AS RQST_DCD
     	     , B.ROOT_SUBJECTNAME   AS MDL_LNM
     	     , B.PARENT_SUBJECTNAME AS UPP_SUBJ_LNM
     	     , B.SUBJECTNAME        AS SUBJ_LNM
     	     , A.TAB_KOR_NM         AS PDM_TBL_LNM
     	     , UPPER(A.TAB_ENG_NM)  AS PDM_TBL_PNM
     	     , TRIM(C.COL_KOR_NM)         AS PDM_COL_LNM
     	     , TRIM(UPPER(C.COL_ENG_NM))  AS PDM_COL_PNM
     	     , C.COL_SEQ            AS COL_ORD
     	     , C.PK_YN              AS PK_YN
<!--      	     , CASE WHEN C.PK_YN = 'Y' THEN C.PK_SEQ END AS PK_ORD -->
<!--              , CASE WHEN C.PK_YN = 'Y' THEN C.COL_SEQ END AS PK_ORD -->
             , CASE WHEN C.PK_YN = 'Y' THEN C.PK_SEQ END AS PK_ORD
     	     , C.FK_YN              AS FK_YN
              , DATATYPE AS DATA_TYPE          
              , TO_NUMBER(REGEXP_SUBSTR(C.COLUMN_LENGTH,'[^,]+',1,1)) AS DATA_LEN
              , TO_NUMBER(REGEXP_SUBSTR(C.COLUMN_LENGTH,'[^,]+',1,2)) AS DATA_SCAL             
     	      , DECODE(C.PK_YN, 'Y', 'Y',DECODE(C.NULL_YN,'Y','N', 'Y'))         AS NONUL_YN
     	      , C.DEFAULT_VALUE        AS DEFLT_VAL
     	      , DBMS_LOB.SUBSTR(C.COLDEF,1000) AS OBJ_DESCN
              ,NVL(D.PSI_YN,'N') AS PSI_YN
              ,NVL(D.ENC_YN,'N') AS ENC_YN
              ,D.CODE_ID AS CODE_ID
              ,NVL(D.DIS_DIV_YN,'N') AS DIS_DIV_YN--파기분리여부
<!--               ,RC.REFPARENT_TBL_ENG_NM||DECODE(RC.REFPARENT_TBL_ENG_NM,NULL,'','.')||RC.REFPARENT_COL_ENG_NM AS FK_INFO -->
<!--               ,RC.PDM_REL_PNM AS FK_NM -->
              ,RC.FK_INFO AS FK_INFO
              ,NULL AS FK_NM
              ,C.ORIGINAL_KEY_YN AS ORGN_KEY_YN  --본질식별자
              ,C.ALT_NM AS SUB_COL_NM --컬럼보조명
              ,C.AK_YN --보조식별자
     	 FROM MODEL_NG.DA#V_TABLE A
     	      INNER JOIN (
     	        SELECT X.SUBJECTNAME
     	              ,X.SUBJECTID
     	              ,X.PARENT_SUBJECTID  
     	              ,CASE LVL WHEN 1 THEN X.SUBJECTNAME ELSE X.PARENT_SUBJECTNAME END AS PARENT_SUBJECTNAME
     	              ,CASE LVL
     	                 WHEN 1 THEN X.SUBJECTNAME
     	                 WHEN 2 THEN X.PARENT_SUBJECTNAME
     	                 ELSE Y.PARENT_SUBJECTNAME
     	               END AS ROOT_SUBJECTNAME
     	          FROM MODEL_NG.DA#V_SUBJECTAREA X
     	               LEFT OUTER JOIN (
     	                 SELECT PARENT_SUBJECTNAME, PARENT_SUBJECTID, SUBJECTID
     	                   FROM MODEL_NG.DA#V_SUBJECTAREA
     	                  WHERE LVL = 2
     	               ) Y
     	                 ON X.PARENT_SUBJECTID = Y.SUBJECTID     	     
     	      )B
     	        ON A.SUBJECTID = B.SUBJECTID
     	       AND A.PARENT_SUBJECTID = B.PARENT_SUBJECTID  
<!--      	      INNER JOIN MODEL_NG.DA#V_COLUMN C -->
               INNER JOIN (SELECT 
<!--                D.SUBJECTNAME,D.PARENT_SUBJECTNAME, -->
                              	A.COLID COLUMNID,
                              	A.REGISTERDATE AS APP_START_DATE,
                              	A.EXPIREDDATE AS APP_END_DATE,
                              	A.REFENTID AS TABLEID,
<!--                                 D.SUBJECTID AS SUBJECTID, -->
                                A.REFAREAID AS MODELID,
<!--                               	D.PARENT_SUBJECTID, -->
                              	A.MODELATTRID AS ATTRIBUTEID,
                              	A.ATTRNAME AS COL_KOR_NM,
                              	A.COLNAME AS COL_ENG_NM,
                              	A.ALTNATTRNAME AS ALT_NM,
                              	DECODE(A.BSUBJECT,'1','Y','N') AS ORIGINAL_KEY_YN,
                              	DECODE(A.BPRIMARY,'1','Y','N') AS PK_YN,
                              	DECODE(A.BUNIQ,'1','Y','N') AS AK_YN,
                              	A.COLTYPE AS DATATYPE,
                              	A.COLLEN AS COLUMN_LENGTH,
                              	A.SEQNUM+1 AS COL_SEQ,
                              	A.DEFVAL DEFAULT_VALUE,
                              	DECODE(A.BFKMODEL,'1','Y','N') FK_YN,
                              	DECODE(A.BNULL,'1','Y','N') NULL_YN,
                               	DECODE(A.BSUBSET,'1','Y','N') AS SUBTYPESET_COL_YN,
                               	DECODE(A.ATTRTYPE,'0','NORMAL','1','PSEUDO','2','ADDITIONAL','3','DROP','4','SYSTEM','6','DERIVED', 'UNUSED') AS COL_TYPE,
                              	B.DEFINITIONREM COLDEF,
                              	DECODE(A.BPRIMARY,'1', TRUNC(INSTR(C.COLIDS,A.COLID)/37) + 1, '') PK_SEQ
                              FROM MODEL_NG.DA_COLUMN A
                              LEFT OUTER JOIN MODEL_NG.DA_REMARK B
                               ON A.COLID = B.REFOBJECTID
                              AND A.EXPIREDDATE = '99999999999999'
                              AND B.EXPIREDDATE= '99999999999999'
                              LEFT OUTER JOIN MODEL_NG.DA_CONSTRAINT C
                              ON A.REFENTID = C.REFTABID
                              AND A.REFAREAID = C.REFAREAID
                              AND C.CONSTTYPENAME = 'PRIMARY KEY'
                              AND C.EXPIREDDATE = '99999999999999'
<!--                               LEFT OUTER JOIN DA#V_MODEL D  -->
<!--                               ON A.REFAREAID = D.PHYSICAL_MODELID -->
                              WHERE A.EXPIREDDATE = '99999999999999'
               ) C
                ON A.TABLEID = C.TABLEID
<!--      	        AND C.COL_SEQ > 0 -->
              LEFT OUTER JOIN ( SELECT '데이터변환여부' AS UDPNAME1
                                       ,MAX(PSI_YN) AS PSI_YN
                                       ,'암호화여부' AS UDPNAME2  
                                       ,MAX(ENC_YN) AS ENC_YN
                                       ,'클래스ID' AS UDPNAME3 
                                       ,MAX(CODE_ID) AS CODE_ID
                                       ,'파기분리여부' AS UDPNAME4 
                                       ,MAX(DIS_DIV_YN) AS DIS_DIV_YN
                                       ,ATTRIBUTEID AS ATTRIBUTEID
                                FROM (
                                      SELECT DECODE(UDP_NM,'데이터변환여부',TRIM(UDP_VAL)) AS PSI_YN
                                             , DECODE(UDP_NM,'암호화여부',TRIM(UDP_VAL)) AS ENC_YN
                                             , DECODE(UDP_NM,'클래스ID',TRIM(UDP_VAL)) AS CODE_ID
                                             , DECODE(UDP_NM,'파기분리여부',TRIM(UDP_VAL)) AS DIS_DIV_YN
                                            ,ATTRIBUTEID 
<!--                                       FROM MODEL_NG.DA#V_UDP_ATTRIBUTE -->
<!-- 뷰에서는 ORDER BY 때문에 속도가 안나와서 쿼리 직접입력 -->
<!--                                        FROM (SELECT A.SUBJECTNAME, A.PARENT_SUBJECTNAME -->
<!--                                                   , A.ATTRIBUTE_NM, -->
<!--                                                     A.UDPNAME UDP_NM, -->
<!--                                                     CASE WHEN A.TYPEID = '0006' THEN B.UDPVALUE -->
<!--                                                     ELSE DECODE( B.UDPVALUE, NULL, A.DEFAULTVAL, B.UDPVALUE ) END UDP_VAL, -->
<!--                                                     A.SUBJECTID, A.MODELID, A.ENTITYID, A.ATTRIBUTEID, A.UDPID, -->
<!--                                                     A.DEFAULTVAL UDP_DEF_VAL -->
<!--                                               FROM ( SELECT A.SUBJECTNAME, A.PARENT_SUBJECTNAME, A.SUBJECTID, A.MODELID, -->
<!--                                                                A.ENTITYID, A.ATTRIBUTEID, D.UDPID, D.TYPEID, A.ATTRIBUTE_NM, -->
<!--                                                                D.DISPORD, D.UDPNAME, DECODE(INSTR(D.DEFAULTVAL, '^^^'), 0 , D.DEFAULTVAL, SUBSTR(D.DEFAULTVAL, '1', INSTR(D.DEFAULTVAL, '^^^')-1) ) DEFAULTVAL -->
<!--                                                         FROM MODEL_NG.DA#V_ATTRIBUTE A, MODEL_NG.DA_UDPDEF D -->
<!--                                                         WHERE D.REFAREAID = A.MODELID -->
<!--                                                         AND D.UDPNAME IN ('데이터변환여부', '암호화여부','클래스ID','파기분리여부') -->
<!--                                                         AND D.EXPIREDDATE = '99999999999999' -->
<!--                                                         AND D.CLASSID = '0003' ) A, MODEL_NG.DA_UDPVALUE B -->
                                                 
<!--                                             WHERE A.ATTRIBUTEID = B.OBJID(+) -->
<!--                                             AND A.UDPID = B.UDPID(+) -->
<!--                                             AND B.EXPIREDDATE(+) = '99999999999999' -->
<!--                                             ) -->
<!--                                              WHERE ENTITYID IN       -->
<!--                                                           <foreach collection="list" item="item" open="(" separator="," close=")"> -->
<!--               	  		                                  #{item.martEntityId,jdbcType=VARCHAR}                                                      -->
<!--               	 		                                  </foreach>                                                                 -->
                                      FROM (SELECT A.SUBJECTNAME, A.PARENT_SUBJECTNAME
                                             , A.ATTRIBUTE_NM,
                                             A.UDPNAME UDP_NM,
                                             CASE WHEN A.TYPEID = '0006' THEN A.UDPVALUE
                                             ELSE DECODE( A.UDPVALUE, NULL, A.DEFAULTVAL, A.UDPVALUE ) END UDP_VAL,
                                             A.SUBJECTID, A.MODELID, A.ENTITYID, A.ATTRIBUTEID, A.UDPID,
                                             A.DEFAULTVAL UDP_DEF_VAL
                                             FROM ( SELECT A.SUBJECTNAME, A.PARENT_SUBJECTNAME, A.SUBJECTID, A.MODELID,
                                                          A.ENTITYID, A.ATTRIBUTEID, D.UDPID, D.TYPEID, A.ATTRIBUTE_NM,
                                                          D.DISPORD, D.UDPNAME, DECODE(INSTR(D.DEFAULTVAL, '^^^'), 0 , D.DEFAULTVAL, SUBSTR(D.DEFAULTVAL, '1', INSTR(D.DEFAULTVAL, '^^^')-1) ) DEFAULTVAL
                                                          ,B.UDPVALUE
                                                   FROM MODEL_NG.DA#V_ATTRIBUTE A
                                                   INNER JOIN MODEL_NG.DA_UDPDEF D 
                                                   ON D.REFAREAID = A.MODELID
                                                   AND D.UDPNAME IN ('데이터변환여부', '암호화여부','클래스ID','파기분리여부')
                                                   AND D.EXPIREDDATE = '99999999999999'
                                                   AND D.CLASSID = '0003' 
                                                   LEFT OUTER JOIN MODEL_NG.DA_UDPVALUE B
                                                   ON A.ATTRIBUTEID = B.OBJID
                                                   AND D.UDPID = B.UDPID
                                                   AND B.EXPIREDDATE = '99999999999999'
                                            
                                             WHERE A.ENTITYID IN      
                                                          <foreach collection="list" item="item" open="(" separator="," close=")">
              	  		                                  #{item.martEntityId,jdbcType=VARCHAR}                                                     
              	 		                                  </foreach>     ) A            
                                     )
                                 )
                                 GROUP BY ATTRIBUTEID 
                                 ) D
               ON C.ATTRIBUTEID  = D.ATTRIBUTEID  
                LEFT OUTER JOIN (
                                      SELECT Z.CHILDENTID
                                           ,Z.REFCHILD_COLID
                                           ,SUBSTR(XMLAGG(XMLELEMENT(x, ',',RELID||'.'||Z.PARENT_TAB_ENG_NM||'.'||Z.REFPARENT_COL_ENG_NM) ORDER BY Z.PARENT_TAB_ENG_NM).Extract('//text()'),2) AS FK_INFO
                                     FROM MODEL_NG.DA#V_RELATIONSHIP_COLS Z
                                     WHERE Z.CHILDENTID IN	
                                     <foreach collection="list" item="item" open="(" separator="," close=")">
              	  		             #{item.martTblId,jdbcType=VARCHAR}                                                     
              	 		             </foreach>             
                                     GROUP BY Z.CHILDENTID,Z.REFCHILD_COLID
                                     
<!--                                      SELECT Z.CHILDENTID -->
<!--                                            ,Z.REFCHILD_COLID,max(REFCHILD_COL_ENG_NM  ) -->
<!--                                            ,SUBSTR(XMLAGG(XMLELEMENT(x, ',','FK_'||SUBSTR(Z.CHILD_TAB_ENG_NM,2,5)||'_'||SUBSTR(Z.CHILD_TAB_ENG_NM,-1) -->
<!--                                                    ||'_'||SUBSTR(Z.PARENT_TAB_ENG_NM,2,5)||'_'||SUBSTR(Z.PARENT_TAB_ENG_NM,-1) -->
<!--                                                    ||'_'||SEQ -->
<!--                                                    ||'.'||Z.PARENT_TAB_ENG_NM||'.'||Z.REFPARENT_COL_ENG_NM) ORDER BY Z.PARENT_TAB_ENG_NM).Extract('//text()'),2) AS FK_INFO -->
<!--                                                    FROM -->
<!--                                      (SELECT TRIM(TO_CHAR(DENSE_RANK() OVER(PARTITION BY Z.PARENTENTID||CHILDENTID ORDER BY RELID),'00')) AS SEQ ,Z.*             -->
<!--                                      FROM MODEL_NG.DA#V_RELATIONSHIP_COLS Z -->
<!--                                      WHERE Z.CHILDENTID IN	( <foreach collection="list" item="item" open="(" separator="," close=")"> -->
<!--               	  		             #{item.martTblId,jdbcType=VARCHAR}                                                      -->
<!--               	 		             </foreach>      ) -->
<!--               	 		             ) Z -->
<!--                                      GROUP BY Z.CHILDENTID,Z.REFCHILD_COLID -->
                                    ) RC
                   ON A.TABLEID = RC.CHILDENTID   
                  AND C.COLUMNID = RC.REFCHILD_COLID
              	WHERE 1 = 1	 
                  AND A.TABLEID IN 
                      	<foreach collection="list" item="item" open="(" separator="," close=")">
              	  		#{item.martTblId,jdbcType=VARCHAR}                                                     
              	 		</foreach>             
                  AND C.COL_ENG_NM IS NOT NULL
                  AND C.COL_KOR_NM IS NOT NULL
  </select>    
</mapper>