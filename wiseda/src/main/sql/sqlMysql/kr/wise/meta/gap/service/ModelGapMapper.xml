<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.meta.gap.service.ModelGapMapper" >
<resultMap id="BaseResultMap" type="kr.wise.meta.gap.service.ModelGapVO">
	<id column="GAP_STATUS" property="gapStatus" jdbcType="VARCHAR" />
    <result column="SUBJ_LNM"            property="subjLnm"         jdbcType="VARCHAR" />
    <result column="PDM_TBL_PNM"         property="pdmTblPnm"       jdbcType="VARCHAR" />
    <result column="PDM_TBL_LNM"         property="pdmTblLnm"       jdbcType="VARCHAR" />
    <result column="PDM_COL_CNT"         property="pdmColCnt"       jdbcType="VARCHAR" />
    <result column="DB_CONN_TRG_LNM"     property="dbConnTrgLnm"    jdbcType="VARCHAR" />
    <result column="DB_CONN_TRG_PNM"     property="dbConnTrgPnm"    jdbcType="VARCHAR" />
    <result column="DB_SCH_LNM"          property="dbSchLnm"        jdbcType="VARCHAR" />
    <result column="DB_SCH_PNM"          property="dbSchPnm"        jdbcType="VARCHAR" />  
    <result column="DDL_TBL_PNM"         property="ddlTblPnm"       jdbcType="VARCHAR" />
    <result column="DDL_COL_CNT"         property="ddlColCnt"       jdbcType="VARCHAR" />
    <result column="PDM_GAP_COL_CNT_DDL" property="pdmGapColCntDdl" jdbcType="VARCHAR" />
    <result column="DBC_TBL_NM"          property="dbcTblNm"        jdbcType="VARCHAR" />
    <result column="DBC_COL_CNT"         property="dbcColCnt"       jdbcType="VARCHAR" />
    <result column="PDM_GAP_COL_CNT_DBC" property="pdmGapColCntDbc" jdbcType="VARCHAR" />
    <result column="DDL_GAP_COL_CNT_DBC" property="ddlGapColCntDbc" jdbcType="VARCHAR" />
    <result column="DDL_TBL_ERR_DESCN"   property="ddlTblErrDescn"  jdbcType="VARCHAR" />
    <result column="DDL_COL_ERR_DESCN"   property="ddlColErrDescn"  jdbcType="VARCHAR" />
    <result column="PDM_TBL_ERR_DESCN"   property="pdmTblErrDescn"  jdbcType="VARCHAR" />
    <result column="PDM_COL_ERR_DESCN"   property="pdmColErrDescn"  jdbcType="VARCHAR" />
    
    
    <result column="SUBJ_ID"        property="subjId"      jdbcType="VARCHAR" />
    <result column="FULL_PATH"      property="fullPath"    jdbcType="VARCHAR" />
    <result column="DB_SCH_ID"      property="dbSchId"     jdbcType="VARCHAR" />
    <result column="DB_CONN_TRG_ID" property="dbConnTrgId" jdbcType="VARCHAR" />
    <result column="SEARCH_BGN_DE"  property="searchBgnDe" jdbcType="VARCHAR" />
    <result column="SEARCH_END_DE"  property="searchEndDe" jdbcType="VARCHAR" />
    <result column="SEARCH_TYP"     property="searchTyp"   jdbcType="VARCHAR" />
    <result column="OBJ_NM"         property="objNm"       jdbcType="VARCHAR" />
    <result column="DDL_TBL_ID"     property="ddlTblId"    jdbcType="VARCHAR" />
    <result column="PDM_TBL_ID"     property="pdmTblId"    jdbcType="VARCHAR" />
    
    <result column="PDM_TBL_CNT" property="pdmTblCnt" jdbcType="VARCHAR" />
    <result column="GAP_CNT"     property="gapCnt"    jdbcType="VARCHAR" />
    <result column="NML_CNT"     property="nmlCnt"    jdbcType="VARCHAR" />
    
    <result column="PDM_COL_ID"  property="pdmColId"  jdbcType="VARCHAR" />
    <result column="PDM_COL_PNM" property="pdmColPnm" jdbcType="VARCHAR" />
    <result column="PDM_COL_LNM" property="pdmColLnm" jdbcType="VARCHAR" />
    <result column="DDL_COL_ID"  property="ddlColId"  jdbcType="VARCHAR" />
    <result column="DDL_COL_PNM" property="ddlColPnm" jdbcType="VARCHAR" />
    <result column="DDL_COL_LNM" property="ddlColLnm" jdbcType="VARCHAR" />
    
    <result column="PDM_COL_ORD" property="pdmColOrd" jdbcType="VARCHAR" />
    <result column="PDM_DATA_TYPE" property="pdmDataType" jdbcType="VARCHAR" />
    <result column="PDM_DATA_LEN" property="pdmDataLen" jdbcType="VARCHAR" />
    <result column="PDM_DATA_SCAL" property="pdmDataScal" jdbcType="VARCHAR" />
    <result column="PDM_PK_YN" property="pdmPkYn" jdbcType="VARCHAR" />
    <result column="PDM_PK_ORD" property="pdmPkOrd" jdbcType="VARCHAR" />
    <result column="PDM_NONUL_YN" property="pdmNonulYn" jdbcType="VARCHAR" />
    <result column="PDM_DEFLT_VAL" property="pdmDefltVal" jdbcType="VARCHAR" />
    
    
    <result column="DDL_TBL_LNM" property="ddlTblLnm" jdbcType="VARCHAR" />
    <result column="DDL_COL_ORD" property="ddlColOrd" jdbcType="VARCHAR" />
    <result column="DDL_DATA_TYPE" property="ddlDataType" jdbcType="VARCHAR" />
    <result column="DDL_DATA_LEN" property="ddlDataLen" jdbcType="VARCHAR" />
    <result column="DDL_DATA_SCAL" property="ddlDataScal" jdbcType="VARCHAR" />                              
    <result column="DDL_PK_YN" property="ddlPkYn" jdbcType="VARCHAR" />
    <result column="DDL_PK_ORD" property="ddlPkOrd" jdbcType="VARCHAR" />
    <result column="DDL_NONUL_YN" property="ddlNonulYn" jdbcType="VARCHAR" />
    <result column="DDL_DEFLT_VAL" property="ddlDefltVal" jdbcType="VARCHAR" />
    
    <result column="DBC_COL_ORD" property="dbcColOrd" jdbcType="VARCHAR" />
    <result column="DBC_DATA_TYPE" property="dbcDataType" jdbcType="VARCHAR" />
    <result column="DBC_DATA_LEN" property="dbcDataLen" jdbcType="VARCHAR" />
    <result column="DBC_DATA_SCAL" property="dbcDataScal" jdbcType="VARCHAR" />                              
    <result column="DBC_PK_YN" property="dbcPkYn" jdbcType="VARCHAR" />
    <result column="DBC_PK_ORD" property="dbcPkOrd" jdbcType="VARCHAR" />
    <result column="DBC_NONUL_YN" property="dbcNonulYn" jdbcType="VARCHAR" />
    <result column="DBC_DEFLT_VAL" property="dbcDefltVal" jdbcType="VARCHAR" />
    
    
    <result column="MART_COL_CNT" property="martColCnt" jdbcType="VARCHAR" />
    <result column="MART_TBL_PNM" property="martTblPnm" jdbcType="VARCHAR" />
    <result column="MART_TBL_LNM" property="martTblLnm" jdbcType="VARCHAR" />
    <result column="MART_COL_PNM" property="martColPnm" jdbcType="VARCHAR" />
    <result column="MART_COL_LNM" property="martColLnm" jdbcType="VARCHAR" />
    <result column="MART_COL_ORD" property="martColOrd" jdbcType="VARCHAR" />
    <result column="MART_DATA_TYPE" property="martDataType" jdbcType="VARCHAR" />
    <result column="MART_DATA_LEN" property="martDataLen" jdbcType="VARCHAR" />
    <result column="MART_DATA_SCAL" property="martDataScal" jdbcType="VARCHAR" />                              
    <result column="MART_PK_YN" property="martPkYn" jdbcType="VARCHAR" />
    <result column="MART_PK_ORD" property="martPkOrd" jdbcType="VARCHAR" />
    <result column="MART_NONUL_YN" property="martNonulYn" jdbcType="VARCHAR" />
    <result column="MART_DEFLT_VAL" property="martDefltVal" jdbcType="VARCHAR" />
    
    <result column="DB_TSF_SCH_ID" property="dbTsfSchId" jdbcType="VARCHAR" />
    <result column="DB_TSF_CONN_TRG_ID" property="dbTsfConnTrgId" jdbcType="VARCHAR" />
    <result column="DB_TSF_CONN_TRG_LNM" property="dbTsfConnTrgLnm" jdbcType="VARCHAR" />
    <result column="DB_TSF_SCH_LNM" property="dbTsfSchLnm" jdbcType="VARCHAR" />
    <result column="DDL_TSF_TBL_ID" property="ddlTsfTblId" jdbcType="VARCHAR" />
    <result column="DDL_TSF_TBL_PNM" property="ddlTsfTblPnm" jdbcType="VARCHAR" />
    <result column="DDL_TSF_TBL_LNM" property="ddlTsfTblLnm" jdbcType="VARCHAR" />
    <result column="DDL_TSF_COL_ORD" property="ddlTsfColOrd" jdbcType="VARCHAR" />
    <result column="DDL_TSF_DATA_TYPE" property="ddlTsfDataType" jdbcType="VARCHAR" />
    <result column="DDL_TSF_DATA_LEN" property="ddlTsfDataLen" jdbcType="VARCHAR" />
    <result column="DDL_TSF_DATA_SCAL" property="ddlTsfDataScal" jdbcType="VARCHAR" />                              
    <result column="DDL_TSF_PK_YN" property="ddlTsfPkYn" jdbcType="VARCHAR" />
    <result column="DDL_TSF_PK_ORD" property="ddlTsfPkOrd" jdbcType="VARCHAR" />
    <result column="DDL_TSF_NONUL_YN" property="ddlTsfNonulYn" jdbcType="VARCHAR" />
    <result column="DDL_TSF_DEFLT_VAL" property="ddlTsfDefltVal" jdbcType="VARCHAR" />
    <result column="DDL_TSF_COL_CNT" property="ddlTsfColCnt" jdbcType="VARCHAR" />
    <result column="DDL_TSF_COL_PNM" property="ddlTsfColPnm" jdbcType="VARCHAR" />
    <result column="DDL_TSF_COL_LNM" property="ddlTsfColLnm" jdbcType="VARCHAR" />
    
    <result column="DB_REAL_SCH_ID" property="dbRealSchId" jdbcType="VARCHAR" />
    <result column="DBC_REAL_TBL_NM" property="dbcRealTblNm" jdbcType="VARCHAR" />
    <result column="DBC_REAL_COL_PNM" property="dbcRealColPnm" jdbcType="VARCHAR" />
    <result column="DBC_REAL_COl_LNM" property="dbcRealColLnm" jdbcType="VARCHAR" />
    <result column="DBC_REAL_COL_ORD" property="dbcRealColOrd" jdbcType="VARCHAR" />
    <result column="DBC_REAL_DATA_TYPE" property="dbcRealDataType" jdbcType="VARCHAR" />
    <result column="DBC_REAL_DATA_LEN" property="dbcRealDataLen" jdbcType="VARCHAR" />
    <result column="DBC_REAL_DATA_SCAL" property="dbcRealDataScal" jdbcType="VARCHAR" />                              
    <result column="DBC_REAL_PK_YN" property="dbcRealPkYn" jdbcType="VARCHAR" />
    <result column="DBC_REAL_PK_ORD" property="dbcRealPkOrd" jdbcType="VARCHAR" />
    <result column="DBC_REAL_NONUL_YN" property="dbcRealNonulYn" jdbcType="VARCHAR" />
    <result column="DBC_REAL_DEFLT_VAL" property="dbcRealDefltVal" jdbcType="VARCHAR" />
    <result column="DBC_REAL_COL_CNT" property="dbcRealColCnt" jdbcType="VARCHAR" />
    
    <result column="DDL_TRG_DCD"              property="ddlTrgDcd"           jdbcType="VARCHAR" />
    <result column="DBC_DB_CONN_TRG_PNM"      property="dbcDbConnTrgPnm"     jdbcType="VARCHAR" />
    <result column="DBC_DB_CONN_TRG_LNM"      property="dbcDbConnTrgLnm"     jdbcType="VARCHAR" />
    <result column="DBC_DB_SCH_LNM"           property="dbcDbSchLnm"         jdbcType="VARCHAR" />
    <result column="DBC_REAL_DB_CONN_TRG_LNM" property="dbcRealDbConnTrgLnm" jdbcType="VARCHAR" />
    <result column="DBC_REAL_DB_SCH_LNM"      property="dbcRealDbSchLnm"     jdbcType="VARCHAR" />
    
    <result column="DBC_COL_PNM" property="dbcColPnm" jdbcType="VARCHAR" />
    <result column="DBC_COL_LNM" property="dbcColLnm" jdbcType="VARCHAR" />
    
    <result column="DBC_TBL_LNM"      property="dbcTblLnm" jdbcType="VARCHAR" />
    <result column="DBC_REAL_TBL_LNM" property="dbcRealTblLnm" jdbcType="VARCHAR" />
    
    <result column="GAP_CONTS"        property="gapConts" jdbcType="VARCHAR" />
    
    <result column="SDITM_PNM"       property="sditmPnm"      jdbcType="VARCHAR" />
    <result column="SDITM_LNM"       property="sditmLnm"      jdbcType="VARCHAR" />    
    <result column="SDITM_DATA_TYPE" property="sditmDataType" jdbcType="VARCHAR" />
    <result column="SDITM_DATA_LEN"  property="sditmDataLen"  jdbcType="VARCHAR" />
    <result column="SDITM_DATA_SCAL" property="sditmDataScal" jdbcType="VARCHAR" />
    
    <result column="DB_SCH_PNM"      property="dbSchPnm"      jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_ID"   property="srcDbSchId"    jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_PNM"  property="srcDbSchPnm"   jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_ID"   property="tgtDbSchId"    jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_PNM"  property="tgtDbSchPnm"   jdbcType="VARCHAR" />
    
    <result column="DDL_SEQ_ID"  property="ddlSeqId"   jdbcType="VARCHAR" />
    <result column="DDL_SEQ_PNM"  property="ddlSeqNm"   jdbcType="VARCHAR" />
    <result column="DBC_SEQ_NM"  property="dbcSeqNm"   jdbcType="VARCHAR" />
    
    <result column="DBC_MINVAL"      property="dbcminval"   jdbcType="VARCHAR" />
    <result column="DBC_MAXVAL"      property="dbcmaxval"   jdbcType="VARCHAR" />
    <result column="DBC_CYC_YN"      property="dbccycYn"    jdbcType="VARCHAR" />
    <result column="DBC_INCBY"       property="dbcincby"    jdbcType="VARCHAR" />
    <result column="DBC_ORD_YN"      property="dbcordYn"    jdbcType="VARCHAR" />
    <result column="DBC_CACHE_SZ"    property="dbccacheSz"  jdbcType="VARCHAR" />
    <result column="DDL_MINVAL"      property="ddlminval"   jdbcType="VARCHAR" />
    <result column="DDL_MAXVAL"      property="ddlmaxval"   jdbcType="VARCHAR" />
    <result column="DDL_CYC_YN"      property="ddlcycYn"    jdbcType="VARCHAR" />
    <result column="DDL_INCBY"       property="ddlincby"    jdbcType="VARCHAR" />
    <result column="DDL_ORD_YN"      property="ddlordYn"    jdbcType="VARCHAR" />
    <result column="DDL_CACHE_SZ"    property="ddlcacheSz"  jdbcType="VARCHAR" />

    <result column="REG_DTM"  property="regDtm"   jdbcType="VARCHAR" />
</resultMap>

<select id="getModelGapAnalyze" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	SELECT /* ModelGapMapper.getModelGapAnalyze */
		A.*
      ,CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor
  FROM (
        SELECT 
                PDM.PDM_TBL_PNM
               ,PDM.PDM_TBL_LNM
               ,PCOL.PDM_COL_CNT
               ,SUBJ.FULL_PATH AS SUBJ_LNM
               ,DB.DB_CONN_TRG_LNM
               ,SCH.DB_SCH_LNM
               ,DDL.DDL_TBL_PNM
               ,DDL.DDL_TBL_LNM
               ,DCOL.DDL_COL_CNT
               ,T.DBC_TBL_NM
               ,DBCCOL.DBC_COL_CNT
               ,T.DDL_TBL_ERR_DESCN
               ,T.DDL_COL_ERR_DESCN
               ,T.PDM_TBL_ERR_DESCN
               ,T.PDM_COL_ERR_DESCN
               ,CASE WHEN T.DDL_TBL_ERR_EXS = 'Y' THEN 'GAP'
                WHEN T.DDL_COL_ERR_EXS = 'Y' THEN 'GAP' 
                WHEN T.PDM_TBL_ERR_EXS = 'Y' THEN 'GAP'
                WHEN T.PDM_COL_ERR_EXS = 'Y' THEN 'GAP'
                ELSE 'NML' END /*END END*/ AS GAP_STATUS
               ,DB.DB_CONN_TRG_ID
               ,SCH.DB_SCH_ID
               ,DDL.DDL_TBL_ID
               ,PDM.PDM_TBL_ID
          FROM WAT_DBC_TBL T
            INNER JOIN WAA_DB_CONN_TRG DB
              ON T.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
             AND DB.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
             AND DB.REG_TYP_CD IN ('C', 'U')
            INNER JOIN WAA_DB_SCH SCH
              ON T.DB_SCH_ID = SCH.DB_SCH_ID
             AND SCH.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
             AND SCH.REG_TYP_CD IN ('C', 'U')
            LEFT OUTER JOIN WAA_SUBJ SUBJ
              ON T.SUBJ_ID = SUBJ.SUBJ_ID
             AND SUBJ.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
             AND SUBJ.REG_TYP_CD IN ('C', 'U')
            LEFT OUTER JOIN WAM_DDL_TBL DDL
              ON T.DDL_TBL_ID = DDL.DDL_TBL_ID
             AND DDL.REG_TYP_CD IN ('C', 'U')
            LEFT OUTER JOIN WAM_PDM_TBL PDM
              ON T.PDM_TBL_ID = PDM.PDM_TBL_ID
             AND PDM.REG_TYP_CD IN ('C', 'U')
            LEFT OUTER JOIN ( SELECT PDM_TBL_ID, COUNT(1) AS PDM_COL_CNT
                                FROM WAM_PDM_COL
                               WHERE REG_TYP_CD IN ('C', 'U')
                               GROUP BY PDM_TBL_ID ) PCOL
              ON PDM.PDM_TBL_ID = PCOL.PDM_TBL_ID
            LEFT OUTER JOIN ( SELECT DDL_TBL_ID, COUNT(1) AS DDL_COL_CNT
                                FROM WAM_DDL_COL
                               WHERE REG_TYP_CD IN ('C', 'U')
                               GROUP BY DDL_TBL_ID ) DCOL
              ON DDL.DDL_TBL_ID = DCOL.DDL_TBL_ID
            LEFT OUTER JOIN ( SELECT DB_SCH_ID, DBC_TBL_NM, COUNT(1) AS DBC_COL_CNT
                                FROM WAT_DBC_COL
                               WHERE 1 = 1
                               GROUP BY DB_SCH_ID, DBC_TBL_NM ) DBCCOL
              ON T.DB_SCH_ID = DBCCOL.DB_SCH_ID
             AND T.DBC_TBL_NM = DBCCOL.DBC_TBL_NM
            
            
           WHERE 1=1
<!--            메타 물리모델 미존재도 GAP 으로 나와야 한다. -->
<!--              AND T.SUBJ_ID IS NOT NULL -->
<!--              AND T.DDL_TBL_ID IS NOT NULL -->
<!--              AND T.PDM_TBL_ID IS NOT NULL  -->
             AND DB.META_MNG_YN ='Y'
<!--              <if test="fullPath != null"> -->
<!--              AND SUBJ.FULL_PATH LIKE '%' || #{fullPath,jdbcType=VARCHAR} || '%' -->
<!--              </if> -->
             <if test="dbConnTrgId != null">
             AND T.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
             </if>
             <if test="dbSchId != null">
             AND T.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
             </if>
             <if test="searchBgnDe != null">
             <![CDATA[
             AND DATE_FORMAT(DDL.APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR}
             ]]>
             </if>
             <if test="searchEndDe != null">
             <![CDATA[
             AND DATE_FORMAT(DDL.APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR}
             ]]>
             </if>
             <if test='searchTyp == "CU"'>
             AND IFNULL(T.REG_TYP, 'C') IN ('C', 'U')
             </if>
             <if test="tblNm != null">
             AND (    T.DBC_TBL_NM LIKE CONCAT('%' , UPPER( #{tblNm,jdbcType=VARCHAR}) , '%') 
                   OR T.DBC_TBL_KOR_NM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                   OR DDL.DDL_TBL_PNM  LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                   OR DDL.DDL_TBL_LNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
<!--               OR PDM.PDM_TBL_PNM  LIKE '%' || UPPER(#{tblNm,jdbcType=VARCHAR}) || '%' -->
<!--               OR PDM.PDM_TBL_LNM LIKE '%' || UPPER(#{tblNm,jdbcType=VARCHAR}) || '%' -->
                    )
             </if>
             ) A
     	<where>
     	<if test="gapStatus != null">
        AND A.GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
        </if>
     	</where>
     	ORDER BY A.GAP_STATUS
</select>

<select id="getGapChart" resultMap="BaseResultMap">
	SELECT 	/* ModelGapMapper.getGapChart */
			COUNT(1) AS PDM_TBL_CNT
	      ,SUM(CASE WHEN A.GAP_STATUS = 'GAP' THEN 1 ELSE 0 END ) AS GAP_CNT
	      ,SUM(CASE WHEN A.GAP_STATUS = 'GAP' THEN 0 ELSE 1 END ) AS NML_CNT
	  FROM (
	        SELECT PDM.PDM_TBL_PNM
	              ,T.*
	              ,CASE WHEN T.DDL_TBL_ERR_EXS = 'Y' THEN 'GAP'
	               ELSE CASE WHEN T.DDL_COL_ERR_EXS = 'Y' THEN 'GAP' 
	               ELSE CASE WHEN T.PDM_TBL_ERR_EXS = 'Y' THEN 'GAP'
	               ELSE CASE WHEN T.PDM_COL_ERR_EXS = 'Y' THEN 'GAP'
	               ELSE CASE WHEN T.DBC_TBL_NM IS NULL THEN 'GAP'
	               ELSE 'NML' END END END END END AS GAP_STATUS
	          FROM WAM_PDM_TBL PDM
	            LEFT OUTER JOIN WAT_DBC_TBL T
	              ON PDM.PDM_TBL_ID = T.PDM_TBL_ID
<!-- 	             AND IFNULL(T.REG_TYP, 'C') IN ('C', 'U') -->
	              ) A
</select>

<select id="getModelDdlColGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
        /* ModelGapMapper.getModelDdlColGapList */
SELECT A.*
      ,CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor
  FROM (
          SELECT 
            A_PDM_TBL_ID 	 AS PDM_TBL_ID
           ,A_PDM_TBL_PNM 	 AS PDM_TBL_PNM
           ,A_PDM_TBL_LNM 	 AS PDM_TBL_LNM
           ,A_PDM_COL_ID 	 AS PDM_COL_ID
           ,A_PDM_COL_PNM 	 AS PDM_COL_PNM
           ,A_PDM_COL_LNM	 AS PDM_COL_LNM
           ,A_COL_ORD        AS PDM_COL_ORD
           ,A_DATA_TYPE      AS PDM_DATA_TYPE 
           ,A_DATA_LEN       AS PDM_DATA_LEN  
           ,A_DATA_SCAL      AS PDM_DATA_SCAL 
           ,IFNULL(A_PK_YN,'-') AS PDM_PK_YN     
           ,A_PK_ORD         AS PDM_PK_ORD    
           ,IFNULL(A_NONUL_YN,'-') AS PDM_NONUL_YN  
           ,A_DEFLT_VAL      AS PDM_DEFLT_VAL 
           ,C_DDL_TBL_ID	 AS DDL_TBL_ID
           ,C_DDL_TBL_PNM	 AS DDL_TBL_PNM
           ,C_DDL_TBL_LNM	 AS DDL_TBL_LNM
           ,C_DDL_COL_ID	 AS DDL_COL_ID
           ,C_DDL_COL_PNM	 AS DDL_COL_PNM
           ,C_DDL_COL_LNM	 AS DDL_COL_LNM
           ,C_COL_ORD      AS DDL_COL_ORD   
           ,C_DATA_TYPE    AS DDL_DATA_TYPE 
           ,C_DATA_LEN     AS DDL_DATA_LEN  
           ,C_DATA_SCAL    AS DDL_DATA_SCAL 
           ,IFNULL(C_PK_YN,'-')  AS DDL_PK_YN     
           ,C_PK_ORD       AS DDL_PK_ORD    
           ,IFNULL(C_NONUL_YN,'-') AS DDL_NONUL_YN  
           ,C_DEFLT_VAL    AS DDL_DEFLT_VAL 
           ,CASE WHEN IFNULL(A_COL_ORD,0)   != IFNULL(C_COL_ORD, 0) 
                   OR IFNULL(A_DATA_TYPE,'-') != IFNULL(C_DATA_TYPE,'-')
                   OR IFNULL(A_DATA_LEN,0)  != IFNULL(C_DATA_LEN ,0)
                   OR IFNULL(A_DATA_SCAL,0) != IFNULL(C_DATA_SCAL,0)
                   OR IFNULL(A_NONUL_YN,'N') != IFNULL(C_NONUL_YN,'N') 
                   OR IFNULL(REPLACE(A_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C_DEFLT_VAL,CHAR(39), NULL),'-')
                   OR IFNULL(A_PK_YN ,'N')    != IFNULL(C_PK_YN   ,'N') 
                   OR IFNULL(A_PK_ORD,0)    != IFNULL(C_PK_ORD,0)   THEN 'GAP'      
             ELSE 'NML' END AS GAP_STATUS       
          FROM (
		  
			SELECT * FROM (
					(
					 SELECT  A.PDM_TBL_ID      AS A_PDM_TBL_ID
							,A.PDM_TBL_PNM     AS A_PDM_TBL_PNM
							,A.PDM_TBL_LNM     AS A_PDM_TBL_LNM
							,B.PDM_COL_ID      AS A_PDM_COL_ID
							,B.PDM_COL_PNM     AS A_PDM_COL_PNM
							,B.PDM_COL_LNM     AS A_PDM_COL_LNM
							,B.COL_ORD         AS A_COL_ORD
							,B.DATA_TYPE       AS A_DATA_TYPE
							,B.DATA_LEN        AS A_DATA_LEN
							,B.DATA_SCAL       AS A_DATA_SCAL
							,B.PK_YN 		   AS A_PK_YN
							,B.PK_ORD          AS A_PK_ORD
							,B.NONUL_YN		   AS A_NONUL_YN
							,B.DEFLT_VAL       AS A_DEFLT_VAL
					FROM WAM_PDM_TBL A
					INNER JOIN WAM_PDM_COL B
					ON A.PDM_TBL_ID = B.PDM_TBL_ID
					) A
			LEFT OUTER JOIN 
					(
					 SELECT  C.DDL_TBL_ID      AS C_DDL_TBL_ID     
							,C.DDL_TBL_PNM     AS C_DDL_TBL_PNM                             
							,C.DDL_TBL_LNM     AS C_DDL_TBL_LNM
							,D.DDL_COL_ID      AS C_DDL_COL_ID
							,D.DDL_COL_PNM     AS C_DDL_COL_PNM
							,D.DDL_COL_LNM     AS C_DDL_COL_LNM
							,D.COL_ORD         AS C_COL_ORD
							,D.DATA_TYPE       AS C_DATA_TYPE
							,D.DATA_LEN        AS C_DATA_LEN
							,D.DATA_SCAL       AS C_DATA_SCAL
							,D.PK_YN           AS C_PK_YN
							,D.PK_ORD          AS C_PK_ORD
							,D.NONUL_YN        AS C_NONUL_YN
							,D.DEFLT_VAL       AS C_DEFLT_VAL
							,C.PDM_TBL_ID      AS C_PDM_TBL_ID
					 FROM WAM_DDL_TBL C
					 INNER JOIN WAM_DDL_COL D
					 ON C.DDL_TBL_ID = D.DDL_TBL_ID
					 ) C
			  ON A_PDM_TBL_ID = C_PDM_TBL_ID
			  AND A_PDM_COL_PNM = C_DDL_COL_PNM
			)
UNION
			SELECT * FROM (
					(
					 SELECT  A.PDM_TBL_ID      AS A_PDM_TBL_ID
							,A.PDM_TBL_PNM     AS A_PDM_TBL_PNM
							,A.PDM_TBL_LNM     AS A_PDM_TBL_LNM
							,B.PDM_COL_ID      AS A_PDM_COL_ID
							,B.PDM_COL_PNM     AS A_PDM_COL_PNM
							,B.PDM_COL_LNM     AS A_PDM_COL_LNM
							,B.COL_ORD         AS A_COL_ORD
							,B.DATA_TYPE       AS A_DATA_TYPE
							,B.DATA_LEN        AS A_DATA_LEN
							,B.DATA_SCAL       AS A_DATA_SCAL
							,B.PK_YN 		   AS A_PK_YN
							,B.PK_ORD          AS A_PK_ORD
							,B.NONUL_YN		   AS A_NONUL_YN
							,B.DEFLT_VAL       AS A_DEFLT_VAL
					FROM WAM_PDM_TBL A
					INNER JOIN WAM_PDM_COL B
					ON A.PDM_TBL_ID = B.PDM_TBL_ID
					) A
			RIGHT OUTER JOIN 
					(
					 SELECT  C.DDL_TBL_ID      AS C_DDL_TBL_ID     
							,C.DDL_TBL_PNM     AS C_DDL_TBL_PNM                             
							,C.DDL_TBL_LNM     AS C_DDL_TBL_LNM
							,D.DDL_COL_ID      AS C_DDL_COL_ID
							,D.DDL_COL_PNM     AS C_DDL_COL_PNM
							,D.DDL_COL_LNM     AS C_DDL_COL_LNM
							,D.COL_ORD         AS C_COL_ORD
							,D.DATA_TYPE       AS C_DATA_TYPE
							,D.DATA_LEN        AS C_DATA_LEN
							,D.DATA_SCAL       AS C_DATA_SCAL
							,D.PK_YN           AS C_PK_YN
							,D.PK_ORD          AS C_PK_ORD
							,D.NONUL_YN        AS C_NONUL_YN
							,D.DEFLT_VAL       AS C_DEFLT_VAL
							,C.PDM_TBL_ID      AS C_PDM_TBL_ID
					 FROM WAM_DDL_TBL C
					 INNER JOIN WAM_DDL_COL D
					 ON C.DDL_TBL_ID = D.DDL_TBL_ID
					 ) C
			  ON A_PDM_TBL_ID = C_PDM_TBL_ID
			  AND A_PDM_COL_PNM = C_DDL_COL_PNM
			)		  
		) FSQ  
		  
		  
          WHERE 1=1
          AND (A_PDM_TBL_PNM = #{pdmTblId,jdbcType=VARCHAR} OR C_DDL_TBL_ID = #{ddlTblId,jdbcType=VARCHAR})
          ) A
ORDER BY PDM_TBL_PNM, PDM_COL_ORD,DDL_COL_ORD
</select>

<select id="selectPdmDdlGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	        /* ModelGapMapper.selectPdmDdlGapList */
SELECT A.*,
       CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor
      FROM (
      SELECT -- FULL_PATH AS SUBJ_LNM, 
               MAX(SUBJ_LNM) AS SUBJ_LNM,
               PDM_TBL_PNM,
               MAX(PDM_TBL_LNM) PDM_TBL_LNM,
               MAX(PDM_TBL_ID) PDM_TBL_ID,
               COUNT(PDM_COL_PNM) AS PDM_COL_CNT, 
               MAX(DB_CONN_TRG_PNM) DB_CONN_TRG_LNM,
               MAX(DB_SCH_PNM) DB_SCH_LNM,
               MAX(DDL_TBL_PNM) DDL_TBL_PNM,
               MAX(DDL_TBL_ID) DDL_TBL_ID,
               COUNT(DDL_COL_PNM) AS DDL_COL_CNT,
               CASE WHEN SUM(GAP_STATUS_SUM) > 0 THEN 'GAP'
                    WHEN  COUNT(DDL_COL_PNM) !=  COUNT(PDM_COL_PNM) THEN 'GAP'
               ELSE 'NML' END GAP_STATUS,
               CASE WHEN COUNT(PDM_COL_PNM) = 0 THEN '[물리모델테이블미존재]'
                         WHEN COUNT(DDL_COL_PNM) = 0 THEN '[DDL개발테이블미존재]'
                   ELSE  '' END  GAP_CONTS
              FROM (
                   SELECT A.*
                         ,CASE WHEN GAP_STATUS = 'GAP' THEN 1 ELSE 0 END AS GAP_STATUS_SUM
                     FROM (

                            SELECT
                              A_FULL_PATH	AS FULL_PATH
                             ,SUBJ.SUBJ_LNM
                             ,A_PDM_TBL_ID  AS PDM_TBL_ID 
                             ,IFNULL(A_PDM_TBL_PNM,C_DDL_TBL_PNM) AS PDM_TBL_PNM
                             ,A_PDM_TBL_LNM  AS PDM_TBL_LNM
                             ,A_PDM_COL_ID 	 AS PDM_COL_ID
                             ,A_PDM_COL_PNM  AS PDM_COL_PNM
                             ,A_PDM_COL_LNM  AS PDM_COL_LNM
                             ,A_COL_ORD      AS PDM_COL_ORD
                             ,A_DATA_TYPE    AS PDM_DATA_TYPE 
                             ,A_DATA_LEN     AS PDM_DATA_LEN  
                             ,A_DATA_SCAL    AS PDM_DATA_SCAL 
                             ,A_PK_YN        AS PDM_PK_YN     
                             ,A_PK_ORD       AS PDM_PK_ORD    
                             ,A_NONUL_YN     AS PDM_NONUL_YN  
                             ,A_DEFLT_VAL    AS PDM_DEFLT_VAL
                             ,TRG.DB_CONN_TRG_PNM
                             ,SCH.DB_SCH_PNM
                             ,C_DDL_TBL_ID	 AS DDL_TBL_ID
                             ,C_DDL_TBL_PNM	 AS DDL_TBL_PNM
                             ,C_DDL_TBL_LNM	 AS DDL_TBL_LNM
                             ,C_DDL_COL_ID 	 AS DDL_COL_ID
                             ,C_DDL_COL_PNM	 AS DDL_COL_PNM
                             ,C_DDL_COL_LNM	 AS DDL_COL_LNM
                             ,C_COL_ORD      AS DDL_COL_ORD   
                             ,C_DATA_TYPE    AS DDL_DATA_TYPE 
                             ,C_DATA_LEN     AS DDL_DATA_LEN  
                             ,C_DATA_SCAL    AS DDL_DATA_SCAL 
                             ,C_PK_YN        AS DDL_PK_YN     
                             ,C_PK_ORD       AS DDL_PK_ORD    
                             ,C_NONUL_YN     AS DDL_NONUL_YN  
                             ,C_DEFLT_VAL    AS DDL_DEFLT_VAL 
							 ,CASE WHEN IFNULL(A_COL_ORD,0)   != IFNULL(C_COL_ORD, 0) 
                                     OR IFNULL(A_DATA_TYPE,'-') != IFNULL(C_DATA_TYPE,'-')
                                     OR IFNULL(A_DATA_LEN,0)  != IFNULL(C_DATA_LEN ,0)
                                     OR IFNULL(A_DATA_SCAL,0) != IFNULL(C_DATA_SCAL,0)
                                     OR IFNULL(A_PK_YN ,'-')    != IFNULL(C_PK_YN   ,'-') 
                                     OR IFNULL(REPLACE(A_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C_DEFLT_VAL,CHAR(39), NULL),'-')
                                     OR IFNULL(A_PK_ORD,0)    != IFNULL(C_PK_ORD,0)   
								   THEN 'GAP' ELSE 'NRM' 
						      END AS GAP_STATUS  
                        FROM ( 
							   SELECT * FROM
							   (
								  (
								  SELECT  A.PDM_TBL_ID        AS A_PDM_TBL_ID
                                         ,A.PDM_TBL_PNM       AS A_PDM_TBL_PNM            
                                         ,A.PDM_TBL_LNM       AS A_PDM_TBL_LNM
                                         ,B.PDM_COL_ID        AS A_PDM_COL_ID                
                                         ,B.PDM_COL_PNM       AS A_PDM_COL_PNM
                                         ,B.PDM_COL_LNM       AS A_PDM_COL_LNM  
                                         ,B.COL_ORD           AS A_COL_ORD
                                         ,B.DATA_TYPE         AS A_DATA_TYPE 
                                         ,B.DATA_LEN          AS A_DATA_LEN
                                         ,B.DATA_SCAL      	  AS A_DATA_SCAL
                                         ,B.PK_YN             AS A_PK_YN
                                         ,B.PK_ORD         	  AS A_PK_ORD
                                         ,B.NONUL_YN		  AS A_NONUL_YN
                                         ,B.DEFLT_VAL    	  AS A_DEFLT_VAL
                                         ,A.SUBJ_ID			  AS A_SUBJ_ID
                                         ,A.FULL_PATH		  AS A_FULL_PATH
                                         ,A.APRV_DTM		  AS A_APRV_DTM
                                 FROM WAM_PDM_TBL A
	                                 INNER JOIN WAM_PDM_COL B
	                                         ON A.PDM_TBL_ID = B.PDM_TBL_ID
								 ) A
                LEFT OUTER JOIN 
                                 (
								   SELECT  C.DDL_TBL_ID 	AS C_DDL_TBL_ID
                                          ,C.DDL_TBL_PNM    AS C_DDL_TBL_PNM
                                          ,C.DDL_TBL_LNM    AS C_DDL_TBL_LNM
                                          ,D.DDL_COL_ID     AS C_DDL_COL_ID
                                          ,D.DDL_COL_PNM    AS C_DDL_COL_PNM
                                          ,D.DDL_COL_LNM    AS C_DDL_COL_LNM
                                          ,D.COL_ORD        AS C_COL_ORD
                                          ,D.DATA_TYPE      AS C_DATA_TYPE
                                          ,D.DATA_LEN       AS C_DATA_LEN
                                          ,D.DATA_SCAL      AS C_DATA_SCAL
                                          ,D.PK_YN          AS C_PK_YN
                                          ,D.PK_ORD         AS C_PK_ORD
                                          ,D.NONUL_YN       AS C_NONUL_YN
                                          ,D.DEFLT_VAL 		AS C_DEFLT_VAL
                                          ,C.PDM_TBL_ID		AS C_PDM_TBL_ID
                                          ,C.DB_SCH_ID		AS C_DB_SCH_ID
                                         FROM WAM_DDL_TBL C
	                                         INNER JOIN WAM_DDL_COL D
	                                                 ON C.DDL_TBL_ID = D.DDL_TBL_ID
                                  ) C
                                  ON A_PDM_TBL_ID = C_PDM_TBL_ID
                                 AND A_PDM_COL_PNM = C_DDL_COL_PNM
							   )
UNION
							   SELECT * FROM
							   (
								  (
								  SELECT  A.PDM_TBL_ID        AS A_PDM_TBL_ID
                                         ,A.PDM_TBL_PNM       AS A_PDM_TBL_PNM            
                                         ,A.PDM_TBL_LNM       AS A_PDM_TBL_LNM
                                         ,B.PDM_COL_ID        AS A_PDM_COL_ID                
                                         ,B.PDM_COL_PNM       AS A_PDM_COL_PNM
                                         ,B.PDM_COL_LNM       AS A_PDM_COL_LNM  
                                         ,B.COL_ORD           AS A_COL_ORD
                                         ,B.DATA_TYPE         AS A_DATA_TYPE 
                                         ,B.DATA_LEN          AS A_DATA_LEN
                                         ,B.DATA_SCAL      	  AS A_DATA_SCAL
                                         ,B.PK_YN             AS A_PK_YN
                                         ,B.PK_ORD         	  AS A_PK_ORD
                                         ,B.NONUL_YN		  AS A_NONUL_YN
                                         ,B.DEFLT_VAL    	  AS A_DEFLT_VAL
                                         ,A.SUBJ_ID			  AS A_SUBJ_ID
                                         ,A.FULL_PATH		  AS A_FULL_PATH
                                         ,A.APRV_DTM		  AS A_APRV_DTM
                                 FROM WAM_PDM_TBL A
                                 	INNER JOIN WAM_PDM_COL B
                                            ON A.PDM_TBL_ID = B.PDM_TBL_ID
								 ) A
                LEFT OUTER JOIN 
                                 (
								   SELECT  C.DDL_TBL_ID 	AS C_DDL_TBL_ID
                                          ,C.DDL_TBL_PNM    AS C_DDL_TBL_PNM
                                          ,C.DDL_TBL_LNM    AS C_DDL_TBL_LNM
                                          ,D.DDL_COL_ID     AS C_DDL_COL_ID
                                          ,D.DDL_COL_PNM    AS C_DDL_COL_PNM
                                          ,D.DDL_COL_LNM    AS C_DDL_COL_LNM
                                          ,D.COL_ORD        AS C_COL_ORD
                                          ,D.DATA_TYPE      AS C_DATA_TYPE
                                          ,D.DATA_LEN       AS C_DATA_LEN
                                          ,D.DATA_SCAL      AS C_DATA_SCAL
                                          ,D.PK_YN          AS C_PK_YN
                                          ,D.PK_ORD         AS C_PK_ORD
                                          ,D.NONUL_YN       AS C_NONUL_YN
                                          ,D.DEFLT_VAL 		AS C_DEFLT_VAL
                                          ,C.PDM_TBL_ID		AS C_PDM_TBL_ID
                                          ,C.DB_SCH_ID		AS C_DB_SCH_ID
                                         FROM WAM_DDL_TBL C
	                                         INNER JOIN WAM_DDL_COL D
	                                                 ON C.DDL_TBL_ID = D.DDL_TBL_ID
                                  ) C
                                  ON A_PDM_TBL_ID = C_PDM_TBL_ID
                                 AND A_PDM_COL_PNM = C_DDL_COL_PNM
							   )

						     ) FSQ
                                  LEFT OUTER JOIN WAA_DB_SCH SCH
		                                       ON SCH.DB_SCH_ID = C_DB_SCH_ID
		                                      AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		                                      AND SCH.REG_TYP_CD IN ('C', 'U')
                                  LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
			                                   ON SCH.DB_CONN_TRG_ID = TRG.DB_CONN_TRG_ID
			                                  AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			                                  AND TRG.REG_TYP_CD IN ('C', 'U')
                                  LEFT OUTER JOIN WAA_SUBJ SUBJ
			                                   ON A_SUBJ_ID = SUBJ.SUBJ_ID
			                                  AND SUBJ.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			                                  AND SUBJ.REG_TYP_CD IN ('C','U')
							 
                                  WHERE 1=1
                                 <if test="fullPath != null">
                                 AND A_FULL_PATH LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%')
                                 </if>
                                 <if test="dbConnTrgId != null">
                                  AND TRG.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
                                 </if>
                                 <if test="dbSchId != null">
                                  AND C_DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
                                 </if>
                                 <if test="searchBgnDe != null">
                                 <![CDATA[
                                 AND DATE_FORMAT(A_APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR}
                                 ]]>
                                 </if>
                                 <if test="searchEndDe != null">
                                 <![CDATA[
                                 AND DATE_FORMAT(A_APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR}
                                 ]]>
                                 </if>
                                 <if test="tblNm != null">
                                 AND (     C_DDL_TBL_PNM  LIKE CONCAT( '%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%' )
                                        OR C_DDL_TBL_LNM LIKE CONCAT( '%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%' )
                                        OR A_PDM_TBL_PNM  LIKE CONCAT( '%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%' )
                                        OR A_PDM_TBL_LNM LIKE CONCAT( '%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%' )
                                        )
                                 </if>
                          ) A
                    ORDER BY PDM_TBL_PNM, PDM_COL_ORD
                  ) FSQ2
       GROUP BY PDM_TBL_PNM
    ) A
    <where>
     <if test="gapStatus != null">
     AND GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
     </if>
    </where>
     ORDER BY GAP_STATUS 
</select>

<select id="selectDdlDbcGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT 	/* ModelGapMapper.selectDdlDbcGapList */
		A.*,                                                          
       IFNULL(SCH.DB_SCH_PNM,SCH.DB_SCH_LNM) DB_SCH_LNM,
       IFNULL(TRG.DB_CONN_TRG_PNM, TRG.DB_CONN_TRG_LNM) DB_CONN_TRG_LNM,           
       CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor           
       FROM (                                                                    
             SELECT CASE WHEN SUM(GAP_STATUS) = 0 THEN 'NML' ELSE 'GAP' END AS GAP_STATUS
                   ,CASE WHEN COUNT(DDL_COL_PNM) = 0 THEN '[DDL테이블미존재]'
                         WHEN COUNT(DBC_COL_PNM) = 0 THEN '[DBC테이블미존재]'
                   ELSE  MAX(GAP_CONTS) END  GAP_CONTS               
                   ,MAX(DDL_TBL_ID)     DDL_TBL_ID                                             
                   ,DDL_TBL_PNM         DDL_TBL_PNM                                         
                   ,MAX(DDL_TBL_LNM)   DDL_TBL_LNM                                         
                   ,COUNT(DDL_COL_PNM) DDL_COL_CNT                                         
                   ,MAX(DBC_TBL_PNM)    DBC_TBL_NM                                          
                   -- ,MAX(DBC_TBL_LNM)    DBC_TBL_LNM                                          
                   ,COUNT(DBC_COL_PNM)  DBC_COL_CNT   
                   ,MAX(DB_SCH_ID)      DB_SCH_ID  
                   ,MAX(SUBJ_LNM)       SUBJ_LNM                              
             FROM (
                  SELECT 
                    C.DDL_TBL_ID
                   ,IFNULL(C.DDL_TBL_PNM,DBC.DBC_TBL_NM) AS DDL_TBL_PNM
                   ,C.DDL_TBL_LNM
                   ,C.DDL_COL_ID
                   ,IFNULL(C.DDL_COL_PNM,DBC.DBC_COL_NM) AS DDL_COL_PNM
                   ,C.DDL_COL_LNM
                   ,IFNULL(C.COL_ORD,DBC.ORD) AS DDL_COL_ORD   
                   ,C.DATA_TYPE    AS DDL_DATA_TYPE 
                   ,C.DATA_LEN     AS DDL_DATA_LEN  
                   ,C.DATA_SCAL    AS DDL_DATA_SCAL 
                   ,IFNULL(C.PK_YN,'-')  AS DDL_PK_YN     
                   ,C.PK_ORD       AS DDL_PK_ORD    
                   ,IFNULL(C.NONUL_YN,'-') AS DDL_NONUL_YN  
                   ,C.DEFLT_VAL    AS DDL_DEFLT_VAL 
                   ,DBC.DBC_TBL_NM AS DBC_TBL_PNM
                   ,DBC.DBC_COL_NM AS DBC_COL_PNM
                   ,DBC.ORD         AS DBC_COL_ORD
                   ,DBC.DATA_TYPE   AS DBC_DATA_TYPE
                   ,DBC.DATA_LEN   AS DBC_DATA_LEN
                   ,CASE WHEN DBC.DATA_PNT = 0 THEN NULL ELSE DBC.DATA_PNT END AS DBC_DATA_SCAL
                   ,CASE WHEN IFNULL(DBC.NULL_YN,'-') = 'N' THEN 'Y'
			        	 WHEN IFNULL(DBC.NULL_YN,'-') = 'Y' THEN 'N'
					     ELSE '-' END AS DBC_NONUL_YN 
                   ,DBC.DEFLT_VAL   AS DBC_DEFLT_VAL
                   ,DBC.PK_YN       AS DBC_PK_YN
                   ,DBC.PK_ORD      AS DBC_PK_ORD
                   ,CASE WHEN IFNULL(DBC.ORD,0)   != IFNULL(C.COL_ORD, 0) 
                           OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(C.DATA_TYPE,'-')
                           OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(C.DATA_LEN ,0)
                           OR IFNULL(DBC.DATA_PNT,0) != IFNULL(C.DATA_SCAL,0)
                           OR (CASE WHEN IFNULL(DBC.NULL_YN,'N') = 'N' THEN 'Y' ELSE 'N' END) != IFNULL(C.NONUL_YN,'N') 
                           OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C.DEFLT_VAL,CHAR(39), NULL),'-')
                           OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(C.PK_YN   ,'N') 
                           OR IFNULL(DBC.PK_ORD,0)    != IFNULL(C.PK_ORD,0)   THEN 1
                     ELSE 0 END AS GAP_STATUS 
                     ,CONCAT( 
                      		  CASE WHEN C.DDL_TBL_PNM IS NULL THEN '[DDL컬럼미존재]' ELSE '' END
                      		 ,CASE WHEN DBC.DBC_TBL_NM IS NULL THEN '[DBC컬럼미존재]' ELSE '' END
                      		 ,CASE WHEN DBC.DBC_TBL_NM IS NOT NULL
                                    AND C.DDL_TBL_PNM IS NOT NULL
		                            AND (IFNULL(DBC.ORD,0)   != IFNULL(C.COL_ORD, 0) 
		                            OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(C.DATA_TYPE,'-')
		                            OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(C.DATA_LEN ,0)
		                            OR IFNULL(DBC.DATA_PNT,0) != IFNULL(C.DATA_SCAL,0)
		                            OR (CASE WHEN IFNULL(DBC.NULL_YN,'N') = 'N' THEN 'Y' ELSE 'N') != IFNULL(C.NONUL_YN,'N') 
		                            OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C.DEFLT_VAL,CHAR(39), NULL),'-')
		                            OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(C.PK_YN   ,'N') 
		                            OR IFNULL(DBC.PK_ORD,0)    != IFNULL(C.PK_ORD,0))
                      THEN '[컬럼GAP존재]' ELSE '' END
                             ) AS GAP_CONTS       
                    ,IFNULL(C.DB_SCH_ID , DBC.DB_SCH_ID) DB_SCH_ID
                    ,C.SUBJ_LNM
                  FROM (SELECT   C.DDL_TBL_ID
                        ,C.DDL_TBL_PNM
                        ,C.DDL_TBL_LNM
                        ,D.DDL_COL_ID
                        ,D.DDL_COL_PNM
                        ,D.DDL_COL_LNM
                        ,D.COL_ORD       
                        ,D.DATA_TYPE    
                        ,D.DATA_LEN     
                        ,D.DATA_SCAL    
                        ,D.PK_YN 
                        ,D.PK_ORD  
                        ,D.NONUL_YN
                        ,D.DEFLT_VAL
                        ,C.DB_SCH_ID
                        ,C.APRV_DTM
                        ,TRG.DB_CONN_TRG_ID
                        ,PDM.FULL_PATH
                        ,SUBJ.SUBJ_LNM
                        FROM WAM_DDL_TBL C
                        INNER JOIN WAM_DDL_COL D
                        ON C.DDL_TBL_ID = D.DDL_TBL_ID
                        LEFT OUTER JOIN WAA_DB_SCH SCH
                        ON C.DB_SCH_ID = SCH.DB_SCH_ID
                        AND SCH.REG_TYP_CD IN ('C', 'U')
                        AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
                        ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
                        AND TRG.REG_TYP_CD IN ('C', 'U')
                        AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAM_PDM_TBL PDM
                        ON C.PDM_TBL_ID = PDM.PDM_TBL_ID
                        LEFT OUTER JOIN WAA_SUBJ SUBJ
                        ON PDM.SUBJ_ID = SUBJ.SUBJ_ID
                        AND SUBJ.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        AND SUBJ.REG_TYP_CD IN ('C', 'U')
                        
                                                      ) C
                  FULL OUTER JOIN (SELECT DBC.DB_SCH_ID
                                         ,DBC.DBC_TBL_NM
                                         ,DBC.DBC_TBL_KOR_NM
                                         ,DBCCOL.DBC_COL_NM 
                                         ,DBCCOL.ORD      
                                         ,DBCCOL.DATA_TYPE
                                         ,DBCCOL.DATA_LEN
                                         ,DBCCOL.DATA_PNT
                                         ,DBCCOL.NULL_YN
                                         ,DBCCOL.DEFLT_VAL 
                                         ,DBCCOL.PK_YN     
                                         ,DBCCOL.PK_ORD    
                                   FROM WAT_DBC_TBL DBC
                                   INNER JOIN WAT_DBC_COL DBCCOL
                                   ON DBCCOL.DBC_TBL_NM = DBC.DBC_TBL_NM
                                   AND DBC.DB_SCH_ID =DBCCOL.DB_SCH_ID
                                   LEFT OUTER JOIN WAA_DB_SCH SCH
                                   ON DBC.DB_SCH_ID =SCH.DB_SCH_ID
                                   AND SCH.REG_TYP_CD IN ('C', 'U')
                                   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                                   WHERE SCH.DDL_TRG_DCD = 'D'  -- 개발만
                                   ) DBC
                  ON C.DB_SCH_ID = DBC.DB_SCH_ID
                  AND C.DDL_TBL_PNM = DBC.DBC_TBL_NM
                  AND C.DDL_COL_PNM = DBC.DBC_COL_NM 
                  WHERE 1=1   
                <if test="fullPath != null">
                AND C.FULL_PATH LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%')
                </if>
                 <if test="dbConnTrgId != null">
                 AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
                </if>
                <if test="dbSchId != null">
                 AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
                </if>
                <if test="searchBgnDe != null">
                <![CDATA[
                AND DATE_FORMAT(C.APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR}
                ]]>
                </if>
                <if test="searchEndDe != null">
                <![CDATA[
                AND DATE_FORMAT(C.APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR}
                ]]>
                </if>
                <if test="tblNm != null">
                AND (     C.DDL_TBL_PNM  LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR C.DDL_TBL_LNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR DBC.DBC_TBL_NM  LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR DBC.DBC_TBL_KOR_NM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       )
                       </if>
            ) A
             GROUP BY DDL_TBL_PNM
      ) A
      LEFT OUTER JOIN WAA_DB_SCH SCH
      ON A.DB_SCH_ID = SCH.DB_SCH_ID
      AND SCH.REG_TYP_CD IN ('C', 'U')
      AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
      LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
      ON SCH.DB_CONN_TRG_ID = TRG.DB_CONN_TRG_ID
      AND TRG.REG_TYP_CD IN ('C', 'U')
      AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
    <where>
     <if test="gapStatus != null">
     AND A.GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
     </if>
    </where>
     ORDER BY GAP_STATUS, GAP_CONTS 
</select>
<select id="selectDdlDbcColGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT 	/* ModelGapMapper.selectDdlDbcColGapList */
		A.*
      ,CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor
  FROM (
                  SELECT 
                    C.DDL_TBL_ID
                   ,IFNULL(C.DDL_TBL_PNM,DBC.DBC_TBL_NM) AS DDL_TBL_PNM
                   ,C.DDL_TBL_LNM
                   ,C.DDL_COL_ID
                   ,IFNULL(C.DDL_COL_PNM,DBC.DBC_COL_NM) AS DDL_COL_PNM
                   ,C.DDL_COL_LNM
                   ,C.COL_ORD      AS DDL_COL_ORD   
                   ,C.DATA_TYPE    AS DDL_DATA_TYPE 
                   ,C.DATA_LEN     AS DDL_DATA_LEN  
                   ,C.DATA_SCAL    AS DDL_DATA_SCAL 
                   ,IFNULL(C.PK_YN,'-')  AS DDL_PK_YN     
                   ,C.PK_ORD       AS DDL_PK_ORD    
                   ,IFNULL(C.NONUL_YN,'-') AS DDL_NONUL_YN  
                   ,C.DEFLT_VAL    AS DDL_DEFLT_VAL 
                   ,DBC.DBC_TBL_NM AS DBC_TBL_PNM
                   ,DBC.DBC_COL_NM AS DBC_COL_PNM
                   ,DBC.ORD         AS DBC_COL_ORD
                   ,DBC.DATA_TYPE   AS DBC_DATA_TYPE
                   ,DBC.DATA_LEN   AS DBC_DATA_LEN
                   ,CASE WHEN DBC.DATA_PNT = 0 THEN NULL ELSE DBC.DATA_PNT END AS DBC_DATA_SCAL
                   ,CASE WHEN IFNULL(DBC.NULL_YN,'-') = 'N' THEN 'Y'
                         WHEN IFNULL(DBC.NULL_YN,'-') = 'Y' THEN 'N' 
                         ELSE '-'
                    END  AS DBC_NONUL_YN 
                   ,DBC.DEFLT_VAL   AS DBC_DEFLT_VAL
                   ,DBC.PK_YN       AS DBC_PK_YN
                   ,DBC.PK_ORD      AS DBC_PK_ORD
                   ,CASE WHEN IFNULL(DBC.ORD,0)   != IFNULL(C.COL_ORD, 0) 
                           OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(C.DATA_TYPE,'-')
                           OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(C.DATA_LEN ,0)
                           OR IFNULL(DBC.DATA_PNT,0) != IFNULL(C.DATA_SCAL,0)
                           OR (CASE WHEN IFNULL(DBC.NULL_YN,'N') = 'N' THEN 'Y' ELSE 'N' END) != IFNULL(C.NONUL_YN,'N') 
                           OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C.DEFLT_VAL,CHAR(39), NULL),'-')
                           OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(C.PK_YN   ,'N') 
                           OR IFNULL(DBC.PK_ORD,0)    != IFNULL(C.PK_ORD,0)   THEN 'GAP'      
                     ELSE 'NML' END AS GAP_STATUS       
                  FROM (SELECT   C.DDL_TBL_ID
                        ,C.DDL_TBL_PNM
                        ,C.DDL_TBL_LNM
                        ,D.DDL_COL_ID
                        ,D.DDL_COL_PNM
                        ,D.DDL_COL_LNM
                        ,D.COL_ORD       
                        ,D.DATA_TYPE    
                        ,D.DATA_LEN     
                        ,D.DATA_SCAL    
                        ,D.PK_YN 
                        ,D.PK_ORD  
                        ,D.NONUL_YN
                        ,D.DEFLT_VAL
                        ,C.DB_SCH_ID
                        FROM WAM_DDL_TBL C
                        INNER JOIN WAM_DDL_COL D
                        ON C.DDL_TBL_ID = D.DDL_TBL_ID) C
                  FULL OUTER JOIN (SELECT DBC.DB_SCH_ID
                                         ,DBC.DBC_TBL_NM
                                         ,DBCCOL.DBC_COL_NM 
                                         ,DBCCOL.ORD      
                                         ,DBCCOL.DATA_TYPE
                                         ,DBCCOL.DATA_LEN
                                         ,DBCCOL.DATA_PNT
                                         ,DBCCOL.NULL_YN
                                         ,DBCCOL.DEFLT_VAL 
                                         ,DBCCOL.PK_YN     
                                         ,DBCCOL.PK_ORD    
                                   FROM WAT_DBC_TBL DBC
                                   INNER JOIN WAT_DBC_COL DBCCOL
                                   ON DBCCOL.DBC_TBL_NM = DBC.DBC_TBL_NM
                                   AND DBC.DB_SCH_ID =DBCCOL.DB_SCH_ID
                                   ) DBC
                  ON C.DB_SCH_ID = DBC.DB_SCH_ID
                  AND C.DDL_TBL_PNM = DBC.DBC_TBL_NM
                  AND C.DDL_COL_PNM = DBC.DBC_COL_NM 
                  WHERE 1=1   
                    AND (C.DDL_TBL_PNM = #{ddlTblPnm,jdbcType=VARCHAR} OR DBC.DBC_TBL_NM = #{ddlTblPnm,jdbcType=VARCHAR}
                         OR C.DDL_TBL_PNM = #{dbcTblNm,jdbcType=VARCHAR} OR DBC.DBC_TBL_NM = #{dbcTblNm,jdbcType=VARCHAR})
                    AND (C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR} OR DBC.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR})
             ) A
             ORDER BY DDL_TBL_PNM, DDL_COL_ORD,DBC_COL_ORD
</select>

<select id="selectMartPdmGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
<!-- 
SELECT 	/* ModelGapMapper.selectMartPdmGapList */
		A.*,                                                                     
        CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor           
       FROM (                                                                    
             SELECT CASE WHEN SUM(GAP_STATUS) = 0 THEN 'NML' ELSE 'GAP' END AS GAP_STATUS
                   ,CASE WHEN COUNT(MART_COL_PNM) = 0 THEN '[모델마트테이블미존재]'
                         WHEN COUNT(PDM_COL_PNM) = 0 THEN '[물리모델테이블미존재]'
                    ELSE MAX(GAP_CONTS) END  GAP_CONTS                            
                   ,MAX(OF_SUBJ)             SUBJ_LNM                                             
                   ,MART_TBL_PNM        MART_TBL_PNM                                         
                   ,MAX(MART_TBL_LNM)   MART_TBL_LNM                                         
                   ,COUNT(MART_COL_PNM) MART_COL_CNT                                         
                   ,MAX(PDM_TBL_PNM)    PDM_TBL_PNM                                          
                   ,MAX(PDM_TBL_LNM)    PDM_TBL_LNM                                          
                   ,COUNT(PDM_COL_PNM)  PDM_COL_CNT   
                   ,MAX(PDM_TBL_ID)     PDM_TBL_ID                                       
             FROM (                                                                          
                   SELECT                                                                          
                     CASE WHEN IFNULL(E.COL_ORD,0)   != IFNULL(C.POSITION, 0)                       
                            OR IFNULL(E.DATA_TYPE,'-') != IFNULL(C.DATA_TYPE,'-')                  
                            OR IFNULL(E.DATA_LEN,0)  != IFNULL(C.DATA_LENGTH ,0)                   
                            OR IFNULL(E.DATA_SCAL,0) != IFNULL(C.DATA_SCALE,0)                     
                            OR IFNULL(E.NONUL_YN,'N') != IFNULL(C.IS_NULL_YN,'N')                  
                            OR IFNULL(REPLACE(E.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C.DATA_DEFAULT,CHAR(39), NULL),'-')               
                            OR IFNULL(E.PK_YN ,'N')    != IFNULL(C.IS_PK_YN   ,'N')                
                            OR IFNULL(E.PK_ORD,0)    != IFNULL(C.PK_POSITION,0)   THEN 1           
                     ELSE 0 END AS GAP_STATUS 
                     ,CONCAT(
	                        CASE WHEN E.PDM_COL_PNM IS NOT NULL
	                              AND E.PDM_TBL_PNM IS NOT NULL
	                              AND C.MART_COL_PNM IS NOT NULL
	                              AND C.OBJ_ENM IS NOT NULL
	                              AND (IFNULL(E.COL_ORD,0)   != IFNULL(C.POSITION, 0)                       
	                               OR IFNULL(E.DATA_TYPE,'-') != IFNULL(C.DATA_TYPE,'-')                  
	                               OR IFNULL(E.DATA_LEN,0)  != IFNULL(C.DATA_LENGTH ,0)                   
	                               OR IFNULL(E.DATA_SCAL,0) != IFNULL(C.DATA_SCALE,0)                     
	                               OR IFNULL(E.NONUL_YN,'N') != IFNULL(C.IS_NULL_YN,'N')                  
	                               OR IFNULL(REPLACE(E.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C.DATA_DEFAULT,CHAR(39), NULL),'-')               
	                               OR IFNULL(E.PK_YN ,'N')    != IFNULL(C.IS_PK_YN   ,'N')                
	                               OR IFNULL(E.PK_ORD,0)    != IFNULL(C.PK_POSITION,0))
	                             THEN '[컬럼GAP존재]' ELSE '' END
	                       ,CASE WHEN C.OBJ_ENM IS NULL THEN '[모델마트컬럼미존재]' ELSE '' END
	                    /* ,CASE WHEN C.MART_COL_PNM IS NULL THEN '[모델마트컬럼미존재]' ELSE '' END */
	                       ,CASE WHEN E.PDM_TBL_PNM IS NULL THEN '[물리모델컬럼미존재]' ELSE '' END
	                    /* ,CASE WHEN E.PDM_COL_PNM IS NULL THEN '[물리모델컬럼미존재]' ELSE '' END */
	                        ) AS GAP_CONTS                                                                            
                     ,CONCAT(C.OF_DATAMODEL,'>',C.OF_PRIMARY_SUBJ,'>',C.OF_SUBJ) AS MART_FULL_PATH
                     ,C.OF_DATAMODEL                                                          
                     ,C.OF_PRIMARY_SUBJ                                                       
                     ,IFNULL(C.OF_SUBJ,F.SUBJ_LNM) AS OF_SUBJ                                    
                     ,IFNULL(C.OBJ_ENM,E.PDM_TBL_PNM)  AS MART_TBL_PNM                           
                     ,IFNULL(C.OBJ_KNM,E.PDM_TBL_LNM)  AS MART_TBL_LNM                           
                     ,C.MART_COL_PNM                                              
                     ,C.MART_COL_LNM                                              
                     ,C.POSITION                                                              
                     ,C.DATA_TYPE                                                             
                     ,C.DATA_LENGTH                                                           
                     ,C.DATA_SCALE                                                            
                     ,C.IS_PK_YN                                                              
                     ,C.PK_POSITION                                                           
                     ,C.IS_NULL_YN                                                            
                     ,C.DATA_DEFAULT                                                          
                     ,F.SUBJ_LNM                                                              
                     ,E.FULL_PATH                                                             
                     /* ,IFNULL(E.PDM_TBL_PNM, C.OBJ_ENM) PDM_TBL_PNM     */                          
                     /* ,IFNULL(E.PDM_TBL_LNM, C.OBJ_KNM) PDM_TBL_LNM */
                     ,E.PDM_TBL_ID
                     ,E.PDM_TBL_PNM
                     ,E.PDM_TBL_LNM                               
                     ,E.PDM_COL_PNM                                                           
                     ,E.PDM_COL_LNM                                                           
                     ,E.COL_ORD                                                               
                     ,E.DATA_TYPE                                                             
                     ,E.DATA_LEN                                                              
                     ,E.DATA_SCAL                                                             
                     ,E.PK_YN                                                                 
                     ,E.PK_ORD                                                                
                     ,E.NONUL_YN                                                              
                     ,E.DEFLT_VAL                                                             
              FROM 
                  ( 
                       SELECT C.OF_DATAMODEL                                   
                             ,C.OF_PRIMARY_SUBJ                                
                             ,C.OF_SUBJ
                             ,C.OBJ_ENM
                             ,C.OBJ_KNM
                             ,D.OBJ_ENM MART_COL_PNM
                             ,D.OBJ_KNM MART_COL_LNM
                             ,D.POSITION                                       
                             ,D.DATA_TYPE                                      
                             ,D.DATA_LENGTH                                    
                             ,D.DATA_SCALE                                     
                             ,D.IS_PK_YN                                       
                             ,D.PK_POSITION                                    
                             ,D.IS_NULL_YN                                     
                             ,D.DATA_DEFAULT                                   
                         FROM WAE_PDMART_ENTY C                                                          
                         INNER JOIN WAE_PDMART_ATTR D                                                    
                                 ON C.OBJ_ENM =D.OF_TABLE                                                        
                                AND C.OF_DATAMODEL =D.OF_DATAMODEL                                              
                                AND C.OF_PRIMARY_SUBJ =D.OF_PRIMARY_SUBJ                                        
                                AND C.OF_SUBJ        =D.OF_SUBJ
                   ) C
               FULL OUTER JOIN 
                   ( 
                       SELECT A.PDM_TBL_ID
                             ,A.PDM_TBL_PNM
                             ,A.PDM_TBL_LNM
                             ,B.PDM_COL_ID
                             ,B.PDM_COL_PNM
                             ,B.PDM_COL_LNM
                             ,A.SUBJ_ID
                             ,A.FULL_PATH
                             ,B.COL_ORD                                                               
                             ,B.DATA_TYPE                                                             
                             ,B.DATA_LEN                                                              
                             ,B.DATA_SCAL                                                             
                             ,B.PK_YN                                                                 
                             ,B.PK_ORD                                                                
                             ,B.NONUL_YN                                                              
                             ,B.DEFLT_VAL   
                             ,A.APRV_DTM  
                         FROM WAM_PDM_TBL A                                    
                                INNER JOIN WAM_PDM_COL B                                       
                                ON A.PDM_TBL_ID = B.PDM_TBL_ID
                   ) E                              
               ON E.PDM_TBL_PNM = C.OBJ_ENM                                                    
               AND C.MART_COL_PNM = E.PDM_COL_PNM                                                   
               AND CONCAT(C.OF_DATAMODEL,'>',C.OF_PRIMARY_SUBJ,'>',C.OF_SUBJ) = E.FULL_PATH        
               LEFT OUTER JOIN WAA_SUBJ F                                                      
               ON E.SUBJ_ID =F.SUBJ_ID                                                         
               AND F.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')                                 
               AND F.REG_TYP_CD IN ('C', 'U')   
               WHERE 1=1   
               <if test="fullPath != null">
               <![CDATA[
               AND (E.FULL_PATH LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%') 
                    OR (CONCAT(C.OF_DATAMODEL,'>',C.OF_PRIMARY_SUBJ,'>',C.OF_SUBJ)) LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%'))      ]]>
               </if>
               <if test="searchBgnDe != null">
               <![CDATA[
               AND DATE_FORMAT(E.APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR}
               ]]>
               </if>
               <if test="searchEndDe != null">
               <![CDATA[
               AND DATE_FORMAT(E.APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR}
               ]]>
               </if>
               <if test="tblNm != null">
               AND (  C.OBJ_ENM  LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                      OR C.OBJ_KNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                      OR E.PDM_TBL_PNM  LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                      OR E.PDM_TBL_LNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                      )
               </if>                                               
       )                                                                               
       GROUP BY MART_TBL_PNM                                                  
     ) A         
    <where>
     <if test="gapStatus != null">
     AND GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
     </if>
    </where>
     ORDER BY GAP_STATUS, GAP_CONTS,SUBJ_LNM, MART_TBL_PNM 
-->
 
 SELECT A.*,           -- selectMartPdmGapList                                                        
       CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor           
       FROM (                                                                    
             SELECT CASE WHEN SUM(GAP_STATUS) = 0 THEN 'NML' ELSE 'GAP' END AS GAP_STATUS
                   ,CASE WHEN COUNT(MART_COL_PNM) = 0 THEN '[모델마트테이블미존재]'
                         WHEN COUNT(E_PDM_COL_PNM) = 0 THEN '[물리모델테이블미존재]'
                    ELSE  MAX(GAP_CONTS) END  GAP_CONTS                            
                   ,MAX(F_SUBJ_LNM)             SUBJ_LNM                                             
                   ,MART_TBL_PNM        MART_TBL_PNM                                         
                   ,MAX(MART_TBL_LNM)   MART_TBL_LNM                                         
                   ,COUNT(MART_COL_PNM) MART_COL_CNT                                         
                   ,MAX(E_PDM_TBL_PNM)    PDM_TBL_PNM                                          
                   ,MAX(E_PDM_TBL_LNM)    PDM_TBL_LNM                                          
                   ,COUNT(E_PDM_COL_PNM)  PDM_COL_CNT   
                   ,MAX(E_PDM_TBL_ID)     PDM_TBL_ID                                       
             FROM (                                                                          
             SELECT                                                                          
                    CASE WHEN IFNULL(E_COL_ORD,0)   != IFNULL(C_COL_ORD, 0)                       
                           OR IFNULL(E_DATA_TYPE,'-') != IFNULL(C_DATA_TYPE,'-')                  
                           OR IFNULL(E_DATA_LEN,0)  != IFNULL(C_DATA_LEN ,0)                   
                           OR IFNULL(E_DATA_SCAL,0) != IFNULL(C_DATA_SCAL,0)                     
                           OR IFNULL(E_NONUL_YN,'N') != IFNULL(C_NONUL_YN,'N')                  
                           OR IFNULL(REPLACE(E_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C_DEFLT_VAL,CHAR(39), NULL),'-')               
                           OR IFNULL(E_PK_YN ,'N')    != IFNULL(C_PK_YN   ,'N')                
                           OR IFNULL(E_PK_ORD,0)    != IFNULL(C_PK_ORD,0)   THEN 1           
                         ELSE 0 END AS GAP_STATUS 
                   ,CONCAT(
                    CASE WHEN E_PDM_COL_PNM IS NOT NULL
                          AND E_PDM_TBL_PNM IS NOT NULL
                          AND C_PDM_COL_PNM IS NOT NULL
                          AND C_PDM_TBL_PNM IS NOT NULL
                          AND (IFNULL(E_COL_ORD,0)   != IFNULL(C_COL_ORD, 0)                       
                           OR IFNULL(E_DATA_TYPE,'-') != IFNULL(C_DATA_TYPE,'-')                  
                           OR IFNULL(E_DATA_LEN,0)  != IFNULL(C_DATA_LEN ,0)                   
                           OR IFNULL(E_DATA_SCAL,0) != IFNULL(C_DATA_SCAL,0)                     
                           OR IFNULL(E_NONUL_YN,'N') != IFNULL(C_NONUL_YN,'N')                  
                           OR IFNULL(REPLACE(E_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C_DEFLT_VAL,CHAR(39), NULL),'-')               
                           OR IFNULL(E_PK_YN ,'N')    != IFNULL(C_PK_YN   ,'N')                
                           OR IFNULL(E_PK_ORD,0)    != coalesce(C_PK_ORD,0))
                      THEN '[컬럼GAP존재]' ELSE '' END
                      ,CASE WHEN C_PDM_TBL_PNM IS NULL THEN '[모델마트컬럼미존재]' ELSE '' END
                      ,CASE WHEN E_PDM_TBL_PNM IS NULL THEN '[물리모델컬럼미존재]' ELSE '' END
                          ) AS GAP_CONTS                                                                            
                    ,CONCAT(C_MDL_LNM,'>',C_UPP_SUBJ_LNM,'>',C_SUBJ_LNM) AS MART_FULL_PATH
                    ,C_MDL_LNM                                                          
                    ,C_UPP_SUBJ_LNM                                                       
                    ,IFNULL(C_SUBJ_LNM,F_SUBJ_LNM) AS OF_SUBJ                                    
                    ,IFNULL(C_PDM_TBL_PNM,E_PDM_TBL_PNM)  AS MART_TBL_PNM                           
                    ,IFNULL(C_PDM_TBL_LNM,E_PDM_TBL_LNM)  AS MART_TBL_LNM                           
                    ,C_PDM_COL_PNM AS MART_COL_PNM                                              
                    ,C_PDM_COL_LNM AS MART_COL_LNM                                              
                    ,C_COL_ORD                                                              
                    ,C_DATA_TYPE                                                             
                    ,C_DATA_LEN                                                           
                    ,C_DATA_SCAL                                                            
                    ,C_PK_YN                                                              
                    ,C_PK_ORD
                    ,C_NONUL_YN                                                            
                    ,C_DEFLT_VAL                                                          
                    ,F_SUBJ_LNM                                                              
                    ,E_FULL_PATH                                                             
                 -- ,IFNULL(E_PDM_TBL_PNM, C_OBJ_ENM) PDM_TBL_PNM                               
                 -- ,IFNULL(E_PDM_TBL_LNM, C_OBJ_KNM) PDM_TBL_LNM
                    ,E_PDM_TBL_ID
                    ,E_PDM_TBL_PNM
                    ,E_PDM_TBL_LNM                               
                    ,E_PDM_COL_PNM                                                           
                    ,E_PDM_COL_LNM                                                           
                    ,E_COL_ORD                                                               
                    ,E_DATA_TYPE                                                             
                    ,E_DATA_LEN                                                              
                    ,E_DATA_SCAL                                                             
                    ,E_PK_YN                                                                 
                    ,E_PK_ORD                                                                
                    ,E_NONUL_YN                                                              
                    ,E_DEFLT_VAL     
                                                                    
              FROM (
              SELECT * FROM (
                   (
                    SELECT LIB_NM AS C_MDL_LNM
              			 , MDL_NM AS C_UPP_SUBJ_LNM
              			 , SUBJ_NM AS C_SUBJ_LNM
              			 , PDM_TBL_PNM AS C_PDM_TBL_PNM
              			 , PDM_TBL_LNM AS C_PDM_TBL_LNM
              			 , PDM_COL_PNM AS C_PDM_COL_PNM
              			 , PDM_COL_LNM AS C_PDM_COL_LNM
              			 , COL_ORD AS C_COL_ORD
              			 , GET_DATA_TYPE_SPLIT(DATA_TYPE, 'DATA_TYPE') AS C_DATA_TYPE
              			 , GET_DATA_TYPE_SPLIT(DATA_TYPE, 'DATA_LEN') AS C_DATA_LEN
              			 , GET_DATA_TYPE_SPLIT(DATA_TYPE, 'DATA_SCAL') AS C_DATA_SCAL
              			 , PK_YN AS C_PK_YN
              			 , PK_ORD AS C_PK_ORD
              			 , NONUL_YN AS C_NONUL_YN
              			 , DEFLT_VAL AS C_DEFLT_VAL
                      FROM WAE_ERWIN_COL
                     ) C
               LEFT OUTER JOIN 
                    (
                      SELECT A.PDM_TBL_ID AS E_PDM_TBL_ID
                            ,A.PDM_TBL_PNM AS E_PDM_TBL_PNM
                            ,A.PDM_TBL_LNM AS E_PDM_TBL_LNM
                            ,B.PDM_COL_ID AS E_PDM_COL_ID
                            ,B.PDM_COL_PNM AS E_PDM_COL_PNM
                            ,B.PDM_COL_LNM AS E_PDM_COL_LNM
                            ,A.SUBJ_ID AS E_SUBJ_ID
                            ,A.FULL_PATH AS E_FULL_PATH
                            ,B.COL_ORD AS E_COL_ORD
                            ,B.DATA_TYPE AS E_DATA_TYPE
                            ,B.DATA_LEN AS E_DATA_LEN                                                      
                            ,B.DATA_SCAL AS E_DATA_SCAL                                                         
                            ,B.PK_YN AS E_PK_YN                                                   
                            ,B.PK_ORD AS E_PK_ORD                                                            
                            ,B.NONUL_YN AS E_NONUL_YN
                            ,B.DEFLT_VAL AS E_DEFLT_VAL
                            ,A.APRV_DTM AS E_APRV_DTM
                        FROM WAM_PDM_TBL A                                    
                        INNER JOIN WAM_PDM_COL B                                       
                                ON A.PDM_TBL_ID = B.PDM_TBL_ID
                     ) E                              
                ON E_PDM_TBL_PNM = C_PDM_TBL_PNM                                                    
               AND C_PDM_COL_PNM = E_PDM_COL_PNM                                                   
               AND CONCAT(C_MDL_LNM,'>',C_UPP_SUBJ_LNM,'>',C_SUBJ_LNM) = E_FULL_PATH  
             LEFT OUTER JOIN ( SELECT F.SUBJ_ID AS F_SUBJ_ID
                                     ,F.SUBJ_LNM AS F_SUBJ_LNM   
                                     ,F.EXP_DTM AS F_EXP_DTM
                                     ,F.REG_TYP_CD AS F_REG_TYP_CD
                                     FROM WAA_SUBJ F) F                                               
                          ON E_SUBJ_ID =F.F_SUBJ_ID                                                         
                         AND F.F_EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')                               
                         AND F.F_REG_TYP_CD IN ('C', 'U')  
             )   
UNION
			 SELECT * FROM (
                  (
                    SELECT LIB_NM AS C_MDL_LNM
              			 , MDL_NM AS C_UPP_SUBJ_LNM
              			 , SUBJ_NM AS C_SUBJ_LNM
              			 , PDM_TBL_PNM AS C_PDM_TBL_PNM
              			 , PDM_TBL_LNM AS C_PDM_TBL_LNM
              			 , PDM_COL_PNM AS C_PDM_COL_PNM
              			 , PDM_COL_LNM AS C_PDM_COL_LNM
              			 , COL_ORD AS C_COL_ORD
              			 , GET_DATA_TYPE_SPLIT(DATA_TYPE, 'DATA_TYPE') AS C_DATA_TYPE
              			 , GET_DATA_TYPE_SPLIT(DATA_TYPE, 'DATA_LEN') AS C_DATA_LEN
              			 , GET_DATA_TYPE_SPLIT(DATA_TYPE, 'DATA_SCAL') AS C_DATA_SCAL
              			 , PK_YN AS C_PK_YN
              			 , PK_ORD AS C_PK_ORD
              			 , NONUL_YN AS C_NONUL_YN
              			 , DEFLT_VAL AS C_DEFLT_VAL
                     FROM WAE_ERWIN_COL
                    ) C
               RIGHT OUTER JOIN 
                    (
                      SELECT A.PDM_TBL_ID AS E_PDM_TBL_ID
                            ,A.PDM_TBL_PNM AS E_PDM_TBL_PNM
                            ,A.PDM_TBL_LNM AS E_PDM_TBL_LNM
                            ,B.PDM_COL_ID AS E_PDM_COL_ID
                            ,B.PDM_COL_PNM AS E_PDM_COL_PNM
                            ,B.PDM_COL_LNM AS E_PDM_COL_LNM
                            ,A.SUBJ_ID AS E_SUBJ_ID
                            ,A.FULL_PATH AS E_FULL_PATH
                            ,B.COL_ORD AS E_COL_ORD
                            ,B.DATA_TYPE AS E_DATA_TYPE
                            ,B.DATA_LEN AS E_DATA_LEN                                                      
                            ,B.DATA_SCAL AS E_DATA_SCAL                                                         
                            ,B.PK_YN AS E_PK_YN                                                   
                            ,B.PK_ORD AS E_PK_ORD                                                            
                            ,B.NONUL_YN AS E_NONUL_YN
                            ,B.DEFLT_VAL AS E_DEFLT_VAL
                            ,A.APRV_DTM AS E_APRV_DTM
                        FROM WAM_PDM_TBL A                                    
                        INNER JOIN WAM_PDM_COL B                                       
                                ON A.PDM_TBL_ID = B.PDM_TBL_ID
                     ) E                              
                ON E_PDM_TBL_PNM = C_PDM_TBL_PNM                                                    
               AND C_PDM_COL_PNM = E_PDM_COL_PNM                                                   
               AND CONCAT(C_MDL_LNM,'>',C_UPP_SUBJ_LNM,'>',C_SUBJ_LNM) = E_FULL_PATH  
               LEFT OUTER JOIN ( SELECT F.SUBJ_ID AS F_SUBJ_ID
                                     ,F.SUBJ_LNM AS F_SUBJ_LNM   
                                     ,F.EXP_DTM AS F_EXP_DTM
                                     ,F.REG_TYP_CD AS F_REG_TYP_CD
                                     FROM WAA_SUBJ F) F                                               
                          ON E_SUBJ_ID =F.F_SUBJ_ID                                                         
                         AND F.F_EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')                               
                         AND F.F_REG_TYP_CD IN ('C', 'U')    
              )
          ) FSQ     

               WHERE 1=1   
               <if test="fullPath != null">
               <![CDATA[
               AND (E_FULL_PATH LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%') 
                    OR (CONCAT(C_MDL_LNM,'>',C_UPP_SUBJ_LNM,'>',C_SUBJ_LNM)) LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%'))      ]]>
               </if>
               <if test="searchBgnDe != null">
               <![CDATA[
               AND DATE_FORMAT(E_APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR}
               ]]>
               </if>
               <if test="searchEndDe != null">
               <![CDATA[
               AND DATE_FORMAT(E_APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR}
               ]]>
               </if>
               <if test="tblNm != null">
               AND ( C_PDM_TBL_PNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                  OR C_PDM_TBL_LNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                  OR E_PDM_TBL_PNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                  OR E_PDM_TBL_LNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                      )
               </if>                                               
       ) FSQ2
       GROUP BY MART_TBL_PNM                                                  
     ) A         
    <where>
     <if test="gapStatus != null">
     AND GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
     </if>
    </where>
     ORDER BY GAP_STATUS, GAP_CONTS,SUBJ_LNM, MART_TBL_PNM 
 
</select>

<select id="selectMartPdmColGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT 	/* ModelGapMapper.selectMartPdmColGapList */
		A.*
       ,CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor
  FROM (
         SELECT                                                                          
                    CASE WHEN IFNULL(E_COL_ORD,0)   != IFNULL(C_POSITION, 0)                       
                           OR IFNULL(E_DATA_TYPE,'-') != IFNULL(C_DATA_TYPE,'-')                  
                           OR IFNULL(E_DATA_LEN,0)  != IFNULL(C_DATA_LENGTH ,0)                   
                           OR IFNULL(E_DATA_SCAL,0) != IFNULL(C_DATA_SCALE,0)                     
                           OR IFNULL(E_NONUL_YN,'N') != IFNULL(C_IS_NULL_YN,'N')                  
                           OR IFNULL(REPLACE(E_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C_DATA_DEFAULT,CHAR(39), NULL),'-')               
                           OR IFNULL(E_PK_YN ,'N')    != IFNULL(C_IS_PK_YN   ,'N')                
                           OR IFNULL(E_PK_ORD,0)    != IFNULL(C_PK_POSITION,0)   THEN 'GAP'           
                         ELSE 'NML' END AS GAP_STATUS                                           
                    ,CONCAT(C_OF_DATAMODEL,'>',C_OF_PRIMARY_SUBJ,'>',C_OF_SUBJ) AS MART_FULL_PATH
                    ,C_OF_DATAMODEL AS OF_DATAMODEL
                    ,C_OF_PRIMARY_SUBJ AS OF_PRIMARY_SUBJ
                    ,IFNULL(C_OF_SUBJ,F.SUBJ_LNM) AS OF_SUBJ                                    
                    ,IFNULL(C_OBJ_ENM,E_PDM_TBL_PNM)  AS MART_TBL_PNM                           
                    ,IFNULL(C_OBJ_KNM,E_PDM_TBL_LNM)  AS MART_TBL_LNM                           
                    ,IFNULL(MART_COL_PNM, E_PDM_COL_PNM) AS MART_COL_PNM                                              
                    ,MART_COL_LNM                                              
                    ,C_POSITION        AS MART_COL_ORD                                                         
                    ,C_DATA_TYPE       AS MART_DATA_TYPE                                                       
                    ,C_DATA_LENGTH     AS MART_DATA_LEN                                                        
                    ,C_DATA_SCALE      AS MART_DATA_SCAL                                                       
                    ,C_IS_PK_YN        AS MART_PK_YN                                                           
                    ,C_PK_POSITION     AS MART_PK_ORD                                                          
                    ,C_IS_NULL_YN      AS MART_NONUL_YN                                                        
                    ,C_DATA_DEFAULT    AS MART_DEFLT_VAL                                                       
                    ,F.SUBJ_LNM 	   AS SUBJ_LNM 
                    ,E_FULL_PATH       AS FULL_PATH                                                     
                    ,E_PDM_TBL_PNM	   AS PDM_TBL_PNM
                    ,E_PDM_TBL_LNM     AS PDM_TBL_LNM                          
                    ,E_PDM_COL_PNM     AS PDM_COL_PNM
                    ,E_PDM_COL_LNM     AS PDM_COL_LNM                                                      
                    ,E_COL_ORD        AS PDM_COL_ORD                                                          
                    ,E_DATA_TYPE      AS PDM_DATA_TYPE                                                        
                    ,E_DATA_LEN       AS PDM_DATA_LEN                                                         
                    ,E_DATA_SCAL      AS PDM_DATA_SCAL                                                        
                    ,E_PK_YN          AS PDM_PK_YN                                                            
                    ,E_PK_ORD         AS PDM_PK_ORD                                                           
                    ,E_NONUL_YN       AS PDM_NONUL_YN                                                            
                    ,E_DEFLT_VAL      AS PDM_DEFLT_VAL                                                              
              FROM (
			  	  SELECT * 
				    FROM (
					      (
					        SELECT      C.OF_DATAMODEL AS C_OF_DATAMODEL
                                  ,C.OF_PRIMARY_SUBJ AS C_OF_PRIMARY_SUBJ
                                  ,C.OF_SUBJ AS C_OF_SUBJ
                                  ,C.OBJ_ENM AS C_OBJ_ENM
                                  ,C.OBJ_KNM AS C_OBJ_KNM
                                  ,D.OBJ_ENM  AS MART_COL_PNM
                                  ,D.OBJ_KNM  AS MART_COL_LNM
                                  ,D.POSITION AS C_POSITION
                                  ,D.DATA_TYPE AS C_DATA_TYPE
                                  ,D.DATA_LENGTH AS C_DATA_LENGTH
                                  ,D.DATA_SCALE AS C_DATA_SCALE
                                  ,D.IS_PK_YN AS C_IS_PK_YN
                                  ,D.PK_POSITION AS C_PK_POSITION
                                  ,D.IS_NULL_YN AS C_IS_NULL_YN
                                  ,D.DATA_DEFAULT AS C_DATA_DEFAULT
                              FROM WAE_PDMART_ENTY C                                                          
                              INNER JOIN WAE_PDMART_ATTR D                                                    
                                         ON C.OBJ_ENM =D.OF_TABLE                                                        
                                        AND C.OF_DATAMODEL =D.OF_DATAMODEL                                              
                                        AND C.OF_PRIMARY_SUBJ =D.OF_PRIMARY_SUBJ                                        
                                        AND C.OF_SUBJ        =D.OF_SUBJ
					       ) C
					 LEFT OUTER JOIN
					     (
						   SELECT A.PDM_TBL_ID AS E_PDM_TBL_ID
							     ,A.PDM_TBL_PNM AS E_PDM_TBL_PNM 
							     ,A.PDM_TBL_LNM AS E_PDM_TBL_LNM
							     ,B.PDM_COL_ID AS E_PDM_COL_ID
							     ,B.PDM_COL_PNM AS E_PDM_COL_PNM
							     ,B.PDM_COL_LNM AS E_PDM_COL_LNM
							     ,A.SUBJ_ID AS E_SUBJ_ID
							     ,A.FULL_PATH AS E_FULL_PATH
							     ,B.COL_ORD AS E_COL_ORD                                                     
							     ,B.DATA_TYPE AS E_DATA_TYPE                                                    
							     ,B.DATA_LEN AS E_DATA_LEN                                                      
							     ,B.DATA_SCAL AS E_DATA_SCAL                                                         
							     ,B.PK_YN AS E_PK_YN
							     ,B.PK_ORD AS E_PK_ORD                                                            
							     ,B.NONUL_YN AS E_NONUL_YN
							     ,B.DEFLT_VAL AS E_DEFLT_VAL
							     ,A.APRV_DTM AS E_APRV_DTM
                             FROM WAM_PDM_TBL A                                    
                             INNER JOIN WAM_PDM_COL B                                       
                                     ON A.PDM_TBL_ID = B.PDM_TBL_ID
						 ) E
					ON E.E_PDM_TBL_PNM = C.C_OBJ_ENM                                                    
				   AND C.MART_COL_PNM = E.E_PDM_COL_PNM                                                   
				   AND CONCAT(C_OF_DATAMODEL,'>',C_OF_PRIMARY_SUBJ,'>',C_OF_SUBJ) = E_FULL_PATH   
				        )
               UNION
			      SELECT * 
				    FROM (
					      (
					         SELECT C.OF_DATAMODEL AS C_OF_DATAMODEL
                                   ,C.OF_PRIMARY_SUBJ AS C_OF_PRIMARY_SUBJ
                                   ,C.OF_SUBJ AS C_OF_SUBJ
                                   ,C.OBJ_ENM AS C_OBJ_ENM
                                   ,C.OBJ_KNM AS C_OBJ_KNM
                                   ,D.OBJ_ENM  AS MART_COL_PNM
                                   ,D.OBJ_KNM  AS MART_COL_LNM
                                   ,D.POSITION AS C_POSITION
                                   ,D.DATA_TYPE AS C_DATA_TYPE
                                   ,D.DATA_LENGTH AS C_DATA_LENGTH
                                   ,D.DATA_SCALE AS C_DATA_SCALE
                                   ,D.IS_PK_YN AS C_IS_PK_YN
                                   ,D.PK_POSITION AS C_PK_POSITION
                                   ,D.IS_NULL_YN AS C_IS_NULL_YN
                                   ,D.DATA_DEFAULT AS C_DATA_DEFAULT
                               FROM WAE_PDMART_ENTY C                                                          
                               INNER JOIN WAE_PDMART_ATTR D                                                    
                                       ON C.OBJ_ENM =D.OF_TABLE                                                        
                                      AND C.OF_DATAMODEL =D.OF_DATAMODEL                                              
                                      AND C.OF_PRIMARY_SUBJ =D.OF_PRIMARY_SUBJ                                        
                                      AND C.OF_SUBJ        =D.OF_SUBJ
					     ) C
					 RIGHT OUTER JOIN
					       (
						     SELECT A.PDM_TBL_ID AS E_PDM_TBL_ID
							       ,A.PDM_TBL_PNM AS E_PDM_TBL_PNM 
							       ,A.PDM_TBL_LNM AS E_PDM_TBL_LNM
							       ,B.PDM_COL_ID AS E_PDM_COL_ID
							       ,B.PDM_COL_PNM AS E_PDM_COL_PNM
						  	       ,B.PDM_COL_LNM AS E_PDM_COL_LNM
							       ,A.SUBJ_ID AS E_SUBJ_ID
							       ,A.FULL_PATH AS E_FULL_PATH
							       ,B.COL_ORD AS E_COL_ORD                                                     
							       ,B.DATA_TYPE AS E_DATA_TYPE                                                    
							       ,B.DATA_LEN AS E_DATA_LEN                                                      
							       ,B.DATA_SCAL AS E_DATA_SCAL                                                         
							       ,B.PK_YN AS E_PK_YN
							       ,B.PK_ORD AS E_PK_ORD                                                            
							       ,B.NONUL_YN AS E_NONUL_YN
							       ,B.DEFLT_VAL AS E_DEFLT_VAL
							       ,A.APRV_DTM AS E_APRV_DTM
                               FROM WAM_PDM_TBL A                                    
                               INNER JOIN WAM_PDM_COL B                                       
                                       ON A.PDM_TBL_ID = B.PDM_TBL_ID
						   ) E
					ON E.E_PDM_TBL_PNM = C.C_OBJ_ENM                                                    
				   AND C.MART_COL_PNM = E.E_PDM_COL_PNM                                                  
				   AND CONCAT(C_OF_DATAMODEL,'>',C_OF_PRIMARY_SUBJ,'>',C_OF_SUBJ) = E_FULL_PATH   
				          )       
            ) FSQ
                           LEFT OUTER JOIN WAA_SUBJ F                                                      
                            ON E_SUBJ_ID =F.SUBJ_ID                                                         
                           AND F.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')                                 
                           AND F.REG_TYP_CD IN ('C', 'U')   
               WHERE 1=1
                AND (C_OBJ_ENM = #{martTblPnm,jdbcType=VARCHAR} OR E_PDM_TBL_ID = #{pdmTblId,jdbcType=VARCHAR})
       ) A
WHERE 1=1
  AND OF_SUBJ =#{subjLnm,jdbcType=VARCHAR}
ORDER BY MART_TBL_PNM, MART_COL_ORD   ,PDM_COL_ORD
               
</select>

<select id="selectDdlTsfGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	 	/* ModelGapMapper.selectDdlTsfGapList */
SELECT A.*,
       IFNULL(SCH.DB_SCH_PNM,SCH.DB_SCH_LNM) DB_SCH_LNM,
       IFNULL(TRG.DB_CONN_TRG_PNM, TRG.DB_CONN_TRG_LNM) DB_CONN_TRG_LNM,
       DB_TSF_CONN_TRG_LNM,
       DB_TSF_SCH_LNM,
       CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor           
       FROM (                                                                    
             SELECT CASE WHEN SUM(GAP_STATUS) = 0 THEN 'NML' ELSE 'GAP' END AS GAP_STATUS
                   ,CASE WHEN COUNT(DDL_COL_PNM) = 0 THEN '[DDL소스테이블미존재]'
                         WHEN COUNT(DDL_TSF_COL_PNM) = 0 THEN '[DDL타겟테이블미존재]'
                    ELSE  MAX(GAP_CONTS) END  GAP_CONTS                     
                   ,MAX(DDL_TBL_ID)     DDL_TBL_ID                                             
                   ,DDL_TBL_PNM         DDL_TBL_PNM                                         
                   ,MAX(DDL_TBL_LNM)   DDL_TBL_LNM                                         
                   ,COUNT(DDL_COL_PNM) DDL_COL_CNT                                         
                   ,MAX(DDL_TSF_TBL_PNM)    DDL_TSF_TBL_PNM                                          
                   -- ,MAX(DBC_TBL_LNM)    DBC_TBL_LNM                                          
                   ,COUNT(DDL_TSF_COL_PNM)  DDL_TSF_COL_CNT   
                   ,MAX(DB_SCH_ID)      DB_SCH_ID   
                   ,MAX(DB_TSF_SCH_ID) DB_TSF_SCH_ID
                   ,MAX(DB_TSF_CONN_TRG_LNM) DB_TSF_CONN_TRG_LNM
                   ,MAX(DB_TSF_SCH_LNM) DB_TSF_SCH_LNM
                   ,MAX(DDL_TSF_TBL_ID) DDL_TSF_TBL_ID
                   ,MAX(SUBJ_LNM) AS SUBJ_LNM
             FROM (
                  SELECT 
                    A_DDL_TBL_ID	AS DDL_TBL_ID
                   ,IFNULL(A_DDL_TBL_PNM,B_DDL_TBL_PNM) AS DDL_TBL_PNM
                   ,A_DDL_TBL_LNM	AS DDL_TBL_LNM
                   ,A_DDL_COL_ID	AS DDL_COL_ID
                   ,IFNULL(A_DDL_COL_PNM,B_DDL_COL_PNM) AS DDL_COL_PNM
                   ,A_DDL_COL_LNM  AS DDL_COL_LNM
                   ,A_COL_ORD      AS DDL_COL_ORD   
                   ,A_DATA_TYPE    AS DDL_DATA_TYPE 
                   ,A_DATA_LEN     AS DDL_DATA_LEN  
                   ,A_DATA_SCAL    AS DDL_DATA_SCAL 
                   ,IFNULL(A_PK_YN,'-')  AS DDL_PK_YN     
                   ,A_PK_ORD       AS DDL_PK_ORD    
                   ,IFNULL(A_NONUL_YN,'-') AS DDL_NONUL_YN  
                   ,A_DEFLT_VAL    AS DDL_DEFLT_VAL 
                   ,B_DDL_TBL_PNM AS DDL_TSF_TBL_PNM
                   ,B_DDL_COL_PNM AS DDL_TSF_COL_PNM
                   ,B_COL_ORD         AS DDL_TSF_COL_ORD
                   ,B_DATA_TYPE   AS DDL_TSF_DATA_TYPE
                   ,B_DATA_LEN   AS DDL_TSF_DATA_LEN
                   ,CASE WHEN B_DATA_SCAL = 0 THEN NULL ELSE B_DATA_SCAL END AS DDL_TSF_DATA_SCAL
				   ,CASE WHEN IFNULL(B_NONUL_YN,'-') = 'N' THEN 'Y'
                         WHEN IFNULL(B_NONUL_YN,'-') = 'Y' THEN 'N'
                    ELSE '-' END  AS DDL_TSF_NONUL_YN 
                   ,B_DEFLT_VAL   AS DDL_TSF_DEFLT_VAL
                   ,B_PK_YN       AS DDL_TSF_PK_YN
                   ,B_PK_ORD      AS DDL_TSF_PK_ORD
                   ,CASE WHEN IFNULL(B_COL_ORD,0)   != IFNULL(A_COL_ORD, 0) 
                           OR IFNULL(B_DATA_TYPE,'-') != IFNULL(A_DATA_TYPE,'-')
                           OR IFNULL(B_DATA_LEN,0)  != IFNULL(A_DATA_LEN ,0)
                           OR IFNULL(B_DATA_SCAL,0) != IFNULL(A_DATA_SCAL,0)
                           OR IFNULL(B_NONUL_YN,'N')  != IFNULL(A_NONUL_YN,'N') 
                           OR IFNULL(REPLACE(B_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(A_DEFLT_VAL,CHAR(39), NULL),'-')
                           OR IFNULL(B_PK_YN ,'N')    != IFNULL(A_PK_YN   ,'N') 
                           OR IFNULL(B_PK_ORD,0)    != IFNULL(A_PK_ORD,0)   THEN 1
                     ELSE 0 END AS GAP_STATUS 
                     , CONCAT(
							CASE WHEN A_DDL_TBL_PNM IS NULL THEN '[DDL소스컬럼미존재]' ELSE '' END
							  ,CASE WHEN B_DDL_TBL_PNM IS NULL THEN '[DDL타겟컬럼미존재]' ELSE '' END
							  ,CASE WHEN B_DDL_TBL_PNM IS NOT NULL
									 AND A_DDL_TBL_PNM IS NOT NULL
									 AND (    IFNULL(B_COL_ORD,0)   != IFNULL(A_COL_ORD, 0) 
										   OR IFNULL(B_DATA_TYPE,'-') != IFNULL(A_DATA_TYPE,'-')
										   OR IFNULL(B_DATA_LEN,0)  != IFNULL(A_DATA_LEN ,0)
										   OR IFNULL(B_DATA_SCAL,0) != IFNULL(A_DATA_SCAL,0)
										   OR IFNULL(B_NONUL_YN,'N')  != IFNULL(A_NONUL_YN,'N') 
										   OR IFNULL(REPLACE(B_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(A_DEFLT_VAL,CHAR(39), NULL),'-')
										   OR IFNULL(B_PK_YN ,'N')    != IFNULL(A_PK_YN   ,'N') 
										   OR IFNULL(B_PK_ORD,0)    != IFNULL(A_PK_ORD,0))
                      THEN '[컬럼GAP존재]' ELSE '' END
                       ) AS GAP_CONTS       
                    ,IFNULL(A_DB_SCH_ID , B_SRC_DB_SCH_ID) AS DB_SCH_ID
                    ,IFNULL(A_DB_SCH_ID , B_TGT_DB_SCH_ID) AS DB_TSF_SCH_ID
                    ,IFNULL(TRG.DB_CONN_TRG_PNM,DB_CONN_TRG_LNM) AS DB_TSF_CONN_TRG_LNM
                    ,IFNULL(SCH.DB_SCH_PNM,DB_SCH_LNM) AS DB_TSF_SCH_LNM
                    ,B_DDL_TBL_ID AS DDL_TSF_TBL_ID
                    ,A_SUBJ_LNM AS SUBJ_LNM
                  FROM (
				  
					SELECT * FROM (
							  (
							  SELECT C.DDL_TBL_ID		AS A_DDL_TBL_ID
									,C.DDL_TBL_PNM		AS A_DDL_TBL_PNM
									,C.DDL_TBL_LNM		AS A_DDL_TBL_LNM
									,D.DDL_COL_ID		AS A_DDL_COL_ID
									,D.DDL_COL_PNM		AS A_DDL_COL_PNM
									,D.DDL_COL_LNM		AS A_DDL_COL_LNM
									,D.COL_ORD       	AS A_COL_ORD
									,D.DATA_TYPE    	AS A_DATA_TYPE
									,D.DATA_LEN     	AS A_DATA_LEN
									,D.DATA_SCAL    	AS A_DATA_SCAL
									,D.PK_YN 			AS A_PK_YN
									,D.PK_ORD  			AS A_PK_ORD
									,D.NONUL_YN			AS A_NONUL_YN
									,D.DEFLT_VAL		AS A_DEFLT_VAL
									,C.DB_SCH_ID		AS A_DB_SCH_ID
									,C.APRV_DTM			AS A_APRV_DTM
									,TRG.DB_CONN_TRG_ID AS A_DB_CONN_TRG_ID
									,PDM.FULL_PATH		AS A_FULL_PATH
									,SUBJ.SUBJ_LNM		AS A_SUBJ_LNM
									FROM WAM_DDL_TBL C
										INNER JOIN WAM_DDL_COL D
										ON C.DDL_TBL_ID = D.DDL_TBL_ID
										LEFT OUTER JOIN WAA_DB_SCH SCH
										ON C.DB_SCH_ID = SCH.DB_SCH_ID
										AND SCH.REG_TYP_CD IN ('C', 'U')
										AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
										ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
										AND TRG.REG_TYP_CD IN ('C', 'U')
										AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										LEFT OUTER JOIN WAM_PDM_TBL PDM
										ON C.PDM_TBL_ID = PDM.PDM_TBL_ID
										LEFT OUTER JOIN WAA_SUBJ SUBJ
										ON PDM.SUBJ_ID = SUBJ.SUBJ_ID
										AND SUBJ.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										AND SUBJ.REG_TYP_CD IN ('C', 'U')
									WHERE 1=1
									<choose>
										<when test="gapDcd.equals('DT')">
											AND SCH.DDL_TRG_DCD = 'D'		-- 개발
										</when>
										<when test="gapDcd.equals('DR')">
											AND SCH.DDL_TRG_DCD = 'D'		-- 개발
										</when>
										<when test="gapDcd.equals('TR')">
											AND SCH.DDL_TRG_DCD = 'T'		-- 테스트
										</when>
									</choose>
									AND SCH.DDL_TRG_YN = 'Y'		-- DDL대상여부
									AND SCH.DB_SCH_ID IN (SELECT SRC_DB_SCH_ID
															FROM WAA_DB_MAP
														   WHERE EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
															 AND REG_TYP_CD IN ('C', 'U'))
									) A
							LEFT OUTER JOIN 
									(
											   SELECT TBL.DDL_TBL_ID		AS B_DDL_TBL_ID
													 ,TBL.DDL_TBL_PNM		AS B_DDL_TBL_PNM
													 ,TBL.DDL_TBL_LNM		AS B_DDL_TBL_LNM
													 ,TBL.TGT_DB_SCH_ID 	AS B_TGT_DB_SCH_ID
													 ,TBL.SRC_DB_SCH_ID     AS B_SRC_DB_SCH_ID
													 ,TBL.TBL_SPAC_ID		AS B_TBL_SPAC_ID
													 ,TBL.APRV_DTM			AS B_APRV_DTM
													 ,COL.DDL_COL_ID		AS B_DDL_COL_ID
													 ,COL.DDL_COL_PNM		AS B_DDL_COL_PNM
													 ,COL.DDL_COL_LNM		AS B_DDL_COL_LNM
													 ,COL.COL_ORD       	AS B_COL_ORD
													 ,COL.DATA_TYPE    		AS B_DATA_TYPE
													 ,COL.DATA_LEN     		AS B_DATA_LEN
													 ,COL.DATA_SCAL    		AS B_DATA_SCAL
													 ,COL.PK_YN 			AS B_PK_YN
													 ,COL.PK_ORD  			AS B_PK_ORD
													 ,COL.NONUL_YN			AS B_NONUL_YN
													 ,COL.DEFLT_VAL			AS B_DEFLT_VAL
											   FROM WAM_DDL_TBL TBL	
												   INNER JOIN WAM_DDL_COL COL
												   ON TBL.DDL_TBL_ID = COL.DDL_TBL_ID
												   LEFT OUTER JOIN WAA_DB_SCH SCH
												   ON TBL.DB_SCH_ID = SCH.DB_SCH_ID
												   AND SCH.REG_TYP_CD IN ('C','U')
												   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
											   WHERE 1=1
											<choose>
												<when test="gapDcd.equals('DT')">
													AND SCH.DDL_TRG_DCD = 'T'		-- 테스트
												</when>
												<when test="gapDcd.equals('DR')">
													AND SCH.DDL_TRG_DCD = 'R'		-- 운영
												</when>
												<when test="gapDcd.equals('TR')">
													AND SCH.DDL_TRG_DCD = 'R'		-- 운영
												</when>
											</choose>
											AND SCH.DDL_TRG_YN = 'Y'		-- DDL대상여부
											AND SCH.DB_SCH_ID IN (SELECT TGT_DB_SCH_ID
																	FROM WAA_DB_MAP
																   WHERE EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
																	 AND REG_TYP_CD IN ('C', 'U'))
									) B
							  ON A_DB_SCH_ID = B_SRC_DB_SCH_ID
							  AND A_DDL_TBL_ID = B_DDL_TBL_ID
							  AND A_DDL_COL_ID = B_DDL_COL_ID
							)
UNION
					SELECT * FROM (
							  (
							  SELECT C.DDL_TBL_ID		AS A_DDL_TBL_ID
									,C.DDL_TBL_PNM		AS A_DDL_TBL_PNM
									,C.DDL_TBL_LNM		AS A_DDL_TBL_LNM
									,D.DDL_COL_ID		AS A_DDL_COL_ID
									,D.DDL_COL_PNM		AS A_DDL_COL_PNM
									,D.DDL_COL_LNM		AS A_DDL_COL_LNM
									,D.COL_ORD       	AS A_COL_ORD
									,D.DATA_TYPE    	AS A_DATA_TYPE
									,D.DATA_LEN     	AS A_DATA_LEN
									,D.DATA_SCAL    	AS A_DATA_SCAL
									,D.PK_YN 			AS A_PK_YN
									,D.PK_ORD  			AS A_PK_ORD
									,D.NONUL_YN			AS A_NONUL_YN
									,D.DEFLT_VAL		AS A_DEFLT_VAL
									,C.DB_SCH_ID		AS A_DB_SCH_ID
									,C.APRV_DTM			AS A_APRV_DTM
									,TRG.DB_CONN_TRG_ID AS A_DB_CONN_TRG_ID
									,PDM.FULL_PATH		AS A_FULL_PATH
									,SUBJ.SUBJ_LNM		AS A_SUBJ_LNM
									FROM WAM_DDL_TBL C
										INNER JOIN WAM_DDL_COL D
										ON C.DDL_TBL_ID = D.DDL_TBL_ID
										LEFT OUTER JOIN WAA_DB_SCH SCH
										ON C.DB_SCH_ID = SCH.DB_SCH_ID
										AND SCH.REG_TYP_CD IN ('C', 'U')
										AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
										ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
										AND TRG.REG_TYP_CD IN ('C', 'U')
										AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										LEFT OUTER JOIN WAM_PDM_TBL PDM
										ON C.PDM_TBL_ID = PDM.PDM_TBL_ID
										LEFT OUTER JOIN WAA_SUBJ SUBJ
										ON PDM.SUBJ_ID = SUBJ.SUBJ_ID
										AND SUBJ.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										AND SUBJ.REG_TYP_CD IN ('C', 'U')
									WHERE 1=1
									<choose>
										<when test="gapDcd.equals('DT')">
											AND SCH.DDL_TRG_DCD = 'D'		-- 개발
										</when>
										<when test="gapDcd.equals('DR')">
											AND SCH.DDL_TRG_DCD = 'D'		-- 개발
										</when>
										<when test="gapDcd.equals('TR')">
											AND SCH.DDL_TRG_DCD = 'T'		-- 테스트
										</when>
									</choose>
									AND SCH.DDL_TRG_YN = 'Y'		-- DDL대상여부
									AND SCH.DB_SCH_ID IN (SELECT SRC_DB_SCH_ID
															FROM WAA_DB_MAP
														   WHERE EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
															 AND REG_TYP_CD IN ('C', 'U'))
									) A
							RIGHT OUTER JOIN 
									(
											   SELECT TBL.DDL_TBL_ID		AS B_DDL_TBL_ID
													 ,TBL.DDL_TBL_PNM		AS B_DDL_TBL_PNM
													 ,TBL.DDL_TBL_LNM		AS B_DDL_TBL_LNM
													 ,TBL.TGT_DB_SCH_ID 	AS B_TGT_DB_SCH_ID
													 ,TBL.SRC_DB_SCH_ID     AS B_SRC_DB_SCH_ID
													 ,TBL.TBL_SPAC_ID		AS B_TBL_SPAC_ID
													 ,TBL.APRV_DTM			AS B_APRV_DTM
													 ,COL.DDL_COL_ID		AS B_DDL_COL_ID
													 ,COL.DDL_COL_PNM		AS B_DDL_COL_PNM
													 ,COL.DDL_COL_LNM		AS B_DDL_COL_LNM
													 ,COL.COL_ORD       	AS B_COL_ORD
													 ,COL.DATA_TYPE    		AS B_DATA_TYPE
													 ,COL.DATA_LEN     		AS B_DATA_LEN
													 ,COL.DATA_SCAL    		AS B_DATA_SCAL
													 ,COL.PK_YN 			AS B_PK_YN
													 ,COL.PK_ORD  			AS B_PK_ORD
													 ,COL.NONUL_YN			AS B_NONUL_YN
													 ,COL.DEFLT_VAL			AS B_DEFLT_VAL
											   FROM WAM_DDL_TBL TBL	
												   INNER JOIN WAM_DDL_COL COL
												   ON TBL.DDL_TBL_ID = COL.DDL_TBL_ID
												   LEFT OUTER JOIN WAA_DB_SCH SCH
												   ON TBL.DB_SCH_ID = SCH.DB_SCH_ID
												   AND SCH.REG_TYP_CD IN ('C','U')
												   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
											   WHERE 1=1
											<choose>
												<when test="gapDcd.equals('DT')">
													AND SCH.DDL_TRG_DCD = 'T'		-- 테스트
												</when>
												<when test="gapDcd.equals('DR')">
													AND SCH.DDL_TRG_DCD = 'R'		-- 운영
												</when>
												<when test="gapDcd.equals('TR')">
													AND SCH.DDL_TRG_DCD = 'R'		-- 운영
												</when>
											</choose>
											AND SCH.DDL_TRG_YN = 'Y'		-- DDL대상여부
											AND SCH.DB_SCH_ID IN (SELECT TGT_DB_SCH_ID
																	FROM WAA_DB_MAP
																   WHERE EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
																	 AND REG_TYP_CD IN ('C', 'U'))
									) B
							  ON A_DB_SCH_ID = B_SRC_DB_SCH_ID
							  AND A_DDL_TBL_ID = B_DDL_TBL_ID
							  AND A_DDL_COL_ID = B_DDL_COL_ID
							)				  
				  
						) FSQ
                  LEFT OUTER JOIN WAA_DB_SCH SCH
                  ON B_TGT_DB_SCH_ID = SCH.DB_SCH_ID
                  AND SCH.REG_TYP_CD IN ('C', 'U')
                  AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                  LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
                  ON SCH.DB_CONN_TRG_ID = TRG.DB_CONN_TRG_ID
                  AND TRG.REG_TYP_CD IN ('C', 'U')
                  AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                  WHERE 1=1   
                <if test="fullPath != null">
                 AND A_FULL_PATH LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%')
                </if>
                 <if test="dbConnTrgId != null">
                 AND (A_DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR} OR TRG.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}) 
                </if>
                <if test="dbSchId != null">
                 AND (A_DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR} OR B_TGT_DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR})
                </if>
                <if test="searchBgnDe != null">
                <![CDATA[
                AND DATE_FORMAT(B_APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR}
                ]]>
                </if>
                <if test="searchEndDe != null">
                <![CDATA[
                AND DATE_FORMAT(B_APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR}
                ]]>
                </if>
                <if test="tblNm != null">
                AND (     A_DDL_TBL_PNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR A_DDL_TBL_LNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR B_DDL_TBL_PNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR B_DDL_TBL_LNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                    )
                </if>
            ) A
             GROUP BY DDL_TBL_PNM
      ) A
      LEFT OUTER JOIN WAA_DB_SCH SCH
      ON A.DB_SCH_ID = SCH.DB_SCH_ID
      AND SCH.REG_TYP_CD IN ('C', 'U')
      AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
      LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
      ON SCH.DB_CONN_TRG_ID = TRG.DB_CONN_TRG_ID
      AND TRG.REG_TYP_CD IN ('C', 'U')
      AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
    <where>
     <if test="gapStatus != null">
     AND A.GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
     </if>
    </where>
     ORDER BY GAP_STATUS, GAP_CONTS, SUBJ_LNM,  DDL_TBL_PNM
</select>

<select id="selectDdlTsfColGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	 	/* ModelGapMapper.selectDdlTsfColGapList */
SELECT A.*
      ,CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor
  FROM (
         SELECT 
                    A_DDL_TBL_ID						AS DDL_TBL_ID
                   ,IFNULL(A_DDL_TBL_PNM,B_DDL_TBL_PNM) AS DDL_TBL_PNM
                   ,A_DDL_TBL_LNM						AS DDL_TBL_LNM
                   ,A_DDL_COL_ID						AS DDL_COL_ID
                   ,IFNULL(A_DDL_COL_PNM,B_DDL_COL_PNM) AS DDL_COL_PNM
                   ,A_DDL_COL_LNM						AS DDL_COL_LNM
                   ,A_COL_ORD AS DDL_COL_ORD   
                   ,A_DATA_TYPE    AS DDL_DATA_TYPE		 
                   ,A_DATA_LEN     AS DDL_DATA_LEN  
                   ,A_DATA_SCAL    AS DDL_DATA_SCAL 
                   ,IFNULL(A_PK_YN,'-')  AS DDL_PK_YN     
                   ,A_PK_ORD       AS DDL_PK_ORD    
                   ,IFNULL(A_NONUL_YN,'-') AS DDL_NONUL_YN  
                   ,A_DEFLT_VAL    AS DDL_DEFLT_VAL 
                   ,B_DDL_TBL_PNM AS DDL_TSF_TBL_PNM
                   ,B_DDL_COL_PNM AS DDL_TSF_COL_PNM
                   ,B_COL_ORD         AS DDL_TSF_COL_ORD
                   ,B_DATA_TYPE   AS DDL_TSF_DATA_TYPE
                   ,B_DATA_LEN   AS DDL_TSF_DATA_LEN
				   ,CASE WHEN B_DATA_SCAL = 0 THEN NULL ELSE B_DATA_SCAL END AS DDL_TSF_DATA_SCAL
                   ,CASE WHEN IFNULL(B_NONUL_YN,'-') = 'N' THEN 'Y'
                         WHEN IFNULL(B_NONUL_YN,'-') = 'Y' THEN 'N'
                    ELSE '-' END AS DDL_TSF_NONUL_YN 
                   ,B_DEFLT_VAL   AS DDL_TSF_DEFLT_VAL
                   ,B_PK_YN       AS DDL_TSF_PK_YN
                   ,B_PK_ORD      AS DDL_TSF_PK_ORD
                   ,CASE WHEN IFNULL(B_COL_ORD,0)   != IFNULL(A_COL_ORD, 0) 
                           OR IFNULL(B_DATA_TYPE,'-') != IFNULL(A_DATA_TYPE,'-')
                           OR IFNULL(B_DATA_LEN,0)  != IFNULL(A_DATA_LEN ,0)
                           OR IFNULL(B_DATA_SCAL,0) != IFNULL(A_DATA_SCAL,0)
                           OR IFNULL(B_NONUL_YN,'N')  != IFNULL(A_NONUL_YN,'N') 
                           OR IFNULL(REPLACE(B_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(A_DEFLT_VAL,CHAR(39), NULL),'-')
                           OR IFNULL(B_PK_YN ,'N')    != IFNULL(A_PK_YN   ,'N') 
                           OR IFNULL(B_PK_ORD,0)    != IFNULL(A_PK_ORD,0)   THEN 'GAP'
                     ELSE 'NML' END AS GAP_STATUS 
                     ,CONCAT(
		                       CASE WHEN A_DDL_TBL_PNM IS NULL THEN '[DDL컬럼미존재]' ELSE '' END
		                      ,CASE WHEN B_DDL_TBL_PNM IS NULL THEN '[DDL운영컬럼미존재]' ELSE '' END
		                      ,CASE WHEN B_DDL_TBL_PNM IS NOT NULL
		                             AND A_DDL_TBL_PNM IS NOT NULL
		                             AND (IFNULL(B_COL_ORD,0)   != IFNULL(A_COL_ORD, 0) 
		                                  OR IFNULL(B_DATA_TYPE,'-') != IFNULL(A_DATA_TYPE,'-')
		                                  OR IFNULL(B_DATA_LEN,0)  != IFNULL(A_DATA_LEN ,0)
		                                  OR IFNULL(B_DATA_SCAL,0) != IFNULL(A_DATA_SCAL,0)
		                                  OR IFNULL(B_NONUL_YN,'N')  != IFNULL(A_NONUL_YN,'N') 
		                                  OR IFNULL(REPLACE(B_DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(A_DEFLT_VAL,CHAR(39), NULL),'-')
		                                  OR IFNULL(B_PK_YN ,'N')    != IFNULL(A_PK_YN   ,'N') 
		                                  OR IFNULL(B_PK_ORD,0)    != IFNULL(A_PK_ORD,0))
		                       THEN '[컬럼GAP존재]' ELSE '' END
                          ) AS GAP_CONTS 
                    ,IFNULL(A_DB_SCH_ID , B_SRC_DB_SCH_ID) AS DB_SCH_ID
                    ,IFNULL(A_DB_SCH_ID , B_TGT_DB_SCH_ID) AS DB_TSF_SCH_ID
                    ,IFNULL(TRG.DB_CONN_TRG_PNM,DB_CONN_TRG_LNM) AS DB_TSF_CONN_TRG_LNM
                    ,IFNULL(SCH.DB_SCH_PNM,DB_SCH_LNM) AS DB_TSF_SCH_LNM
                  FROM (
				  
						SELECT * FROM (
							  ( 
							  SELECT C.DDL_TBL_ID		AS A_DDL_TBL_ID
									,C.DDL_TBL_PNM		AS A_DDL_TBL_PNM
									,C.DDL_TBL_LNM		AS A_DDL_TBL_LNM
									,D.DDL_COL_ID		AS A_DDL_COL_ID
									,D.DDL_COL_PNM		AS A_DDL_COL_PNM
									,D.DDL_COL_LNM		AS A_DDL_COL_LNM
									,D.COL_ORD       	AS A_COL_ORD
									,D.DATA_TYPE    	AS A_DATA_TYPE
									,D.DATA_LEN     	AS A_DATA_LEN
									,D.DATA_SCAL    	AS A_DATA_SCAL
									,D.PK_YN 			AS A_PK_YN
									,D.PK_ORD  			AS A_PK_ORD
									,D.NONUL_YN			AS A_NONUL_YN
									,D.DEFLT_VAL		AS A_DEFLT_VAL
									,C.DB_SCH_ID		AS A_DB_SCH_ID
									,C.APRV_DTM			AS A_APRV_DTM
									,TRG.DB_CONN_TRG_ID AS A_DB_CONN_TRG_ID
									,PDM.FULL_PATH		AS A_FULL_PATH
									FROM WAM_DDL_TBL C
										INNER JOIN WAM_DDL_COL D
										ON C.DDL_TBL_ID = D.DDL_TBL_ID
										LEFT OUTER JOIN WAA_DB_SCH SCH
										ON C.DB_SCH_ID = SCH.DB_SCH_ID
										AND SCH.REG_TYP_CD IN ('C', 'U')
										AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
										ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
										AND TRG.REG_TYP_CD IN ('C', 'U')
										AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										LEFT OUTER JOIN WAM_PDM_TBL PDM
										ON C.PDM_TBL_ID = PDM.PDM_TBL_ID
							    ) A
                   LEFT OUTER JOIN 
								(
								   SELECT TBL.DDL_TBL_ID		AS B_DDL_TBL_ID
                                         ,TBL.DDL_TBL_PNM		AS B_DDL_TBL_PNM
                                         ,TBL.DDL_TBL_LNM		AS B_DDL_TBL_LNM
                                         ,TBL.TGT_DB_SCH_ID 	AS B_TGT_DB_SCH_ID
                                         ,TBL.SRC_DB_SCH_ID     AS B_SRC_DB_SCH_ID
                                         ,TBL.TBL_SPAC_ID		AS B_TBL_SPAC_ID
                                         ,TBL.APRV_DTM			AS B_APRV_DTM
                                         ,COL.DDL_COL_ID		AS B_DDL_COL_ID
                                         ,COL.DDL_COL_PNM		AS B_DDL_COL_PNM
                                         ,COL.DDL_COL_LNM		AS B_DDL_COL_LNM
                                         ,COL.COL_ORD       	AS B_COL_ORD
                                         ,COL.DATA_TYPE    		AS B_DATA_TYPE
                                         ,COL.DATA_LEN     		AS B_DATA_LEN
                                         ,COL.DATA_SCAL    		AS B_DATA_SCAL
                                         ,COL.PK_YN 			AS B_PK_YN
                                         ,COL.PK_ORD  			AS B_PK_ORD
                                         ,COL.NONUL_YN			AS B_NONUL_YN
                                         ,COL.DEFLT_VAL			AS B_DEFLT_VAL
                                   FROM WAM_DDL_TSF_TBL TBL
									   INNER JOIN WAM_DDL_TSF_COL COL
									   ON TBL.DDL_TBL_ID = COL.DDL_TBL_ID
                                ) B
							    ON A_DB_SCH_ID = B_SRC_DB_SCH_ID
							   AND A_DDL_TBL_ID = B_DDL_TBL_ID
							   AND A_DDL_COL_ID = B_DDL_COL_ID
							)
UNION
						SELECT * FROM (
							  ( 
							  SELECT C.DDL_TBL_ID		AS A_DDL_TBL_ID
									,C.DDL_TBL_PNM		AS A_DDL_TBL_PNM
									,C.DDL_TBL_LNM		AS A_DDL_TBL_LNM
									,D.DDL_COL_ID		AS A_DDL_COL_ID
									,D.DDL_COL_PNM		AS A_DDL_COL_PNM
									,D.DDL_COL_LNM		AS A_DDL_COL_LNM
									,D.COL_ORD       	AS A_COL_ORD
									,D.DATA_TYPE    	AS A_DATA_TYPE
									,D.DATA_LEN     	AS A_DATA_LEN
									,D.DATA_SCAL    	AS A_DATA_SCAL
									,D.PK_YN 			AS A_PK_YN
									,D.PK_ORD  			AS A_PK_ORD
									,D.NONUL_YN			AS A_NONUL_YN
									,D.DEFLT_VAL		AS A_DEFLT_VAL
									,C.DB_SCH_ID		AS A_DB_SCH_ID
									,C.APRV_DTM			AS A_APRV_DTM
									,TRG.DB_CONN_TRG_ID AS A_DB_CONN_TRG_ID
									,PDM.FULL_PATH		AS A_FULL_PATH
									FROM WAM_DDL_TBL C
										INNER JOIN WAM_DDL_COL D
										ON C.DDL_TBL_ID = D.DDL_TBL_ID
										LEFT OUTER JOIN WAA_DB_SCH SCH
										ON C.DB_SCH_ID = SCH.DB_SCH_ID
										AND SCH.REG_TYP_CD IN ('C', 'U')
										AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
										ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
										AND TRG.REG_TYP_CD IN ('C', 'U')
										AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
										LEFT OUTER JOIN WAM_PDM_TBL PDM
										ON C.PDM_TBL_ID = PDM.PDM_TBL_ID
							    ) A
                   RIGHT OUTER JOIN 
								(
								   SELECT TBL.DDL_TBL_ID		AS B_DDL_TBL_ID
                                         ,TBL.DDL_TBL_PNM		AS B_DDL_TBL_PNM
                                         ,TBL.DDL_TBL_LNM		AS B_DDL_TBL_LNM
                                         ,TBL.TGT_DB_SCH_ID 	AS B_TGT_DB_SCH_ID
                                         ,TBL.SRC_DB_SCH_ID     AS B_SRC_DB_SCH_ID
                                         ,TBL.TBL_SPAC_ID		AS B_TBL_SPAC_ID
                                         ,TBL.APRV_DTM			AS B_APRV_DTM
                                         ,COL.DDL_COL_ID		AS B_DDL_COL_ID
                                         ,COL.DDL_COL_PNM		AS B_DDL_COL_PNM
                                         ,COL.DDL_COL_LNM		AS B_DDL_COL_LNM
                                         ,COL.COL_ORD       	AS B_COL_ORD
                                         ,COL.DATA_TYPE    		AS B_DATA_TYPE
                                         ,COL.DATA_LEN     		AS B_DATA_LEN
                                         ,COL.DATA_SCAL    		AS B_DATA_SCAL
                                         ,COL.PK_YN 			AS B_PK_YN
                                         ,COL.PK_ORD  			AS B_PK_ORD
                                         ,COL.NONUL_YN			AS B_NONUL_YN
                                         ,COL.DEFLT_VAL			AS B_DEFLT_VAL
                                   FROM WAM_DDL_TSF_TBL TBL
									   INNER JOIN WAM_DDL_TSF_COL COL
									   ON TBL.DDL_TBL_ID = COL.DDL_TBL_ID
                                ) B
							    ON A_DB_SCH_ID = B_SRC_DB_SCH_ID
							   AND A_DDL_TBL_ID = B_DDL_TBL_ID
							   AND A_DDL_COL_ID = B_DDL_COL_ID
							)

						) FSQ
				
                  LEFT OUTER JOIN WAA_DB_SCH SCH
                  ON B_TGT_DB_SCH_ID = SCH.DB_SCH_ID
                  AND SCH.REG_TYP_CD IN ('C', 'U')
                  AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                  LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
                  ON SCH.DB_CONN_TRG_ID = TRG.DB_CONN_TRG_ID
                  AND TRG.REG_TYP_CD IN ('C', 'U')
                  AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                  WHERE 1=1   
                  AND (A_DDL_TBL_ID = #{ddlTblId,jdbcType=VARCHAR} OR B_DDL_TBL_ID = #{ddlTsfTblId,jdbcType=VARCHAR})
                  AND (A_DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR} OR B_TGT_DB_SCH_ID = #{dbTsfSchId,jdbcType=VARCHAR})
          ) A
ORDER BY DDL_TBL_PNM, DDL_COL_ORD ,DDL_TSF_COL_ORD
</select>

<select id="selectDdlTsfDbcGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT 	/* ModelGapMapper.selectDdlTsfDbcGapList */
		A.*,                                                          
       IFNULL(SCH.DB_SCH_PNM,SCH.DB_SCH_LNM) DB_TSF_SCH_LNM,
       IFNULL(TRG.DB_CONN_TRG_PNM, TRG.DB_CONN_TRG_LNM) DB_TSF_CONN_TRG_LNM,           
       CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor           
       FROM (                                                                    
             SELECT CASE WHEN SUM(GAP_STATUS) = 0 THEN 'NML' ELSE 'GAP' END  AS GAP_STATUS
                   ,CASE WHEN COUNT(DDL_COL_PNM) = 0 THEN '[DDL운영테이블미존재]'
                         WHEN COUNT(DBC_COL_PNM) = 0 THEN '[DBC운영테이블미존재]'
                    ELSE MAX(GAP_CONTS) END AS GAP_CONTS   
                   ,MAX(DB_SCH_ID)      DB_TSF_SCH_ID               
                   ,MAX(DDL_TBL_ID)     DDL_TSF_TBL_ID                                             
                   ,DDL_TBL_PNM         DDL_TSF_TBL_PNM                                         
                   ,MAX(DDL_TBL_LNM)   DDL_TSF_TBL_LNM                                         
                   ,COUNT(DDL_COL_PNM) DDL_TSF_COL_CNT                                         
                   ,MAX(DBC_TBL_PNM)    DBC_REAL_TBL_NM                                          
                   -- ,MAX(DBC_TBL_LNM)    DBC_REAL_TBL_LNM                                          
                   ,COUNT(DBC_COL_PNM)  DBC_REAL_COL_CNT   
                   ,MAX(SUBJ_LNM)       SUBJ_LNM     
             FROM (
                  SELECT 
                    C.DDL_TBL_ID
                   ,IFNULL(C.DDL_TBL_PNM,DBC.DBC_TBL_NM) AS DDL_TBL_PNM
                   ,IFNULL(C.DDL_TBL_LNM,DBC.DBC_TBL_KOR_NM) AS DDL_TBL_LNM
                   ,C.DDL_COL_ID
                   ,IFNULL(C.DDL_COL_PNM,DBC.DBC_COL_NM) AS DDL_COL_PNM
                   ,C.DDL_COL_LNM
                   ,C.COL_ORD      AS DDL_COL_ORD   
                   ,C.DATA_TYPE    AS DDL_DATA_TYPE 
                   ,C.DATA_LEN     AS DDL_DATA_LEN  
                   ,C.DATA_SCAL    AS DDL_DATA_SCAL 
                   ,IFNULL(C.PK_YN,'-')  AS DDL_PK_YN     
                   ,C.PK_ORD       AS DDL_PK_ORD    
                   ,IFNULL(C.NONUL_YN,'-') AS DDL_NONUL_YN  
                   ,C.DEFLT_VAL    AS DDL_DEFLT_VAL 
                   ,DBC.DBC_TBL_NM AS DBC_TBL_PNM
                   ,DBC.DBC_COL_NM AS DBC_COL_PNM
                   ,DBC.ORD         AS DBC_COL_ORD
                   ,DBC.DATA_TYPE   AS DBC_DATA_TYPE
                   ,DBC.DATA_LEN   AS DBC_DATA_LEN
                   ,CASE WHEN DBC.DATA_PNT = 0 THEN NULL ELSE DBC.DATA_PNT END AS DBC_DATA_SCAL
                   ,CASE WHEN IFNULL(DBC.NONUL_YN,'-') = 'N' THEN 'Y'
                         WHEN IFNULL(DBC.NONUL_YN,'-') = 'Y' THEN 'N'
                    ELSE '-' END AS DBC_NONUL_YN
                   ,DBC.DEFLT_VAL   AS DBC_DEFLT_VAL
                   ,DBC.PK_YN       AS DBC_PK_YN
                   ,DBC.PK_ORD      AS DBC_PK_ORD
                   ,CASE WHEN IFNULL(DBC.ORD,0)   != IFNULL(C.COL_ORD, 0) 
                           OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(C.DATA_TYPE,'-')
                           OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(C.DATA_LEN ,0)
                           OR IFNULL(DBC.DATA_PNT,0) != IFNULL(C.DATA_SCAL,0)
                           OR DECODE(IFNULL(DBC.NULL_YN,'N'),'N','Y','N') != IFNULL(C.NONUL_YN,'N') 
                           OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C.DEFLT_VAL,CHAR(39), NULL),'-')
                           OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(C.PK_YN   ,'N') 
                           OR IFNULL(DBC.PK_ORD,0)    != IFNULL(C.PK_ORD,0)   THEN 1
                     ELSE 0 END AS GAP_STATUS 
                    ,CONCAT( 
	                     	CASE WHEN C.DDL_TBL_PNM IS NULL THEN '[DDL운영컬럼미존재]' ELSE '' END
	                       ,CASE WHEN DBC.DBC_TBL_NM IS NULL THEN '[DBC운영컬럼미존재]' ELSE '' END
	                       ,CASE WHEN DBC.DBC_TBL_NM IS NOT NULL
	                              AND C.DDL_TBL_PNM IS NOT NULL
	                              AND (IFNULL(DBC.ORD,0)   != IFNULL(C.COL_ORD, 0) 
	                                   OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(C.DATA_TYPE,'-')
	                                   OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(C.DATA_LEN ,0)
	                                   OR IFNULL(DBC.DATA_PNT,0) != IFNULL(C.DATA_SCAL,0)
	                                   OR (CASE WHEN IFNULL(DBC.NULL_YN,'N') = 'N' THEN 'Y' ELSE 'N' END) != IFNULL(C.NONUL_YN,'N') 
	                                   OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C.DEFLT_VAL,CHAR(39), NULL),'-')
	                                   OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(C.PK_YN   ,'N') 
	                                   OR IFNULL(DBC.PK_ORD,0)    != IFNULL(C.PK_ORD,0))
	                         THEN '[컬럼GAP존재]' ELSE '' END
                           ) AS GAP_CONTS       
                    ,IFNULL(C.TGT_DB_SCH_ID , DBC.DB_SCH_ID) DB_SCH_ID
                    ,C.SUBJ_LNM
                  FROM (SELECT   C.DDL_TBL_ID
                        ,C.DDL_TBL_PNM
                        ,C.DDL_TBL_LNM
                        ,D.DDL_COL_ID
                        ,D.DDL_COL_PNM
                        ,D.DDL_COL_LNM
                        ,D.COL_ORD       
                        ,D.DATA_TYPE    
                        ,D.DATA_LEN     
                        ,D.DATA_SCAL    
                        ,D.PK_YN 
                        ,D.PK_ORD  
                        ,D.NONUL_YN
                        ,D.DEFLT_VAL
                        ,C.TGT_DB_SCH_ID
                        ,C.APRV_DTM
                        ,TRG.DB_CONN_TRG_ID
                        ,PDM.FULL_PATH
                        ,SUBJ.SUBJ_LNM
                        FROM WAM_DDL_TSF_TBL C
                        INNER JOIN WAM_DDL_TSF_COL D
                        ON C.DDL_TBL_ID = D.DDL_TBL_ID
                        LEFT OUTER JOIN WAA_DB_SCH SCH
                        ON C.TGT_DB_SCH_ID = SCH.DB_SCH_ID
                        AND SCH.REG_TYP_CD IN ('C', 'U')
                        AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
                        ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
                        AND TRG.REG_TYP_CD IN ('C', 'U')
                        AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAM_PDM_TBL PDM
                        ON C.PDM_TBL_ID = PDM.PDM_TBL_ID
                        LEFT OUTER JOIN WAA_SUBJ SUBJ
                        ON PDM.SUBJ_ID = SUBJ.SUBJ_ID
                        AND SUBJ.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        AND SUBJ.REG_TYP_CD IN ('C', 'U')
                                                                              ) C
                  FULL OUTER JOIN (SELECT DBC.DB_SCH_ID
                                         ,DBC.DBC_TBL_NM
                                         ,DBC.DBC_TBL_KOR_NM
                                         ,DBCCOL.DBC_COL_NM 
                                         ,DBCCOL.ORD      
                                         ,DBCCOL.DATA_TYPE
                                         ,DBCCOL.DATA_LEN
                                         ,DBCCOL.DATA_PNT
                                         ,DBCCOL.NULL_YN
                                         ,DBCCOL.DEFLT_VAL 
                                         ,DBCCOL.PK_YN     
                                         ,DBCCOL.PK_ORD
                                         ,SCH.DB_CONN_TRG_ID    
                                   FROM WAT_DBC_TBL DBC
                                   INNER JOIN WAT_DBC_COL DBCCOL
                                   ON DBCCOL.DBC_TBL_NM = DBC.DBC_TBL_NM
                                   AND DBC.DB_SCH_ID =DBCCOL.DB_SCH_ID
                                   LEFT OUTER JOIN WAA_DB_SCH SCH
                                   ON DBC.DB_SCH_ID =SCH.DB_SCH_ID
                                   AND SCH.REG_TYP_CD IN ('C', 'U')
                                   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                                   WHERE SCH.DDL_TRG_DCD = 'R'  --운영 DB만
                                   ) DBC
                  ON C.TGT_DB_SCH_ID = DBC.DB_SCH_ID
                  AND C.DDL_TBL_PNM = DBC.DBC_TBL_NM
                  AND C.DDL_COL_PNM = DBC.DBC_COL_NM 
                  WHERE 1=1 
                <if test="fullPath != null">
                AND C.FULL_PATH LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%')
                </if>
                 <if test="dbConnTrgId != null">
                 AND (C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR} OR DBC.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}) 
                </if>
                <if test="dbSchId != null">
                 AND (C.TGT_DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR} OR DBC.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR})
                </if>
                <if test="searchBgnDe != null">
                <![CDATA[
                AND DATE_FORMAT(C.APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR}
                ]]>
                </if>
                <if test="searchEndDe != null">
                <![CDATA[
                AND DATE_FORMAT(C.APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR}
                ]]>
                </if>
                <if test="tblNm != null">
                AND (   C.DDL_TBL_PNM        LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR C.DDL_TBL_LNM      LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR DBC.DBC_TBL_NM     LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR DBC.DBC_TBL_KOR_NM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       )
                       </if>
            ) A
             GROUP BY DDL_TBL_PNM
      ) A
      LEFT OUTER JOIN WAA_DB_SCH SCH
      ON A.DB_TSF_SCH_ID = SCH.DB_SCH_ID
      AND SCH.REG_TYP_CD IN ('C', 'U')
      AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
      LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
      ON SCH.DB_CONN_TRG_ID = TRG.DB_CONN_TRG_ID
      AND TRG.REG_TYP_CD IN ('C', 'U')
      AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
    <where>
     <if test="gapStatus != null">
     AND A.GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
     </if>
    </where>
     ORDER BY GAP_STATUS, GAP_CONTS, SUBJ_LNM, DDL_TSF_TBL_PNM
</select>

<select id="selectDdlTsfDbcColGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT 	/* ModelGapMapper.selectDdlTsfDbcColGapList */
		A.*
      ,CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor
  FROM (
                  SELECT 
                    C.DDL_TBL_ID                      AS DDL_TSF_TBL_ID
                   ,IFNULL(C.DDL_TBL_PNM,DBC.DBC_TBL_NM) AS DDL_TSF_TBL_PNM
                   ,C.DDL_TBL_LNM                     AS DDL_TSF_TBL_LNM
                   ,C.DDL_COL_ID                      AS DDL_TSF_COL_ID
                   ,IFNULL(C.DDL_COL_PNM,DBC.DBC_COL_NM) AS DDL_TSF_COL_PNM
                   ,C.DDL_COL_LNM                     AS DDL_TSF_COL_LNM
                   ,C.COL_ORD           AS DDL_TSF_COL_ORD   
                   ,C.DATA_TYPE    AS DDL_TSF_DATA_TYPE 
                   ,C.DATA_LEN     AS DDL_TSF_DATA_LEN  
                   ,C.DATA_SCAL    AS DDL_TSF_DATA_SCAL 
                   ,IFNULL(C.PK_YN,'-')  AS DDL_TSF_PK_YN     
                   ,C.PK_ORD       AS DDL_TSF_PK_ORD    
                   ,IFNULL(C.NONUL_YN,'-') AS DDL_TSF_NONUL_YN  
                   ,C.DEFLT_VAL    AS DDL_TSF_DEFLT_VAL 
                   ,DBC.DBC_TBL_NM AS DBC_REAL_TBL_PNM
                   ,DBC.DBC_COL_NM AS DBC_REAL_COL_PNM
                   ,DBC.ORD         AS DBC_REAL_COL_ORD
                   ,DBC.DATA_TYPE   AS DBC_REAL_DATA_TYPE
                   ,DBC.DATA_LEN   AS DBC_REAL_DATA_LEN
                   ,CASE WHEN DBC.DATA_PNT = 0 THEN NULL ELSE DBC.DATA_PNT END AS DBC_REAL_DATA_SCAL
                   ,CASE WHEN IFNULL(DBC.NONUL_YN,'-') = 'N' THEN 'Y'
                         WHEN IFNULL(DBC.NONUL_YN,'-') = 'Y' THEN 'N'
                    ELSE '-' END AS DBC_REAL_NONUL_YN 
                   ,DBC.DEFLT_VAL   AS DBC_REAL_DEFLT_VAL
                   ,DBC.PK_YN       AS DBC_REAL_PK_YN
                   ,DBC.PK_ORD      AS DBC_REAL_PK_ORD
                   ,CASE WHEN IFNULL(DBC.ORD,0)   != IFNULL(C.COL_ORD, 0) 
                           OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(C.DATA_TYPE,'-')
                           OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(C.DATA_LEN ,0)
                           OR IFNULL(DBC.DATA_PNT,0) != IFNULL(C.DATA_SCAL,0)
                           OR (CASE WHEN IFNULL(DBC.NULL_YN,'N') = 0 THEN 'Y' ELSE 'N' END) != IFNULL(C.NONUL_YN,'N') 
                           OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(C.DEFLT_VAL,CHAR(39), NULL),'-')
                           OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(C.PK_YN   ,'N') 
                           OR IFNULL(DBC.PK_ORD,0)    != IFNULL(C.PK_ORD,0)   THEN 'GAP'      
                     ELSE 'NML' END AS GAP_STATUS       
                  FROM (SELECT   C.DDL_TBL_ID
                        ,C.DDL_TBL_PNM
                        ,C.DDL_TBL_LNM
                        ,D.DDL_COL_ID
                        ,D.DDL_COL_PNM
                        ,D.DDL_COL_LNM
                        ,D.COL_ORD       
                        ,D.DATA_TYPE    
                        ,D.DATA_LEN     
                        ,D.DATA_SCAL    
                        ,D.PK_YN 
                        ,D.PK_ORD  
                        ,D.NONUL_YN
                        ,D.DEFLT_VAL
                        ,C.TGT_DB_SCH_ID
                        FROM WAM_DDL_TSF_TBL C
                        INNER JOIN WAM_DDL_TSF_COL D
                        ON C.DDL_TBL_ID = D.DDL_TBL_ID) C
                  FULL OUTER JOIN (SELECT DBC.DB_SCH_ID
                                         ,DBC.DBC_TBL_NM
                                         ,DBCCOL.DBC_COL_NM 
                                         ,DBCCOL.ORD      
                                         ,DBCCOL.DATA_TYPE
                                         ,DBCCOL.DATA_LEN
                                         ,DBCCOL.DATA_PNT
                                         ,DBCCOL.NULL_YN
                                         ,DBCCOL.DEFLT_VAL 
                                         ,DBCCOL.PK_YN     
                                         ,DBCCOL.PK_ORD    
                                   FROM WAT_DBC_TBL DBC
                                   INNER JOIN WAT_DBC_COL DBCCOL
                                   ON DBCCOL.DBC_TBL_NM = DBC.DBC_TBL_NM
                                   AND DBC.DB_SCH_ID =DBCCOL.DB_SCH_ID
                                   ) DBC
                  ON C.TGT_DB_SCH_ID = DBC.DB_SCH_ID
                  AND C.DDL_TBL_PNM = DBC.DBC_TBL_NM
                  AND C.DDL_COL_PNM = DBC.DBC_COL_NM 
                  WHERE 1=1 
                    AND (C.DDL_TBL_PNM = #{ddlTsfTblPnm,jdbcType=VARCHAR} OR DBC.DBC_TBL_NM = #{ddlTsfTblPnm,jdbcType=VARCHAR}
                         OR C.DDL_TBL_PNM = #{dbcRealTblNm,jdbcType=VARCHAR} OR DBC.DBC_TBL_NM = #{dbcRealTblNm,jdbcType=VARCHAR})
                    AND (C.TGT_DB_SCH_ID = #{dbTsfSchId,jdbcType=VARCHAR} OR DBC.DB_SCH_ID = #{dbTsfSchId,jdbcType=VARCHAR})
             ) A
             ORDER BY DDL_TSF_TBL_PNM, DDL_TSF_COL_ORD , DBC_REAL_COL_ORD
</select>

<select id="selectDbcGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT 	/* ModelGapMapper.selectDbcGapList */
		A.*,                                                             
       CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor           
       FROM (                                                                    
             SELECT CASE WHEN SUM(GAP_STATUS) = 0 THEN 'NML' ELSE 'GAP' END AS GAP_STATUS
                   ,CASE WHEN COUNT(DBC_COL_PNM) = 0 THEN '[DBC테이블미존재]'
                         WHEN COUNT(DBC_REAL_COL_PNM) = 0 THEN '[DBC운영테이블미존재]'
                         ELSE  MAX(GAP_CONTS) END  GAP_CONTS  
                   ,MAX(DBC_DB_SCH_ID)      DB_SCH_ID               
                   ,DBC_TBL_PNM         DBC_TBL_NM                                         
                   ,MAX(DBC_TBL_LNM)    DBC_TBL_LNM                                         
                   ,COUNT(DBC_COL_PNM)  DBC_COL_CNT       
                   ,MAX(DBC_REAL_DB_SCH_ID)  DB_REAL_SCH_ID                                      
                   ,MAX(DBC_REAL_TBL_PNM)    DBC_REAL_TBL_NM                                          
                   -- ,MAX(DBC_TBL_LNM)    DBC_REAL_TBL_LNM                                          
                   ,COUNT(DBC_REAL_COL_PNM)  DBC_REAL_COL_CNT       
                   ,MAX(DBC_DB_SCH_LNM) AS DBC_DB_SCH_LNM
                   ,MAX(DBC_DB_CONN_TRG_LNM) AS DBC_DB_CONN_TRG_LNM
                   ,MAX(DBC_REAL_DB_SCH_LNM) AS DBC_REAL_DB_SCH_LNM
                   ,MAX(DBC_REAL_DB_CONN_TRG_LNM) AS DBC_REAL_DB_CONN_TRG_LNM
                   ,MAX(SUBJ_LNM) SUBJ_LNM
             FROM (
                  SELECT 
                    IFNULL(DBC.DBC_TBL_NM,DBCR.DBC_TBL_NM) AS DBC_TBL_PNM
                   ,IFNULL(DBC.DBC_TBL_KOR_NM,DBCR.DBC_TBL_KOR_NM) AS DBC_TBL_LNM
                   ,IFNULL(DBC.DBC_COL_NM,DBCR.DBC_COL_NM) AS DBC_COL_PNM
                   ,DBC.DB_SCH_PNM      AS DBC_DB_SCH_LNM
                   ,DBC.DB_CONN_TRG_PNM AS DBC_DB_CONN_TRG_LNM
                   ,IFNULL(DBC.ORD,DBCR.ORD) AS DBC_COL_ORD
                   ,DBC.DATA_TYPE   AS DBC_DATA_TYPE
                   ,DBC.DATA_LEN   AS DBC_DATA_LEN
                   ,CASE WHEN DBC.DATA_PNT = 0 THEN NULL ELSE DBC.DATA_PNT END AS DBC_DATA_SCAL
                   ,CASE WHEN IFNULL(DBC.NULL_YN,'-') = 'N' THEN 'Y'
				         WHEN IFNULL(DBC.NULL_YN,'-') = 'Y' THEN 'N'  
				         ELSE '-' END AS DBC_NONUL_YN 
                   ,DBC.DEFLT_VAL   AS DBC_DEFLT_VAL
                   ,DBC.PK_YN       AS DBC_PK_YN
                   ,DBC.PK_ORD      AS DBC_PK_ORD
                   ,DBCR.DBC_TBL_NM AS DBC_REAL_TBL_PNM
                   ,DBCR.DBC_COL_NM AS DBC_REAL_COL_PNM
                   ,DBCR.DB_SCH_PNM      AS DBC_REAL_DB_SCH_LNM
                   ,DBCR.DB_CONN_TRG_PNM AS DBC_REAL_DB_CONN_TRG_LNM
                   ,DBCR.ORD         AS DBC_REAL_COL_ORD
                   ,DBCR.DATA_TYPE   AS DBC_REAL_DATA_TYPE
                   ,DBCR.DATA_LEN   AS DBC_REAL_DATA_LEN
                   ,CASE WHEN DBCR.DATA_PNT = 0 THEN NULL ELSE DBCR.DATA_PNT END AS DBC_REAL_DATA_SCAL
                   ,CASE WHEN IFNULL(DBCR.NULL_YN,'-') = 'N' THEN 'Y'
				         WHEN IFNULL(DBCR.NULL_YN,'-') = 'Y' THEN 'N'  
				         ELSE '-' END  AS DBC_REAL_NONUL_YN 
                   ,DBCR.DEFLT_VAL   AS DBC_REAL_DEFLT_VAL
                   ,DBCR.PK_YN       AS DBC_REAL_PK_YN
                   ,DBCR.PK_ORD      AS DBC_REAL_PK_ORD
                   ,CASE WHEN IFNULL(DBC.ORD,0)   != IFNULL(DBCR.ORD,0)
                           OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(DBCR.DATA_TYPE,'-') 
                           OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(DBCR.DATA_LEN,0)
                           OR IFNULL(DBC.DATA_PNT,0) != IFNULL(DBCR.DATA_PNT,0)
                           OR DECODE(IFNULL(DBC.NULL_YN,'N'),'N','Y','N') != DECODE(IFNULL(DBCR.NULL_YN,'N'),'N','Y','N') 
                           OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(DBCR.DEFLT_VAL,CHAR(39), NULL),'-')
                           OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(DBCR.PK_YN   ,'N') 
                           OR IFNULL(DBC.PK_ORD,0)    != IFNULL(DBCR.PK_ORD,0) THEN 1
                     ELSE 0 END AS GAP_STATUS 
                     ,CONCAT( 
			                     CASE WHEN DBC.DBC_TBL_NM IS NULL THEN '[DBC개발컬럼미존재]' ELSE '' END
			                    ,CASE WHEN DBCR.DBC_TBL_NM IS NULL THEN '[DBC운영컬럼미존재]' ELSE '' END
			                    ,CASE WHEN DBC.DBC_TBL_NM IS NOT NULL
			                           AND DBCR.DBC_TBL_NM IS NOT NULL
			                           AND (    IFNULL(DBC.ORD,0)   != IFNULL(DBCR.ORD,0)
			                                 OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(DBCR.DATA_TYPE,'-') 
			                                 OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(DBCR.DATA_LEN,0)
			                                 OR IFNULL(DBC.DATA_PNT,0) != IFNULL(DBCR.DATA_PNT,0)
			                                 OR DECODE(IFNULL(DBC.NULL_YN,'N'),'N','Y','N') != DECODE(IFNULL(DBCR.NULL_YN,'N'),'N','Y','N') 
			                                 OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(DBCR.DEFLT_VAL,CHAR(39), NULL),'-')
			                                 OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(DBCR.PK_YN   ,'N') 
			                                 OR IFNULL(DBC.PK_ORD,0)    != IFNULL(DBCR.PK_ORD,0))
			                          THEN '[컬럼GAP존재]' ELSE '' END
                      		) AS GAP_CONTS       
                    ,DBC.DB_SCH_ID AS DBC_DB_SCH_ID
                    ,DBCR.DB_SCH_ID AS DBC_REAL_DB_SCH_ID
                    ,DBC.SUBJ_LNM
                  FROM (SELECT DBC.DB_SCH_ID
                             ,DBC.DBC_TBL_NM
                             ,DBC.DBC_TBL_KOR_NM
                             ,DBCCOL.DBC_COL_NM 
                             ,DBCCOL.ORD      
                             ,DBCCOL.DATA_TYPE
                             ,DBCCOL.DATA_LEN
                             ,DBCCOL.DATA_PNT
                             ,DBCCOL.NULL_YN
                             ,DBCCOL.DEFLT_VAL 
                             ,DBCCOL.PK_YN     
                             ,DBCCOL.PK_ORD
                             ,SCH.DB_CONN_TRG_ID
                             ,PDM.FULL_PATH
                             ,MAP.SRC_DB_SCH_ID
                             ,MAP.TGT_DB_SCH_ID
                             ,SCH.DB_SCH_PNM
                             ,TRG.DB_CONN_TRG_PNM
                             ,SUBJ.SUBJ_LNM
                        FROM WAT_DBC_TBL DBC
                        INNER JOIN WAT_DBC_COL DBCCOL
                        ON DBCCOL.DBC_TBL_NM = DBC.DBC_TBL_NM
                        AND DBC.DB_SCH_ID =DBCCOL.DB_SCH_ID
                        INNER JOIN WAA_DB_MAP MAP
                        ON MAP.SRC_DB_SCH_ID = DBC.DB_SCH_ID
                        AND MAP.REG_TYP_CD IN ('C', 'U')
                        AND MAP.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAA_DB_SCH SCH
                        ON DBC.DB_SCH_ID = SCH.DB_SCH_ID
                        AND SCH.REG_TYP_CD IN ('C', 'U')
                        AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
                        ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
                        AND TRG.REG_TYP_CD IN ('C', 'U')
                        AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAM_PDM_TBL PDM
                        ON DBC.PDM_TBL_ID = PDM.PDM_TBL_ID
                        LEFT OUTER JOIN WAA_SUBJ SUBJ
                        ON PDM.SUBJ_ID = SUBJ.SUBJ_ID
                        AND SUBJ.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        AND SUBJ.REG_TYP_CD IN ('C', 'U')
                        WHERE SCH.DDL_TRG_DCD = 'D'  --개발 DB만
                        ) DBC
                  FULL OUTER JOIN (SELECT DBC.DB_SCH_ID
                                         ,DBC.DBC_TBL_NM
                                         ,DBC.DBC_TBL_KOR_NM
                                         ,DBCCOL.DBC_COL_NM 
                                         ,DBCCOL.ORD      
                                         ,DBCCOL.DATA_TYPE
                                         ,DBCCOL.DATA_LEN
                                         ,DBCCOL.DATA_PNT
                                         ,DBCCOL.NULL_YN
                                         ,DBCCOL.DEFLT_VAL 
                                         ,DBCCOL.PK_YN     
                                         ,DBCCOL.PK_ORD
                                         ,SCH.DB_CONN_TRG_ID  
                                         ,MAP.SRC_DB_SCH_ID
                                         ,MAP.TGT_DB_SCH_ID
                                         ,SCH.DB_SCH_PNM
                                         ,TRG.DB_CONN_TRG_PNM
                                   FROM WAT_DBC_TBL DBC
                                   INNER JOIN WAT_DBC_COL DBCCOL
                                   ON DBCCOL.DBC_TBL_NM = DBC.DBC_TBL_NM
                                   AND DBC.DB_SCH_ID =DBCCOL.DB_SCH_ID
                                   INNER JOIN WAA_DB_MAP MAP
                                   ON MAP.TGT_DB_SCH_ID = DBC.DB_SCH_ID
                                   AND MAP.REG_TYP_CD IN ('C', 'U')
                                   LEFT OUTER JOIN WAA_DB_SCH SCH
                                   ON DBC.DB_SCH_ID =SCH.DB_SCH_ID
                                   AND SCH.REG_TYP_CD IN ('C', 'U')
                                   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                                   LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
                                   ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
                                   AND TRG.REG_TYP_CD IN ('C', 'U')
                                   AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                                   WHERE SCH.DDL_TRG_DCD = 'R'  --운영 DB만
                                   ) DBCR
                  ON DBC.SRC_DB_SCH_ID = DBCR.SRC_DB_SCH_ID
                  AND DBC.TGT_DB_SCH_ID = DBCR.TGT_DB_SCH_ID
                  AND DBC.DBC_TBL_NM = DBCR.DBC_TBL_NM
                  AND DBC.DBC_COL_NM = DBCR.DBC_COL_NM 
                  WHERE 1=1 
                <if test="fullPath != null">
                AND DBC.FULL_PATH LIKE CONCAT('%' ,#{fullPath,jdbcType=VARCHAR} , '%')
                </if>
                 <if test="dbConnTrgId != null">
                 AND (DBC.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR} OR DBCR.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}) 
                </if>
                <if test="dbSchId != null">
                 AND (DBC.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR} OR DBCR.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR})
                </if>
<!--                 <if test="searchBgnDe != null"> -->
<!--                 <![CDATA[ -->
<!--                 AND TO_CHAR(C.APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR} -->
<!--                 ]]> -->
<!--                 </if> -->
<!--                 <if test="searchEndDe != null"> -->
<!--                 <![CDATA[ -->
<!--                 AND TO_CHAR(C.APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR} -->
<!--                 ]]> -->
<!--                 </if> -->
                <if test="tblNm != null">
                AND (  DBC.DBC_TBL_NM  LIKE CONCAT( '%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR DBC.DBC_TBL_KOR_NM LIKE CONCAT( '%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR DBCR.DBC_TBL_NM  LIKE CONCAT( '%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR DBCR.DBC_TBL_KOR_NM LIKE CONCAT( '%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       )
                       </if>
            ) A
             GROUP BY DBC_TBL_PNM
      ) A
    <where>
     <if test="gapStatus != null">
     AND A.GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
     </if>
    </where>
     ORDER BY GAP_STATUS , GAP_CONTS,SUBJ_LNM, DBC_TBL_NM
</select>

<select id="selectDbcColGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT 	/* ModelGapMapper.selectDbcColGapList */
		A.*
      ,CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor
  FROM (
                 SELECT 
                    IFNULL(DBC.DBC_TBL_NM,DBCR.DBC_TBL_NM) AS DBC_TBL_NM
                   ,IFNULL(DBC.DBC_TBL_KOR_NM,DBCR.DBC_TBL_KOR_NM) AS DBC_TBL_LNM
                   ,IFNULL(DBC.DBC_COL_NM,DBCR.DBC_COL_NM) AS DBC_COL_PNM
                   ,DBC.DB_SCH_PNM      AS DBC_DB_SCH_LNM
                   ,DBC.DB_CONN_TRG_PNM AS DBC_DB_CONN_TRG_LNM
                   ,DBC.ORD            AS DBC_COL_ORD
                   ,DBC.DATA_TYPE   AS DBC_DATA_TYPE
                   ,DBC.DATA_LEN   AS DBC_DATA_LEN
                   ,CASE WHEN DBC.DATA_PNT = 0 THEN NULL ELSE DBC.DATA_PNT END AS DBC_DATA_SCAL
                   ,CASE WHEN IFNULL(DBC.NULL_YN,'-') = 'N' THEN 'Y'
				         WHEN IFNULL(DBC.NULL_YN,'-') = 'Y' THEN 'N'  
				         ELSE '-' END AS DBC_NONUL_YN 
                   ,DBC.DEFLT_VAL   AS DBC_DEFLT_VAL
                   ,DBC.PK_YN       AS DBC_PK_YN
                   ,DBC.PK_ORD      AS DBC_PK_ORD
                   ,DBCR.DBC_TBL_NM AS DBC_REAL_TBL_NM
                   ,DBCR.DBC_COL_NM AS DBC_REAL_COL_PNM
                   ,DBCR.DB_SCH_PNM      AS DBC_REAL_DB_SCH_LNM
                   ,DBCR.DB_CONN_TRG_PNM AS DBC_REAL_DB_CONN_TRG_LNM
                   ,DBCR.ORD         AS DBC_REAL_COL_ORD
                   ,DBCR.DATA_TYPE   AS DBC_REAL_DATA_TYPE
                   ,DBCR.DATA_LEN   AS DBC_REAL_DATA_LEN
                   ,CASE WHEN DBCR.DATA_PNT = 0 THEN NULL ELSE DBCR.DATA_PNT END AS DBC_REAL_DATA_SCAL
                   ,CASE WHEN IFNULL(DBCR.NULL_YN,'-') = 'N' THEN 'Y'
		 		         WHEN IFNULL(DBCR.NULL_YN,'-') = 'Y' THEN 'N'  
				         ELSE '-' END AS DBC_REAL_NONUL_YN 
                   ,DBCR.DEFLT_VAL   AS DBC_REAL_DEFLT_VAL
                   ,DBCR.PK_YN       AS DBC_REAL_PK_YN
                   ,DBCR.PK_ORD      AS DBC_REAL_PK_ORD
                   ,CASE WHEN IFNULL(DBC.ORD,0)   != IFNULL(DBCR.ORD,0)
                           OR IFNULL(DBC.DATA_TYPE,'-') != IFNULL(DBCR.DATA_TYPE,'-') 
                           OR IFNULL(DBC.DATA_LEN,0)  != IFNULL(DBCR.DATA_LEN,0)
                           OR IFNULL(DBC.DATA_PNT,0) != IFNULL(DBCR.DATA_PNT,0)
                           OR DECODE(IFNULL(DBC.NULL_YN,'N'),'N','Y','N') != DECODE(IFNULL(DBCR.NULL_YN,'N'),'N','Y','N') 
                           OR IFNULL(REPLACE(DBC.DEFLT_VAL,CHAR(39),NULL),'-') != IFNULL(REPLACE(DBCR.DEFLT_VAL,CHAR(39), NULL),'-')
                           OR IFNULL(DBC.PK_YN ,'N')    != IFNULL(DBCR.PK_YN   ,'N') 
                           OR IFNULL(DBC.PK_ORD,0)    != IFNULL(DBCR.PK_ORD,0) THEN 'GAP'
                     ELSE 'NML' END AS GAP_STATUS 
                    ,DBC.DB_SCH_ID AS DBC_DB_SCH_ID
                    ,DBCR.DB_SCH_ID AS DBC_REAL_DB_SCH_ID
                  FROM (SELECT DBC.DB_SCH_ID
                             ,DBC.DBC_TBL_NM
                             ,DBC.DBC_TBL_KOR_NM
                             ,DBCCOL.DBC_COL_NM 
                             ,DBCCOL.ORD      
                             ,DBCCOL.DATA_TYPE
                             ,DBCCOL.DATA_LEN
                             ,DBCCOL.DATA_PNT
                             ,DBCCOL.NULL_YN
                             ,DBCCOL.DEFLT_VAL 
                             ,DBCCOL.PK_YN     
                             ,DBCCOL.PK_ORD
                             ,SCH.DB_CONN_TRG_ID
                             ,PDM.FULL_PATH
                             ,MAP.SRC_DB_SCH_ID
                             ,MAP.TGT_DB_SCH_ID
                             ,SCH.DB_SCH_PNM
                             ,TRG.DB_CONN_TRG_PNM
                        FROM WAT_DBC_TBL DBC
                        INNER JOIN WAT_DBC_COL DBCCOL
                        ON DBCCOL.DBC_TBL_NM = DBC.DBC_TBL_NM
                        AND DBC.DB_SCH_ID =DBCCOL.DB_SCH_ID
                        INNER JOIN WAA_DB_MAP MAP
                        ON MAP.SRC_DB_SCH_ID = DBC.DB_SCH_ID
                        AND MAP.REG_TYP_CD IN ('C', 'U')
                        AND MAP.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAA_DB_SCH SCH
                        ON DBC.DB_SCH_ID = SCH.DB_SCH_ID
                        AND SCH.REG_TYP_CD IN ('C', 'U')
                        AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
                        ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
                        AND TRG.REG_TYP_CD IN ('C', 'U')
                        AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAM_PDM_TBL PDM
                        ON DBC.PDM_TBL_ID = PDM.PDM_TBL_ID
                        WHERE SCH.DDL_TRG_DCD = 'D'  --개발 DB만
                        ) DBC
                  FULL OUTER JOIN (SELECT DBC.DB_SCH_ID
                                         ,DBC.DBC_TBL_NM
                                         ,DBC.DBC_TBL_KOR_NM
                                         ,DBCCOL.DBC_COL_NM 
                                         ,DBCCOL.ORD      
                                         ,DBCCOL.DATA_TYPE
                                         ,DBCCOL.DATA_LEN
                                         ,DBCCOL.DATA_PNT
                                         ,DBCCOL.NULL_YN
                                         ,DBCCOL.DEFLT_VAL 
                                         ,DBCCOL.PK_YN     
                                         ,DBCCOL.PK_ORD
                                         ,SCH.DB_CONN_TRG_ID  
                                         ,MAP.SRC_DB_SCH_ID
                                         ,MAP.TGT_DB_SCH_ID
                                         ,SCH.DB_SCH_PNM
                                         ,TRG.DB_CONN_TRG_PNM
                                   FROM WAT_DBC_TBL DBC
                                   INNER JOIN WAT_DBC_COL DBCCOL
                                   ON DBCCOL.DBC_TBL_NM = DBC.DBC_TBL_NM
                                   AND DBC.DB_SCH_ID =DBCCOL.DB_SCH_ID
                                   INNER JOIN WAA_DB_MAP MAP
                                   ON MAP.TGT_DB_SCH_ID = DBC.DB_SCH_ID
                                   AND MAP.REG_TYP_CD IN ('C', 'U')
                                   LEFT OUTER JOIN WAA_DB_SCH SCH
                                   ON DBC.DB_SCH_ID =SCH.DB_SCH_ID
                                   AND SCH.REG_TYP_CD IN ('C', 'U')
                                   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                                   LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
                                   ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
                                   AND TRG.REG_TYP_CD IN ('C', 'U')
                                   AND TRG.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                                   WHERE SCH.DDL_TRG_DCD = 'R'  -- 운영 DB만
                                   ) DBCR
                  ON DBC.SRC_DB_SCH_ID = DBCR.SRC_DB_SCH_ID
                  AND DBC.TGT_DB_SCH_ID = DBCR.TGT_DB_SCH_ID
                  AND DBC.DBC_TBL_NM = DBCR.DBC_TBL_NM
                  AND DBC.DBC_COL_NM = DBCR.DBC_COL_NM 
                  WHERE 1=1 
                    AND (DBC.DBC_TBL_NM = #{dbcTblNm,jdbcType=VARCHAR} OR DBC.DBC_TBL_KOR_NM = #{dbcTblNm,jdbcType=VARCHAR}
                         OR DBCR.DBC_TBL_NM = #{dbcRealTblNm,jdbcType=VARCHAR} OR DBCR.DBC_TBL_KOR_NM = #{dbcRealTblNm,jdbcType=VARCHAR})
                    AND (DBC.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR} OR DBCR.DB_SCH_ID = #{dbRealSchId,jdbcType=VARCHAR})
             ) A
             ORDER BY DBC_TBL_NM, DBC_COL_ORD , DBC_REAL_COL_ORD
</select>


<resultMap id="MdlDevDdlGapMap" type="kr.wise.meta.gap.service.ModelGapVO">

    <result column="GAP_STATUS"  property="gapStatus" jdbcType="VARCHAR" />
	<result column="PDM_TBL_CNT" property="pdmTblCnt" jdbcType="VARCHAR" />
    <result column="GAP_CNT"     property="gapCnt"    jdbcType="VARCHAR" />
    <result column="COL_GAP_CNT" property="colGapCnt" jdbcType="VARCHAR" />
    <result column="NML_CNT"     property="nmlCnt"    jdbcType="VARCHAR" />
    <result column="PDM_COL_CNT" property="pdmColCnt" jdbcType="VARCHAR" />
    <result column="DDL_COL_CNT" property="ddlColCnt" jdbcType="VARCHAR" />
    <result column="APRV_DTM"    property="aprvDtm"   jdbcType="VARCHAR" />
      
    <result column="FULL_PATH"       property="fullPath"      jdbcType="VARCHAR" />
    <result column="DB_SCH_ID"       property="dbSchId"       jdbcType="VARCHAR" />
    <result column="PDM_TBL_ID"      property="pdmTblId"      jdbcType="VARCHAR" />
    <result column="PDM_TBL_PNM"     property="pdmTblPnm"     jdbcType="VARCHAR" />
    <result column="PDM_TBL_LNM"     property="pdmTblLnm"     jdbcType="VARCHAR" />   
    <result column="PDM_COL_PNM"     property="pdmColPnm"     jdbcType="VARCHAR" />
    <result column="PDM_COL_LNM"     property="pdmColLnm"     jdbcType="VARCHAR" />
    <result column="PDM_COL_SPNM"    property="pdmColSpnm"    jdbcType="VARCHAR" />
    <result column="PDM_COL_ORD"     property="pdmColOrd"     jdbcType="VARCHAR" />
    <result column="PDM_PK_YN"       property="pdmPkYn"       jdbcType="VARCHAR" />
    <result column="PDM_DATA_TYPE"   property="pdmDataType"   jdbcType="VARCHAR" />
    <result column="PDM_DATA_LEN"    property="pdmDataLen"    jdbcType="VARCHAR" />
    <result column="PDM_DATA_SCAL"   property="pdmDataScal"   jdbcType="VARCHAR" />
    <result column="PDM_NONUL_YN"    property="pdmNonulYn"    jdbcType="VARCHAR" />
    <result column="PDM_DEFLT_VAL"   property="pdmDefltVal"   jdbcType="VARCHAR" />
    
    <result column="DDL_COL_PNM"     property="ddlColPnm"     jdbcType="VARCHAR" />
    <result column="DDL_COL_LNM"     property="ddlColLnm"     jdbcType="VARCHAR" />
    <result column="DDL_COL_ORD"     property="ddlColOrd"     jdbcType="VARCHAR" />
    <result column="DDL_PK_YN"       property="ddlPkYn"       jdbcType="VARCHAR" />
    <result column="DDL_DATA_TYPE"   property="ddlDataType"   jdbcType="VARCHAR" />
    <result column="DDL_DATA_LEN"    property="ddlDataLen"    jdbcType="VARCHAR" />
    <result column="DDL_DATA_SCAL"   property="ddlDataScal"   jdbcType="VARCHAR" />
    <result column="DDL_NONUL_YN"    property="ddlNonulYn"    jdbcType="VARCHAR" />
    <result column="DDL_DEFLT_VAL"   property="ddlDefltVal"   jdbcType="VARCHAR" />
</resultMap>

<select id="selectMdlDevDdlTblGapList" resultMap="MdlDevDdlGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
/* ModelGapMapper.selectMdlDevDdlTblGapList */
	SELECT FULL_PATH	
	     , SUBJ_ID    
	     , PDM_TBL_ID
	     , DB_SCH_ID
         , TBL_NM      AS PDM_TBL_PNM          
         , IFNULL(PDM_TBL_LNM, DDL_TBL_LNM) AS PDM_TBL_LNM        
         , GAP_STATUS     
         , COL_GAP_CNT   
         , PDM_COL_CNT        
         , DDL_COL_CNT   
         , APRV_DTM     
      FROM (
        SELECT MAX(A_FULL_PATH)                  AS FULL_PATH
             , MAX(A_SUBJ_ID)                    AS SUBJ_ID
             , IFNULL(A_DB_SCH_ID, B_DB_SCH_ID)     AS DB_SCH_ID		   
             , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM) AS TBL_NM
             , MAX(A_APRV_DTM)                   AS APRV_DTM
             , CASE WHEN MAX(B_PDM_TBL_PNM)  IS NULL THEN 'NTGT'                -- 개발DDL 테이블미존재 
                    WHEN MAX(A_PDM_TBL_PNM)  IS NULL THEN 'NPDM'                -- '메타테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(A_PDM_COL_LNM,'_') != IFNULL(B_PDM_COL_LNM,'_')
                                         OR A_DATA_TYPE != B_DATA_TYPE
                                         OR IFNULL(A_DATA_LEN, 0)   != IFNULL(B_DATA_LEN, 0)
                                         OR IFNULL(A_DATA_SCAL,0)   != IFNULL(B_DATA_SCAL,0)
                                         OR A_COL_ORD            != B_COL_ORD
                                         OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                         OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                         OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(A_PDM_COL_LNM,'_') != IFNULL(B_PDM_COL_LNM,'_')  
                                 OR A_DATA_TYPE != B_DATA_TYPE
                                 OR A_DATA_LEN  != B_DATA_LEN
                                 OR A_DATA_SCAL != B_DATA_SCAL
                                 OR A_COL_ORD   != B_COL_ORD
                                 OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                 OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                 OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(A_PDM_TBL_PNM)  AS PDM_COL_CNT        
             , COUNT(B_PDM_TBL_PNM)  AS DDL_COL_CNT
             , MAX(B_PDM_TBL_PNM)    AS DDL_TBL_PNM
             , MAX(B_PDM_TBL_LNM)    AS DDL_TBL_LNM
             , MAX(B_PDM_COL_PNM)    AS DDL_COL_PNM
             , MAX(B_PDM_COL_LNM)    AS DDL_COL_LNM
             , MAX(B_COL_ORD)        AS ORD
             , MAX(B_DATA_TYPE)      AS DATA_TYPE
             , MAX(B_DATA_LEN)       AS DATA_LEN
             , MAX(B_DATA_SCAL)      AS DATA_SCAL
             , MAX(A_PDM_TBL_ID)     AS PDM_TBL_ID
             , MAX(A_PDM_TBL_PNM)    AS PDM_TBL_PNM
             , MAX(A_PDM_TBL_LNM)    AS PDM_TBL_LNM
             , MAX(A_PDM_COL_PNM)    AS PDM_COL_PNM
             , MAX(A_PDM_COL_LNM)    AS PDM_COL_LNM         
          FROM (
		  
		SELECT * FROM (  
				(   
				SELECT  D.DB_SCH_ID AS A_DB_SCH_ID
                      , A.FULL_PATH AS A_FULL_PATH
                      , A.SUBJ_ID AS A_SUBJ_ID
                      , A.PDM_TBL_ID AS A_PDM_TBL_ID
                      , A.PDM_TBL_PNM AS A_PDM_TBL_PNM
                      , A.PDM_TBL_LNM AS A_PDM_TBL_LNM
                      , A.APRV_DTM AS A_APRV_DTM
                      , B.PDM_COL_PNM AS A_PDM_COL_PNM
                      , B.PDM_COL_LNM AS A_PDM_COL_LNM
                      , B.COL_ORD AS A_COL_ORD
                      , B.PK_YN AS A_PK_YN
                      , B.DATA_TYPE AS A_DATA_TYPE
                      , B.DATA_LEN AS A_DATA_LEN
                      , B.DATA_SCAL	AS A_DATA_SCAL
                      , B.NONUL_YN AS A_NONUL_YN
                      , B.DEFLT_VAL AS A_DEFLT_VAL
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID                             
                        INNER JOIN WAA_SUBJ_DB_SCH_MAP D
                           ON D.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
                          AND D.SUBJ_ID = C.SUBJ_ID
                  WHERE 1 = 1
                    AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}     
                    
                    <if test="subjId != null">
				   	   AND A.SUBJ_ID LIKE CONCAT(#{subjId, jdbcType=VARCHAR} , '%')
				    </if>   	                                   
                        
                ) A
            LEFT OUTER JOIN 
               (
                SELECT A.DB_SCH_ID AS B_DB_SCH_ID
                     , ''               AS B_FULL_PATH
                     , ''               AS B_SUBJ_ID
                     , A.DDL_TBL_PNM    AS B_PDM_TBL_PNM
                     , A.DDL_TBL_LNM    AS B_PDM_TBL_LNM                                 
                     , B.DDL_COL_PNM    AS B_PDM_COL_PNM
                     , B.DDL_COL_LNM    AS B_PDM_COL_LNM		             
                     , B.COL_ORD AS B_COL_ORD
                     , B.PK_YN AS B_PK_YN
                     , B.DATA_TYPE      AS B_DATA_TYPE  
                     , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS B_DATA_LEN
                     , B.DATA_SCAL AS B_DATA_SCAL
                     , B.NONUL_YN AS B_NONUL_YN
                     , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS B_DEFLT_VAL
                  FROM WAM_DDL_TBL A
                       INNER JOIN WAM_DDL_COL B
                          ON B.DDL_TBL_ID  = A.DDL_TBL_ID                         
                 WHERE 1 = 1		                                       
                   AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}    
                ) B                
                ON 1 = 1
               AND A_DB_SCH_ID   = B_DB_SCH_ID 
               AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
               AND IFNULL(A_PDM_COL_PNM,'_') = IFNULL(B_PDM_COL_PNM,'_')
		)	   
UNION
		SELECT * FROM (  
				(   
				SELECT  D.DB_SCH_ID AS A_DB_SCH_ID
                      , A.FULL_PATH AS A_FULL_PATH
                      , A.SUBJ_ID AS A_SUBJ_ID
                      , A.PDM_TBL_ID AS A_PDM_TBL_ID
                      , A.PDM_TBL_PNM AS A_PDM_TBL_PNM
                      , A.PDM_TBL_LNM AS A_PDM_TBL_LNM
                      , A.APRV_DTM AS A_APRV_DTM
                      , B.PDM_COL_PNM AS A_PDM_COL_PNM
                      , B.PDM_COL_LNM AS A_PDM_COL_LNM
                      , B.COL_ORD AS A_COL_ORD
                      , B.PK_YN AS A_PK_YN
                      , B.DATA_TYPE AS A_DATA_TYPE
                      , B.DATA_LEN AS A_DATA_LEN
                      , B.DATA_SCAL	AS A_DATA_SCAL
                      , B.NONUL_YN AS A_NONUL_YN
                      , B.DEFLT_VAL AS A_DEFLT_VAL
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID                             
                        INNER JOIN WAA_SUBJ_DB_SCH_MAP D
                           ON D.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
                          AND D.SUBJ_ID = C.SUBJ_ID
                  WHERE 1 = 1
                    AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}     
                    
                    <if test="subjId != null">
				   	   AND A.SUBJ_ID LIKE CONCAT(#{subjId, jdbcType=VARCHAR} , '%')
				    </if>   	                                   
                        
                ) A
            RIGHT OUTER JOIN 
               (
                SELECT A.DB_SCH_ID AS B_DB_SCH_ID
                     , ''               AS B_FULL_PATH
                     , ''               AS B_SUBJ_ID
                     , A.DDL_TBL_PNM    AS B_PDM_TBL_PNM
                     , A.DDL_TBL_LNM    AS B_PDM_TBL_LNM                                 
                     , B.DDL_COL_PNM    AS B_PDM_COL_PNM
                     , B.DDL_COL_LNM    AS B_PDM_COL_LNM		             
                     , B.COL_ORD AS B_COL_ORD
                     , B.PK_YN AS B_PK_YN
                     , B.DATA_TYPE      AS B_DATA_TYPE  
                     , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS B_DATA_LEN
                     , B.DATA_SCAL AS B_DATA_SCAL
                     , B.NONUL_YN AS B_NONUL_YN
                     , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS B_DEFLT_VAL
                  FROM WAM_DDL_TBL A
                       INNER JOIN WAM_DDL_COL B
                          ON B.DDL_TBL_ID  = A.DDL_TBL_ID                         
                 WHERE 1 = 1		                                       
                   AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}    
                ) B                
                ON 1 = 1
               AND A_DB_SCH_ID   = B_DB_SCH_ID 
               AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
               AND IFNULL(A_PDM_COL_PNM,'_') = IFNULL(B_PDM_COL_PNM,'_')
		)			   
		   
		) FSQ	   
         WHERE 1 = 1  
         GROUP BY IFNULL(A_DB_SCH_ID, B_DB_SCH_ID)
                , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM) 
       ) X
    WHERE 1 = 1                  
      <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     
	  <if test="subjId != null">
	   	   AND X.SUBJ_ID LIKE CONCAT(#{subjId, jdbcType=VARCHAR} , '%')
	  </if>   		
	  <if test="pdmTblPnm != null">
	   	   AND X.TBL_NM LIKE CONCAT(#{pdmTblPnm, jdbcType=VARCHAR} , '%')
	  </if>   		                 
    ORDER BY TBL_NM  
	
</select>

<!-- 위의 selectMdlDevDdlTblGapList 쿼리를 오라클 버전으로 바꾸기 전 원본  -->
<select id="selectMdlDevDdlTblGapList_BAKUP" resultMap="MdlDevDdlGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	SELECT 	
		   X.FULL_PATH	
	     , X.SUBJ_ID    
	     , X.SYS_AREA_ID
	     , X.PDM_TBL_ID
	     , X.DDL_TBL_ID
	     , X.DB_SCH_ID
         , X.TBL_NM      AS PDM_TBL_PNM          
         , IFNULL(X.PDM_TBL_LNM, X.DDL_TBL_LNM) AS PDM_TBL_LNM        
         , X.GAP_STATUS     
         , X.COL_GAP_CNT   
         , X.PDM_COL_CNT        
         , X.DDL_COL_CNT   
         , X.PDM_APRV_DTM     
         , X.DDL_APRV_DTM
         , X.STND_ASRT
         , S.DB_SCH_LNM
         , T.DB_CONN_TRG_LNM
      FROM (
        SELECT IFNULL(PDM_FULL_PATH, DDL_FULL_PATH)   AS FULL_PATH
             , IFNULL(PDM_SUBJ_ID, DDL_SUBJ_ID)        AS SUBJ_ID
             , IFNULL(PDM_SYS_AREA_iD, DDL_SYS_AREA_ID)        AS SYS_AREA_ID
             , IFNULL(PDM_DB_SCH_ID, DDL_DB_SCH_ID)     AS DB_SCH_ID		   
             , IFNULL(PDM_TBL_PNM, DDL_TBL_PNM) 		AS TBL_NM
             , DDL_APRV_DTM
             , PDM_APRV_DTM
             , CASE WHEN MAX(DDL_TBL_ID)  IS NULL THEN 'NTGT'                -- 개발DDL 테이블미존재 
                    WHEN MAX(PDM_TBL_ID)  IS NULL THEN 'NPDM'                -- '메타테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(PDM_COL_LNM,'_') != IFNULL(DDL_COL_LNM,'_')
                                         OR PDM_DATA_TYPE != DDL_DATA_TYPE
                                         OR IFNULL(PDM_DATA_LEN, 0)   != IFNULL(DDL_DATA_LEN, 0)
                                         OR IFNULL(PDM_DATA_SCAL,0)   != IFNULL(DDL_DATA_SCAL,0)
                                         OR PDM_COL_ORD            != DDL_COL_ORD
                                         OR IFNULL(PDM_NONUL_YN,'N')  != IFNULL(DDL_NONUL_YN,'N')
                                         OR IFNULL(PDM_DEFLT_VAL,'_') != IFNULL(DDL_DEFLT_VAL,'_')
                                         OR IFNULL(PDM_PK_YN,'N')     != IFNULL(DDL_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(PDM_COL_LNM,'_') != IFNULL(DDL_COL_LNM,'_')  
                                 OR PDM_DATA_TYPE != DDL_DATA_TYPE
                                 OR PDM_DATA_LEN  != DDL_DATA_LEN
                                 OR PDM_DATA_SCAL != DDL_DATA_SCAL
                                 OR PDM_COL_ORD   != DDL_COL_ORD
                                 OR IFNULL(PDM_NONUL_YN,'N')  != IFNULL(DDL_NONUL_YN,'N')
                                 OR IFNULL(PDM_DEFLT_VAL,'_') != IFNULL(DDL_DEFLT_VAL,'_')
                                 OR IFNULL(PDM_PK_YN,'N')     != IFNULL(DDL_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(PDM_TBL_PNM)  AS PDM_COL_CNT        
             , COUNT(DDL_TBL_PNM)  AS DDL_COL_CNT
             , MAX(PDM_TBL_ID)     AS PDM_TBL_ID
             , MAX(PDM_TBL_PNM)    AS PDM_TBL_PNM
             , MAX(PDM_TBL_LNM)    AS PDM_TBL_LNM
             , MAX(PDM_COL_PNM)    AS PDM_COL_PNM
             , MAX(PDM_COL_LNM)    AS PDM_COL_LNM
             , MAX(DDL_TBL_ID)     AS DDL_TBL_ID
             , MAX(DDL_TBL_PNM)    AS DDL_TBL_PNM
             , MAX(DDL_TBL_LNM)    AS DDL_TBL_LNM
             , MAX(DDL_COL_PNM)    AS DDL_COL_PNM
             , MAX(DDL_COL_LNM)    AS DDL_COL_LNM
             , STND_ASRT         
          FROM (
          select   A.FULL_PATH 	   AS PDM_FULL_PATH
	             , A.SUBJ_ID       AS PDM_SUBJ_ID
	             , A.SYS_AREA_ID AS PDM_SYS_AREA_ID
	             , A.DB_SCH_ID     AS PDM_DB_SCH_ID
	             , A.PDM_TBL_PNM   AS PDM_TBL_PNM
	             , A.PDM_TBL_LNM   AS PDM_TBL_LNM
	             , A.PDM_TBL_ID    AS PDM_TBL_ID
	             , A.APRV_DTM      AS PDM_APRV_DTM
	             , A.PDM_COL_PNM   AS PDM_COL_PNM
	             , A.PDM_COL_LNM   AS PDM_COL_LNM
	             , A.COL_ORD as PDM_COL_ORD
		          , A.PK_YN as PDM_PK_YN
		          , A.DATA_TYPE as PDM_DATA_TYPE
		          , A.DATA_LEN as PDM_DATA_LEN
		          , A.DATA_SCAL	as PDM_DATA_SCAL
		          , A.NONUL_YN as PDM_NONUL_YN
		          , A.DEFLT_VAL as PDM_DEFLT_VAL
		         , B.FULL_PATH 	   AS DDL_FULL_PATH
	             , B.SUBJ_ID       AS DDL_SUBJ_ID
	             , B.SYS_AREA_ID AS DDL_SYS_AREA_ID
	             , B.DB_SCH_ID     AS DDL_DB_SCH_ID		   
	             , B.DDL_TBL_PNM   AS DDL_TBL_PNM
	             , B.DDL_TBL_LNM   AS DDL_TBL_LNM
	             , B.DDL_TBL_ID    AS DDL_TBL_ID
	             , B.APRV_DTM      AS DDL_APRV_DTM
	             , B.DDL_COL_PNM   AS DDL_COL_PNM
	             , B.DDL_COL_LNM   AS DDL_COL_LNM
	             , B.COL_ORD as DDL_COL_ORD
		          , B.PK_YN as DDL_PK_YN
		          , B.DATA_TYPE as DDL_DATA_TYPE
		          , B.DATA_LEN as DDL_DATA_LEN
		          , B.DATA_SCAL	as DDL_DATA_SCAL
		          , B.NONUL_YN as DDL_NONUL_YN
		          , B.DEFLT_VAL as DDL_DEFLT_VAL
	              , IFNULL(A.STND_ASRT,B.STND_ASRT) AS STND_ASRT 
          from (
          		SELECT  D.DB_SCH_ID   
                      , A.FULL_PATH
                      , A.SUBJ_ID
                      , E.SYS_AREA_ID
                      , A.PDM_TBL_ID                   
                      , A.PDM_TBL_PNM
                      , A.PDM_TBL_LNM
                      , A.APRV_DTM 
                      , B.PDM_COL_PNM
                      , B.PDM_COL_LNM              
                      , B.COL_ORD
                      , B.PK_YN
                      , B.DATA_TYPE
                      , B.DATA_LEN
                      , B.DATA_SCAL	
                      , B.NONUL_YN
                      , B.DEFLT_VAL  
                      , A.STND_ASRT                    
                    FROM WAM_PDM_TBL A 
                        INNER JOIN WAM_PDM_COL B 
                           ON B.STND_ASRT = A.STND_ASRT
                          AND B.PDM_TBL_ID = A.PDM_TBL_ID
                        INNER JOIN WAA_SUBJ C
                           ON C.STND_ASRT = A.STND_ASRT
                           AND C.SUBJ_ID = A.SUBJ_ID
                           AND C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')                         
                        INNER JOIN WAM_DDL_TBL D
                           ON D.STND_ASRT =C.STND_ASRT 
                          AND D.PDM_TBL_ID = A.PDM_TBL_ID
                          AND D.DDL_TRG_DCD = 'D' -- 개발만
                         LEFT JOIN WAA_SYS_AREA E
                           ON E.STND_ASRT = C.STND_ASRT
                          AND E.SYS_AREA_ID = C.SYS_AREA_ID
                          AND E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND E.REG_TYP_CD IN ('C','U')                 
                         INNER JOIN WAA_DB_SCH F
                         ON D.STND_ASRT = F.STND_ASRT
                         AND D.DB_SCH_ID = F.DB_SCH_ID
                         AND F.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                         AND F.REG_TYP_CD IN ('C', 'U')
                         INNER JOIN WAA_DB_CONN_TRG G
                         ON F.STND_ASRT = G.STND_ASRT
                         AND F.DB_CONN_TRG_ID = G.DB_CONN_TRG_ID
                         AND G.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                         AND G.REG_TYP_CD IN ('C', 'U')
                         AND G.META_MNG_YN ='Y'                
                  WHERE A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}
                   <if test="dbSchId!=null and dbSchId!=''">
                    AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                    </if>
                    <if test="sysAreaId != null and sysAreaId != '' " >
		            AND C.SYS_AREA_ID = #{sysAreaId,jdbcType=VARCHAR}
                    </if>  
             <choose>
	   	           <when test='subjLvl == 1' >
	   	           	AND C.SUBJ_ID IN 
	   	           	                (SELECT SUBJ_ID
                                                   FROM WAA_SUBJ
		           			  	    WHERE REG_TYP_CD IN ('C', 'U')
		           			  	      AND LECY_DCD = 'SFG'
                                      AND EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
                                      AND STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}  
                                      <if test="subjId!=null">
                                      AND UPP_SUBJ_ID = #{subjId,jdbcType=VARCHAR}
                              		  </if>
                                          )
	   	           </when>
	   	           <when test='subjLvl == 2'>
	   	           	AND A.SUBJ_ID = #{subjId,jdbcType=VARCHAR}
	   	           </when> 			   		
	         </choose>  
                ) A
               inner JOIN 
               (
                SELECT A.DB_SCH_ID	
                     , A.FULL_PATH             AS FULL_PATH
                     , ''               AS SUBJ_ID
                     , ''               AS SYS_AREA_ID
                     , B.DDL_TBL_ID
                     , A.DDL_TBL_PNM    AS DDL_TBL_PNM
                     , A.DDL_TBL_LNM    AS DDL_TBL_LNM                                 
                     , B.DDL_COL_PNM    AS DDL_COL_PNM
                     , B.DDL_COL_LNM    AS DDL_COL_LNM		             
                     , B.COL_ORD
                     , B.PK_YN
                     , B.DATA_TYPE      AS DATA_TYPE  
                     , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS DATA_LEN
                     , B.DATA_SCAL 
                     , B.NONUL_YN
                     , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS DEFLT_VAL
                     , A.APRV_DTM
                     , A.STND_ASRT
                  FROM WAM_DDL_TBL A
                       INNER JOIN WAM_DDL_COL B
                        ON B.STND_ASRT = A.STND_ASRT
                       AND B.DDL_TBL_ID  = A.DDL_TBL_ID
                       AND A.DDL_TRG_DCD = 'D' -- 개발만
                       INNER JOIN WAM_PDM_TBL C
                       ON A.STND_ASRT = C.STND_ASRT
                       AND A.PDM_TBL_ID = C.PDM_TBL_ID 
                       INNER JOIN WAA_SUBJ D
                       ON D.STND_ASRT = C.STND_ASRT
                       AND D.SUBJ_ID = C.SUBJ_ID
                       AND D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                       AND D.REG_TYP_CD IN ('C', 'U')
                       INNER JOIN WAA_DB_SCH E
                       ON A.STND_ASRT = E.STND_ASRT
                       AND A.DB_SCH_ID = E.DB_SCH_ID
                       AND E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                       AND E.REG_TYP_CD IN ('C', 'U')
                       INNER JOIN WAA_DB_CONN_TRG F
                       ON F.STND_ASRT = E.STND_ASRT
                       AND F.DB_CONN_TRG_ID = E.DB_CONN_TRG_ID
                       AND F.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                       AND F.REG_TYP_CD IN ('C', 'U')
                       AND F.META_MNG_YN ='Y'
                 WHERE A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}
                   <if test="dbSchId!=null and dbSchId!=''">		                                       
                   AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                   </if>
                   <if test="sysAreaId != null and sysAreaId != '' " >
		            AND D.SYS_AREA_ID = #{sysAreaId,jdbcType=VARCHAR}
                   </if>      
               <choose>
	   	           <when test='subjLvl == 1' >
	   	           	AND C.SUBJ_ID IN 
	   	           	                (SELECT SUBJ_ID
                                                   FROM WAA_SUBJ
		           			  	    WHERE REG_TYP_CD IN ('C', 'U')
		           			  	      AND LECY_DCD = 'SFG'
                                      AND EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
                                      AND STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}  
                                      <if test="subjId!=null">
                                      AND UPP_SUBJ_ID = #{subjId,jdbcType=VARCHAR}
                              		  </if>
                                          )
	   	           </when>
	   	           <when test='subjLvl == 2'>
	   	           	AND C.SUBJ_ID = #{subjId,jdbcType=VARCHAR}
	   	           </when> 			   		
	         </choose>  
                ) B                
                ON A.STND_ASRT = B.STND_ASRT
               AND A.DB_SCH_ID   = B.DB_SCH_ID 
               AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
               AND IFNULL(A.PDM_COL_PNM,'_') = IFNULL(B.DDL_COL_PNM,'_')
         UNION
         SELECT    A.FULL_PATH 	   AS PDM_FULL_PATH
	             , A.SUBJ_ID       AS PDM_SUBJ_ID
	             , E.SYS_AREA_ID AS PDM_SYS_AREA_ID
	             , D.DB_SCH_ID     AS PDM_DB_SCH_ID		   
	             , A.PDM_TBL_PNM   AS PDM_TBL_PNM
	             , A.PDM_TBL_LNM   AS PDM_TBL_LNM
	             , A.PDM_TBL_ID    AS PDM_TBL_ID
	             , A.APRV_DTM      AS PDM_APRV_DTM
	             , B.PDM_COL_PNM   AS PDM_COL_PNM
	             , B.PDM_COL_LNM   AS PDM_COL_LNM
	             , B.COL_ORD as PDM_COL_ORD
		          , B.PK_YN as PDM_PK_YN
		          , B.DATA_TYPE as PDM_DATA_TYPE
		          , B.DATA_LEN as PDM_DATA_LEN
		          , B.DATA_SCAL	as PDM_DATA_SCAL
		          , B.NONUL_YN as PDM_NONUL_YN
		          , B.DEFLT_VAL as PDM_DEFLT_VAL
		         , NULL 	     AS DDL_FULL_PATH
	             , NULL       AS DDL_SUBJ_ID
	             , NULL       AS DDL_SYS_AREA_ID
	             , NULL       AS DDL_DB_SCH_ID
	             , NULL       AS DDL_TBL_PNM
	             , NULL   AS DDL_TBL_LNM
	             , NULL    AS DDL_TBL_ID
	             , NULL      AS DDL_APRV_DTM
	             , NULL   AS DDL_COL_PNM
	             , NULL   AS DDL_COL_LNM
	             , NULL as DDL_COL_ORD
		          , NULL as DDL_PK_YN
		          , NULL as DDL_DATA_TYPE
		          , NULL as DDL_DATA_LEN
		          , null as DDL_DATA_SCAL
		          , NULL as DDL_NONUL_YN
		          , NULL as DDL_DEFLT_VAL
		          , A.STND_ASRT
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                          AND B.STND_ASRT = A.STND_ASRT
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID
                          AND C.STND_ASRT = A.STND_ASRT                             
                         LEFT JOIN WAA_SYS_AREA E
                           ON E.STND_ASRT = C.STND_ASRT
                          AND E.SYS_AREA_ID = C.SYS_AREA_ID
                          AND E.REG_TYP_CD IN ('C','U')
                          AND E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
                          LEFT OUTER JOIN 
                          (SELECT D.STND_ASRT, D.PDM_TBL_ID,D.DB_SCH_ID,D.DDL_TBL_ID
                           FROM WAM_DDL_TBL D
                            INNER JOIN WAA_DB_SCH F
                           ON D.STND_ASRT = F.STND_ASRT
                           AND D.DB_SCH_ID = F.DB_SCH_ID
                           AND F.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                           AND F.REG_TYP_CD IN ('C', 'U')
                           INNER JOIN WAA_DB_CONN_TRG G
                           ON F.STND_ASRT = G.STND_ASRT
                           AND F.DB_CONN_TRG_ID = G.DB_CONN_TRG_ID
                           AND G.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                           AND G.REG_TYP_CD IN ('C', 'U')
                           AND G.META_MNG_YN ='Y'  
                           WHERE D.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}
                             AND D.DDL_TRG_DCD = 'D' -- 개발만
                             <if test="dbSchId!=null and dbSchId!=''">
                             AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                             </if>
                          ) D
                          ON A.STND_ASRT = D.STND_ASRT
                          AND A.PDM_TBL_ID = D.PDM_TBL_ID              
<!--                           LEFT OUTER JOIN WAM_DDL_COL D2 -->
<!--                           ON  D.STND_ASRT = D2.STND_ASRT -->
<!--                           AND D.DDL_TBL_ID = D2.DDL_TBL_ID -->
<!--                           AND B.PDM_COL_PNM = D2.DDL_COL_PNM -->
                  WHERE A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}
                   <if test="dbSchId!=null and dbSchId!=''">
                    AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                    </if>
                    <if test="sysAreaId != null and sysAreaId != '' " >
		            AND C.SYS_AREA_ID = #{sysAreaId,jdbcType=VARCHAR}
                    </if> 
              <choose>
	   	           <when test='subjLvl == 1' >
	   	           	AND C.SUBJ_ID IN 
	   	           	                (SELECT SUBJ_ID
                                     FROM WAA_SUBJ
		           			  	    WHERE REG_TYP_CD IN ('C', 'U')
		           			  	      AND LECY_DCD = 'SFG'
                                      AND EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
                                      AND STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}  
                                      <if test="subjId!=null">
                                      AND UPP_SUBJ_ID = #{subjId,jdbcType=VARCHAR}
                              		  </if>
                                      )
	   	           </when>
	   	           <when test='subjLvl == 2'>
	   	           	AND C.SUBJ_ID = #{subjId,jdbcType=VARCHAR}
	   	           </when> 			   		
	         </choose>
         	        AND D.DDL_TBL_ID IS NULL
         UNION
         SELECT    A.FULL_PATH  AS PDM_FULL_PATH
	             , NULL         AS PDM_SUBJ_ID
	             , NULL         AS PDM_SYS_AREA_ID
 	             , NULL     AS PDM_DB_SCH_ID
	             , NULL   AS PDM_TBL_PNM
	             , NULL   AS PDM_TBL_LNM
	             , NULL    AS PDM_TBL_ID
	             , NULL      AS PDM_APRV_DTM
	             , NULL   AS PDM_COL_PNM
	             , NULL   AS PDM_COL_LNM
	             , NULL as PDM_COL_ORD
		          , NULL as PDM_PK_YN
		          , NULL as PDM_DATA_TYPE
		          , NULL as PDM_DATA_LEN
		          , NULL	as PDM_DATA_SCAL
		          , NULL as PDM_NONUL_YN
		          , NULL as PDM_DEFLT_VAL
		         , A.FULL_PATH 	   AS DDL_FULL_PATH
	             , ''       AS DDL_SUBJ_ID
	             ,''        AS DDL_SYS_AREA_ID
	             , A.DB_SCH_ID     AS DDL_DB_SCH_ID		   
	             , A.DDL_TBL_PNM   AS DDL_TBL_PNM
	             , A.DDL_TBL_LNM   AS DDL_TBL_LNM
	             , A.DDL_TBL_ID    AS DDL_TBL_ID
	             , A.APRV_DTM      AS DDL_APRV_DTM
	             , B.DDL_COL_PNM   AS DDL_COL_PNM
	             , B.DDL_COL_LNM   AS DDL_COL_LNM
	             , B.COL_ORD as DDL_COL_ORD
		          , B.PK_YN as DDL_PK_YN
		          , B.DATA_TYPE as DDL_DATA_TYPE
		          , B.DATA_LEN as DDL_DATA_LEN
		          , B.DATA_SCAL	as DDL_DATA_SCAL
		          , B.NONUL_YN as DDL_NONUL_YN
		          , B.DEFLT_VAL as DDL_DEFLT_VAL
		          , A.STND_ASRT
                 FROM WAM_DDL_TBL A
                       INNER JOIN WAM_DDL_COL B
                          ON B.STND_ASRT = A.STND_ASRT  
                         AND B.DDL_TBL_ID  = A.DDL_TBL_ID         
                         AND A.DDL_TRG_DCD = 'D' -- 개발만
                        INNER JOIN WAA_SUBJ E
                          ON A.STND_ASRT = E.STND_ASRT
                         AND A.FULL_PATH = E.FULL_PATH
                         AND E.REG_TYP_CD IN ('C','U')
                         AND E.EXP_DTM = '9999-12-31' 
                            INNER JOIN WAA_DB_SCH F
                           ON A.STND_ASRT = F.STND_ASRT
                           AND A.DB_SCH_ID = F.DB_SCH_ID
                           AND F.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                           AND F.REG_TYP_CD IN ('C', 'U')
                           INNER JOIN WAA_DB_CONN_TRG G
                           ON F.STND_ASRT = G.STND_ASRT
                           AND F.DB_CONN_TRG_ID = G.DB_CONN_TRG_ID
                           AND G.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                           AND G.REG_TYP_CD IN ('C', 'U')
                           AND G.META_MNG_YN ='Y'
                             LEFT OUTER JOIN WAM_PDM_TBL C
                          ON A.STND_ASRT = C.STND_ASRT
                         AND A.PDM_TBL_ID = C.PDM_TBL_ID  
                 WHERE  A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR} 
                   <if test="dbSchId!=null and dbSchId!=''">
                   AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                   </if>
                     <if test="sysAreaId != null and sysAreaId != '' " >
		            AND E.SYS_AREA_ID = #{sysAreaId,jdbcType=VARCHAR}
		            </if>
             <choose>
	   	           <when test='subjLvl == 1' >
	   	           	AND E.SUBJ_ID IN 
	   	           	                (SELECT SUBJ_ID
                                     FROM WAA_SUBJ
		           			  	    WHERE REG_TYP_CD IN ('C', 'U')
		           			  	      AND LECY_DCD = 'SFG'
                                      AND EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
                                      AND STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}  
                                      <if test="subjId!=null">
                                      AND UPP_SUBJ_ID = #{subjId,jdbcType=VARCHAR}
                              		  </if>
                                      )
	   	           </when>
	   	           <when test='subjLvl == 2'>
	   	           	AND E.SUBJ_ID = #{subjId,jdbcType=VARCHAR}
	   	           </when> 			   		
	         </choose>
	               AND C.PDM_TBL_ID IS NULL
         ) A
         GROUP BY STND_ASRT
<!--                 , IFNULL(PDM_DB_SCH_ID, DDL_DB_SCH_ID) -->
                , PDM_FULL_PATH
                , IFNULL(PDM_TBL_PNM, DDL_TBL_PNM) 
       ) X
       LEFT OUTER JOIN WAA_DB_SCH S
       ON X.STND_ASRT = S.STND_ASRT
       AND X.DB_SCH_ID =S.DB_SCH_ID
       AND S.EXP_DTM = '9999-12-31'
       AND S.REG_TYP_CD IN ('C', 'U')
       LEFT OUTER JOIN WAA_DB_CONN_TRG T
       ON S.STND_ASRT = T.STND_ASRT
       AND S.DB_CONN_TRG_ID = T.DB_CONN_TRG_ID
       AND T.EXP_DTM = '9999-12-31'
       AND T.REG_TYP_CD IN ('C', 'U')
     <where>
	   	   AND X.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}
       <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     
	  <if test="sysAreaId != null and sysAreaId != '' " >
		    AND X.SYS_AREA_ID = #{sysAreaId,jdbcType=VARCHAR}
       </if>
<!-- 	   <choose> -->
<!-- 	   		<when test='subjLvl == 1' > -->
<!-- 	   			AND  X.SUBJ_ID IN  -->
<!-- 	   			                 (SELECT  SUBJ_ID -->
<!--                                   FROM WAA_SUBJ -->
<!-- 						  	      WHERE REG_TYP_CD IN ('C', 'U') -->
<!-- 						  	       AND LECY_DCD = 'SFG' -->
<!--                     	  	       AND EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')  -->
<!--                     	  	       AND STND_ASRT      = #{stndAsrt, jdbcType=VARCHAR} -->
<!--                     	  	       <if test="subjId!=null"> -->
<!--                     	  	       AND UPP_SUBJ_ID = #{subjId,jdbcType=VARCHAR} -->
<!--                     	  	       </if> -->
<!--                                   ) -->
<!-- 	   		</when> -->
<!-- 	   		<when test='subjLvl == 2'> -->
<!-- 	   			AND X.SUBJ_ID = #{subjId,jdbcType=VARCHAR} -->
<!-- 	   		</when> 			   		 -->
<!-- 	   </choose>   		 -->
	  <if test="pdmTblPnm != null">
	   	   AND X.TBL_NM LIKE CONCAT('%', #{pdmTblPnm, jdbcType=VARCHAR},'%')
	  </if>     
	 </where>     		              
<!--     ORDER BY TBL_NM   -->
	
	
	
	
	
	
	
</select>


<select id="selectMdlDevDdlColGapList" resultMap="MdlDevDdlGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO"> 
			 /* ModelGapMapper.selectMdlDevDdlColGapList */
    SELECT IFNULL(A_FULL_PATH, B_FULL_PATH)       AS FULL_PATH	 	     
	     , CONCAT(
			 CASE WHEN B_PDM_COL_PNM IS NULL                            THEN 'DDL컬럼미존재' END
	      , CASE WHEN A_PDM_COL_PNM IS NULL                            THEN '메타컬럼미존재' END
	      , CASE WHEN IFNULL(A_PDM_COL_LNM,'_') != IFNULL(B_PDM_COL_LNM,'_') THEN '컬럼한글명불일치' END
	      , CASE WHEN IFNULL(A_PK_YN,'N') != IFNULL(B_PK_YN,'N')             THEN 'PK여부불일치' END
	      , CASE WHEN A_DATA_TYPE != B_DATA_TYPE                       THEN '데이터타입불일치' END
	      , CASE WHEN IFNULL(A_DATA_LEN,0)   != IFNULL(B_DATA_LEN,0)         THEN '데이터길이불일치' END 
	      , CASE WHEN IFNULL(A_DATA_SCAL,-1) != IFNULL(B_DATA_SCAL,-1)       THEN '소수점불일치' END
	      , CASE WHEN A_COL_ORD   != B_COL_ORD                         THEN '컬럼순서불일치' END
	      , CASE WHEN IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')      THEN 'NOT NULL여부불일치' END
	      , CASE WHEN IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')     THEN 'DEFAULT불일치' END   
		   ) AS GAP_STATUS   
	     , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM)     AS DBC_TBL_NM       
	     , A_PDM_TBL_LNM     AS PDM_TBL_NM   
	     , A_PDM_COL_PNM     AS PDM_COL_PNM
	     , A_PDM_COL_LNM     AS PDM_COL_LNM
	     , A_COL_ORD         AS PDM_COL_ORD
	     , A_PK_YN           AS PDM_PK_YN
	     , A_DATA_TYPE       AS PDM_DATA_TYPE
	     , A_DATA_LEN        AS PDM_DATA_LEN
	     , A_DATA_SCAL       AS PDM_DATA_SCAL
	     , A_NONUL_YN        AS PDM_NONUL_YN
	     , A_DEFLT_VAL       AS PDM_DEFLT_VAL         
	     , B_PDM_TBL_PNM     AS DDL_TBL_PNM
	     , B_PDM_COL_PNM     AS DDL_COL_PNM
	     , B_PDM_COL_LNM     AS DDL_COL_LNM         
	     , B_COL_ORD         AS DDL_COL_ORD
	     , B_PK_YN           AS DDL_PK_YN
	     , B_DATA_TYPE       AS DDL_DATA_TYPE
	     , B_DATA_LEN        AS DDL_DATA_LEN
	     , B_DATA_SCAL       AS DDL_DATA_SCAL
	     , B_NONUL_YN        AS DDL_NONUL_YN
	     , B_DEFLT_VAL       AS DDL_DEFLT_VAL         
	  FROM (
		
		SELECT * FROM (
			(
			SELECT  A.FULL_PATH	 			AS A_FULL_PATH
                  , D.DB_SCH_ID				AS A_DB_SCH_ID
	              , A.PDM_TBL_PNM			AS A_PDM_TBL_PNM
	              , A.PDM_TBL_LNM			AS A_PDM_TBL_LNM
	              , B.PDM_COL_PNM			AS A_PDM_COL_PNM
	              , B.PDM_COL_LNM           AS A_PDM_COL_LNM
	              , B.COL_ORD				AS A_COL_ORD
	              , IFNULL(B.PK_YN,'N') 	AS A_PK_YN 
	              , B.DATA_TYPE				AS A_DATA_TYPE
	              , B.DATA_LEN				AS A_DATA_LEN
	              , B.DATA_SCAL				AS A_DATA_SCAL
	              , IFNULL(B.NONUL_YN,'N')  AS A_NONUL_YN 
	              , B.DEFLT_VAL				AS A_DEFLT_VAL
	           FROM WAM_PDM_TBL A
	                INNER JOIN WAM_PDM_COL B
	                   ON B.PDM_TBL_ID = A.PDM_TBL_ID
	                INNER JOIN WAA_SUBJ C
	                   ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND C.SUBJ_ID = A.SUBJ_ID   
	                INNER JOIN WAA_SUBJ_DB_SCH_MAP D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND D.SUBJ_ID = C.SUBJ_ID	               
	          WHERE 1 = 1
	            AND D.DB_SCH_ID  = #{dbSchId, jdbcType=VARCHAR}        
                AND A.PDM_TBL_ID = #{pdmTblId, jdbcType=VARCHAR}                            	           
	        ) A
	  LEFT OUTER JOIN 
	       (
	        SELECT A.DB_SCH_ID		AS B_DB_SCH_ID
                 , ''               AS B_FULL_PATH
                 , ''               AS B_SUBJ_ID
                 , A.DDL_TBL_PNM    AS B_PDM_TBL_PNM
                 , A.DDL_TBL_LNM    AS B_PDM_TBL_LNM                                 
                 , B.DDL_COL_PNM    AS B_PDM_COL_PNM
                 , B.DDL_COL_LNM    AS B_PDM_COL_LNM		             
                 , B.COL_ORD		AS B_COL_ORD
                 , B.PK_YN			AS B_PK_YN
                 , B.DATA_TYPE      AS B_DATA_TYPE  
                 , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS B_DATA_LEN
                 , B.DATA_SCAL 		AS B_DATA_SCAL
                 , B.NONUL_YN		AS B_NONUL_YN
                 , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS B_DEFLT_VAL
              FROM WAM_DDL_TBL A
                   INNER JOIN WAM_DDL_COL B
                      ON B.DDL_TBL_ID  = A.DDL_TBL_ID                         
             WHERE 1 = 1		                                       
               AND A.DB_SCH_ID   = #{dbSchId, jdbcType=VARCHAR}                           
               AND A.DDL_TBL_PNM = #{ddlTblPnm, jdbcType=VARCHAR}  
	       ) B                
	        ON 1 = 1
           AND A_DB_SCH_ID   = B_DB_SCH_ID 
           AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
           AND IFNULL(A_PDM_COL_PNM,'_') = IFNULL(B_PDM_COL_PNM,'_')  
		)
UNION
		SELECT * FROM (
			(
			SELECT  A.FULL_PATH	 			AS A_FULL_PATH
                  , D.DB_SCH_ID				AS A_DB_SCH_ID
	              , A.PDM_TBL_PNM			AS A_PDM_TBL_PNM
	              , A.PDM_TBL_LNM			AS A_PDM_TBL_LNM
	              , B.PDM_COL_PNM			AS A_PDM_COL_PNM
	              , B.PDM_COL_LNM           AS A_PDM_COL_LNM
	              , B.COL_ORD				AS A_COL_ORD
	              , IFNULL(B.PK_YN,'N') 	AS A_PK_YN 
	              , B.DATA_TYPE				AS A_DATA_TYPE
	              , B.DATA_LEN				AS A_DATA_LEN
	              , B.DATA_SCAL				AS A_DATA_SCAL
	              , IFNULL(B.NONUL_YN,'N')  AS A_NONUL_YN 
	              , B.DEFLT_VAL				AS A_DEFLT_VAL
	           FROM WAM_PDM_TBL A
	                INNER JOIN WAM_PDM_COL B
	                   ON B.PDM_TBL_ID = A.PDM_TBL_ID
	                INNER JOIN WAA_SUBJ C
	                   ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND C.SUBJ_ID = A.SUBJ_ID   
	                INNER JOIN WAA_SUBJ_DB_SCH_MAP D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND D.SUBJ_ID = C.SUBJ_ID	               
	          WHERE 1 = 1
	            AND D.DB_SCH_ID  = #{dbSchId, jdbcType=VARCHAR}        
                AND A.PDM_TBL_ID = #{pdmTblId, jdbcType=VARCHAR}                            	           
	        ) A
	  RIGHT OUTER JOIN 
	       (
	        SELECT A.DB_SCH_ID		AS B_DB_SCH_ID
                 , ''               AS B_FULL_PATH
                 , ''               AS B_SUBJ_ID
                 , A.DDL_TBL_PNM    AS B_PDM_TBL_PNM
                 , A.DDL_TBL_LNM    AS B_PDM_TBL_LNM                                 
                 , B.DDL_COL_PNM    AS B_PDM_COL_PNM
                 , B.DDL_COL_LNM    AS B_PDM_COL_LNM		             
                 , B.COL_ORD		AS B_COL_ORD
                 , B.PK_YN			AS B_PK_YN
                 , B.DATA_TYPE      AS B_DATA_TYPE  
                 , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS B_DATA_LEN
                 , B.DATA_SCAL 		AS B_DATA_SCAL
                 , B.NONUL_YN		AS B_NONUL_YN
                 , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS B_DEFLT_VAL
              FROM WAM_DDL_TBL A
                   INNER JOIN WAM_DDL_COL B
                      ON B.DDL_TBL_ID  = A.DDL_TBL_ID                         
             WHERE 1 = 1		                                       
               AND A.DB_SCH_ID   = #{dbSchId, jdbcType=VARCHAR}                           
               AND A.DDL_TBL_PNM = #{ddlTblPnm, jdbcType=VARCHAR}  
	       ) B                
	        ON 1 = 1
           AND A_DB_SCH_ID   = B_DB_SCH_ID 
           AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
           AND IFNULL(A_PDM_COL_PNM,'_') = IFNULL(B_PDM_COL_PNM,'_')  	   
		)   
		
	 ) FSQ
	 WHERE 1 = 1  
	 ORDER BY IFNULL(A_FULL_PATH, B_FULL_PATH) 
	        , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM) 
	        , IFNULL(A_COL_ORD, B_COL_ORD)
	        	      
</select>



<resultMap id="MdlDevDbGapMap" type="kr.wise.meta.gap.service.ModelGapVO">

    <result column="GAP_STATUS"  property="gapStatus" jdbcType="VARCHAR" />
	<result column="PDM_TBL_CNT" property="pdmTblCnt" jdbcType="VARCHAR" />
    <result column="GAP_CNT"     property="gapCnt"    jdbcType="VARCHAR" />
    <result column="COL_GAP_CNT" property="colGapCnt" jdbcType="VARCHAR" />
    <result column="NML_CNT"     property="nmlCnt"    jdbcType="VARCHAR" />
    <result column="PDM_COL_CNT" property="pdmColCnt" jdbcType="VARCHAR" />
    <result column="DBC_COL_CNT" property="dbcColCnt" jdbcType="VARCHAR" />
    <result column="APRV_DTM"    property="aprvDtm"   jdbcType="VARCHAR" />
      
    <result column="FULL_PATH"       property="fullPath"      jdbcType="VARCHAR" />
    <result column="DB_SCH_ID"       property="dbSchId"       jdbcType="VARCHAR" />
    <result column="PDM_TBL_ID"      property="pdmTblId"      jdbcType="VARCHAR" />
    <result column="PDM_TBL_PNM"     property="pdmTblPnm"     jdbcType="VARCHAR" />
    <result column="PDM_TBL_LNM"     property="pdmTblLnm"     jdbcType="VARCHAR" />   
    <result column="PDM_COL_PNM"     property="pdmColPnm"     jdbcType="VARCHAR" />
    <result column="PDM_COL_LNM"     property="pdmColLnm"     jdbcType="VARCHAR" />
    <result column="PDM_COL_SPNM"    property="pdmColSpnm"    jdbcType="VARCHAR" />
    <result column="PDM_COL_ORD"     property="pdmColOrd"     jdbcType="VARCHAR" />
    <result column="PDM_PK_YN"       property="pdmPkYn"       jdbcType="VARCHAR" />
    <result column="PDM_DATA_TYPE"   property="pdmDataType"   jdbcType="VARCHAR" />
    <result column="PDM_DATA_LEN"    property="pdmDataLen"    jdbcType="VARCHAR" />
    <result column="PDM_DATA_SCAL"   property="pdmDataScal"   jdbcType="VARCHAR" />
    <result column="PDM_NONUL_YN"    property="pdmNonulYn"    jdbcType="VARCHAR" />
    <result column="PDM_DEFLT_VAL"   property="pdmDefltVal"   jdbcType="VARCHAR" />
    
    <result column="DBC_COL_PNM"     property="dbcColPnm"     jdbcType="VARCHAR" />
    <result column="DBC_COL_LNM"     property="dbcColLnm"     jdbcType="VARCHAR" />
    <result column="DBC_COL_ORD"     property="dbcColOrd"     jdbcType="VARCHAR" />
    <result column="DBC_PK_YN"       property="dbcPkYn"       jdbcType="VARCHAR" />
    <result column="DBC_DATA_TYPE"   property="dbcDataType"   jdbcType="VARCHAR" />
    <result column="DBC_DATA_LEN"    property="dbcDataLen"    jdbcType="VARCHAR" />
    <result column="DBC_DATA_SCAL"   property="dbcDataScal"   jdbcType="VARCHAR" />
    <result column="DBC_NONUL_YN"    property="dbcNonulYn"    jdbcType="VARCHAR" />
    <result column="DBC_DEFLT_VAL"   property="dbcDefltVal"   jdbcType="VARCHAR" />
</resultMap>


<select id="selectMdlDevDbTblGapList" resultMap="MdlDevDbGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	SELECT FULL_PATH	
	     , SUBJ_ID    
	     , PDM_TBL_ID
	     , DB_SCH_ID
         , TBL_NM      AS PDM_TBL_PNM          
         , IFNULL(PDM_TBL_LNM, DBC_TBL_KOR_NM) AS PDM_TBL_LNM        
         , GAP_STATUS     
         , COL_GAP_CNT   
         , PDM_COL_CNT        
         , DBC_COL_CNT   
         , APRV_DTM     
      FROM (
        SELECT MAX(A_FULL_PATH)                  AS FULL_PATH
             , MAX(A_SUBJ_ID)                    AS SUBJ_ID
             , IFNULL(A_DB_SCH_ID, B_DB_SCH_ID)     AS DB_SCH_ID		   
             , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM) AS TBL_NM
             , MAX(A_APRV_DTM)                   AS APRV_DTM
             , CASE WHEN MAX(B_PDM_TBL_PNM)  IS NULL THEN 'NTGT'  -- 개발DB 테이블미존재 
                    WHEN MAX(A_PDM_TBL_PNM)  IS NULL THEN 'NPDM'                -- '메타테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(A_PDM_COL_LNM,'_') != IFNULL(B_PDM_COL_LNM,'_')
                                         OR A_DATA_TYPE != B_DATA_TYPE
                                         OR IFNULL(A_DATA_LEN, 0)   != IFNULL(B_DATA_LEN, 0)
                                         OR IFNULL(A_DATA_SCAL,0)   != IFNULL(B_DATA_SCAL,0)
                                         OR A_COL_ORD            != B_COL_ORD
                                         OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                         OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                         OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(A_PDM_COL_LNM,'_') != IFNULL(B_PDM_COL_LNM,'_')  
                                 OR A_DATA_TYPE != B_DATA_TYPE
                                 OR A_DATA_LEN  != B_DATA_LEN
                                 OR A_DATA_SCAL != B_DATA_SCAL
                                 OR A_COL_ORD   != B_COL_ORD
                                 OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                 OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                 OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(A_PDM_TBL_PNM)  AS PDM_COL_CNT        
             , COUNT(B_PDM_TBL_PNM)  AS DBC_COL_CNT
             , MAX(B_PDM_TBL_PNM)    AS DBC_TBL_NM
             , MAX(B_PDM_TBL_LNM)    AS DBC_TBL_KOR_NM
             , MAX(B_PDM_COL_PNM)    AS DBC_COL_NM
             , MAX(B_PDM_COL_LNM)    AS DBC_COL_KOR_NM
             , MAX(B_COL_ORD)        AS ORD
             , MAX(B_DATA_TYPE)      AS DATA_TYPE
             , MAX(B_DATA_LEN)       AS DATA_LEN
             , MAX(B_DATA_SCAL)      AS DATA_SCAL
             , MAX(A_PDM_TBL_ID)     AS PDM_TBL_ID
             , MAX(A_PDM_TBL_PNM)    AS PDM_TBL_PNM
             , MAX(A_PDM_TBL_LNM)    AS PDM_TBL_LNM
             , MAX(A_PDM_COL_PNM)    AS PDM_COL_PNM
             , MAX(A_PDM_COL_LNM)    AS PDM_COL_LNM         
          FROM (

		    SELECT * FROM (
				(
				SELECT  D.DB_SCH_ID AS A_DB_SCH_ID
                      , A.FULL_PATH AS A_FULL_PATH
                      , A.SUBJ_ID AS A_SUBJ_ID
                      , A.PDM_TBL_ID AS A_PDM_TBL_ID
                      , A.PDM_TBL_PNM AS A_PDM_TBL_PNM
                      , A.PDM_TBL_LNM AS A_PDM_TBL_LNM
                      , A.APRV_DTM AS A_APRV_DTM
                      , B.PDM_COL_PNM AS A_PDM_COL_PNM
                      , B.PDM_COL_LNM AS A_PDM_COL_LNM
                      , B.COL_ORD AS A_COL_ORD
                      , B.PK_YN AS A_PK_YN
                      , B.DATA_TYPE AS A_DATA_TYPE
                      , B.DATA_LEN AS A_DATA_LEN
                      , B.DATA_SCAL	AS A_DATA_SCAL
                      , B.NONUL_YN AS A_NONUL_YN
                      , B.DEFLT_VAL AS A_DEFLT_VAL
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID                             
                        INNER JOIN WAA_SUBJ_DB_SCH_MAP D
                           ON D.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
                          AND D.SUBJ_ID = C.SUBJ_ID
                  WHERE 1 = 1
                    AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                    
                    <if test="subjId != null">
				   	   AND A.SUBJ_ID LIKE CONCAT(#{subjId, jdbcType=VARCHAR} , '%')
				    </if>   		 
                        
                ) A
          LEFT OUTER JOIN 
               (
                SELECT A.DB_SCH_ID AS B_DB_SCH_ID
                     , ''               AS B_FULL_PATH
                     , ''               AS B_SUBJ_ID
                     , A.DBC_TBL_NM     AS B_PDM_TBL_PNM
                     , A.DBC_TBL_KOR_NM AS B_PDM_TBL_LNM                                 
                     , B.DBC_COL_NM     AS B_PDM_COL_PNM
                     , B.DBC_COL_KOR_NM AS B_PDM_COL_LNM		             
                     , B.ORD            AS B_COL_ORD
                     , B.PK_YN          AS B_PK_YN
                     , B.DATA_TYPE      AS B_DATA_TYPE  
                     , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS B_DATA_LEN
                     , B.DATA_PNT  AS B_DATA_SCAL 
                     , (CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) AS B_NONUL_YN
                     , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS B_DEFLT_VAL
                  FROM WAT_DBC_TBL A
                       INNER JOIN WAT_DBC_COL B
                          ON B.DB_SCH_ID  = A.DB_SCH_ID
                         AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                 WHERE 1 = 1		                    
<!--                    AND SUBSTR(A.DBC_TBL_NM,1,3) = 'PTB'   -->
                   AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}                   
                ) B                
                ON 1 = 1
               AND A_DB_SCH_ID   = B_DB_SCH_ID 
               AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
               AND A_PDM_COL_PNM = B_PDM_COL_PNM 
			)      
UNION
		    SELECT * FROM (
				(
				SELECT  D.DB_SCH_ID AS A_DB_SCH_ID
                      , A.FULL_PATH AS A_FULL_PATH
                      , A.SUBJ_ID AS A_SUBJ_ID
                      , A.PDM_TBL_ID AS A_PDM_TBL_ID
                      , A.PDM_TBL_PNM AS A_PDM_TBL_PNM
                      , A.PDM_TBL_LNM AS A_PDM_TBL_LNM
                      , A.APRV_DTM AS A_APRV_DTM
                      , B.PDM_COL_PNM AS A_PDM_COL_PNM
                      , B.PDM_COL_LNM AS A_PDM_COL_LNM
                      , B.COL_ORD AS A_COL_ORD
                      , B.PK_YN AS A_PK_YN
                      , B.DATA_TYPE AS A_DATA_TYPE
                      , B.DATA_LEN AS A_DATA_LEN
                      , B.DATA_SCAL	AS A_DATA_SCAL
                      , B.NONUL_YN AS A_NONUL_YN
                      , B.DEFLT_VAL AS A_DEFLT_VAL
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID                             
                        INNER JOIN WAA_SUBJ_DB_SCH_MAP D
                           ON D.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
                          AND D.SUBJ_ID = C.SUBJ_ID
                  WHERE 1 = 1
                    AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                    
                    <if test="subjId != null">
				   	   AND A.SUBJ_ID LIKE CONCAT(#{subjId, jdbcType=VARCHAR} , '%')
				    </if>   		 
                        
                ) A
          RIGHT OUTER JOIN 
               (
                SELECT A.DB_SCH_ID AS B_DB_SCH_ID
                     , ''               AS B_FULL_PATH
                     , ''               AS B_SUBJ_ID
                     , A.DBC_TBL_NM     AS B_PDM_TBL_PNM
                     , A.DBC_TBL_KOR_NM AS B_PDM_TBL_LNM                                 
                     , B.DBC_COL_NM     AS B_PDM_COL_PNM
                     , B.DBC_COL_KOR_NM AS B_PDM_COL_LNM		             
                     , B.ORD            AS B_COL_ORD
                     , B.PK_YN          AS B_PK_YN
                     , B.DATA_TYPE      AS B_DATA_TYPE  
                     , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS B_DATA_LEN
                     , B.DATA_PNT  AS B_DATA_SCAL 
                     , (CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) AS B_NONUL_YN
                     , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS B_DEFLT_VAL
                  FROM WAT_DBC_TBL A
                       INNER JOIN WAT_DBC_COL B
                          ON B.DB_SCH_ID  = A.DB_SCH_ID
                         AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                 WHERE 1 = 1		                    
<!--                    AND SUBSTR(A.DBC_TBL_NM,1,3) = 'PTB'   -->
                   AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}                   
                ) B                
                ON 1 = 1
               AND A_DB_SCH_ID   = B_DB_SCH_ID 
               AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
               AND A_PDM_COL_PNM = B_PDM_COL_PNM 
			)   		   
		   
		 ) FSQ   
         WHERE 1 = 1  
         GROUP BY IFNULL(A_DB_SCH_ID, B_DB_SCH_ID)
                , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM) 
       ) X
    WHERE 1 = 1                  
      <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     
	  <if test="subjId != null">
	   	   AND X.SUBJ_ID LIKE CONCAT(#{subjId, jdbcType=VARCHAR} , '%')
	  </if>   		
	  <if test="pdmTblPnm != null">
	   	   AND X.PDM_TBL_PNM LIKE CONCAT(#{pdmTblPnm, jdbcType=VARCHAR} , '%')
	  </if>   		                 
    ORDER BY TBL_NM  
	
</select>


<!-- 위의 selectMdlDevDbTblGap BAKUP 쿼리를 오라클 버전으로 바꾸기 전 원본  -->
<select id="selectMdlDevDbTblGapList_BAKUP" resultMap="MdlDevDbGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	SELECT 
			FULL_PATH	
	     , SUBJ_ID
	     , SYS_AREA_ID    
	     , PDM_TBL_ID
	     , DB_SCH_ID
         , TBL_NM      AS PDM_TBL_PNM          
         , IFNULL(PDM_TBL_LNM, DBC_TBL_LNM) AS PDM_TBL_LNM        
         , GAP_STATUS     
         , COL_GAP_CNT   
         , PDM_COL_CNT        
         , DBC_COL_CNT   
         , APRV_DTM    
         , STND_ASRT 
      FROM (
      
        SELECT IFNULL(PDM_FULL_PATH, DBC_FULL_PATH)   AS FULL_PATH
             , IFNULL(PDM_SUBJ_ID, DBC_SUBJ_ID)        AS SUBJ_ID
             , IFNULL(PDM_SYS_AREA_ID, DBC_SYS_AREA_ID)        AS SYS_AREA_ID
             , IFNULL(PDM_DB_SCH_ID, DBC_DB_SCH_ID)     AS DB_SCH_ID		   
             , IFNULL(PDM_TBL_PNM, DBC_TBL_PNM) 		AS TBL_NM
             , IFNULL(PDM_APRV_DTM, DBC_APRV_DTM)       AS APRV_DTM
             , CASE WHEN MAX(DBC_TBL_ID)  IS NULL THEN 'NTGT'                -- 개발DBC 테이블미존재 
                    WHEN MAX(PDM_TBL_ID)  IS NULL THEN 'NPDM'                -- '메타테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(PDM_COL_LNM,'_') != IFNULL(DBC_COL_LNM,'_')
                                         OR PDM_DATA_TYPE != DBC_DATA_TYPE
                                         OR (IFNULL(PDM_DATA_LEN, 0)   != IFNULL(DBC_DATA_LEN, 0)
                                             AND IFNULL(PDM_DATA_LEN, 0)   != IFNULL(DATA_PNUM, 0))
                                         OR IFNULL(PDM_DATA_SCAL,0)   != IFNULL(DBC_DATA_SCAL,0)
                                         OR PDM_COL_ORD            != DBC_COL_ORD
                                         OR IFNULL(PDM_NONUL_YN,'N')  != IFNULL(DBC_NONUL_YN,'N')
                                         OR IFNULL(PDM_DEFLT_VAL,'') != IFNULL(DBC_DEFLT_VAL,'')
                                         OR IFNULL(PDM_PK_YN,'N')     != IFNULL(DBC_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(PDM_COL_LNM,'_') != IFNULL(DBC_COL_LNM,'_')  
                                 OR PDM_DATA_TYPE != DBC_DATA_TYPE
                                 OR (PDM_DATA_LEN  != DBC_DATA_LEN AND PDM_DATA_LEN != DATA_PNUM)
                                 OR IFNULL(PDM_DATA_SCAL,0) != IFNULL(DBC_DATA_SCAL,0)
                                 OR PDM_COL_ORD   != DBC_COL_ORD
                                 OR IFNULL(PDM_NONUL_YN,'N')  != IFNULL(DBC_NONUL_YN,'N')
                                 OR IFNULL(PDM_DEFLT_VAL,'') != IFNULL(DBC_DEFLT_VAL,'')
                                 OR IFNULL(PDM_PK_YN,'N')     != IFNULL(DBC_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(PDM_TBL_LNM)  AS PDM_COL_CNT        
             , COUNT(DBC_TBL_LNM)  AS DBC_COL_CNT
             
             , MAX(PDM_TBL_ID)     AS PDM_TBL_ID
             , MAX(PDM_TBL_PNM)    AS PDM_TBL_PNM
             , MAX(PDM_TBL_LNM)    AS PDM_TBL_LNM
             , MAX(PDM_COL_PNM)    AS PDM_COL_PNM
             , MAX(PDM_COL_LNM)    AS PDM_COL_LNM
             
             , MAX(DBC_TBL_PNM)    AS DBC_TBL_PNM
             , MAX(DBC_TBL_LNM)    AS DBC_TBL_LNM
             , MAX(DBC_COL_PNM)    AS DBC_COL_PNM
             , MAX(DBC_COL_LNM)    AS DBC_COL_LNM
             , STND_ASRT          
          FROM (
          
          select   A.FULL_PATH 	   AS PDM_FULL_PATH
	             , A.SUBJ_ID       AS PDM_SUBJ_ID
	             , A.SYS_AREA_ID  AS PDM_SYS_AREA_ID
	             , A.DB_SCH_ID     AS PDM_DB_SCH_ID
	             , A.PDM_TBL_PNM   AS PDM_TBL_PNM
	             , A.PDM_TBL_LNM   AS PDM_TBL_LNM
	             , A.PDM_TBL_ID    AS PDM_TBL_ID
	             , A.APRV_DTM      AS PDM_APRV_DTM
	             , A.PDM_COL_PNM   AS PDM_COL_PNM
	             , A.PDM_COL_LNM   AS PDM_COL_LNM
	             , A.COL_ORD as PDM_COL_ORD
		          , A.PK_YN as PDM_PK_YN
		          , A.DATA_TYPE as PDM_DATA_TYPE
		          , A.DATA_LEN as PDM_DATA_LEN
		          , A.DATA_SCAL	as PDM_DATA_SCAL
		          , A.NONUL_YN as PDM_NONUL_YN
		          , A.DEFLT_VAL as PDM_DEFLT_VAL
	             
		         , B.FULL_PATH 	   AS DBC_FULL_PATH
	             , B.SUBJ_ID           AS DBC_SUBJ_ID
	             , B.SYS_AREA_ID    AS DBC_SYS_AREA_ID
	             , B.DB_SCH_ID       AS DBC_DB_SCH_ID		   
	             , B.DBC_TBL_PNM   AS DBC_TBL_PNM
	             , B.DBC_TBL_LNM   AS DBC_TBL_LNM
	             , B.DBC_TBL_ID    AS DBC_TBL_ID
	             , B.APRV_DTM      AS DBC_APRV_DTM
	             , B.DBC_COL_PNM   AS DBC_COL_PNM
	             , B.DBC_COL_LNM   AS DBC_COL_LNM
	             , B.COL_ORD as DBC_COL_ORD
		          , B.PK_YN as DBC_PK_YN
		          , B.DATA_TYPE as DBC_DATA_TYPE
		          , B.DATA_LEN as DBC_DATA_LEN
		          , B.DATA_SCAL	as DBC_DATA_SCAL
		          , B.NONUL_YN as DBC_NONUL_YN
		          , B.DEFLT_VAL as DBC_DEFLT_VAL
                  , IFNULL(A.STND_ASRT, B.STND_ASRT)   AS STND_ASRT
                  , B.DATA_PNUM
          		 from (
          		SELECT  D.DB_SCH_ID   
                      , A.FULL_PATH
                      , A.SUBJ_ID
                      , E.SYS_AREA_ID
                      , A.PDM_TBL_ID                   
                      , A.PDM_TBL_PNM
                      , A.PDM_TBL_LNM
                      , A.APRV_DTM 
                      , B.PDM_COL_PNM
                      , B.PDM_COL_LNM              
                      , B.COL_ORD
                      , B.PK_YN
                      , B.DATA_TYPE
                      , B.DATA_LEN
                      , B.DATA_SCAL	
                      , B.NONUL_YN
                      , B.DEFLT_VAL   
                      , A.STND_ASRT                   
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                          AND B.STND_ASRT = A.STND_ASRT
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID
                          AND C.STND_ASRT = A.STND_ASRT                             
                        INNER JOIN WAA_SUBJ_DB_SCH_MAP D
                           ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND D.SUBJ_ID = C.SUBJ_ID
                          AND C.STND_ASRT = D.STND_ASRT
                        LEFT JOIN WAA_SYS_AREA E
                          ON E.STND_ASRT = C.STND_ASRT
                         AND E.SYS_AREA_ID = C.SYS_AREA_ID 
                         AND E.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
                         AND E.REG_TYP_CD IN ('C','U')                          
                  WHERE A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}
                    AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                    
                ) A
               inner JOIN 
               (
                SELECT A.DB_SCH_ID	
                     , ''             AS FULL_PATH
                     , ''               AS SUBJ_ID
                     , ''               AS SYS_AREA_ID
                     , A.DBC_TBL_NM		as DBC_TBL_ID
                     , A.DBC_TBL_NM    AS DBC_TBL_PNM
                     , A.DBC_TBL_KOR_NM    AS DBC_TBL_LNM                                 
                     , B.DBC_COL_NM    AS DBC_COL_PNM
                     , B.DBC_COL_KOR_NM    AS DBC_COL_LNM		             
                     , B.ORD as COL_ORD
                     , B.PK_YN
                     , B.DATA_TYPE      AS DATA_TYPE  
                     , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS DATA_LEN
                     , B.DATA_PNUM
                     , B.DATA_PNT as DATA_SCAL 
                     , (CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) AS NONUL_YN
                     , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS DEFLT_VAL
                     , A.REG_DTM as APRV_DTM
                     , A.STND_ASRT
                  FROM WAT_DBC_TBL A
                       INNER JOIN WAT_DBC_COL B
                          ON B.DB_SCH_ID  = A.DB_SCH_ID
                         AND B.DBC_TBL_NM = A.DBC_TBL_NM   
                         AND B.STND_ASRT = A.STND_ASRT                    
                 WHERE A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}		                                       
                   AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}    
                ) B                
<!--                 ON 1 = 1 -->
                ON A.STND_ASRT = B.STND_ASRT 
               AND A.DB_SCH_ID   = B.DB_SCH_ID 
               AND A.PDM_TBL_PNM = B.DBC_TBL_PNM
               AND IFNULL(A.PDM_COL_PNM,'_') = IFNULL(B.DBC_COL_PNM,'_')  
<!--          WHERE 1 = 1   -->
         union
         
         SELECT    A.FULL_PATH 	   AS PDM_FULL_PATH
	             , A.SUBJ_ID       AS PDM_SUBJ_ID
	             , E.SYS_AREA_ID AS PDM_SYS_AREA_ID
	             , D.DB_SCH_ID     AS PDM_DB_SCH_ID		   
	             , A.PDM_TBL_PNM   AS PDM_TBL_PNM
	             , A.PDM_TBL_LNM   AS PDM_TBL_LNM
	             , A.PDM_TBL_ID    AS PDM_TBL_ID
	             , A.APRV_DTM      AS PDM_APRV_DTM
	             , B.PDM_COL_PNM   AS PDM_COL_PNM
	             , B.PDM_COL_LNM   AS PDM_COL_LNM
	             , B.COL_ORD as PDM_COL_ORD
		          , B.PK_YN as PDM_PK_YN
		          , B.DATA_TYPE as PDM_DATA_TYPE
		          , B.DATA_LEN as PDM_DATA_LEN
		          , B.DATA_SCAL	as PDM_DATA_SCAL
		          , B.NONUL_YN as PDM_NONUL_YN
		          , B.DEFLT_VAL as PDM_DEFLT_VAL
	             
		         , NULL 	   AS DBC_FULL_PATH
	             , NULL       AS DBC_SUBJ_ID
	             , NULL      AS DBC_SYS_AREA_ID
	             , NULL     AS DBC_DB_SCH_ID
	             , NULL   AS DBC_TBL_PNM
	             , NULL   AS DBC_TBL_LNM
	             , NULL    AS DBC_TBL_ID
	             , NULL      AS DBC_APRV_DTM
	             , NULL   AS DBC_COL_PNM
	             , NULL   AS DBC_COL_LNM
	             , NULL as DBC_COL_ORD
		          , NULL as DBC_PK_YN
		          , NULL as DBC_DATA_TYPE
		          , NULL as DBC_DATA_LEN
		          , null as DBC_DATA_SCAL
		          , NULL as DBC_NONUL_YN
		          , NULL as DBC_DEFLT_VAL
		          , A.STND_ASRT
		          , NULL AS DATA_PNUM
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                          AND B.STND_ASRT = A.STND_ASRT
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID
                          AND C.STND_ASRT = A.STND_ASRT                             
                        INNER JOIN WAA_SUBJ_DB_SCH_MAP D
                           ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND D.SUBJ_ID = C.SUBJ_ID
                          AND D.STND_ASRT = C.STND_ASRT
                         LEFT JOIN WAA_SYS_AREA E
                            ON E.STND_ASRT = C.STND_ASRT
                          AND E.SYS_AREA_ID = C.SYS_AREA_ID
                          AND E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND E.REG_TYP_CD IN ('C','U')   
                  WHERE A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}		           
                    AND D.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                    and not exists (select 1 from WAT_DBC_TBL A2
                    				 inner join WAT_DBC_COL B2
                    				    ON B2.DB_SCH_ID  = A2.DB_SCH_ID
                         				AND B2.DBC_TBL_NM = A2.DBC_TBL_NM
                         				AND B2.STND_ASRT = A2.STND_ASRT 
                    				 where A2.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                    				   and A2.DBC_TBL_NM = A.PDM_TBL_PNM
                    				   and B2.DBC_COL_NM = B.PDM_COL_PNM
                    				   AND A2.STND_ASRT = A.STND_ASRT
                    				)
         
         union
         
         SELECT    NULL 	   AS PDM_FULL_PATH
	             , NULL         AS PDM_SUBJ_ID
	             , NULL         AS PDM_SYS_AREA_ID
	             , NULL     AS PDM_DB_SCH_ID
	             , NULL   AS PDM_TBL_PNM
	             , NULL   AS PDM_TBL_LNM
	             , NULL    AS PDM_TBL_ID
	             , NULL      AS PDM_APRV_DTM
	             , NULL   AS PDM_COL_PNM
	             , NULL   AS PDM_COL_LNM
	             , NULL as PDM_COL_ORD
		          , NULL as PDM_PK_YN
		          , NULL as PDM_DATA_TYPE
		          , NULL as PDM_DATA_LEN
		          , NULL	as PDM_DATA_SCAL
		          , NULL as PDM_NONUL_YN
		          , NULL as PDM_DEFLT_VAL
	             
		         , NULL 	   AS DBC_FULL_PATH
	             , NULL       AS DDL_SUBJ_ID
	             , NULL       AS DDL_SYS_AREA_ID
	             , A.DB_SCH_ID     AS DBC_DB_SCH_ID		   
	             , A.DBC_TBL_NM   AS DBC_TBL_PNM
	             , A.DBC_TBL_KOR_NM   AS DBC_TBL_LNM
	             , A.DBC_TBL_NM    AS DBC_TBL_ID
	             , A.REG_DTM      AS DBC_APRV_DTM
	             , B.DBC_COL_NM   AS DBC_COL_PNM
	             , B.DBC_COL_KOR_NM   AS DBC_COL_LNM
	             , B.ORD as DBC_COL_ORD
		          , B.PK_YN as DBC_PK_YN
		          , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS DBC_DATA_LEN
		          , B.DATA_LEN as DBC_DATA_LEN
		          , B.DATA_PNT	as DBC_DATA_SCAL
		          , (CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) AS DBC_NONUL_YN
		          , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS DBC_DEFLT_VAL
		          , A.STND_ASRT
		          , B.DATA_PNUM
                  FROM WAT_DBC_TBL A
                       INNER JOIN WAT_DBC_COL B
                         ON B.DB_SCH_ID  = A.DB_SCH_ID
                         AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                         AND B.STND_ASRT = A.STND_ASRT                         
                 WHERE A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}		           	                                       
                   AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                   and not exists (select 1 from WAM_PDM_TBL A2
                    				 inner join WAM_PDM_COL B2
                    				    on A2.PDM_TBL_ID = B2.PDM_TBL_ID
                    				   AND A2.STND_ASRT = B2.STND_ASRT
                    				 INNER JOIN WAA_SUBJ C2
			                            ON C2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
			                           AND C2.SUBJ_ID = A2.SUBJ_ID
			                           AND C2.STND_ASRT = A2.STND_ASRT                             
			                         INNER JOIN WAA_SUBJ_DB_SCH_MAP D2
			                            ON D2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
			                           AND D2.SUBJ_ID = C2.SUBJ_ID
			                           AND D2.STND_ASRT = C2.STND_ASRT
					                 WHERE A2.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}		           
					                   AND D2.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
                    				   AND A2.STND_ASRT = A.STND_ASRT
                    				   and A2.PDM_TBL_PNM = A.DBC_TBL_NM
                    				   and B2.PDM_COL_PNM = B.DBC_COL_NM
                    				 
                    				)
         ) A
<!--          where 1=1 -->
         GROUP BY STND_ASRT 
                , IFNULL(PDM_DB_SCH_ID, DBC_DB_SCH_ID)
                , IFNULL(PDM_TBL_PNM, DBC_TBL_PNM) 
       ) X
<!--     WHERE 1 = 1 -->
      <where>
      <if test="stndAsrt != null">
	   	   AND X.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR}
	  </if>     
       <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     
	 <if test="sysAreaId != null and sysAreaId != '' " >
			AND X.STND_ASRT      = #{stndAsrt, jdbcType=VARCHAR}
		    AND X.SYS_AREA_ID = #{sysAreaId,jdbcType=VARCHAR}
      </if>
       
	  <choose>
	   		<when test='subjLvl == 1' >
	   			AND (X.STND_ASRT, X.SUBJ_ID) IN 
	   			          (SELECT STND_ASRT, SUBJ_ID
                                   FROM WAA_SUBJ
							WHERE REG_TYP_CD IN ('C', 'U')
							  AND LECY_DCD = 'SFG'
                    		  AND EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
                    		  <if test="subjId!=null">  
                    		  AND UPP_SUBJ_ID = #{subjId,jdbcType=VARCHAR}
                    		  </if>                           			
                                )
	   		</when>
	   		<when test='subjLvl == 2'>
	   		    AND X.STND_ASRT  = #{stndAsrt, jdbcType=VARCHAR}
	   			AND X.SUBJ_ID = #{subjId,jdbcType=VARCHAR}
	   		</when> 			   		
	  </choose>   		
	  <if test="pdmTblPnm != null">
	   	   AND X.TBL_NM LIKE CONCAT('%', #{pdmTblPnm, jdbcType=VARCHAR} ,'%')
	  </if>     
      </where>         
<!--     ORDER BY TBL_NM  -->
	
</select>

<select id="selectMdlDevDbColGapList" resultMap="MdlDevDbGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO"> 
			/* ModelGapMapper.selectMdlDevDbColGapList */
    SELECT IFNULL(A_FULL_PATH, B_FULL_PATH)       AS FULL_PATH	 	     
	     , CONCAT(  
			 CASE WHEN B_PDM_COL_PNM IS NULL                            THEN 'DB컬럼미존재' END
	      , CASE WHEN A_PDM_COL_PNM IS NULL                            THEN '메타컬럼미존재' END
	      , CASE WHEN IFNULL(A_PDM_COL_LNM,'_') != IFNULL(B_PDM_COL_LNM,'_') THEN '컬럼한글명불일치' END
	      , CASE WHEN IFNULL(A_PK_YN,'N') != IFNULL(B_PK_YN,'N')             THEN 'PK여부불일치' END
	      , CASE WHEN A_DATA_TYPE != B_DATA_TYPE                       THEN '데이터타입불일치' END
	      , CASE WHEN IFNULL(A_DATA_LEN,0)   != IFNULL(B_DATA_LEN,0)         THEN '데이터길이불일치' END 
	      , CASE WHEN IFNULL(A_DATA_SCAL,-1) != IFNULL(B_DATA_SCAL,-1)       THEN '소수점불일치' END
	      , CASE WHEN A_COL_ORD   != B_COL_ORD                         THEN '컬럼순서불일치' END
	      , CASE WHEN IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')      THEN 'NOT NULL여부불일치' END
	      , CASE WHEN IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')     THEN 'DEFAULT불일치' END   
		   ) AS GAP_STATUS   
	     , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM)     AS DBC_TBL_NM       
	     , A_PDM_TBL_LNM     AS PDM_TBL_NM   
	     , A_PDM_COL_PNM     AS PDM_COL_PNM
	     , A_PDM_COL_LNM     AS PDM_COL_LNM
	     , A_COL_ORD         AS PDM_COL_ORD
	     , A_PK_YN           AS PDM_PK_YN
	     , A_DATA_TYPE       AS PDM_DATA_TYPE
	     , A_DATA_LEN        AS PDM_DATA_LEN
	     , A_DATA_SCAL       AS PDM_DATA_SCAL
	     , A_NONUL_YN        AS PDM_NONUL_YN
	     , A_DEFLT_VAL       AS PDM_DEFLT_VAL         
	     , B_PDM_TBL_PNM     AS DBC_TBL_PNM
	     , B_PDM_COL_PNM     AS DBC_COL_PNM
	     , B_PDM_COL_LNM     AS DBC_COL_LNM         
	     , B_COL_ORD         AS DBC_COL_ORD
	     , B_PK_YN           AS DBC_PK_YN
	     , B_DATA_TYPE       AS DBC_DATA_TYPE
	     , B_DATA_LEN        AS DBC_DATA_LEN
	     , B_DATA_SCAL       AS DBC_DATA_SCAL
	     , B_NONUL_YN        AS DBC_NONUL_YN
	     , B_DEFLT_VAL       AS DBC_DEFLT_VAL         
	  FROM (
	  
		SELECT * FROM (
			(
			SELECT  A.FULL_PATH			AS A_FULL_PATH
                  , D.DB_SCH_ID			AS A_DB_SCH_ID
	              , A.PDM_TBL_PNM		AS A_PDM_TBL_PNM
	              , A.PDM_TBL_LNM		AS A_PDM_TBL_LNM
	              , B.PDM_COL_PNM		AS A_PDM_COL_PNM
	              , B.PDM_COL_LNM       AS A_PDM_COL_LNM
	              , B.COL_ORD			AS A_COL_ORD
	              , IFNULL(B.PK_YN,'N') AS A_PK_YN 
	              , B.DATA_TYPE			AS A_DATA_TYPE
	              , B.DATA_LEN			AS A_DATA_LEN
	              , B.DATA_SCAL			AS A_DATA_SCAL
	              , IFNULL(B.NONUL_YN,'N') AS A_NONUL_YN 
	              , B.DEFLT_VAL			AS A_DEFLT_VAL
	           FROM WAM_PDM_TBL A		
	                INNER JOIN WAM_PDM_COL B
	                   ON B.PDM_TBL_ID = A.PDM_TBL_ID
	                INNER JOIN WAA_SUBJ C
	                   ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND C.SUBJ_ID = A.SUBJ_ID   
	                INNER JOIN WAA_SUBJ_DB_SCH_MAP D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND D.SUBJ_ID = C.SUBJ_ID	               
	          WHERE 1 = 1
	            AND D.DB_SCH_ID  = #{dbSchId, jdbcType=VARCHAR}        
                AND A.PDM_TBL_ID = #{pdmTblId, jdbcType=VARCHAR}                            	           
	        ) A
	  LEFT OUTER JOIN 
	       (
	        SELECT A.DB_SCH_ID		AS B_DB_SCH_ID
                 , ''               AS B_FULL_PATH
                 , A.DBC_TBL_NM     AS B_PDM_TBL_PNM
                 , A.DBC_TBL_KOR_NM AS B_PDM_TBL_LNM                                 
                 , B.DBC_COL_NM     AS B_PDM_COL_PNM
                 , B.DBC_COL_KOR_NM AS B_PDM_COL_LNM		             
                 , B.ORD            AS B_COL_ORD
                 , B.PK_YN			AS B_PK_YN
                 , B.DATA_TYPE 		AS B_DATA_TYPE
                 , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS B_DATA_LEN
                 , (CASE WHEN B.DATA_PNT != 0 THEN B.DATA_PNT END)   AS B_DATA_SCAL 
                 , (CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) AS B_NONUL_YN
                 , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS B_DEFLT_VAL
              FROM WAT_DBC_TBL A
                   INNER JOIN WAT_DBC_COL B
                      ON B.DB_SCH_ID  = A.DB_SCH_ID
                     AND B.DBC_TBL_NM = A.DBC_TBL_NM 
             WHERE 1 = 1		                    
<!--                AND SUBSTR(A.DBC_TBL_NM,1,3) = 'PTB'     -->
               AND A.DB_SCH_ID  = #{dbSchId, jdbcType=VARCHAR}        
               AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}  
	       ) B                
	        ON 1 = 1
           AND A_DB_SCH_ID   = B_DB_SCH_ID 
           AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
           AND A_PDM_COL_PNM = B_PDM_COL_PNM 
		)   
UNION		   
		SELECT * FROM (
			(
			SELECT  A.FULL_PATH			AS A_FULL_PATH
                  , D.DB_SCH_ID			AS A_DB_SCH_ID
	              , A.PDM_TBL_PNM		AS A_PDM_TBL_PNM
	              , A.PDM_TBL_LNM		AS A_PDM_TBL_LNM
	              , B.PDM_COL_PNM		AS A_PDM_COL_PNM
	              , B.PDM_COL_LNM       AS A_PDM_COL_LNM
	              , B.COL_ORD			AS A_COL_ORD
	              , IFNULL(B.PK_YN,'N') AS A_PK_YN 
	              , B.DATA_TYPE			AS A_DATA_TYPE
	              , B.DATA_LEN			AS A_DATA_LEN
	              , B.DATA_SCAL			AS A_DATA_SCAL
	              , IFNULL(B.NONUL_YN,'N') AS A_NONUL_YN 
	              , B.DEFLT_VAL			AS A_DEFLT_VAL
	           FROM WAM_PDM_TBL A		
	                INNER JOIN WAM_PDM_COL B
	                   ON B.PDM_TBL_ID = A.PDM_TBL_ID
	                INNER JOIN WAA_SUBJ C
	                   ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND C.SUBJ_ID = A.SUBJ_ID   
	                INNER JOIN WAA_SUBJ_DB_SCH_MAP D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND D.SUBJ_ID = C.SUBJ_ID	               
	          WHERE 1 = 1
	            AND D.DB_SCH_ID  = #{dbSchId, jdbcType=VARCHAR}        
                AND A.PDM_TBL_ID = #{pdmTblId, jdbcType=VARCHAR}                            	           
	        ) A
	  RIGHT OUTER JOIN 
	       (
	        SELECT A.DB_SCH_ID		AS B_DB_SCH_ID
                 , ''               AS B_FULL_PATH
                 , A.DBC_TBL_NM     AS B_PDM_TBL_PNM
                 , A.DBC_TBL_KOR_NM AS B_PDM_TBL_LNM                                 
                 , B.DBC_COL_NM     AS B_PDM_COL_PNM
                 , B.DBC_COL_KOR_NM AS B_PDM_COL_LNM		             
                 , B.ORD            AS B_COL_ORD
                 , B.PK_YN			AS B_PK_YN
                 , B.DATA_TYPE 		AS B_DATA_TYPE
                 , (CASE WHEN B.DATA_TYPE NOT IN ('SDO_GEOMETRY','CLOB','BLOB') THEN B.DATA_LEN END) AS B_DATA_LEN
                 , (CASE WHEN B.DATA_PNT != 0 THEN B.DATA_PNT END)   AS B_DATA_SCAL 
                 , (CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) AS B_NONUL_YN
                 , REPLACE(REPLACE(B.DEFLT_VAL,CHAR(10),''),CHAR(13),'') AS B_DEFLT_VAL
              FROM WAT_DBC_TBL A
                   INNER JOIN WAT_DBC_COL B
                      ON B.DB_SCH_ID  = A.DB_SCH_ID
                     AND B.DBC_TBL_NM = A.DBC_TBL_NM 
             WHERE 1 = 1		                    
<!--                AND SUBSTR(A.DBC_TBL_NM,1,3) = 'PTB'     -->
               AND A.DB_SCH_ID  = #{dbSchId, jdbcType=VARCHAR}        
               AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}  
	       ) B                
	        ON 1 = 1
           AND A_DB_SCH_ID   = B_DB_SCH_ID 
           AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
           AND A_PDM_COL_PNM = B_PDM_COL_PNM 
		)   	   

	  ) FSQ	   
	 WHERE 1 = 1  
	 ORDER BY IFNULL(A_FULL_PATH, B_FULL_PATH) 
	        , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM) 
	        , IFNULL(A_COL_ORD, B_COL_ORD)
	        	    
</select>

<select id="selectNonStndPdmColGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
			/* ModelGapMapper.selectNonStndPdmColGapList */
	SELECT A.GAP_STATUS
	     , A.FULL_PATH
	     , A.PDM_TBL_PNM
	     , A.PDM_TBL_LNM
	     , A.PDM_COL_PNM
	     , A.PDM_COL_SPNM
	     , A.PDM_COL_LNM     
	     , A.PDM_DATA_TYPE
	     , A.PDM_DATA_LEN
	     , A.PDM_DATA_SCAL
	     , A.SDITM_LNM
	     , A.SDITM_PNM
	     , A.SDITM_DATA_TYPE
	     , A.SDITM_DATA_LEN
	     , A.SDITM_DATA_SCAL	     
	     , (SELECT MAX(APRV_DTM)
	          FROM ( 
	                SELECT X.SDITM_ID, X.APRV_DTM
	                  FROM WAM_SDITM X
	                 WHERE 1 = 1
	                 UNION ALL
	                SELECT X.SDITM_ID, Y.APRV_DTM
	                  FROM WAM_SDITM X
	                       INNER JOIN WAM_DMN Y
	                          ON X.DMN_ID = Y.DMN_ID
	                 WHERE 1 = 1
	               ) X  
	          WHERE X.SDITM_ID = A.SDITM_ID         
	       ) AS APRV_DTM 
	  FROM (	
			SELECT /*+ LEADING(D A) */  
			    TRIM(LEADING ',' FROM 
			    						CONCAT(
										    	 CASE WHEN C.SDITM_LNM IS NULL THEN '용어미존재' END
										        ,CASE WHEN TRIM(TRAILING '_0123456789' FROM B.PDM_COL_PNM) != IFNULL(C.SDITM_PNM,'_')THEN ',컬럼명불일치' END
										        ,CASE WHEN B.DATA_TYPE != C.DATA_TYPE THEN ',타입불일치' END
										        ,CASE WHEN B.DATA_LEN  != C.DATA_LEN  THEN ',길이불일치'  END
										        ,CASE WHEN coalesce(B.DATA_SCAL,0) != IFNULL(C.DATA_SCAL,0) THEN ',소수점불일치' END
			      							   )
			        )  AS GAP_STATUS
			     , A.FULL_PATH
			     , A.PDM_TBL_PNM
			     , A.PDM_TBL_LNM
			     , B.PDM_COL_PNM
			     , B.PDM_COL_LNM
			     , TRIM(TRAILING '_0123456789' FROM B.PDM_COL_PNM) AS PDM_COL_SPNM     
			     , B.DATA_TYPE    AS PDM_DATA_TYPE
			     , B.DATA_LEN     AS PDM_DATA_LEN
			     , B.DATA_SCAL    AS PDM_DATA_SCAL
			     , C.SDITM_LNM
			     , C.SDITM_PNM
			     , C.DATA_TYPE    AS SDITM_DATA_TYPE
			     , C.DATA_LEN     AS SDITM_DATA_LEN
			     , C.DATA_SCAL    AS SDITM_DATA_SCAL
			     , C.SDITM_ID
			  FROM WAM_PDM_TBL A
			       INNER JOIN WAM_PDM_COL B
			          	   ON B.PDM_TBL_ID = A.PDM_TBL_ID
			       LEFT JOIN V_CHECK_SDITM C
			              ON C.SDITM_LNM = TRIM(TRAILING '_0123456789' FROM B.PDM_COL_LNM) 
			       INNER JOIN WAA_SUBJ D
			         ON D.EXP_DTM = DATE_FORMAT('9999-12-31','%Y-%m-%d')
			        AND D.SUBJ_ID     = A.SUBJ_ID
			        AND D.DBMS_TYP_CD = C.DBMS_TYPE
			 WHERE 1 = 1   
			   AND C.DBMS_TYPE = #{dbmsTypCd, jdbcType=VARCHAR}
			   AND D.STD_APL_YN = 'Y'   -- 표준준수영역만
			   AND NOT (     TRIM(TRAILING '_0123456789' FROM B.PDM_COL_PNM) = IFNULL(C.SDITM_PNM,'_')
			             AND B.DATA_TYPE = C.DATA_TYPE
			             AND B.DATA_LEN  = C.DATA_LEN
			             AND IFNULL(B.DATA_SCAL,0) = IFNULL(C.DATA_SCAL,0)
			           )
	       ) A
	   WHERE 1 = 1
	   <if test="gapStatus != null">
	   	   AND A.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	   </if>     
	   <if test="subjLnm != null">
	   	   AND A.FULL_PATH LIKE #{subjLnm, jdbcType=VARCHAR} 
	   </if>   		
	   <if test="pdmTblLnm != null">
	   	   AND A.PDM_TBL_PNM LIKE CONCAT('%' , #{pdmTblLnm, jdbcType=VARCHAR} , '%' )
	   </if>   		           
	       
	 ORDER BY A.FULL_PATH
	     , A.PDM_TBL_PNM
	     , A.PDM_TBL_LNM
	     , A.PDM_COL_PNM
	     , A.PDM_COL_LNM
	    	                   
</select>



<resultMap id="MdlErwinGapMap" type="kr.wise.meta.gap.service.ModelGapVO">

    <result column="GAP_STATUS"  property="gapStatus" jdbcType="VARCHAR" />
	<result column="PDM_TBL_CNT" property="pdmTblCnt" jdbcType="VARCHAR" />
    <result column="GAP_CNT"     property="gapCnt"    jdbcType="VARCHAR" />
    <result column="COL_GAP_CNT" property="colGapCnt" jdbcType="VARCHAR" />
    <result column="NML_CNT"     property="nmlCnt"    jdbcType="VARCHAR" />
    <result column="PDM_COL_CNT" property="pdmColCnt" jdbcType="VARCHAR" />
    <result column="DBC_COL_CNT" property="dbcColCnt" jdbcType="VARCHAR" />
    <result column="APRV_DTM"    property="aprvDtm"   jdbcType="VARCHAR" />
      
    <result column="FULL_PATH"       property="fullPath"      jdbcType="VARCHAR" />
    <result column="DB_SCH_ID"       property="dbSchId"       jdbcType="VARCHAR" />
    <result column="PDM_TBL_ID"      property="pdmTblId"      jdbcType="VARCHAR" />
    <result column="PDM_TBL_PNM"     property="pdmTblPnm"     jdbcType="VARCHAR" />
    <result column="PDM_TBL_LNM"     property="pdmTblLnm"     jdbcType="VARCHAR" />   
    <result column="PDM_COL_PNM"     property="pdmColPnm"     jdbcType="VARCHAR" />
    <result column="PDM_COL_LNM"     property="pdmColLnm"     jdbcType="VARCHAR" />
    <result column="PDM_COL_SPNM"    property="pdmColSpnm"    jdbcType="VARCHAR" />
    <result column="PDM_COL_ORD"     property="pdmColOrd"     jdbcType="VARCHAR" />
    <result column="PDM_PK_YN"       property="pdmPkYn"       jdbcType="VARCHAR" />
    <result column="PDM_DATA_TYPE"   property="pdmDataType"   jdbcType="VARCHAR" />
    <result column="PDM_DATA_LEN"    property="pdmDataLen"    jdbcType="VARCHAR" />
    <result column="PDM_DATA_SCAL"   property="pdmDataScal"   jdbcType="VARCHAR" />
    <result column="PDM_NONUL_YN"    property="pdmNonulYn"    jdbcType="VARCHAR" />
    <result column="PDM_DEFLT_VAL"   property="pdmDefltVal"   jdbcType="VARCHAR" />
    
    <result column="ERWIN_COL_PNM"     property="erwinColPnm"     jdbcType="VARCHAR" />
    <result column="ERWIN_COL_LNM"     property="erwinColLnm"     jdbcType="VARCHAR" />
    <result column="ERWIN_COL_ORD"     property="erwinColOrd"     jdbcType="VARCHAR" />
    <result column="ERWIN_PK_YN"       property="erwinPkYn"       jdbcType="VARCHAR" />
    <result column="ERWIN_DATA_TYPE"   property="erwinDataType"   jdbcType="VARCHAR" />
    <result column="ERWIN_DATA_LEN"    property="erwinDataLen"    jdbcType="VARCHAR" />
    <result column="ERWIN_DATA_SCAL"   property="erwinDataScal"   jdbcType="VARCHAR" />
    <result column="ERWIN_NONUL_YN"    property="erwinNonulYn"    jdbcType="VARCHAR" />
    <result column="ERWIN_DEFLT_VAL"   property="erwinDefltVal"   jdbcType="VARCHAR" />
</resultMap>



<select id="selectErwinPdmTblGapList" resultMap="MdlErwinGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	SELECT 	/* ModelGapMapper.selectErwinPdmTblGapList */
		   FULL_PATH	    
	     , PDM_TBL_ID
         , TBL_NM      AS PDM_TBL_PNM          
         , IFNULL(PDM_TBL_LNM, ERWIN_TBL_KOR_NM) AS PDM_TBL_LNM        
         , GAP_STATUS     
         , COL_GAP_CNT   
         , PDM_COL_CNT        
         , ERWIN_COL_CNT   
         , APRV_DTM     
      FROM (
        SELECT IFNULL(B_FULL_PATH, A_FULL_PATH)     AS FULL_PATH		   
             , IFNULL(B_PDM_TBL_PNM, A_PDM_TBL_PNM) AS TBL_NM
             , MAX(B_APRV_DTM)                   AS APRV_DTM
             , CASE WHEN MAX(A_PDM_TBL_PNM)  IS NULL THEN 'NERW'  -- ER-WIN테이블미존재 
                    WHEN MAX(B_PDM_TBL_PNM)  IS NULL THEN 'NPDM'                -- '메타테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(A_PDM_COL_LNM,'_') != IFNULL(B_PDM_COL_LNM,'_')
                                         OR A_DATA_TYPE != B_DATA_TYPE
                                         OR A_DATA_LEN  != B_DATA_LEN
                                         OR IFNULL(A_DATA_SCAL,-1) != IFNULL(B_DATA_SCAL,-1)
                                         OR A_COL_ORD   != B_COL_ORD
                                         OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                         OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                         OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(A_PDM_COL_LNM,'_') != IFNULL(B_PDM_COL_LNM,'_')  
                                 OR A_DATA_TYPE != B_DATA_TYPE
                                 OR A_DATA_LEN  != B_DATA_LEN
                                 OR IFNULL(A_DATA_SCAL,-1) != IFNULL(B_DATA_SCAL,-1)
                                 OR A_COL_ORD   != B_COL_ORD
                                 OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                 OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                 OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(B_PDM_TBL_PNM)  AS PDM_COL_CNT        
             , COUNT(A_PDM_TBL_PNM)  AS ERWIN_COL_CNT
             , MAX(A_PDM_TBL_PNM)    AS ERWIN_TBL_NM
             , MAX(A_PDM_TBL_LNM)    AS ERWIN_TBL_KOR_NM
             , MAX(A_PDM_COL_PNM)    AS ERWIN_COL_NM
             , MAX(A_PDM_COL_LNM)    AS ERWIN_COL_KOR_NM
             , MAX(A_COL_ORD)        AS ORD
             , MAX(A_DATA_TYPE)      AS DATA_TYPE
             , MAX(A_DATA_LEN)       AS DATA_LEN
             , MAX(A_DATA_SCAL)      AS DATA_SCAL
             , MAX(B_PDM_TBL_ID)     AS PDM_TBL_ID
             , MAX(B_PDM_TBL_PNM)    AS PDM_TBL_PNM
             , MAX(B_PDM_TBL_LNM)    AS PDM_TBL_LNM
             , MAX(B_PDM_COL_PNM)    AS PDM_COL_PNM
             , MAX(B_PDM_COL_LNM)    AS PDM_COL_LNM         
          FROM (
		SELECT * FROM (  
		       (
		  SELECT  A.FULL_PATH AS B_FULL_PATH
                      , A.PDM_TBL_ID AS B_PDM_TBL_ID
                      , A.PDM_TBL_PNM AS B_PDM_TBL_PNM
                      , A.PDM_TBL_LNM AS B_PDM_TBL_LNM
                      , A.APRV_DTM AS B_APRV_DTM
                      , B.PDM_COL_PNM AS B_PDM_COL_PNM
                      , B.PDM_COL_LNM AS B_PDM_COL_LNM
                      , B.COL_ORD AS B_COL_ORD
                      , B.PK_YN AS B_PK_YN
                      , B.DATA_TYPE AS B_DATA_TYPE
                      , B.DATA_LEN AS B_DATA_LEN
                      , B.DATA_SCAL	AS B_DATA_SCAL
                      , B.NONUL_YN AS B_NONUL_YN
                      , B.DEFLT_VAL AS B_DEFLT_VAL
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID                           
                  WHERE A.FULL_PATH LIKE  CONCAT(#{fullPath, jdbcType=VARCHAR},'%')   
                        
                ) B
            LEFT OUTER JOIN 
               (
                SELECT CONCAT(MDL_LNM , '>' , UPP_SUBJ_LNM , '>' , SUBJ_LNM) AS A_FULL_PATH		             
                     , A.PDM_TBL_PNM AS A_PDM_TBL_PNM
                     , A.PDM_TBL_LNM AS A_PDM_TBL_LNM                  
                     , A.PDM_COL_PNM AS A_PDM_COL_PNM
                     , A.PDM_COL_LNM AS A_PDM_COL_LNM
                     , A.COL_ORD AS A_COL_ORD
                     , A.PK_YN AS A_PK_YN
<!--                      , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_TYPE') AS DATA_TYPE -->
<!--                      , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_LEN')  AS DATA_LEN -->
<!--                      , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_SCAL') AS DATA_SCAL  -->
                     , A.DATA_TYPE AS A_DATA_TYPE
                     , A.DATA_LEN AS A_DATA_LEN
                     , A.DATA_SCAL AS A_DATA_SCAL
                     , A.NONUL_YN AS A_NONUL_YN
                     , A.DEFLT_VAL AS A_DEFLT_VAL
                  FROM WAE_ERMART_R7_COL A
<!--                   FROM WAE_ERWIN_COL A -->
                 WHERE 1 = 1		 
<!--                    AND A.LIB_NM = #{sysAreaLnm, jdbcType=VARCHAR} -->
<!--                    AND SUBSTR(A.PDM_TBL_PNM,1,2) = 'TB'   -->
                   AND EXISTS (SELECT 1
                                 FROM WAA_SUBJ X
                                WHERE X.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                                  AND X.FULL_PATH   = CONCAT(MDL_LNM ,'>', UPP_SUBJ_LNM ,'>', SUBJ_LNM)
<!--                                   AND X.FULL_PATH   = LIB_NM ||'>'|| MDL_NM ||'>'|| SUBJ_NM -->
<!--                                   AND X.SUBJ_ABR_NM = SUBSTR(A.PDM_TBL_PNM,3,5)   -->
                              )
                          
                ) A                
                ON A_FULL_PATH   = B_FULL_PATH
               AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
               AND A_PDM_COL_PNM = B_PDM_COL_PNM 
			)
UNION
		SELECT * FROM (  
		       (
		  SELECT  A.FULL_PATH AS B_FULL_PATH
                      , A.PDM_TBL_ID AS B_PDM_TBL_ID
                      , A.PDM_TBL_PNM AS B_PDM_TBL_PNM
                      , A.PDM_TBL_LNM AS B_PDM_TBL_LNM
                      , A.APRV_DTM AS B_APRV_DTM
                      , B.PDM_COL_PNM AS B_PDM_COL_PNM
                      , B.PDM_COL_LNM AS B_PDM_COL_LNM
                      , B.COL_ORD AS B_COL_ORD
                      , B.PK_YN AS B_PK_YN
                      , B.DATA_TYPE AS B_DATA_TYPE
                      , B.DATA_LEN AS B_DATA_LEN
                      , B.DATA_SCAL	AS B_DATA_SCAL
                      , B.NONUL_YN AS B_NONUL_YN
                      , B.DEFLT_VAL AS B_DEFLT_VAL
                   FROM WAM_PDM_TBL A
                        INNER JOIN WAM_PDM_COL B
                           ON B.PDM_TBL_ID = A.PDM_TBL_ID
                        INNER JOIN WAA_SUBJ C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.SUBJ_ID = A.SUBJ_ID                           
                  WHERE A.FULL_PATH LIKE  CONCAT(#{fullPath, jdbcType=VARCHAR},'%')   
                        
                ) B
            RIGHT OUTER JOIN 
               (
                SELECT CONCAT(MDL_LNM , '>' , UPP_SUBJ_LNM , '>' , SUBJ_LNM) AS A_FULL_PATH		             
                     , A.PDM_TBL_PNM AS A_PDM_TBL_PNM
                     , A.PDM_TBL_LNM AS A_PDM_TBL_LNM                  
                     , A.PDM_COL_PNM AS A_PDM_COL_PNM
                     , A.PDM_COL_LNM AS A_PDM_COL_LNM
                     , A.COL_ORD AS A_COL_ORD
                     , A.PK_YN AS A_PK_YN
<!--                      , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_TYPE') AS DATA_TYPE -->
<!--                      , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_LEN')  AS DATA_LEN -->
<!--                      , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_SCAL') AS DATA_SCAL  -->
                     , A.DATA_TYPE AS A_DATA_TYPE
                     , A.DATA_LEN AS A_DATA_LEN
                     , A.DATA_SCAL AS A_DATA_SCAL
                     , A.NONUL_YN AS A_NONUL_YN
                     , A.DEFLT_VAL AS A_DEFLT_VAL
                  FROM WAE_ERMART_R7_COL A
<!--                   FROM WAE_ERWIN_COL A -->
                 WHERE 1 = 1		 
<!--                    AND A.LIB_NM = #{sysAreaLnm, jdbcType=VARCHAR} -->
<!--                    AND SUBSTR(A.PDM_TBL_PNM,1,2) = 'TB'   -->
                   AND EXISTS (SELECT 1
                                 FROM WAA_SUBJ X
                                WHERE X.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                                  AND X.FULL_PATH   = CONCAT(MDL_LNM ,'>', UPP_SUBJ_LNM ,'>', SUBJ_LNM)
<!--                                   AND X.FULL_PATH   = LIB_NM ||'>'|| MDL_NM ||'>'|| SUBJ_NM -->
<!--                                   AND X.SUBJ_ABR_NM = SUBSTR(A.PDM_TBL_PNM,3,5)   -->
                              )
                          
                ) A                
                ON A_FULL_PATH   = B_FULL_PATH
               AND A_PDM_TBL_PNM = B_PDM_TBL_PNM
               AND A_PDM_COL_PNM = B_PDM_COL_PNM 
			)
	) FSQ
         WHERE 1 = 1  
         GROUP BY IFNULL(B_FULL_PATH, A_FULL_PATH) 
                , IFNULL(B_PDM_TBL_PNM, A_PDM_TBL_PNM) 
         -- HAVING MAX(B.FULL_PATH) IS NOT NULL
       ) X
    WHERE 1 = 1      
      <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     
	  <if test="fullPath != null">
	   	   AND X.FULL_PATH LIKE CONCAT(#{fullPath, jdbcType=VARCHAR},'%')
	  </if>   		
	  <if test="pdmTblPnm != null">
	   	   AND X.PDM_TBL_PNM LIKE CONCAT('%', #{pdmTblPnm, jdbcType=VARCHAR},'%')
	  </if>   		                 
    ORDER BY TBL_NM 
	
</select>


<select id="selectErwinPdmColGapList" resultMap="MdlErwinGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
	SELECT 	/* ModelGapMapper.selectErwinPdmColGapList */
			IFNULL(B_FULL_PATH, A_FULL_PATH)       AS FULL_PATH	 	     
	     , CONCAT( 
			        CASE WHEN A_PDM_COL_PNM IS NULL                THEN 'ERWIN컬럼미존재' END
			       ,CASE WHEN B_PDM_COL_PNM IS NULL                THEN '메타컬럼미존재' END
			       ,CASE WHEN IFNULL(A_PK_YN,'N') != IFNULL(B_PK_YN,'N') THEN 'PK여부불일치' END
			       ,CASE WHEN A_DATA_TYPE != B_DATA_TYPE           THEN '데이터타입불일치' END
			       ,CASE WHEN A_DATA_LEN  != B_DATA_LEN            THEN '데이터길이불일치' END
			       ,CASE WHEN IFNULL(A_DATA_SCAL,-1) != IFNULL(B_DATA_SCAL,-1)   THEN '소수점불일치' END
			       ,CASE WHEN A_COL_ORD   != B_COL_ORD                     THEN '컬럼순서불일치' END
			       ,CASE WHEN IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')  THEN 'NOT NULL여부불일치' END
			       ,CASE WHEN IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_') THEN 'DEFAULT불일치' END   
	             ) AS GAP_STATUS   
	     , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM)     AS ERWIN_TBL_NM       
	     , B_PDM_TBL_LNM     AS ERWIN_TBL_NM   
	     , A_PDM_COL_PNM     AS ERWIN_COL_PNM
	     , A_PDM_COL_LNM     AS ERWIN_COL_LNM
	     , A_COL_ORD         AS ERWIN_COL_ORD
	     , A_PK_YN           AS ERWIN_PK_YN
	     , A_DATA_TYPE       AS ERWIN_DATA_TYPE
	     , A_DATA_LEN        AS ERWIN_DATA_LEN
	     , A_DATA_SCAL       AS ERWIN_DATA_SCAL
	     , A_NONUL_YN        AS ERWIN_NONUL_YN
	     , A_DEFLT_VAL       AS ERWIN_DEFLT_VAL         
	     , B_PDM_TBL_PNM     AS PDM_TBL_PNM
	     , B_PDM_COL_PNM     AS PDM_COL_PNM
	     , B_PDM_COL_LNM     AS PDM_COL_LNM         
	     , B_COL_ORD         AS PDM_COL_ORD
	     , B_PK_YN           AS PDM_PK_YN
	     , B_DATA_TYPE       AS PDM_DATA_TYPE
	     , B_DATA_LEN        AS PDM_DATA_LEN
	     , B_DATA_SCAL       AS PDM_DATA_SCAL
	     , B_NONUL_YN        AS PDM_NONUL_YN
	     , B_DEFLT_VAL       AS PDM_DEFLT_VAL         
	  FROM (

		SELECT * FROM (
	       (
		    SELECT  A.FULL_PATH			AS B_FULL_PATH
	              , A.PDM_TBL_PNM		AS B_PDM_TBL_PNM
	              , A.PDM_TBL_LNM		AS B_PDM_TBL_LNM
	              , B.PDM_COL_PNM		AS B_PDM_COL_PNM
	              , B.PDM_COL_LNM       AS B_PDM_COL_LNM
	              , B.COL_ORD			AS B_COL_ORD
	              , IFNULL(B.PK_YN,'N') AS B_PK_YN 
	              , B.DATA_TYPE			AS B_DATA_TYPE
	              , B.DATA_LEN			AS B_DATA_LEN
	              , B.DATA_SCAL			AS B_DATA_SCAL
	              , IFNULL(B.NONUL_YN,'N') AS B_NONUL_YN 
	              , B.DEFLT_VAL			AS B_DEFLT_VAL
	           FROM WAM_PDM_TBL A
	                INNER JOIN WAM_PDM_COL B
	                   ON B.PDM_TBL_ID = A.PDM_TBL_ID
	                INNER JOIN WAA_SUBJ C
	                   ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND C.SUBJ_ID = A.SUBJ_ID    	                
	          WHERE A.PDM_TBL_ID =  #{pdmTblId, jdbcType=VARCHAR}           
	           
	        ) B
	    LEFT OUTER JOIN 
	       (
	        SELECT CONCAT(MDL_LNM , '>' , UPP_SUBJ_LNM , '>' , SUBJ_LNM) AS A_FULL_PATH		            
	             , A.PDM_TBL_PNM 		AS A_PDM_TBL_PNM
	             , A.PDM_COL_PNM		AS A_PDM_COL_PNM
	             , A.PDM_COL_LNM		AS A_PDM_COL_LNM
	             , A.COL_ORD			AS A_COL_ORD
	             , A.PK_YN				AS A_PK_YN	
	             , A.DATA_TYPE			AS A_DATA_TYPE
	             , A.DATA_LEN			AS A_DATA_LEN
	             , A.DATA_SCAL 			AS A_DATA_SCAL
<!-- 	             , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_TYPE') AS DATA_TYPE -->
<!-- 	             , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_LEN')  AS DATA_LEN -->
<!-- 	             , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_SCAL') AS DATA_SCAL  -->
	             , A.NONUL_YN			AS A_NONUL_YN
	             , A.DEFLT_VAL			AS A_DEFLT_VAL
	          FROM WAE_ERMART_R7_COL A 	                
<!-- 	          FROM WAE_ERWIN_COL A 	                 -->
	         WHERE 1 = 1
	           AND A.MDL_LNM      =  #{sysAreaLnm, jdbcType=VARCHAR} 		     
	           AND A.UPP_SUBJ_LNM =  #{uppSubjLnm, jdbcType=VARCHAR}  
	           AND A.SUBJ_LNM     =  #{subjLnm, jdbcType=VARCHAR}
	           AND A.PDM_TBL_PNM =  #{pdmTblPnm, jdbcType=VARCHAR}         	           
	        ) A                
	        ON A_PDM_TBL_PNM = B_PDM_TBL_PNM
	       AND A_PDM_COL_PNM = B_PDM_COL_PNM 
		)
UNION
		SELECT * FROM (
	       (
		    SELECT  A.FULL_PATH			AS B_FULL_PATH
	              , A.PDM_TBL_PNM		AS B_PDM_TBL_PNM
	              , A.PDM_TBL_LNM		AS B_PDM_TBL_LNM
	              , B.PDM_COL_PNM		AS B_PDM_COL_PNM
	              , B.PDM_COL_LNM       AS B_PDM_COL_LNM
	              , B.COL_ORD			AS B_COL_ORD
	              , IFNULL(B.PK_YN,'N') AS B_PK_YN 
	              , B.DATA_TYPE			AS B_DATA_TYPE
	              , B.DATA_LEN			AS B_DATA_LEN
	              , B.DATA_SCAL			AS B_DATA_SCAL
	              , IFNULL(B.NONUL_YN,'N') AS B_NONUL_YN 
	              , B.DEFLT_VAL			AS B_DEFLT_VAL
	           FROM WAM_PDM_TBL A
	                INNER JOIN WAM_PDM_COL B
	                   ON B.PDM_TBL_ID = A.PDM_TBL_ID
	                INNER JOIN WAA_SUBJ C
	                   ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                  AND C.SUBJ_ID = A.SUBJ_ID    	                
	          WHERE A.PDM_TBL_ID =  #{pdmTblId, jdbcType=VARCHAR}           
	           
	        ) B
	    RIGHT OUTER JOIN 
	       (
	        SELECT CONCAT(MDL_LNM , '>' , UPP_SUBJ_LNM , '>' , SUBJ_LNM) AS 	A_FULL_PATH		            
	             , A.PDM_TBL_PNM 		AS A_PDM_TBL_PNM
	             , A.PDM_COL_PNM		AS A_PDM_COL_PNM
	             , A.PDM_COL_LNM		AS A_PDM_COL_LNM
	             , A.COL_ORD			AS A_COL_ORD
	             , A.PK_YN				AS A_PK_YN	
	             , A.DATA_TYPE			AS A_DATA_TYPE
	             , A.DATA_LEN			AS A_DATA_LEN
	             , A.DATA_SCAL 			AS A_DATA_SCAL
<!-- 	             , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_TYPE') AS DATA_TYPE -->
<!-- 	             , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_LEN')  AS DATA_LEN -->
<!-- 	             , GET_DATA_TYPE_SPLIT(A.DATA_TYPE,'DATA_SCAL') AS DATA_SCAL  -->
	             , A.NONUL_YN			AS A_NONUL_YN
	             , A.DEFLT_VAL			AS A_DEFLT_VAL
	          FROM WAE_ERMART_R7_COL A 	                
<!-- 	          FROM WAE_ERWIN_COL A 	                 -->
	         WHERE 1 = 1
	           AND A.MDL_LNM      =  #{sysAreaLnm, jdbcType=VARCHAR} 		     
	           AND A.UPP_SUBJ_LNM =  #{uppSubjLnm, jdbcType=VARCHAR}  
	           AND A.SUBJ_LNM     =  #{subjLnm, jdbcType=VARCHAR}
	           AND A.PDM_TBL_PNM =  #{pdmTblPnm, jdbcType=VARCHAR}         	           
	        ) A                
	        ON A_PDM_TBL_PNM = B_PDM_TBL_PNM
	       AND A_PDM_COL_PNM = B_PDM_COL_PNM 
		)
		
	  ) FSQ

	 WHERE 1 = 1  
	 ORDER BY IFNULL(A_FULL_PATH, B_FULL_PATH) 
	        , IFNULL(A_PDM_TBL_PNM, B_PDM_TBL_PNM) 
	        , IFNULL(B_COL_ORD, A_COL_ORD)
</select>

<select id="selectSrcDbSchList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
		
	SELECT 	/* ModelGapMapper.selectSrcDbSchList */
			DISTINCT
	       A.SRC_DB_SCH_ID    AS DB_SCH_ID 
	     , C.DB_CONN_TRG_PNM 
	     , B.DB_SCH_PNM 
	     ,  GET_CMCD_DTL_NM('DDL_TRG_DCD', B.DDL_TRG_DCD)  AS DDL_TRG_DCD
	  FROM WAA_DB_MAP A
	       INNER JOIN WAA_DB_SCH B
	          ON B.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')         
	         AND B.DB_SCH_ID = A.SRC_DB_SCH_ID  	
	       INNER JOIN WAA_DB_CONN_TRG C
	          ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	         AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID     
	       INNER JOIN WAA_DB_SCH D
	          ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')         
	         AND D.DB_SCH_ID = A.TGT_DB_SCH_ID 
	 WHERE A.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	   AND A.REG_TYP_CD IN ('C','U')
	 ORDER BY DB_SCH_PNM
	    	                   
</select>


<select id="selectTgtDbSchList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO"> 
		
	SELECT 	/* ModelGapMapper.selectTgtDbSchList */
			DISTINCT
	       A.TGT_DB_SCH_ID    AS DB_SCH_ID 
	     , E.DB_CONN_TRG_PNM 
	     , D.DB_SCH_PNM 
	     , GET_CMCD_DTL_NM('DDL_TRG_DCD', D.DDL_TRG_DCD) AS DDL_TRG_DCD  
	  FROM WAA_DB_MAP A
	       INNER JOIN WAA_DB_SCH B
	          ON B.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')         
	         AND B.DB_SCH_ID = A.SRC_DB_SCH_ID         
	       INNER JOIN WAA_DB_CONN_TRG C
	          ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	         AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID
	       INNER JOIN WAA_DB_SCH D
	          ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')         
	         AND D.DB_SCH_ID = A.TGT_DB_SCH_ID
	       INNER JOIN WAA_DB_CONN_TRG E
	          ON E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	         AND E.DB_CONN_TRG_ID = D.DB_CONN_TRG_ID
	 WHERE A.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	   AND A.REG_TYP_CD IN ('C','U')
	   AND A.SRC_DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR} 
	 ORDER BY DB_CONN_TRG_PNM, DB_SCH_PNM  
	    	                   
</select>


<resultMap id="DbSrcTgtGapMap" type="kr.wise.meta.gap.service.ModelGapVO">

    <result column="GAP_STATUS"  property="gapStatus" jdbcType="VARCHAR" />
	<result column="PDM_TBL_CNT" property="pdmTblCnt" jdbcType="VARCHAR" />
    <result column="GAP_CNT"     property="gapCnt"    jdbcType="VARCHAR" />
    <result column="COL_GAP_CNT" property="colGapCnt" jdbcType="VARCHAR" />
    <result column="NML_CNT"     property="nmlCnt"    jdbcType="VARCHAR" />
    <result column="PDM_COL_CNT" property="pdmColCnt" jdbcType="VARCHAR" />
    <result column="DBC_COL_CNT" property="dbcColCnt" jdbcType="VARCHAR" />
    <result column="APRV_DTM"    property="aprvDtm"   jdbcType="VARCHAR" />
          
    <result column="SRC_DB_SCH_ID"      property="srcDbSchId"       jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_PNM"     property="srcDbSchPnm"      jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_ID"      property="tgtDbSchId"       jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_PNM"     property="tgtDbSchPnm"      jdbcType="VARCHAR" />
    <result column="DBC_TBL_NM"         property="dbcTblNm"         jdbcType="VARCHAR" />
    <result column="DBC_TBL_LNM"        property="dbcTblLnm"        jdbcType="VARCHAR" />
    
    <result column="SRC_DBC_COL_CNT"    property="srcDbcColCnt"     jdbcType="VARCHAR" /> 
    <result column="TGT_DBC_COL_CNT"    property="tgtDbcColCnt"     jdbcType="VARCHAR" />
    
    <result column="SRC_DBC_TBL_ID"     property="srcDbcTblId"      jdbcType="VARCHAR" />
    <result column="SRC_DBC_TBL_PNM"    property="srcDbcTblPnm"     jdbcType="VARCHAR" />
    <result column="SRC_DBC_TBL_LNM"    property="srcDbcTblLnm"     jdbcType="VARCHAR" />   
    <result column="SRC_DBC_COL_PNM"    property="srcDbcColPnm"     jdbcType="VARCHAR" />
    <result column="SRC_DBC_COL_LNM"    property="srcDbcColLnm"     jdbcType="VARCHAR" />
    <result column="SRC_DBC_COL_SPNM"   property="srcDbcColSpnm"    jdbcType="VARCHAR" />
    <result column="SRC_DBC_COL_ORD"    property="srcDbcColOrd"     jdbcType="VARCHAR" />
    <result column="SRC_DBC_PK_YN"      property="srcDbcPkYn"       jdbcType="VARCHAR" />
    <result column="SRC_DBC_DATA_TYPE"  property="srcDbcDataType"   jdbcType="VARCHAR" />
    <result column="SRC_DBC_DATA_LEN"   property="srcDbcDataLen"    jdbcType="VARCHAR" />
    <result column="SRC_DBC_DATA_SCAL"  property="srcDbcDataScal"   jdbcType="VARCHAR" />
    <result column="SRC_DBC_NONUL_YN"   property="srcDbcNonulYn"    jdbcType="VARCHAR" />
    <result column="SRC_DBC_DEFLT_VAL"  property="srcDbcDefltVal"   jdbcType="VARCHAR" />
    
    <result column="TGT_DBC_COL_PNM"    property="tgtDbcColPnm"     jdbcType="VARCHAR" />
    <result column="TGT_DBC_COL_LNM"    property="tgtDbcColLnm"     jdbcType="VARCHAR" />
    <result column="TGT_DBC_COL_ORD"    property="tgtDbcColOrd"     jdbcType="VARCHAR" />
    <result column="TGT_DBC_PK_YN"      property="tgtDbcPkYn"       jdbcType="VARCHAR" /> 
    <result column="TGT_DBC_DATA_TYPE"  property="tgtDbcDataType"   jdbcType="VARCHAR" />
    <result column="TGT_DBC_DATA_LEN"   property="tgtDbcDataLen"    jdbcType="VARCHAR" />
    <result column="TGT_DBC_DATA_SCAL"  property="tgtDbcDataScal"   jdbcType="VARCHAR" />
    <result column="TGT_DBC_NONUL_YN"   property="tgtDbcNonulYn"    jdbcType="VARCHAR" />
    <result column="TGT_DBC_DEFLT_VAL"  property="tgtDbcDefltVal"   jdbcType="VARCHAR" />
</resultMap>

<select id="selectDbSrcTgtTblGapList" resultMap="DbSrcTgtGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
    		/* ModelGapMapper.selectDbSrcTgtTblGapList */
    SELECT CONCAT(SRC_DB_CONN_TRG_PNM , '.' , SRC_DB_SCH_PNM) AS SRC_DB_SCH_PNM
	     , CONCAT(TGT_DB_CONN_TRG_PNM , '.' , TGT_DB_SCH_PNM) AS TGT_DB_SCH_PNM
	     , DBC_TBL_NM                            AS DBC_TBL_NM          
         , IFNULL(SRC_DBC_TBL_LNM, TGT_DBC_TBL_LNM) AS DBC_TBL_LNM        
         , GAP_STATUS     
         , COL_GAP_CNT   
         , SRC_DBC_COL_CNT        
         , TGT_DBC_COL_CNT   
         , APRV_DTM     
         , SRC_DB_SCH_ID
         , TGT_DB_SCH_ID
      FROM (
        SELECT MAX(A_DB_CONN_TRG_PNM)            AS SRC_DB_CONN_TRG_PNM
             , MAX(A_DB_SCH_ID)                  AS SRC_DB_SCH_ID		   
             , MAX(A_DB_SCH_PNM)                 AS SRC_DB_SCH_PNM
             , MAX(B_DB_CONN_TRG_PNM)            AS TGT_DB_CONN_TRG_PNM
             , MAX(B_DB_SCH_ID)                  AS TGT_DB_SCH_ID
             , MAX(B_DB_SCH_PNM)                 AS TGT_DB_SCH_PNM
             , IFNULL(A_DBC_TBL_PNM, B_DBC_TBL_PNM) AS DBC_TBL_NM
             , MAX(A_APRV_DTM)                   AS APRV_DTM
             , CASE WHEN MAX(B_DBC_TBL_PNM)  IS NULL THEN 'NTGT'   -- 타겟 테이블미존재 
                    WHEN MAX(A_DBC_TBL_PNM)  IS NULL THEN 'NSRC'   -- '소스 테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(A_DBC_COL_LNM,'_') != IFNULL(B_DBC_COL_LNM,'_')
                                         OR A_DATA_TYPE != B_DATA_TYPE
                                         OR IFNULL(A_DATA_LEN, 0)   != IFNULL(B_DATA_LEN, 0)
                                         OR IFNULL(A_DATA_SCAL,0)   != IFNULL(B_DATA_SCAL,0)
                                         OR A_COL_ORD            != B_COL_ORD
                                         OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                         OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                         OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(A_DBC_COL_LNM,'_') != IFNULL(B_DBC_COL_LNM,'_')  
                                 OR A_DATA_TYPE != B_DATA_TYPE
                                 OR A_DATA_LEN  != B_DATA_LEN
                                 OR A_DATA_SCAL != B_DATA_SCAL
                                 OR A_COL_ORD   != B_COL_ORD
                                 OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                 OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                 OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(A_DBC_TBL_PNM)  AS SRC_DBC_COL_CNT        
             , COUNT(B_DBC_TBL_PNM)  AS TGT_DBC_COL_CNT
             , MAX(B_DBC_TBL_PNM)    AS TGT_DBC_TBL_PNM
             , MAX(B_DBC_TBL_LNM)    AS TGT_DBC_TBL_LNM            
             , MAX(A_DBC_TBL_PNM)    AS SRC_DBC_TBL_PNM
             , MAX(A_DBC_TBL_LNM)    AS SRC_DBC_TBL_LNM
             , MAX(A_DBC_COL_PNM)    AS TGT_DBC_COL_PNM
             , MAX(A_DBC_COL_LNM)    AS TGT_DBC_COL_LNM         
       FROM (
		  
		  SELECT * FROM (
			  ( SELECT  A.DB_SCH_ID AS A_DB_SCH_ID
                      , D.DB_CONN_TRG_PNM AS A_DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM AS A_DB_SCH_PNM
                      , A.DBC_TBL_NM     AS A_DBC_TBL_PNM
                      , A.DBC_TBL_KOR_NM AS A_DBC_TBL_LNM
                      , A.REG_DTM        AS A_APRV_DTM 
                      , B.DBC_COL_NM     AS A_DBC_COL_PNM
                      , B.DBC_COL_KOR_NM AS A_DBC_COL_LNM              
                      , B.ORD            AS A_COL_ORD
                      , B.PK_YN AS A_PK_YN
                      , B.DATA_TYPE AS A_DATA_TYPE
                      , B.DATA_LEN AS A_DATA_LEN
                      , B.DATA_PNT AS A_DATA_SCAL	
                      , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS A_NONUL_YN
                      , B.DEFLT_VAL AS A_DEFLT_VAL
                   FROM WAT_DBC_TBL A
                        INNER JOIN WAT_DBC_COL B
                           ON B.DB_SCH_ID  = A.DB_SCH_ID
                          AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
                  WHERE 1 = 1
                    AND A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}                                          
                ) A
        LEFT OUTER JOIN 
               (
                SELECT  A.DB_SCH_ID AS B_DB_SCH_ID
                      , D.DB_CONN_TRG_PNM AS B_DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM AS B_DB_SCH_PNM
                      , A.DBC_TBL_NM     AS B_DBC_TBL_PNM
                      , A.DBC_TBL_KOR_NM AS B_DBC_TBL_LNM
                      , A.REG_DTM        AS B_APRV_DTM 
                      , B.DBC_COL_NM     AS B_DBC_COL_PNM
                      , B.DBC_COL_KOR_NM AS B_DBC_COL_LNM              
                      , B.ORD            AS B_COL_ORD
                      , B.PK_YN AS B_PK_YN
                      , B.DATA_TYPE AS B_DATA_TYPE
                      , B.DATA_LEN AS B_DATA_LEN
                      , B.DATA_PNT AS B_DATA_SCAL	
                      , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS B_NONUL_YN
                      , B.DEFLT_VAL AS B_DEFLT_VAL
                   FROM WAT_DBC_TBL A
                        INNER JOIN WAT_DBC_COL B
                           ON B.DB_SCH_ID  = A.DB_SCH_ID
                          AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
                  WHERE 1 = 1 
                   AND A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}            
                ) B                
                ON 1 = 1              
               AND A_DBC_TBL_PNM = B_DBC_TBL_PNM
               AND A_DBC_COL_PNM = B_DBC_COL_PNM 
			  )
UNION
		SELECT * FROM (
			  ( SELECT  A.DB_SCH_ID AS A_DB_SCH_ID
                      , D.DB_CONN_TRG_PNM AS A_DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM AS A_DB_SCH_PNM
                      , A.DBC_TBL_NM     AS A_DBC_TBL_PNM
                      , A.DBC_TBL_KOR_NM AS A_DBC_TBL_LNM
                      , A.REG_DTM        AS A_APRV_DTM 
                      , B.DBC_COL_NM     AS A_DBC_COL_PNM
                      , B.DBC_COL_KOR_NM AS A_DBC_COL_LNM              
                      , B.ORD            AS A_COL_ORD
                      , B.PK_YN AS A_PK_YN
                      , B.DATA_TYPE AS A_DATA_TYPE
                      , B.DATA_LEN AS A_DATA_LEN
                      , B.DATA_PNT AS A_DATA_SCAL	
                      , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS A_NONUL_YN
                      , B.DEFLT_VAL AS A_DEFLT_VAL
                   FROM WAT_DBC_TBL A
                        INNER JOIN WAT_DBC_COL B
                           ON B.DB_SCH_ID  = A.DB_SCH_ID
                          AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
                  WHERE 1 = 1
                    AND A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}                                          
                ) A
        RIGHT OUTER JOIN 
               (
                SELECT  A.DB_SCH_ID AS B_DB_SCH_ID
                      , D.DB_CONN_TRG_PNM AS B_DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM AS B_DB_SCH_PNM
                      , A.DBC_TBL_NM     AS B_DBC_TBL_PNM
                      , A.DBC_TBL_KOR_NM AS B_DBC_TBL_LNM
                      , A.REG_DTM        AS B_APRV_DTM 
                      , B.DBC_COL_NM     AS B_DBC_COL_PNM
                      , B.DBC_COL_KOR_NM AS B_DBC_COL_LNM              
                      , B.ORD            AS B_COL_ORD
                      , B.PK_YN AS B_PK_YN
                      , B.DATA_TYPE AS B_DATA_TYPE
                      , B.DATA_LEN AS B_DATA_LEN
                      , B.DATA_PNT AS B_DATA_SCAL	
                      , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS B_NONUL_YN
                      , B.DEFLT_VAL AS B_DEFLT_VAL
                   FROM WAT_DBC_TBL A
                        INNER JOIN WAT_DBC_COL B
                           ON B.DB_SCH_ID  = A.DB_SCH_ID
                          AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
                  WHERE 1 = 1 
                   AND A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}            
                ) B                
                ON 1 = 1              
               AND A_DBC_TBL_PNM = B_DBC_TBL_PNM
               AND A_DBC_COL_PNM = B_DBC_COL_PNM 
			  )		   
			   
		    ) FSQ	   
			   
         WHERE 1 = 1  
         GROUP BY IFNULL(A_DB_SCH_PNM, B_DB_SCH_PNM) 
                , IFNULL(A_DBC_TBL_PNM, B_DBC_TBL_PNM) 
       ) X
     WHERE 1 = 1        
                 
      <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     	  
	  <if test="dbcTblNm != null">
	   	   AND UPPER(X.DBC_TBL_NM) LIKE CONCAT('%', UPPER(#{dbcTblNm, jdbcType=VARCHAR}) ,'%')
	  </if>   		                 
    ORDER BY DBC_TBL_NM  
	
</select>

<!-- 위의 selectDbSrcTgtTblGapList 쿼리를 오라클 버전으로 바꾸기 전 원본  -->
<select id="selectDbSrcTgtTblGapList_BAKUP" resultMap="DbSrcTgtGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
    SELECT 	/* ModelGapMapper.selectDbSrcTgtTblGapList */
    	   CONCAT(SRC_DB_CONN_TRG_PNM , '.' , SRC_DB_SCH_PNM) AS SRC_DB_SCH_PNM
	     , CONCAT(TGT_DB_CONN_TRG_PNM , '.' , TGT_DB_SCH_PNM) AS TGT_DB_SCH_PNM
	     , DBC_TBL_NM 
         , IFNULL(SRC_DBC_TBL_LNM, TGT_DBC_TBL_LNM) AS DBC_TBL_LNM        
         , GAP_STATUS     
         , COL_GAP_CNT   
         , SRC_DBC_COL_CNT        
         , TGT_DBC_COL_CNT   
         , APRV_DTM     
         , SRC_DB_SCH_ID
         , TGT_DB_SCH_ID
      FROM (
		SELECT MAX(SRC_DB_CONN_TRG_PNM)            AS SRC_DB_CONN_TRG_PNM
             , MAX(SRC_DB_SCH_ID)                  AS SRC_DB_SCH_ID		   
             , MAX(SRC_DB_SCH_PNM)                 AS SRC_DB_SCH_PNM
             , MAX(TGT_DB_CONN_TRG_PNM)            AS TGT_DB_CONN_TRG_PNM
             , MAX(TGT_DB_SCH_ID)                  AS TGT_DB_SCH_ID
             , MAX(TGT_DB_SCH_PNM)                 AS TGT_DB_SCH_PNM
             , IFNULL(SRC_DBC_TBL_PNM, TGT_DBC_TBL_PNM) AS DBC_TBL_NM
             , IFNULL(SRC_APRV_DTM, TGT_APRV_DTM)       AS APRV_DTM
             , CASE WHEN MAX(TGT_DBC_TBL_ID)  IS NULL THEN 'NTGT'   -- 타겟 테이블미존재 
                    WHEN MAX(SRC_DBC_TBL_ID)  IS NULL THEN 'NSRC'   -- '소스 테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(SRC_DBC_COL_LNM,'_') != IFNULL(TGT_DBC_COL_LNM,'_')
                                         OR SRC_DATA_TYPE != TGT_DATA_TYPE
                                         OR IFNULL(SRC_DATA_LEN, 0)   != IFNULL(TGT_DATA_LEN, 0)
                                         OR IFNULL(SRC_DATA_SCAL,0)   != IFNULL( TGT_DATA_SCAL,0)
                                         OR SRC_COL_ORD            != TGT_COL_ORD
                                         OR IFNULL(SRC_NONUL_YN,'N')  != IFNULL(TGT_NONUL_YN,'N')
                                         OR IFNULL(SRC_DEFLT_VAL,'_') != IFNULL(TGT_DEFLT_VAL,'_')
                                         OR IFNULL(SRC_PK_YN,'N')     != IFNULL(TGT_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(SRC_DBC_COL_LNM,'_') != IFNULL(TGT_DBC_COL_LNM,'_')  
                                 OR SRC_DATA_TYPE != TGT_DATA_TYPE
                                 OR SRC_DATA_LEN  != TGT_DATA_LEN
                                 OR SRC_DATA_SCAL != TGT_DATA_SCAL
                                 OR SRC_COL_ORD   != TGT_COL_ORD
                                 OR IFNULL(SRC_NONUL_YN,'N')  != IFNULL(TGT_NONUL_YN,'N')
                                 OR IFNULL(SRC_DEFLT_VAL,'_') != IFNULL(TGT_DEFLT_VAL,'_')
                                 OR IFNULL(SRC_PK_YN,'N')     != IFNULL(TGT_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(SRC_DBC_TBL_PNM)  AS SRC_DBC_COL_CNT        
             , COUNT(TGT_DBC_TBL_PNM)  AS TGT_DBC_COL_CNT
             , MAX(TGT_DBC_TBL_PNM)    AS TGT_DBC_TBL_PNM
             , MAX(TGT_DBC_TBL_LNM)    AS TGT_DBC_TBL_LNM            
             , MAX(SRC_DBC_TBL_PNM)    AS SRC_DBC_TBL_PNM
             , MAX(SRC_DBC_TBL_LNM)    AS SRC_DBC_TBL_LNM
             , MAX(SRC_DBC_COL_PNM)    AS TGT_DBC_COL_PNM
             , MAX(SRC_DBC_COL_LNM)    AS TGT_DBC_COL_LNM         
          FROM (
		
					select  A.DB_SCH_ID as SRC_DB_SCH_ID
				          , A.DB_CONN_TRG_PNM as SRC_DB_CONN_TRG_PNM
				          , A.DB_SCH_PNM as SRC_DB_SCH_PNM                                                              
				          , A.DBC_TBL_PNM as SRC_DBC_TBL_PNM   
				          , A.DBC_TBL_LNM as SRC_DBC_TBL_LNM  
				          , A.DBC_TBL_PNM as SRC_DBC_TBL_ID 
				          , A.APRV_DTM as SRC_APRV_DTM   
				          , A.DBC_COL_PNM as SRC_DBC_COL_PNM 
				          , A.DBC_COL_LNM as SRC_DBC_COL_LNM              
				          , A.ORD as SRC_COL_ORD
				          , A.PK_YN as SRC_PK_YN
				          , A.DATA_TYPE as SRC_DATA_TYPE
				          , A.DATA_LEN as SRC_DATA_LEN
				          , A.DATA_SCAL	as SRC_DATA_SCAL
				          , A.NONUL_YN as SRC_NONUL_YN
				          , A.DEFLT_VAL as SRC_DEFLT_VAL
				          
				          , B.DB_SCH_ID as TGT_DB_SCH_ID
				          , B.DB_CONN_TRG_PNM as TGT_DB_CONN_TRG_PNM
				          , B.DB_SCH_PNM as TGT_DB_SCH_PNM                                                              
				          , B.DBC_TBL_PNM as TGT_DBC_TBL_PNM   
				          , B.DBC_TBL_LNM as TGT_DBC_TBL_LNM   
				          , B.DBC_TBL_PNM as TGT_DBC_TBL_ID
				          , B.APRV_DTM as TGT_APRV_DTM   
				          , B.DBC_COL_PNM as TGT_DBC_COL_PNM 
				          , B.DBC_COL_LNM as TGT_DBC_COL_LNM              
				          , B.ORD as TGT_COL_ORD
				          , B.PK_YN as TGT_PK_YN
				          , B.DATA_TYPE as TGT_DATA_TYPE
				          , B.DATA_LEN as TGT_DATA_LEN
				          , B.DATA_SCAL	as TGT_DATA_SCAL
				          , B.NONUL_YN as TGT_NONUL_YN
				          , B.DEFLT_VAL as TGT_DEFLT_VAL
						from (
							SELECT   A.DB_SCH_ID 
				                      , D.DB_CONN_TRG_PNM
				                      , C.DB_SCH_PNM                                                                    
				                      , A.DBC_TBL_NM     AS DBC_TBL_PNM
				                      , A.DBC_TBL_KOR_NM AS DBC_TBL_LNM  
				                      , A.DBC_TBL_NM AS DBC_TBL_ID  
				                      , A.REG_DTM AS APRV_DTM        
				                      , B.DBC_COL_NM     AS DBC_COL_PNM
				                      , B.DBC_COL_KOR_NM AS DBC_COL_LNM
				                      , B.ORD
				                      , B.PK_YN
				                      , B.DATA_TYPE
				                      , B.DATA_LEN
				                      , B.DATA_PNT AS DATA_SCAL
				                      , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS NONUL_YN
				                      , B.DEFLT_VAL                     
				                   FROM WAT_DBC_TBL A
			                        INNER JOIN WAT_DBC_COL B
			                           ON B.DB_SCH_ID  = A.DB_SCH_ID
			                          AND B.DBC_TBL_NM = A.DBC_TBL_NM                 
				                        INNER JOIN WAA_DB_SCH C
				                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                          AND C.DB_SCH_ID = A.DB_SCH_ID
				                        INNER JOIN WAA_DB_CONN_TRG D
					                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
					                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID      
				                  WHERE A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
				                    ) A
							inner join (
								SELECT  A.DB_SCH_ID 
				                      , D.DB_CONN_TRG_PNM
				                      , C.DB_SCH_PNM                                                                    
				                      , A.DBC_TBL_NM     AS DBC_TBL_PNM
				                      , A.DBC_TBL_KOR_NM AS DBC_TBL_LNM  
				                      , A.DBC_TBL_NM AS DBC_TBL_ID
				                      , A.REG_DTM       AS APRV_DTM 
				                      , B.DBC_COL_NM     AS DBC_COL_PNM
				                      , B.DBC_COL_KOR_NM AS DBC_COL_LNM              
				                      , B.ORD
				                      , B.PK_YN
				                      , B.DATA_TYPE
				                      , B.DATA_LEN
				                      , B.DATA_PNT AS DATA_SCAL	
				                      , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS NONUL_YN
				                      , B.DEFLT_VAL                      
				                   FROM WAT_DBC_TBL A
			                        INNER JOIN WAT_DBC_COL B
			                           ON B.DB_SCH_ID  = A.DB_SCH_ID
			                          AND B.DBC_TBL_NM = A.DBC_TBL_NM      
				                        INNER JOIN WAA_DB_SCH C
				                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                          AND C.DB_SCH_ID = A.DB_SCH_ID
				                        INNER JOIN WAA_DB_CONN_TRG D
					                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
					                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
				                  WHERE A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
				                   
							) B            
				                ON A.DBC_TBL_PNM = B.DBC_TBL_PNM
				               AND A.DBC_COL_PNM = B.DBC_COL_PNM
<!-- 						where 1=1                -->
						
						union
						
						select  A.DB_SCH_ID as SRC_DB_SCH_ID
					          , D.DB_CONN_TRG_PNM as SRC_DB_CONN_TRG_PNM
					          , C.DB_SCH_PNM as SRC_DB_SCH_PNM                                                              
					          , A.DBC_TBL_NM as SRC_DBC_TBL_PNM   
					          , A.DBC_TBL_KOR_NM as SRC_DBC_TBL_LNM
					          , A.DBC_TBL_NM as SRC_DBC_TBL_ID   
					          , A.REG_DTM as SRC_APRV_DTM   
					          , B.DBC_COL_NM as SRC_DBC_COL_PNM 
					          , B.DBC_COL_KOR_NM as SRC_DBC_COL_LNM              
					          , B.ORD as SRC_COL_ORD
					          , B.PK_YN as SRC_PK_YN
					          , B.DATA_TYPE as SRC_DATA_TYPE
					          , B.DATA_LEN as SRC_DATA_LEN
					          , B.DATA_PNT	as SRC_DATA_SCAL
					          , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END as SRC_NONUL_YN
					          , B.DEFLT_VAL as SRC_DEFLT_VAL
					          
					          , C2.DB_SCH_ID as TGT_DB_SCH_ID
					          , D2.DB_CONN_TRG_PNM as TGT_DB_CONN_TRG_PNM
					          , C2.DB_SCH_PNM as TGT_DB_SCH_PNM                                                              
					          , A.DBC_TBL_NM as TGT_DBC_TBL_PNM   
					          , NULL as TGT_DBC_TBL_LNM   
					          , NULL as TGT_DBC_TBL_ID
					          , NULL as TGT_APRV_DTM   
					          , NULL as TGT_DBC_COL_PNM 
					          , NULL as TGT_DBC_COL_LNM              
					          , NULL as TGT_COL_ORD
					          , NULL as TGT_PK_YN
					          , NULL as TGT_DATA_TYPE
					          , NULL as TGT_DATA_LEN
					          , NULL as TGT_DATA_SCAL
					          , NULL as TGT_NONUL_YN
					          , NULL as TGT_DEFLT_VAL
				         FROM WAT_DBC_TBL A
			                        INNER JOIN WAT_DBC_COL B
			                           ON B.DB_SCH_ID  = A.DB_SCH_ID
			                          AND B.DBC_TBL_NM = A.DBC_TBL_NM                     
				                    INNER JOIN WAA_DB_SCH C
				                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                      AND C.DB_SCH_ID = A.DB_SCH_ID
				                    INNER JOIN WAA_DB_CONN_TRG D
				                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
				                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
				                     left join WAA_DB_SCH C2
				                       on C2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                      and C2.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
				                     left join WAA_DB_CONN_TRG D2
				                       ON D2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
				                      AND D2.DB_CONN_TRG_ID = C2.DB_CONN_TRG_ID
				              WHERE A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
				                and not exists (
				        				         select 1 from WAT_DBC_TBL A2
				        				          inner join WAT_DBC_COL B2
				        				             ON B2.DB_SCH_ID  = A2.DB_SCH_ID
			                          	         	AND B2.DBC_TBL_NM = A2.DBC_TBL_NM    
				        				          where A2.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
				        				            and A2.DBC_TBL_NM = A.DBC_TBL_NM
				        				            and B2.DBC_COL_NM = B.DBC_COL_NM
				        				         )
				
						union
						select  C2.DB_SCH_ID as SRC_DB_SCH_ID
					          , D2.DB_CONN_TRG_PNM as SRC_DB_CONN_TRG_PNM
					          , C2.DB_SCH_PNM as SRC_DB_SCH_PNM                                                              
					          , A.DBC_TBL_NM as SRC_DBC_TBL_PNM   
					          , NULL as SRC_DBC_TBL_LNM   
					          , NULL as SRC_DBC_TBL_ID
					          , NULL as SRC_APRV_DTM   
					          , NULL as SRC_DBC_COL_PNM 
					          , NULL as SRC_DBC_COL_LNM              
					          , NULL as SRC_COL_ORD
					          , NULL as SRC_PK_YN
					          , NULL as SRC_DATA_TYPE
					          , NULL as SRC_DATA_LEN
					          , NULL as SRC_DATA_SCAL
					          , NULL as SRC_NONUL_YN
					          , NULL as SRC_DEFLT_VAL
					          
					          , A.DB_SCH_ID as TGT_DB_SCH_ID
					          , D.DB_CONN_TRG_PNM as TGT_DB_CONN_TRG_PNM
					          , C.DB_SCH_PNM as TGT_DB_SCH_PNM                                                              
					          , A.DBC_TBL_NM as TGT_DBC_TBL_PNM   
					          , A.DBC_TBL_KOR_NM as TGT_DBC_TBL_LNM   
					          , A.DBC_TBL_NM as TGT_DBC_TBL_ID
					          , A.REG_DTM as TGT_APRV_DTM   
					          , B.DBC_COL_NM as TGT_DBC_COL_PNM 
					          , B.DBC_COL_KOR_NM as TGT_DBC_COL_LNM              
					          , B.ORD as TGT_COL_ORD
					          , B.PK_YN as TGT_PK_YN
					          , B.DATA_TYPE as TGT_DATA_TYPE
					          , B.DATA_LEN as TGT_DATA_LEN
					          , B.DATA_PNT	as TGT_DATA_SCAL
					          , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END as TGT_NONUL_YN
					          , B.DEFLT_VAL as TGT_DEFLT_VAL
				         FROM WAT_DBC_TBL A
			                        INNER JOIN WAT_DBC_COL B
			                           ON B.DB_SCH_ID  = A.DB_SCH_ID
			                          AND B.DBC_TBL_NM = A.DBC_TBL_NM                         
				                    INNER JOIN WAA_DB_SCH C
				                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                      AND C.DB_SCH_ID = A.DB_SCH_ID
				                    INNER JOIN WAA_DB_CONN_TRG D
				                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
				                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
				                     left join WAA_DB_SCH C2
				                       on C2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                      and C2.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
				                     left join WAA_DB_CONN_TRG D2
				                       ON D2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
				                      AND D2.DB_CONN_TRG_ID = C2.DB_CONN_TRG_ID
				              WHERE A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
				                and not exists (
				        		          		select 1 from WAT_DBC_TBL A2
				        		          		 inner join WAT_DBC_COL B2
				        		          		    ON B2.DB_SCH_ID  = A2.DB_SCH_ID
			                                    		AND B2.DBC_TBL_NM = A2.DBC_TBL_NM
				        		          		 where A2.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
				        		          		   and A2.DBC_TBL_NM = A.DBC_TBL_NM
				        		          		   and B2.DBC_COL_NM = B.DBC_COL_NM
				        		          		)
		 ) A
<!-- 		 WHERE 1 = 1   -->
         GROUP BY IFNULL(SRC_DB_SCH_PNM, TGT_DB_SCH_PNM) 
                , IFNULL(SRC_DBC_TBL_PNM, TGT_DBC_TBL_PNM)
   ) X
<!--      WHERE 1 = 1  -->
    <where>
      <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     	  
	  <if test="dbcTblNm != null">
	   	   AND X.DBC_TBL_NM LIKE CONCAT('%', #{dbcTblNm, jdbcType=VARCHAR},'%')
	  </if> 
	  </where>
<!--     ORDER BY DBC_TBL_NM   -->
	
</select>


<select id="selectDbSrcTgtColGapList" resultMap="DbSrcTgtGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
<!-- 
	SELECT 
		* FROM (
	SELECT IFNULL(B.DB_SCH_PNM, A.DB_SCH_PNM)       AS DB_SCH_PNM	 	     
	     ,   CONCAT(CASE WHEN A.DBC_COL_PNM IS NULL                THEN '소스컬럼미존재' ELSE '' END
	      , CASE WHEN B.DBC_COL_PNM IS NULL                THEN '타겟컬럼미존재' ELSE '' END
	      , CASE WHEN IFNULL(A.PK_YN,'N') != IFNULL(B.PK_YN,'N') THEN 'PK여부불일치' ELSE '' END
	      , CASE WHEN A.DATA_TYPE != B.DATA_TYPE           THEN '데이터타입불일치' ELSE '' END
	      , CASE WHEN A.DATA_LEN  != B.DATA_LEN            THEN '데이터길이불일치' ELSE '' END
	      , CASE WHEN IFNULL(A.DATA_SCAL,-1) != IFNULL(B.DATA_SCAL,-1)   THEN '소수점불일치' ELSE '' END
	      , CASE WHEN A.COL_ORD   != B.COL_ORD                     THEN '컬럼순서불일치' ELSE '' END
	      , CASE WHEN IFNULL(A.NONUL_YN,'N')  != IFNULL(B.NONUL_YN,'N')  THEN 'NOT NULL여부불일치' ELSE '' END
	      , CASE WHEN IFNULL(A.DEFLT_VAL,'_') != IFNULL(B.DEFLT_VAL,'_') THEN 'DEFAULT불일치' ELSE '' END)   AS GAP_STATUS   
	     , IFNULL(A.DBC_TBL_PNM, B.DBC_TBL_PNM)     AS DBC_TBL_NM       
	     , A.DBC_TBL_LNM     AS SRC_DBC_TBL_LNM    
	     , A.DBC_COL_PNM     AS SRC_DBC_COL_PNM
	     , A.DBC_COL_LNM     AS SRC_DBC_COL_LNM
	     , A.COL_ORD         AS SRC_DBC_COL_ORD
	     , A.PK_YN           AS SRC_DBC_PK_YN
	     , A.DATA_TYPE       AS SRC_DBC_DATA_TYPE
	     , A.DATA_LEN        AS SRC_DBC_DATA_LEN
	     , A.DATA_SCAL       AS SRC_DBC_DATA_SCAL
	     , A.NONUL_YN        AS SRC_DBC_NONUL_YN
	     , A.DEFLT_VAL       AS SRC_DBC_DEFLT_VAL         
	     , B.DBC_TBL_PNM     AS TGT_DBC_TBL_PNM
	     , B.DBC_COL_PNM     AS TGT_DBC_COL_PNM
	     , B.DBC_COL_LNM     AS TGT_DBC_COL_LNM           
	     , B.COL_ORD         AS TGT_DBC_COL_ORD
	     , B.PK_YN           AS TGT_DBC_PK_YN
	     , B.DATA_TYPE       AS TGT_DBC_DATA_TYPE
	     , B.DATA_LEN        AS TGT_DBC_DATA_LEN
	     , B.DATA_SCAL       AS TGT_DBC_DATA_SCAL
	     , B.NONUL_YN        AS TGT_DBC_NONUL_YN
	     , B.DEFLT_VAL       AS TGT_DBC_DEFLT_VAL         
	  FROM (SELECT  A.DB_SCH_ID 
                  , D.DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM                                                                    
                  , A.DBC_TBL_NM     AS DBC_TBL_PNM
                  , A.DBC_TBL_KOR_NM AS DBC_TBL_LNM
                  , A.REG_DTM        AS APRV_DTM 
                  , B.DBC_COL_NM     AS DBC_COL_PNM
                  , B.DBC_COL_KOR_NM AS DBC_COL_LNM              
                  , B.ORD            AS COL_ORD
                  , B.PK_YN
                  , B.DATA_TYPE
                  , B.DATA_LEN
                  , B.DATA_PNT AS DATA_SCAL	
                  , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS NONUL_YN
                  , B.DEFLT_VAL       
               FROM WAT_DBC_TBL A
                    INNER JOIN WAT_DBC_COL B
                       ON B.DB_SCH_ID  = A.DB_SCH_ID
                      AND B.DBC_TBL_NM = A.DBC_TBL_NM
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID
                    INNER JOIN WAA_DB_CONN_TRG D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                  AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID      
              WHERE 1 = 1
                AND A.DB_SCH_ID  = #{srcDbSchId, jdbcType=VARCHAR}   
                AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}   
                                                   
            ) A
           JOIN 
           (
            SELECT  A.DB_SCH_ID 
                  , D.DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM                                                                    
                  , A.DBC_TBL_NM     AS DBC_TBL_PNM
                  , A.DBC_TBL_KOR_NM AS DBC_TBL_LNM
                  , A.REG_DTM        AS APRV_DTM 
                  , B.DBC_COL_NM     AS DBC_COL_PNM
                  , B.DBC_COL_KOR_NM AS DBC_COL_LNM              
                  , B.ORD            AS COL_ORD
                  , B.PK_YN
                  , B.DATA_TYPE
                  , B.DATA_LEN
                  , B.DATA_PNT AS DATA_SCAL	
                  , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS NONUL_YN
                  , B.DEFLT_VAL     
               FROM WAT_DBC_TBL A
                    INNER JOIN WAT_DBC_COL B
                       ON B.DB_SCH_ID  = A.DB_SCH_ID
                      AND B.DBC_TBL_NM = A.DBC_TBL_NM
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID
                    INNER JOIN WAA_DB_CONN_TRG D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                  AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
              WHERE 1 = 1 
               AND A.DB_SCH_ID   = #{tgtDbSchId, jdbcType=VARCHAR}   
               AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}   
            ) B                
            ON 1 = 1              

           AND A.DBC_TBL_PNM = B.DBC_TBL_PNM
           AND A.DBC_COL_PNM = B.DBC_COL_PNM 
    WHERE 1 = 1  
    
    union
    
    SELECT  C.DB_SCH_PNM       AS DB_SCH_PNM	 	     
	      , '타겟컬럼미존재'    AS GAP_STATUS   
	     , A.DBC_TBL_NM      AS DDL_TBL_NM       
	     , A.DBC_TBL_KOR_NM     AS SRC_DBC_TBL_LNM    
	     , B.DBC_COL_NM     AS SRC_DBC_COL_PNM
	     , B.DBC_COL_KOR_NM     AS SRC_DBC_COL_LNM
	     , B.ORD         AS SRC_DBC_COL_ORD
	     , B.PK_YN           AS SRC_DBC_PK_YN
	     , B.DATA_TYPE       AS SRC_DBC_DATA_TYPE
	     , B.DATA_LEN        AS SRC_DBC_DATA_LEN
	     , B.DATA_PNT       AS SRC_DBC_DATA_SCAL
	     , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS SRC_DBC_NONUL_YN
	     , B.DEFLT_VAL       AS SRC_DBC_DEFLT_VAL         
	     , NULL     AS TGT_DBC_TBL_PNM
	     , NULL     AS TGT_DBC_COL_PNM
	     , NULL     AS TGT_DBC_COL_LNM         
	     , NULL     AS TGT_DBC_COL_ORD
	     , NULL     AS TGT_DBC_PK_YN
	     , NULL     AS TGT_DBC_DATA_TYPE
	     , NULL     AS TGT_DBC_DATA_LEN
	     , NULL     AS TGT_DBC_DATA_SCAL
	     , NULL     AS TGT_DBC_NONUL_YN
	     , NULL     AS TGT_DBC_DEFLT_VAL       
       FROM WAT_DBC_TBL A
            INNER JOIN WAT_DBC_COL B
               ON B.DB_SCH_ID  = A.DB_SCH_ID
              AND B.DBC_TBL_NM = A.DBC_TBL_NM
            INNER JOIN WAA_DB_SCH C
               ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
              AND C.DB_SCH_ID = A.DB_SCH_ID
            INNER JOIN WAA_DB_CONN_TRG D
               ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
              AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
      WHERE 1 = 1
        AND A.DB_SCH_ID   = #{srcDbSchId, jdbcType=VARCHAR}
        AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}
        and not exists (
        				select 1 from WAT_DBC_TBL A2
        				 inner join WAT_DBC_COL B2
        				    ON B2.DB_SCH_ID  = A2.DB_SCH_ID
              			   AND B2.DBC_TBL_NM = A2.DBC_TBL_NM
        				 where A2.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
        				   and A2.DBC_TBL_NM = A.DBC_TBL_NM
        				   and B2.DwBC_COL_NM = B.DBC_COL_NM
        				)
	
    union
    
    SELECT  C.DB_SCH_PNM       AS DB_SCH_PNM	 	     
	      , '소스컬럼미존재'    AS GAP_STATUS   
	     , A.DBC_TBL_NM     AS DDL_TBL_NM       
	     , NULL     AS SRC_DBC_TBL_PNM
	     , NULL     AS SRC_DBC_COL_PNM
	     , NULL     AS SRC_DBC_COL_LNM         
	     , NULL     AS SRC_DBC_COL_ORD
	     , NULL     AS SRC_DBC_PK_YN
	     , NULL     AS SRC_DBC_DATA_TYPE
	     , NULL     AS SRC_DBC_DATA_LEN
	     , NULL     AS SRC_DBC_DATA_SCAL
	     , NULL     AS SRC_DBC_NONUL_YN
	     , NULL     AS SRC_DBC_DEFLT_VAL   
	     , A.DBC_TBL_KOR_NM     AS TGT_DBC_TBL_LNM    
	     , B.DBC_COL_NM     	AS TGT_DBC_COL_PNM
	     , B.DBC_COL_KOR_NM     AS TGT_DBC_COL_LNM
	     , B.ORD         AS TGT_DDL_COL_ORD
	     , B.PK_YN           AS TGT_DDL_PK_YN
	     , B.DATA_TYPE       AS TGT_DDL_DATA_TYPE
	     , B.DATA_LEN        AS TGT_DDL_DATA_LEN
	     , B.DATA_PNT       AS TGT_DDL_DATA_SCAL
	     , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS TGT_DBC_NONUL_YN
	     , B.DEFLT_VAL       AS TGT_DDL_DEFLT_VAL 
       FROM WAT_DBC_TBL A
            INNER JOIN WAT_DBC_COL B
               ON B.DB_SCH_ID  = A.DB_SCH_ID
              AND B.DBC_TBL_NM = A.DBC_TBL_NM   
            INNER JOIN WAA_DB_SCH C
               ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
              AND C.DB_SCH_ID = A.DB_SCH_ID
            INNER JOIN WAA_DB_CONN_TRG D
               ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
              AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
      WHERE 1 = 1
        AND A.DB_SCH_ID   = #{tgtDbSchId, jdbcType=VARCHAR}  
        AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}
        and not exists (
        				select 1 from WAT_DBC_TBL A2
        				 inner join WAT_DBC_COL B2
        				    ON B2.DB_SCH_ID  = A2.DB_SCH_ID
              			   AND B2.DBC_TBL_NM = A2.DBC_TBL_NM
        				 where A2.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
        				   and A2.DBC_TBL_NM = A.DBC_TBL_NM
        				   and B2.DBC_COL_NM = B.DBC_COL_NM
        				)
) A

    ORDER BY DBC_TBL_NM 
           , IFNULL(TGT_DBC_COL_ORD, SRC_DBC_COL_ORD)
 -->  
/* ModelGapMapper.selectDbSrcTgtColGapList */
	SELECT IFNULL(B_DB_SCH_PNM, A_DB_SCH_PNM)       AS DB_SCH_PNM	 	     
	     , CONCAT(  
			  CASE WHEN A_DBC_COL_PNM IS NULL                THEN '소스컬럼미존재' END
	        , CASE WHEN B_DBC_COL_PNM IS NULL                THEN '타겟컬럼미존재' END
			, CASE WHEN IFNULL(A_PK_YN,'N') != IFNULL(B_PK_YN,'N') THEN 'PK여부불일치' END
			, CASE WHEN A_DATA_TYPE != B_DATA_TYPE           THEN '데이터타입불일치' END
			, CASE WHEN A_DATA_LEN  != B_DATA_LEN            THEN '데이터길이불일치' END
			, CASE WHEN IFNULL(A_DATA_SCAL,-1) != IFNULL(B_DATA_SCAL,-1)   THEN '소수점불일치' END
			, CASE WHEN A_COL_ORD   != B_COL_ORD                     THEN '컬럼순서불일치' END
			, CASE WHEN IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')  THEN 'NOT NULL여부불일치' END
			, CASE WHEN IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_') THEN 'DEFAULT불일치' END   
		   ) AS GAP_STATUS   
	     , IFNULL(A_DBC_TBL_PNM, B_DBC_TBL_PNM)     AS DBC_TBL_NM       
	     , A_DBC_TBL_LNM     AS SRC_DBC_TBL_LNM    
	     , A_DBC_COL_PNM     AS SRC_DBC_COL_PNM
	     , A_DBC_COL_LNM     AS SRC_DBC_COL_LNM
	     , A_COL_ORD         AS SRC_DBC_COL_ORD
	     , A_PK_YN           AS SRC_DBC_PK_YN
	     , A_DATA_TYPE       AS SRC_DBC_DATA_TYPE
	     , A_DATA_LEN        AS SRC_DBC_DATA_LEN
	     , A_DATA_SCAL       AS SRC_DBC_DATA_SCAL
	     , A_NONUL_YN        AS SRC_DBC_NONUL_YN
	     , A_DEFLT_VAL       AS SRC_DBC_DEFLT_VAL         
	     , B_DBC_TBL_PNM     AS TGT_DBC_TBL_PNM
	     , B_DBC_COL_PNM     AS TGT_DBC_COL_PNM
	     , B_DBC_COL_LNM     AS TGT_DBC_COL_LNM         
	     , B_COL_ORD         AS TGT_DBC_COL_ORD
	     , B_PK_YN           AS TGT_DBC_PK_YN
	     , B_DATA_TYPE       AS TGT_DBC_DATA_TYPE
	     , B_DATA_LEN        AS TGT_DBC_DATA_LEN
	     , B_DATA_SCAL       AS TGT_DBC_DATA_SCAL
	     , B_NONUL_YN        AS TGT_DBC_NONUL_YN
	     , B_DEFLT_VAL       AS TGT_DBC_DEFLT_VAL         
	  FROM (
	  
		SELECT * FROM (	
			(
			SELECT  A.DB_SCH_ID 	 AS A_DB_SCH_ID
                  , D.DB_CONN_TRG_PNM AS A_DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM     AS A_DB_SCH_PNM                                     
                  , A.DBC_TBL_NM     AS A_DBC_TBL_PNM
                  , A.DBC_TBL_KOR_NM AS A_DBC_TBL_LNM
                  , A.REG_DTM        AS A_APRV_DTM 
                  , B.DBC_COL_NM     AS A_DBC_COL_PNM
                  , B.DBC_COL_KOR_NM AS A_DBC_COL_LNM              
                  , B.ORD            AS A_COL_ORD
                  , B.PK_YN			 AS A_PK_YN
                  , B.DATA_TYPE		 AS A_DATA_TYPE
                  , B.DATA_LEN		 AS A_DATA_LEN
                  , B.DATA_PNT 		 AS A_DATA_SCAL	
                  , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS A_NONUL_YN
                  , B.DEFLT_VAL		 AS A_DEFLT_VAL
               FROM WAT_DBC_TBL A
                    INNER JOIN WAT_DBC_COL B
                       ON B.DB_SCH_ID  = A.DB_SCH_ID
                      AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID 
                    INNER JOIN WAA_DB_CONN_TRG D
                    ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                   AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
              WHERE 1 = 1
                AND A.DB_SCH_ID  = #{srcDbSchId, jdbcType=VARCHAR}
                AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}  
                                                            
            ) A
       LEFT OUTER JOIN 
           (
            SELECT  A.DB_SCH_ID 	 AS B_DB_SCH_ID
                  , D.DB_CONN_TRG_PNM AS B_DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM     AS B_DB_SCH_PNM                                           
                  , A.DBC_TBL_NM     AS B_DBC_TBL_PNM
                  , A.DBC_TBL_KOR_NM AS B_DBC_TBL_LNM
                  , A.REG_DTM        AS B_APRV_DTM 
                  , B.DBC_COL_NM     AS B_DBC_COL_PNM
                  , B.DBC_COL_KOR_NM AS B_DBC_COL_LNM              
                  , B.ORD            AS B_COL_ORD
                  , B.PK_YN			 AS B_PK_YN
                  , B.DATA_TYPE		 AS B_DATA_TYPE
                  , B.DATA_LEN		 AS B_DATA_LEN
                  , B.DATA_PNT 		 AS B_DATA_SCAL	
                  , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS B_NONUL_YN
                  , B.DEFLT_VAL		 AS B_DEFLT_VAL
               FROM WAT_DBC_TBL A
                    INNER JOIN WAT_DBC_COL B
                       ON B.DB_SCH_ID  = A.DB_SCH_ID
                      AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID 
                    INNER JOIN WAA_DB_CONN_TRG D
                    ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                   AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
              WHERE 1 = 1 
               AND A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}  
               AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}          
            ) B                
            ON 1 = 1              
<!--            AND A.DB_SCH_PNM  = B.DB_SCH_PNM  -->
           AND A_DBC_TBL_PNM = B_DBC_TBL_PNM
           AND A_DBC_COL_PNM = B_DBC_COL_PNM 
		)   
UNION   
		SELECT * FROM (	
			(
			SELECT  A.DB_SCH_ID 	 AS A_DB_SCH_ID
                  , D.DB_CONN_TRG_PNM AS A_DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM     AS A_DB_SCH_PNM                                     
                  , A.DBC_TBL_NM     AS A_DBC_TBL_PNM
                  , A.DBC_TBL_KOR_NM AS A_DBC_TBL_LNM
                  , A.REG_DTM        AS A_APRV_DTM 
                  , B.DBC_COL_NM     AS A_DBC_COL_PNM
                  , B.DBC_COL_KOR_NM AS A_DBC_COL_LNM              
                  , B.ORD            AS A_COL_ORD
                  , B.PK_YN			 AS A_PK_YN
                  , B.DATA_TYPE		 AS A_DATA_TYPE
                  , B.DATA_LEN		 AS A_DATA_LEN
                  , B.DATA_PNT 		 AS A_DATA_SCAL	
                  , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS A_NONUL_YN
                  , B.DEFLT_VAL		 AS A_DEFLT_VAL
               FROM WAT_DBC_TBL A
                    INNER JOIN WAT_DBC_COL B
                       ON B.DB_SCH_ID  = A.DB_SCH_ID
                      AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID 
                    INNER JOIN WAA_DB_CONN_TRG D
                    ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                   AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
              WHERE 1 = 1
                AND A.DB_SCH_ID  = #{srcDbSchId, jdbcType=VARCHAR}
                AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}  
                                                            
            ) A
       RIGHT OUTER JOIN 
           (
            SELECT  A.DB_SCH_ID 	 AS B_DB_SCH_ID
                  , D.DB_CONN_TRG_PNM AS B_DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM     AS B_DB_SCH_PNM                                           
                  , A.DBC_TBL_NM     AS B_DBC_TBL_PNM
                  , A.DBC_TBL_KOR_NM AS B_DBC_TBL_LNM
                  , A.REG_DTM        AS B_APRV_DTM 
                  , B.DBC_COL_NM     AS B_DBC_COL_PNM
                  , B.DBC_COL_KOR_NM AS B_DBC_COL_LNM              
                  , B.ORD            AS B_COL_ORD
                  , B.PK_YN			 AS B_PK_YN
                  , B.DATA_TYPE		 AS B_DATA_TYPE
                  , B.DATA_LEN		 AS B_DATA_LEN
                  , B.DATA_PNT 		 AS B_DATA_SCAL	
                  , CASE WHEN B.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END  AS B_NONUL_YN
                  , B.DEFLT_VAL		 AS B_DEFLT_VAL
               FROM WAT_DBC_TBL A
                    INNER JOIN WAT_DBC_COL B
                       ON B.DB_SCH_ID  = A.DB_SCH_ID
                      AND B.DBC_TBL_NM = A.DBC_TBL_NM 
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID 
                    INNER JOIN WAA_DB_CONN_TRG D
                    ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                   AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
              WHERE 1 = 1 
               AND A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}  
               AND A.DBC_TBL_NM = #{dbcTblNm, jdbcType=VARCHAR}          
            ) B                
            ON 1 = 1              
<!--            AND A.DB_SCH_PNM  = B.DB_SCH_PNM  -->
           AND A_DBC_TBL_PNM = B_DBC_TBL_PNM
           AND A_DBC_COL_PNM = B_DBC_COL_PNM 
		)      
		   
	  ) FSQ	   
    WHERE 1 = 1  
    ORDER BY IFNULL(A_DB_SCH_PNM, B_DB_SCH_PNM) 
           , IFNULL(A_DBC_TBL_PNM, B_DBC_TBL_PNM) 
           , IFNULL(B_COL_ORD, A_COL_ORD)

        
</select>



<resultMap id="DdlSrcTgtGapMap" type="kr.wise.meta.gap.service.ModelGapVO">

    <result column="GAP_STATUS"  property="gapStatus" jdbcType="VARCHAR" />
	<result column="PDM_TBL_CNT" property="pdmTblCnt" jdbcType="VARCHAR" />
    <result column="GAP_CNT"     property="gapCnt"    jdbcType="VARCHAR" />
    <result column="COL_GAP_CNT" property="colGapCnt" jdbcType="VARCHAR" />
    <result column="NML_CNT"     property="nmlCnt"    jdbcType="VARCHAR" />
    <result column="PDM_COL_CNT" property="pdmColCnt" jdbcType="VARCHAR" />
    <result column="DBC_COL_CNT" property="dbcColCnt" jdbcType="VARCHAR" />
    <result column="APRV_DTM"    property="aprvDtm"   jdbcType="VARCHAR" />
          
    <result column="SRC_DB_SCH_ID"      property="srcDbSchId"       jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_PNM"     property="srcDbSchPnm"      jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_ID"      property="tgtDbSchId"       jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_PNM"     property="tgtDbSchPnm"      jdbcType="VARCHAR" />
    <result column="DBC_TBL_NM"         property="dbcTblNm"         jdbcType="VARCHAR" />
    
    <result column="SRC_DDL_COL_CNT"    property="srcDdlColCnt"     jdbcType="VARCHAR" /> 
    <result column="TGT_DDL_COL_CNT"    property="tgtDdlColCnt"     jdbcType="VARCHAR" />
    
    <result column="DDL_TBL_PNM"        property="ddlTblPnm"        jdbcType="VARCHAR" />
    <result column="DDL_TBL_LNM"        property="ddlTblLnm"        jdbcType="VARCHAR" />
    <result column="SRC_DDL_TBL_ID"     property="srcDdlTblId"      jdbcType="VARCHAR" />
    <result column="SRC_DDL_TBL_PNM"    property="srcDdlTblPnm"     jdbcType="VARCHAR" />
    <result column="SRC_DDL_TBL_LNM"    property="srcDdlTblLnm"     jdbcType="VARCHAR" />   
    <result column="SRC_DDL_COL_PNM"    property="srcDdlColPnm"     jdbcType="VARCHAR" />
    <result column="SRC_DDL_COL_LNM"    property="srcDdlColLnm"     jdbcType="VARCHAR" />
    <result column="SRC_DDL_COL_SPNM"   property="srcDdlColSpnm"    jdbcType="VARCHAR" />
    <result column="SRC_DDL_COL_ORD"    property="srcDdlColOrd"     jdbcType="VARCHAR" />
    <result column="SRC_DDL_PK_YN"      property="srcDdlPkYn"       jdbcType="VARCHAR" />
    <result column="SRC_DDL_DATA_TYPE"  property="srcDdlDataType"   jdbcType="VARCHAR" />
    <result column="SRC_DDL_DATA_LEN"   property="srcDdlDataLen"    jdbcType="VARCHAR" />
    <result column="SRC_DDL_DATA_SCAL"  property="srcDdlDataScal"   jdbcType="VARCHAR" />
    <result column="SRC_DDL_NONUL_YN"   property="srcDdlNonulYn"    jdbcType="VARCHAR" />
    <result column="SRC_DDL_DEFLT_VAL"  property="srcDdlDefltVal"   jdbcType="VARCHAR" />
    
    <result column="TGT_DDL_COL_PNM"    property="tgtDdlColPnm"     jdbcType="VARCHAR" />
    <result column="TGT_DDL_COL_LNM"    property="tgtDdlColLnm"     jdbcType="VARCHAR" />
    <result column="TGT_DDL_COL_ORD"    property="tgtDdlColOrd"     jdbcType="VARCHAR" />
    <result column="TGT_DDL_PK_YN"      property="tgtDdlPkYn"       jdbcType="VARCHAR" /> 
    <result column="TGT_DDL_DATA_TYPE"  property="tgtDdlDataType"   jdbcType="VARCHAR" />
    <result column="TGT_DDL_DATA_LEN"   property="tgtDdlDataLen"    jdbcType="VARCHAR" />
    <result column="TGT_DDL_DATA_SCAL"  property="tgtDdlDataScal"   jdbcType="VARCHAR" />
    <result column="TGT_DDL_NONUL_YN"   property="tgtDdlNonulYn"    jdbcType="VARCHAR" />
    <result column="TGT_DDL_DEFLT_VAL"  property="tgtDdlDefltVal"   jdbcType="VARCHAR" />
</resultMap>

<select id="selectDdlSrcTgtTblGapList" resultMap="DdlSrcTgtGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
    SELECT CONCAT(SRC_DB_CONN_TRG_PNM ,'.', SRC_DB_SCH_PNM) AS SRC_DB_SCH_PNM
	     , CONCAT(TGT_DB_CONN_TRG_PNM ,'.', TGT_DB_SCH_PNM) AS TGT_DB_SCH_PNM
	     , DDL_TBL_PNM 
         , IFNULL(SRC_DDL_TBL_LNM, TGT_DDL_TBL_LNM) AS DDL_TBL_LNM        
         , GAP_STATUS     
         , COL_GAP_CNT   
         , SRC_DDL_COL_CNT        
         , TGT_DDL_COL_CNT   
         , APRV_DTM     
         , SRC_DB_SCH_ID
         , TGT_DB_SCH_ID
      FROM (
        SELECT MAX(A_DB_CONN_TRG_PNM)            AS SRC_DB_CONN_TRG_PNM
             , MAX(A_DB_SCH_ID)                  AS SRC_DB_SCH_ID		   
             , MAX(A_DB_SCH_PNM)                 AS SRC_DB_SCH_PNM
             , MAX(B_DB_CONN_TRG_PNM)            AS TGT_DB_CONN_TRG_PNM
             , MAX(B_DB_SCH_ID)                  AS TGT_DB_SCH_ID
             , MAX(B_DB_SCH_PNM)                 AS TGT_DB_SCH_PNM
             , IFNULL(A_DDL_TBL_PNM, B_DDL_TBL_PNM) AS DDL_TBL_PNM
             , MAX(A_APRV_DTM)                   AS APRV_DTM
             , CASE WHEN MAX(B_DDL_TBL_PNM)  IS NULL THEN 'NTGT'   -- 타겟 테이블미존재 
                    WHEN MAX(A_DDL_TBL_PNM)  IS NULL THEN 'NSRC'   -- '소스 테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(A_DDL_COL_LNM,'_') != IFNULL(B_DDL_COL_LNM,'_')
                                         OR A_DATA_TYPE != B_DATA_TYPE
                                         OR IFNULL(A_DATA_LEN, 0)   != IFNULL(B_DATA_LEN, 0)
                                         OR IFNULL(A_DATA_SCAL,0)   != IFNULL( B_DATA_SCAL,0)
                                         OR A_COL_ORD            != B_COL_ORD
                                         OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                         OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                         OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(A_DDL_COL_LNM,'_') != IFNULL(B_DDL_COL_LNM,'_')  
                                 OR A_DATA_TYPE != B_DATA_TYPE
                                 OR A_DATA_LEN  != B_DATA_LEN
                                 OR A_DATA_SCAL != B_DATA_SCAL
                                 OR A_COL_ORD   != B_COL_ORD
                                 OR IFNULL(A_NONUL_YN,'N')  != IFNULL(B_NONUL_YN,'N')
                                 OR IFNULL(A_DEFLT_VAL,'_') != IFNULL(B_DEFLT_VAL,'_')
                                 OR IFNULL(A_PK_YN,'N')     != IFNULL(B_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(A_DDL_TBL_PNM)  AS SRC_DDL_COL_CNT        
             , COUNT(B_DDL_TBL_PNM)  AS TGT_DDL_COL_CNT
             , MAX(B_DDL_TBL_PNM)    AS TGT_DDL_TBL_PNM
             , MAX(B_DDL_TBL_LNM)    AS TGT_DDL_TBL_LNM            
             , MAX(A_DDL_TBL_PNM)    AS SRC_DDL_TBL_PNM
             , MAX(A_DDL_TBL_LNM)    AS SRC_DDL_TBL_LNM
             , MAX(A_DDL_COL_PNM)    AS TGT_DDL_COL_PNM
             , MAX(A_DDL_COL_LNM)    AS TGT_DDL_COL_LNM         
          FROM ( 
		  
			SELECT * FROM (
			  (
			   SELECT   A.DB_SCH_ID AS A_DB_SCH_ID
                      , D.DB_CONN_TRG_PNM AS A_DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM AS A_DB_SCH_PNM
                      , A.DDL_TBL_PNM AS A_DDL_TBL_PNM
                      , A.DDL_TBL_LNM AS A_DDL_TBL_LNM
                      , A.APRV_DTM AS A_APRV_DTM
                      , B.DDL_COL_PNM AS A_DDL_COL_PNM
                      , B.DDL_COL_LNM AS A_DDL_COL_LNM
                      , B.COL_ORD AS A_COL_ORD
                      , B.PK_YN AS A_PK_YN
                      , B.DATA_TYPE AS A_DATA_TYPE
                      , B.DATA_LEN AS A_DATA_LEN
                      , B.DATA_SCAL	AS A_DATA_SCAL
                      , B.NONUL_YN AS A_NONUL_YN
                      , B.DEFLT_VAL AS A_DEFLT_VAL
                   FROM WAM_DDL_TBL A
                        INNER JOIN WAM_DDL_COL B
                           ON B.DDL_TBL_ID   = A.DDL_TBL_ID                           
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
                  WHERE 1 = 1
                    AND A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}   
                                                                
                ) A
        LEFT OUTER JOIN 
               (
                SELECT  A.DB_SCH_ID AS B_DB_SCH_ID
                      , D.DB_CONN_TRG_PNM AS B_DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM AS B_DB_SCH_PNM
                      , A.DDL_TBL_PNM    AS B_DDL_TBL_PNM
                      , A.DDL_TBL_LNM    AS B_DDL_TBL_LNM
                      , A.APRV_DTM       AS B_APRV_DTM 
                      , B.DDL_COL_PNM    AS B_DDL_COL_PNM
                      , B.DDL_COL_LNM    AS B_DDL_COL_LNM              
                      , B.COL_ORD AS B_COL_ORD
                      , B.PK_YN AS B_PK_YN
                      , B.DATA_TYPE AS B_DATA_TYPE
                      , B.DATA_LEN AS B_DATA_LEN
                      , B.DATA_SCAL	AS B_DATA_SCAL
                      , B.NONUL_YN AS B_NONUL_YN
                      , B.DEFLT_VAL AS B_DEFLT_VAL
                   FROM WAM_DDL_TBL A
                        INNER JOIN WAM_DDL_COL B
                           ON B.DDL_TBL_ID   = A.DDL_TBL_ID   
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
                  WHERE 1 = 1 
                   AND A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}   
                ) B                
                ON 1 = 1              
<!--                AND A.DB_SCH_PNM  = B.DB_SCH_PNM  -->
               AND A_DDL_TBL_PNM = B_DDL_TBL_PNM
               AND A_DDL_COL_PNM = B_DDL_COL_PNM 
			)
UNION	   
			SELECT * FROM (
			  (
			   SELECT   A.DB_SCH_ID AS A_DB_SCH_ID
                      , D.DB_CONN_TRG_PNM AS A_DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM AS A_DB_SCH_PNM
                      , A.DDL_TBL_PNM AS A_DDL_TBL_PNM
                      , A.DDL_TBL_LNM AS A_DDL_TBL_LNM
                      , A.APRV_DTM AS A_APRV_DTM
                      , B.DDL_COL_PNM AS A_DDL_COL_PNM
                      , B.DDL_COL_LNM AS A_DDL_COL_LNM
                      , B.COL_ORD AS A_COL_ORD
                      , B.PK_YN AS A_PK_YN
                      , B.DATA_TYPE AS A_DATA_TYPE
                      , B.DATA_LEN AS A_DATA_LEN
                      , B.DATA_SCAL	AS A_DATA_SCAL
                      , B.NONUL_YN AS A_NONUL_YN
                      , B.DEFLT_VAL AS A_DEFLT_VAL
                   FROM WAM_DDL_TBL A
                        INNER JOIN WAM_DDL_COL B
                           ON B.DDL_TBL_ID   = A.DDL_TBL_ID                           
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
                  WHERE 1 = 1
                    AND A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}   
                                                                
                ) A
        RIGHT OUTER JOIN 
               (
                SELECT  A.DB_SCH_ID AS B_DB_SCH_ID
                      , D.DB_CONN_TRG_PNM AS B_DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM AS B_DB_SCH_PNM
                      , A.DDL_TBL_PNM    AS B_DDL_TBL_PNM
                      , A.DDL_TBL_LNM    AS B_DDL_TBL_LNM
                      , A.APRV_DTM       AS B_APRV_DTM 
                      , B.DDL_COL_PNM    AS B_DDL_COL_PNM
                      , B.DDL_COL_LNM    AS B_DDL_COL_LNM              
                      , B.COL_ORD AS B_COL_ORD
                      , B.PK_YN AS B_PK_YN
                      , B.DATA_TYPE AS B_DATA_TYPE
                      , B.DATA_LEN AS B_DATA_LEN
                      , B.DATA_SCAL	AS B_DATA_SCAL
                      , B.NONUL_YN AS B_NONUL_YN
                      , B.DEFLT_VAL AS B_DEFLT_VAL
                   FROM WAM_DDL_TBL A
                        INNER JOIN WAM_DDL_COL B
                           ON B.DDL_TBL_ID   = A.DDL_TBL_ID   
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
                  WHERE 1 = 1 
                   AND A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}   
                ) B                
                ON 1 = 1              
<!--                AND A.DB_SCH_PNM  = B.DB_SCH_PNM  -->
               AND A_DDL_TBL_PNM = B_DDL_TBL_PNM
               AND A_DDL_COL_PNM = B_DDL_COL_PNM 
			)
			     
		 ) FSQ   
			      
         WHERE 1 = 1  
         GROUP BY IFNULL(A_DB_SCH_PNM, B_DB_SCH_PNM) 
                , IFNULL(A_DDL_TBL_PNM, B_DDL_TBL_PNM) 
       ) X
     WHERE 1 = 1  
      <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     	  
	  <if test="ddlTblPnm != null">
	   	   AND UPPER(X.DDL_TBL_PNM) LIKE CONCAT('%' , UPPER(#{ddlTblPnm, jdbcType=VARCHAR}) ,'%')
	  </if>   		                 
    ORDER BY DDL_TBL_PNM  
</select>

<!-- 위의 selectDdlSrcTgtTblGapList 쿼리를 오라클 버전으로 바꾸기 전 원본  -->
<select id="selectDdlSrcTgtTblGapList_BAKUP" resultMap="DdlSrcTgtGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT 	/* ModelGapMapper.selectDdlSrcTgtTblGapList */
		   CONCAT(SRC_DB_CONN_TRG_PNM , '.' , SRC_DB_SCH_PNM) AS SRC_DB_SCH_PNM
	     , CONCAT(TGT_DB_CONN_TRG_PNM , '.' , TGT_DB_SCH_PNM) AS TGT_DB_SCH_PNM
	     , DDL_TBL_PNM 
         , IFNULL(SRC_DDL_TBL_LNM, TGT_DDL_TBL_LNM) AS DDL_TBL_LNM        
         , GAP_STATUS     
         , COL_GAP_CNT   
         , SRC_DDL_COL_CNT        
         , TGT_DDL_COL_CNT   
         , APRV_DTM     
         , SRC_DB_SCH_ID
         , TGT_DB_SCH_ID
      FROM (
		SELECT MAX(SRC_DB_CONN_TRG_PNM)            AS SRC_DB_CONN_TRG_PNM
             , MAX(SRC_DB_SCH_ID)                  AS SRC_DB_SCH_ID		   
             , MAX(SRC_DB_SCH_PNM)                 AS SRC_DB_SCH_PNM
             , MAX(TGT_DB_CONN_TRG_PNM)            AS TGT_DB_CONN_TRG_PNM
             , MAX(TGT_DB_SCH_ID)                  AS TGT_DB_SCH_ID
             , MAX(TGT_DB_SCH_PNM)                 AS TGT_DB_SCH_PNM
             , IFNULL(SRC_DDL_TBL_PNM, TGT_DDL_TBL_PNM) AS DDL_TBL_PNM
             , IFNULL(SRC_APRV_DTM, TGT_APRV_DTM)       AS APRV_DTM
             , CASE WHEN MAX(TGT_DDL_TBL_ID)  IS NULL THEN 'NTGT'   -- 타겟 테이블미존재 
                    WHEN MAX(SRC_DDL_TBL_ID)  IS NULL THEN 'NSRC'   -- '소스 테이블미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(SRC_DDL_COL_LNM,'_') != IFNULL(TGT_DDL_COL_LNM,'_')
                                         OR SRC_DATA_TYPE != TGT_DATA_TYPE
                                         OR IFNULL(SRC_DATA_LEN, 0)   != IFNULL(TGT_DATA_LEN, 0)
                                         OR IFNULL(SRC_DATA_SCAL,0)   != IFNULL( TGT_DATA_SCAL,0)
                                         OR SRC_COL_ORD            != TGT_COL_ORD
                                         OR IFNULL(SRC_NONUL_YN,'N')  != IFNULL(TGT_NONUL_YN,'N')
                                         OR IFNULL(SRC_DEFLT_VAL,'_') != IFNULL(TGT_DEFLT_VAL,'_')
                                         OR IFNULL(SRC_PK_YN,'N')     != IFNULL(TGT_PK_YN,'N')      THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(SRC_DDL_COL_LNM,'_') != IFNULL(TGT_DDL_COL_LNM,'_')  
                                 OR SRC_DATA_TYPE != TGT_DATA_TYPE
                                 OR SRC_DATA_LEN  != TGT_DATA_LEN
                                 OR SRC_DATA_SCAL != TGT_DATA_SCAL
                                 OR SRC_COL_ORD   != TGT_COL_ORD
                                 OR IFNULL(SRC_NONUL_YN,'N')  != IFNULL(TGT_NONUL_YN,'N')
                                 OR IFNULL(SRC_DEFLT_VAL,'_') != IFNULL(TGT_DEFLT_VAL,'_')
                                 OR IFNULL(SRC_PK_YN,'N')     != IFNULL(TGT_PK_YN,'N')   THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(SRC_DDL_TBL_PNM)  AS SRC_DDL_COL_CNT        
             , COUNT(TGT_DDL_TBL_PNM)  AS TGT_DDL_COL_CNT
             , MAX(TGT_DDL_TBL_PNM)    AS TGT_DDL_TBL_PNM
             , MAX(TGT_DDL_TBL_LNM)    AS TGT_DDL_TBL_LNM            
             , MAX(SRC_DDL_TBL_PNM)    AS SRC_DDL_TBL_PNM
             , MAX(SRC_DDL_TBL_LNM)    AS SRC_DDL_TBL_LNM
             , MAX(SRC_DDL_COL_PNM)    AS TGT_DDL_COL_PNM
             , MAX(SRC_DDL_COL_LNM)    AS TGT_DDL_COL_LNM         
          FROM (
		
					select  A.DB_SCH_ID as SRC_DB_SCH_ID
				          , A.DB_CONN_TRG_PNM as SRC_DB_CONN_TRG_PNM
				          , A.DB_SCH_PNM as SRC_DB_SCH_PNM                                                              
				          , A.DDL_TBL_PNM as SRC_DDL_TBL_PNM   
				          , A.DDL_TBL_LNM as SRC_DDL_TBL_LNM  
				          , A.DDL_TBL_ID as SRC_DDL_TBL_ID 
				          , A.APRV_DTM as SRC_APRV_DTM   
				          , A.DDL_COL_PNM as SRC_DDL_COL_PNM 
				          , A.DDL_COL_LNM as SRC_DDL_COL_LNM              
				          , A.COL_ORD as SRC_COL_ORD
				          , A.PK_YN as SRC_PK_YN
				          , A.DATA_TYPE as SRC_DATA_TYPE
				          , A.DATA_LEN as SRC_DATA_LEN
				          , A.DATA_SCAL	as SRC_DATA_SCAL
				          , A.NONUL_YN as SRC_NONUL_YN
				          , A.DEFLT_VAL as SRC_DEFLT_VAL
				          
				          , B.DB_SCH_ID as TGT_DB_SCH_ID
				          , B.DB_CONN_TRG_PNM as TGT_DB_CONN_TRG_PNM
				          , B.DB_SCH_PNM as TGT_DB_SCH_PNM                                                              
				          , B.DDL_TBL_PNM as TGT_DDL_TBL_PNM   
				          , B.DDL_TBL_LNM as TGT_DDL_TBL_LNM   
				          , B.DDL_TBL_ID as TGT_DDL_TBL_ID
				          , B.APRV_DTM as TGT_APRV_DTM   
				          , B.DDL_COL_PNM as TGT_DDL_COL_PNM 
				          , B.DDL_COL_LNM as TGT_DDL_COL_LNM              
				          , B.COL_ORD as TGT_COL_ORD
				          , B.PK_YN as TGT_PK_YN
				          , B.DATA_TYPE as TGT_DATA_TYPE
				          , B.DATA_LEN as TGT_DATA_LEN
				          , B.DATA_SCAL	as TGT_DATA_SCAL
				          , B.NONUL_YN as TGT_NONUL_YN
				          , B.DEFLT_VAL as TGT_DEFLT_VAL
				     from (
							SELECT   A.DB_SCH_ID 
				                      , D.DB_CONN_TRG_PNM
				                      , C.DB_SCH_PNM                                                                    
				                      , A.DDL_TBL_PNM    
				                      , A.DDL_TBL_LNM  
				                      , A.DDL_TBL_ID  
				                      , A.APRV_DTM        
				                      , B.DDL_COL_PNM    
				                      , B.DDL_COL_LNM                  
				                      , B.COL_ORD
				                      , B.PK_YN
				                      , B.DATA_TYPE
				                      , B.DATA_LEN
				                      , B.DATA_SCAL	
				                      , B.NONUL_YN
				                      , B.DEFLT_VAL                     
				                   FROM WAM_DDL_TBL A
				                        INNER JOIN WAM_DDL_COL B
				                           ON B.DDL_TBL_ID   = A.DDL_TBL_ID                    
				                        INNER JOIN WAA_DB_SCH C
				                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                          AND C.DB_SCH_ID = A.DB_SCH_ID
				                        INNER JOIN WAA_DB_CONN_TRG D
					                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
					                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
				                  WHERE A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
				                    ) A
							inner join (
								SELECT  A.DB_SCH_ID 
				                      , D.DB_CONN_TRG_PNM
				                      , C.DB_SCH_PNM                                                                    
				                      , A.DDL_TBL_PNM    AS DDL_TBL_PNM
				                      , A.DDL_TBL_LNM    AS DDL_TBL_LNM
				                      , A.DDL_TBL_ID
				                      , A.APRV_DTM       AS APRV_DTM 
				                      , B.DDL_COL_PNM    AS DDL_COL_PNM
				                      , B.DDL_COL_LNM    AS DDL_COL_LNM              
				                      , B.COL_ORD
				                      , B.PK_YN
				                      , B.DATA_TYPE
				                      , B.DATA_LEN
				                      , B.DATA_SCAL	
				                      , B.NONUL_YN
				                      , B.DEFLT_VAL                      
				                   FROM WAM_DDL_TBL A
				                        INNER JOIN WAM_DDL_COL B
				                           ON B.DDL_TBL_ID   = A.DDL_TBL_ID
				                        INNER JOIN WAA_DB_SCH C
				                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                          AND C.DB_SCH_ID = A.DB_SCH_ID
				                        INNER JOIN WAA_DB_CONN_TRG D
					                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
					                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID    
				                  WHERE A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
							) B    
							ON 1 = 1              
				               AND A.DDL_TBL_PNM = B.DDL_TBL_PNM
				               AND A.DDL_COL_PNM = B.DDL_COL_PNM 
						where 1=1               
						
						union
						
						select  A.DB_SCH_ID as SRC_DB_SCH_ID
					          , D.DB_CONN_TRG_PNM as SRC_DB_CONN_TRG_PNM
					          , C.DB_SCH_PNM as SRC_DB_SCH_PNM                                                              
					          , A.DDL_TBL_PNM as SRC_DDL_TBL_PNM   
					          , A.DDL_TBL_LNM as SRC_DDL_TBL_LNM
					          , A.DDL_TBL_ID as SRC_DDL_TBL_ID   
					          , A.APRV_DTM as SRC_APRV_DTM   
					          , B.DDL_COL_PNM as SRC_DDL_COL_PNM 
					          , B.DDL_COL_LNM as SRC_DDL_COL_LNM              
					          , B.COL_ORD as SRC_COL_ORD
					          , B.PK_YN as SRC_PK_YN
					          , B.DATA_TYPE as SRC_DATA_TYPE
					          , B.DATA_LEN as SRC_DATA_LEN
					          , B.DATA_SCAL	as SRC_DATA_SCAL
					          , B.NONUL_YN as SRC_NONUL_YN
					          , B.DEFLT_VAL as SRC_DEFLT_VAL
					          
					          , C2.DB_SCH_ID as TGT_DB_SCH_ID
					          , D2.DB_CONN_TRG_PNM as TGT_DB_CONN_TRG_PNM
					          , C2.DB_SCH_PNM as TGT_DB_SCH_PNM                                                              
					          , A.DDL_TBL_PNM as TGT_DDL_TBL_PNM   
					          , NULL as TGT_DDL_TBL_LNM   
					          , NULL as TGT_DDL_TBL_ID
					          , NULL as TGT_APRV_DTM   
					          , NULL as TGT_DDL_COL_PNM 
					          , NULL as TGT_DDL_COL_LNM              
					          , NULL as TGT_COL_ORD
					          , NULL as TGT_PK_YN
					          , NULL as TGT_DATA_TYPE
					          , NULL as TGT_DATA_LEN
					          , NULL as TGT_DATA_SCAL
					          , NULL as TGT_NONUL_YN
					          , NULL as TGT_DEFLT_VAL
				         FROM WAM_DDL_TBL A
				                    INNER JOIN WAM_DDL_COL B
				                       ON B.DDL_TBL_ID   = A.DDL_TBL_ID                        
				                    INNER JOIN WAA_DB_SCH C
				                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                      AND C.DB_SCH_ID = A.DB_SCH_ID
				                    INNER JOIN WAA_DB_CONN_TRG D
				                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
				                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
				                     left join WAA_DB_SCH C2
				                       on C2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                      and C2.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
				                     left join WAA_DB_CONN_TRG D2
				                       ON D2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
				                      AND D2.DB_CONN_TRG_ID = C2.DB_CONN_TRG_ID
				              WHERE A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
				                and not exists (
				        				        select 1 from WAM_DDL_TBL A2
				        				         inner join WAM_DDL_COL B2
				        				            on B2.DDL_TBL_ID = A2.DDL_TBL_ID
				        				         where A2.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
				        				           and A2.DDL_TBL_PNM = A.DDL_TBL_PNM
				        				        )
				
						union
						
						select  C2.DB_SCH_ID as SRC_DB_SCH_ID
					          , D2.DB_CONN_TRG_PNM as SRC_DB_CONN_TRG_PNM
					          , C2.DB_SCH_PNM as SRC_DB_SCH_PNM                                                              
					          , A.DDL_TBL_PNM as SRC_DDL_TBL_PNM   
					          , NULL as SRC_DDL_TBL_LNM   
					          , NULL as SRC_DDL_TBL_ID
					          , NULL as SRC_APRV_DTM   
					          , NULL as SRC_DDL_COL_PNM 
					          , NULL as SRC_DDL_COL_LNM              
					          , NULL as SRC_COL_ORD
					          , NULL as SRC_PK_YN
					          , NULL as SRC_DATA_TYPE
					          , NULL as SRC_DATA_LEN
					          , NULL as SRC_DATA_SCAL
					          , NULL as SRC_NONUL_YN
					          , NULL as SRC_DEFLT_VAL
					          
					          , A.DB_SCH_ID as TGT_DB_SCH_ID
					          , D.DB_CONN_TRG_PNM as TGT_DB_CONN_TRG_PNM
					          , C.DB_SCH_PNM as TGT_DB_SCH_PNM                                                              
					          , A.DDL_TBL_PNM as TGT_DDL_TBL_PNM   
					          , A.DDL_TBL_LNM as TGT_DDL_TBL_LNM   
					          , A.DDL_TBL_ID as TGT_DDL_TBL_ID
					          , A.APRV_DTM as TGT_APRV_DTM   
					          , B.DDL_COL_PNM as TGT_DDL_COL_PNM 
					          , B.DDL_COL_LNM as TGT_DDL_COL_LNM              
					          , B.COL_ORD as TGT_COL_ORD
					          , B.PK_YN as TGT_PK_YN
					          , B.DATA_TYPE as TGT_DATA_TYPE
					          , B.DATA_LEN as TGT_DATA_LEN
					          , B.DATA_SCAL	as TGT_DATA_SCAL
					          , B.NONUL_YN as TGT_NONUL_YN
					          , B.DEFLT_VAL as TGT_DEFLT_VAL
				         FROM WAM_DDL_TBL A
				                    INNER JOIN WAM_DDL_COL B
				                       ON B.DDL_TBL_ID   = A.DDL_TBL_ID                          
				                    INNER JOIN WAA_DB_SCH C
				                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                      AND C.DB_SCH_ID = A.DB_SCH_ID
				                    INNER JOIN WAA_DB_CONN_TRG D
				                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
				                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
				                     left join WAA_DB_SCH C2
				                       on C2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
				                      and C2.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
				                     left join WAA_DB_CONN_TRG D2
				                       ON D2.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
				                      AND D2.DB_CONN_TRG_ID = C2.DB_CONN_TRG_ID
				              WHERE A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
				                and not exists (
				        				        select 1 from WAM_DDL_TBL A2
				        				         inner join WAM_DDL_COL B2
				        				            on B2.DDL_TBL_ID = A2.DDL_TBL_ID
				        				         where A2.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
				        				           and A2.DDL_TBL_PNM = A.DDL_TBL_PNM
				        				           and B2.DDL_COL_PNM = B.DDL_COL_PNM
				        				          
				        				        )
		 ) A
         GROUP BY IFNULL(SRC_DB_SCH_PNM, TGT_DB_SCH_PNM) 
                , IFNULL(SRC_DDL_TBL_PNM, TGT_DDL_TBL_PNM)
   ) X
    <where> 
      <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     	  
	  <if test="ddlTblPnm != null">
	   	   AND X.DDL_TBL_PNM LIKE CONCAT('%',#{ddlTblPnm, jdbcType=VARCHAR},'%')
	  </if>
     </where> 
<!--     ORDER BY DDL_TBL_PNM  -->
	
</select>


<select id="selectDdlSrcTgtColGapList" resultMap="DdlSrcTgtGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT /* ModelGapMapper.selectDdlSrcTgtColGapList */
	* FROM (
	SELECT IFNULL(B.DB_SCH_PNM, A.DB_SCH_PNM)       AS DB_SCH_PNM	 	     
	     ,   CONCAT(
			        CASE WHEN A.DDL_COL_PNM IS NULL                THEN '소스컬럼미존재' ELSE '' END
			      , CASE WHEN B.DDL_COL_PNM IS NULL                THEN '타겟컬럼미존재' ELSE '' END
			      , CASE WHEN IFNULL(A.PK_YN,'N') != IFNULL(B.PK_YN,'N') THEN 'PK여부불일치' ELSE '' END
			      , CASE WHEN A.DATA_TYPE != B.DATA_TYPE           THEN '데이터타입불일치' ELSE '' END
			      , CASE WHEN A.DATA_LEN  != B.DATA_LEN            THEN '데이터길이불일치' ELSE '' END
			      , CASE WHEN IFNULL(A.DATA_SCAL,-1) != IFNULL(B.DATA_SCAL,-1)   THEN '소수점불일치' ELSE '' END
			      , CASE WHEN A.COL_ORD   != B.COL_ORD                     THEN '컬럼순서불일치' ELSE '' END
			      , CASE WHEN IFNULL(A.NONUL_YN,'N')  != IFNULL(B.NONUL_YN,'N')  THEN 'NOT NULL여부불일치' ELSE '' END
			      , CASE WHEN IFNULL(A.DEFLT_VAL,'_') != IFNULL(B.DEFLT_VAL,'_') THEN 'DEFAULT불일치' ELSE '' END
			  )   AS GAP_STATUS   
	     , IFNULL(A.DDL_TBL_PNM, B.DDL_TBL_PNM)     AS DDL_TBL_NM       
	     , A.DDL_TBL_LNM     AS SRC_DDL_TBL_LNM    
	     , A.DDL_COL_PNM     AS SRC_DDL_COL_PNM
	     , A.DDL_COL_LNM     AS SRC_DDL_COL_LNM
	     , A.COL_ORD         AS SRC_DDL_COL_ORD
	     , A.PK_YN           AS SRC_DDL_PK_YN
	     , A.DATA_TYPE       AS SRC_DDL_DATA_TYPE
	     , A.DATA_LEN        AS SRC_DDL_DATA_LEN
	     , A.DATA_SCAL       AS SRC_DDL_DATA_SCAL
	     , A.NONUL_YN        AS SRC_DDL_NONUL_YN
	     , A.DEFLT_VAL       AS SRC_DDL_DEFLT_VAL         
	     , B.DDL_TBL_PNM     AS TGT_DDL_TBL_PNM
	     , B.DDL_COL_PNM     AS TGT_DDL_COL_PNM
	     , B.DDL_COL_LNM     AS TGT_DDL_COL_LNM         
	     , B.COL_ORD         AS TGT_DDL_COL_ORD
	     , B.PK_YN           AS TGT_DDL_PK_YN
	     , B.DATA_TYPE       AS TGT_DDL_DATA_TYPE
	     , B.DATA_LEN        AS TGT_DDL_DATA_LEN
	     , B.DATA_SCAL       AS TGT_DDL_DATA_SCAL
	     , B.NONUL_YN        AS TGT_DDL_NONUL_YN
	     , B.DEFLT_VAL       AS TGT_DDL_DEFLT_VAL         
	  FROM (SELECT  A.DB_SCH_ID 
                  , D.DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM                                                                    
                  , A.DDL_TBL_PNM    
                  , A.DDL_TBL_LNM    
                  , A.APRV_DTM        
                  , B.DDL_COL_PNM    
                  , B.DDL_COL_LNM                  
                  , B.COL_ORD
                  , B.PK_YN
                  , B.DATA_TYPE
                  , B.DATA_LEN
                  , B.DATA_SCAL	
                  , B.NONUL_YN
                  , B.DEFLT_VAL       
               FROM WAM_DDL_TBL A
                    INNER JOIN WAM_DDL_COL B
                       ON B.DDL_TBL_ID   = A.DDL_TBL_ID   
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID
                    INNER JOIN WAA_DB_CONN_TRG D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                  AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
              WHERE 1 = 1
                AND A.DB_SCH_ID   = #{srcDbSchId, jdbcType=VARCHAR}   
                AND A.DDL_TBL_PNM = #{ddlTblPnm, jdbcType=VARCHAR}   
                                                            
            ) A
           JOIN 
           (
            SELECT  A.DB_SCH_ID 
                  , D.DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM                                                                    
                  , A.DDL_TBL_PNM    
                  , A.DDL_TBL_LNM    
                  , A.APRV_DTM        
                  , B.DDL_COL_PNM    
                  , B.DDL_COL_LNM                  
                  , B.COL_ORD
                  , B.PK_YN
                  , B.DATA_TYPE
                  , B.DATA_LEN
                  , B.DATA_SCAL	
                  , B.NONUL_YN
                  , B.DEFLT_VAL     
               FROM WAM_DDL_TBL A
                    INNER JOIN WAM_DDL_COL B
                       ON B.DDL_TBL_ID   = A.DDL_TBL_ID 
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID
                    INNER JOIN WAA_DB_CONN_TRG D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                  AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
              WHERE 1 = 1 
               AND A.DB_SCH_ID   = #{tgtDbSchId, jdbcType=VARCHAR}   
               AND A.DDL_TBL_PNM = #{ddlTblPnm, jdbcType=VARCHAR}
            ) B                
            ON 1 = 1              
<!--            AND A.DB_SCH_PNM  = B.DB_SCH_PNM	 --> 
           AND A.DDL_TBL_PNM = B.DDL_TBL_PNM
           AND A.DDL_COL_PNM = B.DDL_COL_PNM 
    WHERE 1 = 1  
    
    union
    
    SELECT  C.DB_SCH_PNM       AS DB_SCH_PNM	 	     
	      , '타겟컬럼미존재'    AS GAP_STATUS   
	     , A.DDL_TBL_PNM     AS DDL_TBL_NM       
	     , A.DDL_TBL_LNM     AS SRC_DDL_TBL_LNM    
	     , B.DDL_COL_PNM     AS SRC_DDL_COL_PNM
	     , B.DDL_COL_LNM     AS SRC_DDL_COL_LNM
	     , B.COL_ORD         AS SRC_DDL_COL_ORD
	     , B.PK_YN           AS SRC_DDL_PK_YN
	     , B.DATA_TYPE       AS SRC_DDL_DATA_TYPE
	     , B.DATA_LEN        AS SRC_DDL_DATA_LEN
	     , B.DATA_SCAL       AS SRC_DDL_DATA_SCAL
	     , B.NONUL_YN        AS SRC_DDL_NONUL_YN
	     , B.DEFLT_VAL       AS SRC_DDL_DEFLT_VAL         
	     , NULL     AS TGT_DDL_TBL_PNM
	     , NULL     AS TGT_DDL_COL_PNM
	     , NULL     AS TGT_DDL_COL_LNM         
	     , NULL     AS TGT_DDL_COL_ORD
	     , NULL     AS TGT_DDL_PK_YN
	     , NULL     AS TGT_DDL_DATA_TYPE
	     , NULL     AS TGT_DDL_DATA_LEN
	     , NULL     AS TGT_DDL_DATA_SCAL
	     , NULL     AS TGT_DDL_NONUL_YN
	     , NULL     AS TGT_DDL_DEFLT_VAL       
       FROM WAM_DDL_TBL A
            INNER JOIN WAM_DDL_COL B
               ON B.DDL_TBL_ID   = A.DDL_TBL_ID 
            INNER JOIN WAA_DB_SCH C
               ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
              AND C.DB_SCH_ID = A.DB_SCH_ID
            INNER JOIN WAA_DB_CONN_TRG D
               ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
              AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID      
      WHERE 1 = 1
        AND A.DB_SCH_ID   = #{srcDbSchId, jdbcType=VARCHAR}
        AND A.DDL_TBL_PNM = #{ddlTblPnm, jdbcType=VARCHAR}
        and not exists (
        				select 1 from WAM_DDL_TBL A2
        				 inner join WAM_DDL_COL B2
        				    on B2.DDL_TBL_ID = A2.DDL_TBL_ID
        				 where A2.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}
        				   and A2.DDL_TBL_PNM = A.DDL_TBL_PNM
        				   and B2.DDL_COL_PNM = B.DDL_COL_PNM
        				)
	
    union
    
    SELECT  C.DB_SCH_PNM       AS DB_SCH_PNM	 	     
	      , '소스컬럼미존재'    AS GAP_STATUS   
	     , A.DDL_TBL_PNM     AS DDL_TBL_NM       
	     , NULL     AS SRC_DDL_TBL_PNM
	     , NULL     AS SRC_DDL_COL_PNM
	     , NULL     AS SRC_DDL_COL_LNM         
	     , NULL     AS SRC_DDL_COL_ORD
	     , NULL     AS SRC_DDL_PK_YN
	     , NULL     AS SRC_DDL_DATA_TYPE
	     , NULL     AS SRC_DDL_DATA_LEN
	     , NULL     AS SRC_DDL_DATA_SCAL
	     , NULL     AS SRC_DDL_NONUL_YN
	     , NULL     AS SRC_DDL_DEFLT_VAL   
	     , A.DDL_TBL_LNM     AS TGT_DDL_TBL_LNM    
	     , B.DDL_COL_PNM     AS TGT_DDL_COL_PNM
	     , B.DDL_COL_LNM     AS TGT_DDL_COL_LNM
	     , B.COL_ORD         AS TGT_DDL_COL_ORD
	     , B.PK_YN           AS TGT_DDL_PK_YN
	     , B.DATA_TYPE       AS TGT_DDL_DATA_TYPE
	     , B.DATA_LEN        AS TGT_DDL_DATA_LEN
	     , B.DATA_SCAL       AS TGT_DDL_DATA_SCAL
	     , B.NONUL_YN        AS TGT_DDL_NONUL_YN
	     , B.DEFLT_VAL       AS TGT_DDL_DEFLT_VAL 
       FROM WAM_DDL_TBL A
            INNER JOIN WAM_DDL_COL B
               ON B.DDL_TBL_ID   = A.DDL_TBL_ID   
            INNER JOIN WAA_DB_SCH C
               ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
              AND C.DB_SCH_ID = A.DB_SCH_ID
            INNER JOIN WAA_DB_CONN_TRG D
               ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
              AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID      
      WHERE 1 = 1
        AND A.DB_SCH_ID   = #{tgtDbSchId, jdbcType=VARCHAR}  
        AND A.DDL_TBL_PNM = #{ddlTblPnm, jdbcType=VARCHAR}
        and not exists (
        				select 1 from WAM_DDL_TBL A2
        				 inner join WAM_DDL_COL B2
        				    on B2.DDL_TBL_ID = A2.DDL_TBL_ID
        				 where A2.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}
        				   and A2.DDL_TBL_PNM = A.DDL_TBL_PNM
        				   and B2.DDL_COL_PNM = B.DDL_COL_PNM
        				)
) A

    ORDER BY DDL_TBL_NM 
           , IFNULL(TGT_DDL_COL_ORD, SRC_DDL_COL_ORD)
           
</select>



<resultMap id="DdlIdxSrcTgtGapMap" type="kr.wise.meta.gap.service.ModelGapVO">

    <result column="GAP_STATUS"          property="gapStatus"       jdbcType="VARCHAR" />
	<result column="DDL_TBL_CNT"         property="ddlTblCnt"       jdbcType="VARCHAR" />
    <result column="GAP_CNT"             property="gapCnt"          jdbcType="VARCHAR" />
    <result column="COL_GAP_CNT"         property="colGapCnt"       jdbcType="VARCHAR" />
    <result column="NML_CNT"             property="nmlCnt"          jdbcType="VARCHAR" />
    <result column="SRC_DDL_IDX_COL_CNT" property="srcDdlIdxColCnt" jdbcType="VARCHAR" />
    <result column="TGT_DDL_IDX_COL_CNT" property="tgtDdlIdxColCnt" jdbcType="VARCHAR" /> 
    <result column="APRV_DTM"            property="aprvDtm"         jdbcType="VARCHAR" />
          
    <result column="SRC_DB_SCH_ID"      property="srcDbSchId"       jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_PNM"     property="srcDbSchPnm"      jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_ID"      property="tgtDbSchId"       jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_PNM"     property="tgtDbSchPnm"      jdbcType="VARCHAR" />
    <result column="DDL_TBL_PNM"        property="ddlTblPnm"        jdbcType="VARCHAR" />
    <result column="DDL_TBL_LNM"        property="ddlTbLnm"         jdbcType="VARCHAR" />
    <result column="DDL_IDX_PNM"        property="ddlIdxPnm"        jdbcType="VARCHAR" />
    
   
    <result column="DDL_TBL_PNM"        property="ddlTblPnm"        jdbcType="VARCHAR" />
    <result column="DDL_TBL_LNM"        property="ddlTblLnm"        jdbcType="VARCHAR" />
        
    <result column="SRC_DDL_TBL_PNM"      property="srcDdlTblPnm"     jdbcType="VARCHAR" />    
    <result column="SRC_DDL_TBL_LNM"      property="srcDdlTblLnm"     jdbcType="VARCHAR" />   
    <result column="SRC_DDL_IDX_PNM"      property="srcDdlIdxPnm"     jdbcType="VARCHAR" />
    <result column="SRC_DDL_IDX_LNM"      property="srcDdlIdxLnm"     jdbcType="VARCHAR" />
    <result column="SRC_UK_IDX_YN"        property="srcUkIdxYn"       jdbcType="VARCHAR" />           
    <result column="SRC_DDL_IDX_COL_PNM"  property="srcDdlIdxColPnm"  jdbcType="VARCHAR" />
    <result column="SRC_DDL_IDX_COL_LNM"  property="srcDdlIdxColLnm"  jdbcType="VARCHAR" />    
    <result column="SRC_DDL_IDX_COL_ORD"  property="srcDdlIdxColOrd"  jdbcType="VARCHAR" />
    <result column="SRC_SORT_TYP"         property="srcSortTyp"       jdbcType="VARCHAR" />    
    
    <result column="TGT_DDL_TBL_PNM"      property="tgtDdlTblPnm"     jdbcType="VARCHAR" />
    <result column="TGT_DDL_TBL_LNM"      property="tgtDdlTblLnm"     jdbcType="VARCHAR" />
    <result column="TGT_DDL_IDX_PNM"      property="tgtDdlIdxPnm"     jdbcType="VARCHAR" />
    <result column="TGT_DDL_IDX_LNM"      property="tgtDdlIdxLnm"     jdbcType="VARCHAR" />
    <result column="TGT_UK_IDX_YN"        property="tgtUkIdxYn"       jdbcType="VARCHAR" />
    <result column="TGT_DDL_IDX_COL_PNM"  property="tgtDdlIdxColPnm"  jdbcType="VARCHAR" />
    <result column="TGT_DDL_IDX_COL_LNM"  property="tgtDdlIdxColLnm"  jdbcType="VARCHAR" />
    <result column="TGT_DDL_IDX_COL_ORD"  property="tgtDdlIdxColOrd"  jdbcType="VARCHAR" /> 
    <result column="TGT_SORT_TYP"         property="tgtSortTyp"       jdbcType="VARCHAR" />
    
</resultMap>


<select id="selectDdlIdxSrcTgtTblGapList" resultMap="DdlIdxSrcTgtGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
    SELECT 	/* ModelGapMapper.selectDdlIdxSrcTgtTblGapList */
    	   CONCAT(SRC_DB_CONN_TRG_PNM ,'.', SRC_DB_SCH_PNM) AS SRC_DB_SCH_PNM
	     , CONCAT(TGT_DB_CONN_TRG_PNM ,'.', TGT_DB_SCH_PNM) AS TGT_DB_SCH_PNM
	     , DDL_TBL_PNM
	     , DDL_IDX_PNM                  
         , GAP_STATUS     
         , COL_GAP_CNT   
         , SRC_DDL_IDX_COL_CNT        
         , TGT_DDL_IDX_COL_CNT   
         , APRV_DTM     
         , SRC_DB_SCH_ID
         , TGT_DB_SCH_ID
      FROM (
        SELECT MAX(X.DB_CONN_TRG_PNM)            AS SRC_DB_CONN_TRG_PNM
             , MAX(X.DB_SCH_ID)                  AS SRC_DB_SCH_ID		   
             , MAX(X.DB_SCH_PNM)                 AS SRC_DB_SCH_PNM
             , MAX(Y.DB_CONN_TRG_PNM)            AS TGT_DB_CONN_TRG_PNM
             , MAX(Y.DB_SCH_ID)                  AS TGT_DB_SCH_ID
             , MAX(Y.DB_SCH_PNM)                 AS TGT_DB_SCH_PNM
             , IFNULL(X.DDL_TBL_PNM, Y.DDL_TBL_PNM) AS DDL_TBL_PNM
             , IFNULL(X.DDL_IDX_PNM, Y.DDL_IDX_PNM) AS DDL_IDX_PNM
             , MAX(X.APRV_DTM)                   AS APRV_DTM
             , CASE WHEN MAX(Y.DDL_IDX_PNM)  IS NULL THEN 'NTGT'   -- 타겟 DDL인덱스 미존재 
                    WHEN MAX(X.DDL_IDX_PNM)  IS NULL THEN 'NSRC'   -- '소스 DDL인덱스 미존재' 
                    WHEN COUNT(CASE WHEN    IFNULL(X.DDL_IDX_COL_ORD, 0) != IFNULL(Y.DDL_IDX_COL_ORD, 0)  
                                         OR X.SORT_TYP != Y.SORT_TYP  THEN 1
                                END) > 0 THEN 'CGAP' 
                    ELSE 'NOR'             
                END AS GAP_STATUS     
             , COUNT(CASE WHEN      IFNULL(X.DDL_IDX_COL_ORD, 0) != IFNULL(Y.DDL_IDX_COL_ORD, 0)  
                                 OR X.SORT_TYP != Y.SORT_TYP  THEN 1
                     END) AS COL_GAP_CNT   
             , COUNT(X.DDL_IDX_PNM)   AS SRC_DDL_IDX_COL_CNT        
             , COUNT(Y.DDL_IDX_PNM)   AS TGT_DDL_IDX_COL_CNT
             , MAX(Y.DDL_IDX_PNM)     AS TGT_DDL_IDX_PNM                        
             , MAX(X.DDL_IDX_PNM)     AS SRC_DDL_IDX_PNM             
             , MAX(X.DDL_IDX_COL_PNM) AS TGT_DDL_IDX_COL_PNM                      
          FROM ( SELECT A.DB_SCH_ID 
                      , D.DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM                     
                      , E.DDL_TBL_PNM
                      , E.DDL_TBL_LNM                                               
                      , A.DDL_IDX_PNM    
                      , A.DDL_IDX_LNM    
                      , A.APRV_DTM        
                      , B.DDL_IDX_COL_PNM    
                      , B.DDL_IDX_COL_LNM                  
                      , B.DDL_IDX_COL_ORD
                      , B.SORT_TYP
                   FROM WAM_DDL_IDX A
                        INNER JOIN WAM_DDL_IDX_COL B
                           ON B.DDL_IDX_ID   = A.DDL_IDX_ID                           
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
	                    INNER JOIN WAM_DDL_TBL E
	                       ON E.DDL_TBL_ID = A.DDL_TBL_ID  
                  WHERE 1 = 1
                    AND A.DB_SCH_ID = #{srcDbSchId, jdbcType=VARCHAR}   
                                                                
                ) X
               FULL JOIN 
               (
                SELECT A.DB_SCH_ID 
                      , D.DB_CONN_TRG_PNM
                      , C.DB_SCH_PNM                     
                      , E.DDL_TBL_PNM
                      , E.DDL_TBL_LNM                                               
                      , A.DDL_IDX_PNM    
                      , A.DDL_IDX_LNM    
                      , A.APRV_DTM        
                      , B.DDL_IDX_COL_PNM    
                      , B.DDL_IDX_COL_LNM                  
                      , B.DDL_IDX_COL_ORD
                      , B.SORT_TYP
                   FROM WAM_DDL_IDX A
                        INNER JOIN WAM_DDL_IDX_COL B
                           ON B.DDL_IDX_ID   = A.DDL_IDX_ID     
                        INNER JOIN WAA_DB_SCH C
                           ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                          AND C.DB_SCH_ID = A.DB_SCH_ID 
                        INNER JOIN WAA_DB_CONN_TRG D
	                       ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                      AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
	                    INNER JOIN WAM_DDL_TBL E
	                       ON E.DDL_TBL_ID = A.DDL_TBL_ID  
                  WHERE 1 = 1
                   AND A.DB_SCH_ID = #{tgtDbSchId, jdbcType=VARCHAR}   
                ) Y                
                ON 1 = 1              
               AND X.DB_SCH_PNM      = Y.DB_SCH_PNM 
               AND X.DDL_IDX_PNM     = Y.DDL_IDX_PNM
               AND X.DDL_IDX_COL_PNM = Y.DDL_IDX_COL_PNM 
         WHERE 1 = 1  
         GROUP BY IFNULL(X.DB_SCH_PNM,  Y.DB_SCH_PNM) 
                , IFNULL(X.DDL_TBL_PNM, Y.DDL_TBL_PNM)
                , IFNULL(X.DDL_IDX_PNM, Y.DDL_IDX_PNM) 
       ) X
     WHERE 1 = 1  
      <if test="gapStatus != null">
	   	   AND X.GAP_STATUS = #{gapStatus, jdbcType=VARCHAR}
	  </if>     	  
	  <if test="dbcTblNm != null">
	   	   AND X.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm, jdbcType=VARCHAR},'%')
	  </if>   		                 
    ORDER BY DDL_TBL_PNM  
	
</select>


<select id="selectDdlIdxSrcTgtColGapList" resultMap="DdlIdxSrcTgtGapMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">

	SELECT 	/* ModelGapMapper.selectDdlIdxSrcTgtColGapList */
			IFNULL(X.DB_SCH_PNM, Y.DB_SCH_PNM)       AS DB_SCH_PNM	 	     
	      ,CONCAT(
	              CASE WHEN X.DDL_IDX_COL_PNM IS NULL                    THEN '소스컬럼미존재' END
	            , CASE WHEN Y.DDL_IDX_COL_PNM IS NULL                    THEN '타겟컬럼미존재' END
	            , CASE WHEN IFNULL(X.UK_IDX_YN,'N') != IFNULL(Y.UK_IDX_YN,'N')  THEN 'UK여부불일치' END	   
	            , CASE WHEN X.DDL_IDX_COL_ORD    != Y.DDL_IDX_COL_ORD     THEN '컬럼순서불일치' END
	            , CASE WHEN IFNULL(X.SORT_TYP,'N')  != IFNULL(Y.SORT_TYP,'N')   THEN 'SORT유형불일치' END	      
	             ) AS GAP_STATUS  
	     , IFNULL(X.DDL_TBL_PNM, Y.DDL_TBL_PNM)     AS DDL_TBL_PNM
	     , IFNULL(X.DDL_IDX_PNM, Y.DDL_IDX_PNM)     AS DDL_IDX_PNM     
	     , X.DDL_TBL_PNM        AS SRC_DDL_TBL_PNM         
	     , X.DDL_TBL_LNM        AS SRC_DDL_TBL_LNM
	     , X.DDL_IDX_PNM        AS SRC_DDL_IDX_PNM    
	     , IFNULL(X.UK_IDX_YN,'N') AS SRC_UK_IDX_YN
	     , X.DDL_IDX_COL_PNM    AS SRC_DDL_IDX_COL_PNM
	     , X.DDL_IDX_COL_ORD    AS SRC_DDL_IDX_COL_ORD
	     , X.SORT_TYP           AS SRC_SORT_TYP  
	     , Y.DDL_TBL_PNM        AS TGT_DDL_TBL_PNM         
	     , Y.DDL_TBL_LNM        AS TGT_DDL_TBL_LNM
	     , Y.DDL_IDX_PNM        AS TGT_DDL_IDX_PNM    
	     , IFNULL(Y.UK_IDX_YN,'N') AS TGT_UK_IDX_YN
	     , Y.DDL_IDX_COL_PNM    AS TGT_DDL_IDX_COL_PNM
	     , Y.DDL_IDX_COL_ORD    AS TGT_DDL_IDX_COL_ORD
	     , Y.SORT_TYP           AS TGT_SORT_TYP	    
	  FROM ( SELECT A.DB_SCH_ID 
                  , D.DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM                     
                  , E.DDL_TBL_PNM
                  , E.DDL_TBL_LNM                                               
                  , A.DDL_IDX_PNM    
                  , A.DDL_IDX_LNM    
                  , A.UK_IDX_YN
                  , A.APRV_DTM        
                  , B.DDL_IDX_COL_PNM    
                  , B.DDL_IDX_COL_LNM                  
                  , B.DDL_IDX_COL_ORD
                  , B.SORT_TYP
               FROM WAM_DDL_IDX A
                    INNER JOIN WAM_DDL_IDX_COL B
                       ON B.DDL_IDX_ID   = A.DDL_IDX_ID                           
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID 
                    INNER JOIN WAA_DB_CONN_TRG D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                  AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
	                INNER JOIN WAM_DDL_TBL E
	                   ON E.DDL_TBL_ID = A.DDL_TBL_ID  
              WHERE 1 = 1                
                AND A.DB_SCH_ID   = #{srcDbSchId, jdbcType=VARCHAR}   
                AND A.DDL_IDX_PNM = #{ddlIdxPnm, jdbcType=VARCHAR}
                                                            
            ) X
           FULL JOIN 
           (
            SELECT A.DB_SCH_ID 
                  , D.DB_CONN_TRG_PNM
                  , C.DB_SCH_PNM                     
                  , E.DDL_TBL_PNM
                  , E.DDL_TBL_LNM                                               
                  , A.DDL_IDX_PNM    
                  , A.DDL_IDX_LNM    
                  , A.UK_IDX_YN
                  , A.APRV_DTM        
                  , B.DDL_IDX_COL_PNM    
                  , B.DDL_IDX_COL_LNM                  
                  , B.DDL_IDX_COL_ORD
                  , B.SORT_TYP
               FROM WAM_DDL_IDX A
                    INNER JOIN WAM_DDL_IDX_COL B
                       ON B.DDL_IDX_ID   = A.DDL_IDX_ID                           
                    INNER JOIN WAA_DB_SCH C
                       ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
                      AND C.DB_SCH_ID = A.DB_SCH_ID 
                    INNER JOIN WAA_DB_CONN_TRG D
	                   ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d') 
	                  AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID         
	                INNER JOIN WAM_DDL_TBL E
	                   ON E.DDL_TBL_ID = A.DDL_TBL_ID  
              WHERE 1 = 1                
                AND A.DB_SCH_ID   = #{tgtDbSchId, jdbcType=VARCHAR}   
                AND A.DDL_IDX_PNM = #{ddlIdxPnm, jdbcType=VARCHAR}   
            ) Y                
            ON 1 = 1              
           AND X.DB_SCH_PNM      = Y.DB_SCH_PNM 
           AND X.DDL_IDX_PNM     = Y.DDL_IDX_PNM
           AND X.DDL_IDX_COL_PNM = Y.DDL_IDX_COL_PNM 
    WHERE 1 = 1  
    ORDER BY IFNULL(X.DB_SCH_PNM,  Y.DB_SCH_PNM) 
           , IFNULL(X.DDL_TBL_PNM, Y.DDL_TBL_PNM)
           , IFNULL(X.DDL_IDX_PNM, Y.DDL_IDX_PNM)  
           , IFNULL(X.DDL_IDX_COL_ORD, Y.DDL_IDX_COL_ORD)
           
</select>
<select id="getGapChartDateJSON" resultMap="BaseResultMap">
	SELECT 	/* ModelGapMapper.getGapChartDateJSON */
			REG_DTM
	FROM(
	SELECT DATE_FORMAT(REG_DTM,'%Y%m%d %H') AS REG_DTM
	FROM WAM_PDM_TBL PDM
	LEFT OUTER JOIN WAT_DBC_TBL T
	ON PDM.PDM_TBL_ID = T.PDM_TBL_ID
    WHERE DATE_FORMAT(REG_DTM,'%Y%m%d %H') IS NOT NULL
	GROUP BY DATE_FORMAT(REG_DTM,'%Y%m%d %H')
    )
    ORDER BY REG_DTM DESC
</select>

<select id="selectSeqDdlDbcGapList" resultMap="BaseResultMap" parameterType="kr.wise.meta.gap.service.ModelGapVO">
SELECT A.*,                                                          
       IFNULL(SCH.DB_SCH_PNM,SCH.DB_SCH_LNM) DB_SCH_PNM,
       IFNULL(TRG.DB_CONN_TRG_PNM, TRG.DB_CONN_TRG_LNM) DB_CONN_TRG_PNM,           
       CASE WHEN A.GAP_STATUS = 'GAP' THEN '#FF0000' END AS FontColor           
       FROM (
             SELECT CASE WHEN SUM(GAP_STATUS) = 0 THEN 'NML' ELSE 'GAP' END AS GAP_STATUS
                   ,CASE WHEN COUNT(DDL_SEQ_PNM) = 0 THEN '[DDL시퀀스미존재]'
                         WHEN COUNT(DBC_SEQ_PNM) = 0 THEN '[DBC시퀀스미존재]'
                         ELSE  MAX(GAP_CONTS) END  GAP_CONTS               
                   ,MAX(C_DDL_SEQ_ID)   AS DDL_SEQ_ID                                             
                   ,DDL_SEQ_PNM       AS DDL_SEQ_PNM                                         
                   ,MAX(C_DDL_SEQ_LNM)  AS DDL_SEQ_LNM                                         
                   ,MAX(DBC_SEQ_PNM)  AS DBC_SEQ_NM                                          
                   ,MAX(DB_SCH_ID)    AS DB_SCH_ID  
                   ,MAX(C_SUBJ_LNM)     AS SUBJ_LNM     
				   ,MAX(DDL_MINVAL)   AS DDL_MINVAL
				   ,MAX(DDL_MAXVAL)   AS DDL_MAXVAL
				   ,MAX(DDL_CYC_YN)   AS DDL_CYC_YN
				   ,MAX(DDL_INCBY)    AS DDL_INCBY
				   ,MAX(DDL_ORD_YN)   AS DDL_ORD_YN
				   ,MAX(DDL_CACHE_SZ) AS DDL_CACHE_SZ
				   ,MAX(DBC_MINVAL)   AS DBC_MINVAL
				   ,MAX(DBC_MAXVAL)   AS DBC_MAXVAL
				   ,MAX(DBC_CYC_YN)   AS DBC_CYC_YN
				   ,MAX(DBC_INCBY)    AS DBC_INCBY
				   ,MAX(DBC_ORD_YN)   AS DBC_ORD_YN
				   ,MAX(DBC_CACHE_SZ) AS DBC_CACHE_SZ                     
             FROM (

                  SELECT 
                    C_DDL_SEQ_ID
                   ,IFNULL(C_DDL_SEQ_PNM,DBC_DBC_SEQ_NM) AS DDL_SEQ_PNM
                   ,C_DDL_SEQ_LNM
                   ,DBC_DBC_SEQ_NM AS DBC_SEQ_PNM
                   ,CASE WHEN IFNULL(DBC_MAXVAL,0) != IFNULL(C_MAXVAL,0)                             
					       OR IFNULL(DBC_MINVAL,0) != IFNULL(C_MINVAL,0)                             
					       OR IFNULL(DBC_INCBY ,0) != IFNULL(C_INCBY ,0)                             
					       OR IFNULL(DBC_CYC_YN,'N') != IFNULL(C_CYC_YN,'N')     
					       OR IFNULL(DBC_ORD_YN,'N') != IFNULL(C_ORD_YN,'N')     
					       OR IFNULL(DBC_CACHE_SZ,0) != IFNULL(C_CACHE_SZ ,0) THEN 1 
					 ELSE 0 END AS GAP_STATUS  
                   , CONCAT(
		                   	  CASE WHEN DBC_DBC_SEQ_NM IS NULL THEN '[DBC시퀀스미존재]' ELSE '' END
		                     ,CASE WHEN C_DDL_SEQ_PNM IS NULL THEN '[DDL시퀀스미존재]'
		                     	   WHEN DBC_DBC_SEQ_NM IS NOT NULL
		                      		 AND(IFNULL(DBC_MAXVAL,0) != IFNULL(C_MAXVAL,0) 
								      OR IFNULL(DBC_MINVAL,0) != IFNULL(C_MINVAL,0)
								      OR IFNULL(DBC_INCBY ,0) != IFNULL(C_INCBY ,0) 
								      OR IFNULL(DBC_CYC_YN,'N') != IFNULL(C_CYC_YN,'N')  
								      OR IFNULL(DBC_ORD_YN,'N') != IFNULL(C_ORD_YN,'N')  
								      OR IFNULL(DBC_CACHE_SZ,0) != IFNULL(C_CACHE_SZ ,0)    )
                                   THEN '[시퀀스GAP존재]' ELSE '' END     
                          ) AS GAP_CONTS    
                    ,IFNULL(C_DB_SCH_ID , DBC_DB_SCH_ID) DB_SCH_ID
                    ,C_SUBJ_LNM
					,C_MINVAL     AS DDL_MINVAL  
					,C_MAXVAL     AS DDL_MAXVAL  
					,C_CYC_YN     AS DDL_CYC_YN  
					,C_INCBY      AS DDL_INCBY   
					,C_ORD_YN     AS DDL_ORD_YN  
					,C_CACHE_SZ   AS DDL_CACHE_SZ
					,DBC_MINVAL   AS DBC_MINVAL  
					,DBC_MAXVAL   AS DBC_MAXVAL  
					,DBC_CYC_YN   AS DBC_CYC_YN  
					,DBC_INCBY    AS DBC_INCBY   
					,DBC_ORD_YN   AS DBC_ORD_YN  
					,DBC_CACHE_SZ AS DBC_CACHE_SZ
                  FROM (
				  SELECT * FROM (  
				   		(
                  		SELECT   C.DDL_SEQ_ID AS C_DDL_SEQ_ID
		                        ,C.DDL_SEQ_PNM AS C_DDL_SEQ_PNM
		                        ,C.DDL_SEQ_LNM AS C_DDL_SEQ_LNM
		                        ,C.DB_SCH_ID AS C_DB_SCH_ID
		                        ,C.APRV_DTM AS C_APRV_DTM
		                        ,TRG.DB_CONN_TRG_ID AS C_DB_CONN_TRG_ID
		                        ,SUBJ.FULL_PATH AS C_FULL_PATH
		                        ,SUBJ.SUBJ_LNM AS C_SUBJ_LNM
								,STRTWT AS C_STRTWT
								,MAXVAL AS C_MAXVAL
								,MINVAL AS C_MINVAL
								,INCBY AS C_INCBY
								,CYC_YN AS C_CYC_YN
								,ORD_YN AS C_ORD_YN
								,CACHE_SZ AS C_CACHE_SZ
                        FROM WAM_DDL_SEQ C
                        LEFT OUTER JOIN WAA_DB_SCH SCH
			                         ON C.DB_SCH_ID = SCH.DB_SCH_ID
			                        AND SCH.REG_TYP_CD IN ('C', 'U')
			                        AND SCH.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
			                         ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
			                        AND TRG.REG_TYP_CD IN ('C', 'U')
			                        AND TRG.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
                        LEFT JOIN WAA_SUBJ_DB_SCH_MAP MAP
                        	   ON SCH.DB_SCH_ID = MAP.DB_SCH_ID
                        LEFT OUTER JOIN WAA_SUBJ SUBJ
                        			 ON MAP.SUBJ_ID = SUBJ.SUBJ_ID
			                        AND SUBJ.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
			                        AND SUBJ.REG_TYP_CD IN ('C', 'U')
                        WHERE 1=1
                        <choose>
                    		<when test="gapDcd.equals('DC')">
                    			AND SCH.DDL_TRG_DCD = 'D'		-- 개발
                    		</when>
                    		<when test="gapDcd.equals('TC')">
                    			AND SCH.DDL_TRG_DCD = 'T'		-- 테스트
                    		</when>
                    		<when test="gapDcd.equals('RC')">
                    			AND SCH.DDL_TRG_DCD = 'R'		-- 운영
                    		</when>
                        </choose>
                        AND SCH.DDL_TRG_YN = 'Y'			-- DDL대상여부
                      ) C
                      
                  LEFT OUTER JOIN 
                      (
                      			   SELECT DBC.DB_SCH_ID AS DBC_DB_SCH_ID
                                         ,DBC.DBC_SEQ_NM AS DBC_DBC_SEQ_NM
                                         ,CONCAT(MINVAL) AS DBC_MINVAL
		                                 ,CONCAT(MAXVAL) AS DBC_MAXVAL
		                                 ,CONCAT(INCBY ) AS DBC_INCBY 
		                                 ,CYC_YN AS DBC_CYC_YN
		                                 ,ORD_YN AS DBC_ORD_YN
		                                 ,CONCAT(CACHE_SZ) AS DBC_CACHE_SZ
                                   FROM WAT_DBC_SEQ DBC
	                                   LEFT OUTER JOIN WAA_DB_SCH SCH
				                                    ON DBC.DB_SCH_ID =SCH.DB_SCH_ID
				                                   AND SCH.REG_TYP_CD IN ('C', 'U')
				                                   AND SCH.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
                                  WHERE 1=1
				            <choose>
				        		<when test="gapDcd.equals('DC')">
				        			AND SCH.DDL_TRG_DCD = 'D'		-- 개발
				        		</when>
				        		<when test="gapDcd.equals('TC')">
				        			AND SCH.DDL_TRG_DCD = 'T'		-- 테스트
				        		</when>
				        		<when test="gapDcd.equals('RC')">
				        			AND SCH.DDL_TRG_DCD = 'R'		-- 운영
				        		</when>
				            </choose>
               	   ) DBC
                  ON C_DB_SCH_ID = DBC_DB_SCH_ID
                  AND C_DDL_SEQ_PNM = DBC_DBC_SEQ_NM
                )
				  
	UNION

		SELECT * FROM (  
				   		(
                  		SELECT   C.DDL_SEQ_ID AS C_DDL_SEQ_ID
		                        ,C.DDL_SEQ_PNM AS C_DDL_SEQ_PNM
		                        ,C.DDL_SEQ_LNM AS C_DDL_SEQ_LNM
		                        ,C.DB_SCH_ID AS C_DB_SCH_ID
		                        ,C.APRV_DTM AS C_APRV_DTM
		                        ,TRG.DB_CONN_TRG_ID AS C_DB_CONN_TRG_ID
		                        ,SUBJ.FULL_PATH AS C_FULL_PATH
		                        ,SUBJ.SUBJ_LNM AS C_SUBJ_LNM
								,STRTWT AS C_STRTWT
								,MAXVAL AS C_MAXVAL
								,MINVAL AS C_MINVAL
								,INCBY AS C_INCBY
								,CYC_YN AS C_CYC_YN
								,ORD_YN AS C_ORD_YN
								,CACHE_SZ AS C_CACHE_SZ
                        FROM WAM_DDL_SEQ C
                        LEFT OUTER JOIN WAA_DB_SCH SCH
			                         ON C.DB_SCH_ID = SCH.DB_SCH_ID
			                        AND SCH.REG_TYP_CD IN ('C', 'U')
			                        AND SCH.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
                        LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
			                         ON SCH.DB_CONN_TRG_ID =TRG.DB_CONN_TRG_ID
			                        AND TRG.REG_TYP_CD IN ('C', 'U')
			                        AND TRG.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
                        LEFT JOIN WAA_SUBJ_DB_SCH_MAP MAP
                        	   ON SCH.DB_SCH_ID = MAP.DB_SCH_ID
                        LEFT OUTER JOIN WAA_SUBJ SUBJ
                        			 ON MAP.SUBJ_ID = SUBJ.SUBJ_ID
			                        AND SUBJ.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
			                        AND SUBJ.REG_TYP_CD IN ('C', 'U')
                        WHERE 1=1
                        <choose>
                    		<when test="gapDcd.equals('DC')">
                    			AND SCH.DDL_TRG_DCD = 'D'		-- 개발
                    		</when>
                    		<when test="gapDcd.equals('TC')">
                    			AND SCH.DDL_TRG_DCD = 'T'		-- 테스트
                    		</when>
                    		<when test="gapDcd.equals('RC')">
                    			AND SCH.DDL_TRG_DCD = 'R'		-- 운영
                    		</when>
                        </choose>
                        AND SCH.DDL_TRG_YN = 'Y'			-- DDL대상여부
                      ) C
                      
                  RIGHT OUTER JOIN 
                      (
                      			   SELECT DBC.DB_SCH_ID AS DBC_DB_SCH_ID
                                         ,DBC.DBC_SEQ_NM AS DBC_DBC_SEQ_NM
                                         ,CONCAT(MINVAL) AS DBC_MINVAL
		                                 ,CONCAT(MAXVAL) AS DBC_MAXVAL
		                                 ,CONCAT(INCBY ) AS DBC_INCBY 
		                                 ,CYC_YN AS DBC_CYC_YN
		                                 ,ORD_YN AS DBC_ORD_YN
		                                 ,CONCAT(CACHE_SZ) AS DBC_CACHE_SZ
                                   FROM WAT_DBC_SEQ DBC
	                                   LEFT OUTER JOIN WAA_DB_SCH SCH
				                                    ON DBC.DB_SCH_ID =SCH.DB_SCH_ID
				                                   AND SCH.REG_TYP_CD IN ('C', 'U')
				                                   AND SCH.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
                                  WHERE 1=1
				            <choose>
				        		<when test="gapDcd.equals('DC')">
				        			AND SCH.DDL_TRG_DCD = 'D'		-- 개발
				        		</when>
				        		<when test="gapDcd.equals('TC')">
				        			AND SCH.DDL_TRG_DCD = 'T'		-- 테스트
				        		</when>
				        		<when test="gapDcd.equals('RC')">
				        			AND SCH.DDL_TRG_DCD = 'R'		-- 운영
				        		</when>
				            </choose>
               	   ) DBC
                  ON C_DB_SCH_ID = DBC_DB_SCH_ID
                  AND C_DDL_SEQ_PNM = DBC_DBC_SEQ_NM
                )
				  
			) FSQ
				  
                  WHERE 1=1   
                <if test="fullPath != null">
                AND C_FULL_PATH LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%')
                </if>
                 <if test="dbConnTrgId != null">
                 AND C_DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
                </if>
                <if test="dbSchId != null">
                 AND C_DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
                </if>
                <if test="searchBgnDe != null">
                <![CDATA[
                AND DATE_FORMAT(C_APRV_DTM, '%Y-%m-%d') >= #{searchBgnDe,jdbcType=VARCHAR}
                ]]>
                </if>
                <if test="searchEndDe != null">
                <![CDATA[
                AND DATE_FORMAT(C_APRV_DTM, '%Y-%m-%d') <= #{searchEndDe,jdbcType=VARCHAR}
                ]]>
                </if>
                <if test="tblNm != null">
                AND (      C_DDL_SEQ_PNM  LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR   C_DDL_SEQ_LNM LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       OR DBC_DBC_SEQ_NM  LIKE CONCAT('%' , UPPER(#{tblNm,jdbcType=VARCHAR}) , '%')
                       )
                       </if>

			) A
             GROUP BY DDL_SEQ_PNM
      ) A
      LEFT OUTER JOIN WAA_DB_SCH SCH
			       ON A.DB_SCH_ID = SCH.DB_SCH_ID
			      AND SCH.REG_TYP_CD IN ('C', 'U')
			      AND SCH.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
      LEFT OUTER JOIN WAA_DB_CONN_TRG TRG
			       ON SCH.DB_CONN_TRG_ID = TRG.DB_CONN_TRG_ID
			      AND TRG.REG_TYP_CD IN ('C', 'U')
			      AND TRG.EXP_DTM = DATE_FORMAT('99991231', '%Y%m%d')
    <where>
     <if test="gapStatus != null">
     AND A.GAP_STATUS = #{gapStatus,jdbcType=VARCHAR}
     </if>
    </where>
     ORDER BY GAP_STATUS, GAP_CONTS 
</select>

</mapper>