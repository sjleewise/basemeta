<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.meta.ddl.service.WaqDdlSeqMapper" >
  <resultMap id="BaseResultMap" type="kr.wise.meta.ddl.service.WaqDdlSeq" extends="kr.wise.commons.cmm.service.CommonMapper.BaseResultMap" >
    <id column="RQST_NO" property="rqstNo" jdbcType="VARCHAR" />
    <id column="RQST_SNO" property="rqstSno" jdbcType="DECIMAL" />
    <result column="DDL_SEQ_ID" property="ddlSeqId" jdbcType="VARCHAR" />
    <result column="DDL_SEQ_PNM" property="ddlSeqPnm" jdbcType="VARCHAR" />
    <result column="DDL_SEQ_LNM" property="ddlSeqLnm" jdbcType="VARCHAR" />
<!--     <result column="RQST_DCD" property="rqstDcd" jdbcType="VARCHAR" /> -->
<!--     <result column="RVW_STS_CD" property="rvwStsCd" jdbcType="VARCHAR" /> -->
<!--     <result column="RVW_CONTS" property="rvwConts" jdbcType="VARCHAR" /> -->
<!--     <result column="VRF_CD" property="vrfCd" jdbcType="VARCHAR" /> -->
<!--     <result column="VRF_RMK" property="vrfRmk" jdbcType="VARCHAR" /> -->
    <result column="DB_CONN_TRG_PNM" property="dbConnTrgPnm" jdbcType="VARCHAR" />
    <result column="DB_SCH_ID" property="dbSchId" jdbcType="VARCHAR" />
    <result column="DB_SCH_PNM" property="dbSchPnm" jdbcType="VARCHAR" />
    <result column="INCBY" property="incby" jdbcType="VARCHAR" />
    <result column="STRTWT" property="strtwt" jdbcType="VARCHAR" />
    <result column="MAXVAL" property="maxval" jdbcType="VARCHAR" />
    <result column="MINVAL" property="minval" jdbcType="VARCHAR" />
    <result column="CYC_YN" property="cycYn" jdbcType="VARCHAR" />
    <result column="CACHE_SZ" property="cacheSz" jdbcType="VARCHAR" />
    <result column="ORD_YN" property="ordYn" jdbcType="VARCHAR" />
    <result column="NM_RL_TYP_CD" property="nmRlTypCd" jdbcType="VARCHAR" />
    <result column="US_TYP_CD" property="usTypCd" jdbcType="VARCHAR" />
    <result column="PDM_TBL_PNM" property="pdmTblPnm" jdbcType="VARCHAR" />
    <result column="PDM_COL_PNM" property="pdmColPnm" jdbcType="VARCHAR" />
    <result column="L1CD_PNM" property="l1cdPnm" jdbcType="VARCHAR" />
    <result column="L3CD_PNM" property="l3cdPnm" jdbcType="VARCHAR" />
    <result column="GRT_LST" property="grtLst" jdbcType="VARCHAR" />
    <result column="DDL_TRG_DCD" property="ddlTrgDcd" jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_ID" property="srcDbSchId" jdbcType="VARCHAR" />
    <result column="SRC_DDL_SEQ_ID" property="srcDdlSeqId" jdbcType="VARCHAR" />
    <!--      DDL적용요청코드, 일자 -->
    <result column="APL_REQ_TYP_CD" property="aplReqTypCd" jdbcType="VARCHAR" />
    <result column="APL_REQ_DT" property="aplReqdt" jdbcType="VARCHAR" />
    <result column="PRJ_MNG_NO"     property="prjMngNo"    jdbcType="VARCHAR" />
    <result column="SR_MNG_NO"      property="srMngNo"     jdbcType="VARCHAR" />
    
    <result column="PCKG_NM"      property="pckgNm"     jdbcType="VARCHAR" />
    <result column="SEQ_CLAS_CD"      property="seqClasCd"     jdbcType="VARCHAR" />
    <result column="SEQ_INIT_CD"      property="seqInitCd"     jdbcType="VARCHAR" />
    <result column="BIZ_IFNC"      property="bizIfnc"     jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="kr.wise.meta.ddl.service.WaqDdlSeq" extends="BaseResultMap" >
    <result column="SCRT_INFO" property="scrtInfo" jdbcType="CLOB" />
  </resultMap>
  <sql id="Base_Column_List" >
         RQST_NO            
	    ,RQST_SNO           
	    ,DDL_SEQ_ID         
	    ,DDL_SEQ_PNM        
	    ,DDL_SEQ_LNM        
	    ,RQST_DCD           
	    ,RVW_STS_CD         
	    ,RVW_CONTS          
	    ,VRF_CD             
	    ,VRF_RMK            
	    ,DB_CONN_TRG_PNM    
	    ,DB_SCH_ID          
	    ,DB_SCH_PNM         
	    ,INCBY              
	    ,STRTWT             
	    ,MAXVAL             
	    ,MINVAL             
	    ,CYC_YN             
	    ,CACHE_SZ           
	    ,ORD_YN             
	    ,NM_RL_TYP_CD       
	    ,US_TYP_CD          
	    ,PDM_TBL_PNM        
	    ,PDM_COL_PNM        
	    ,L1CD_PNM           
	    ,L3CD_PNM           
	    ,GRT_LST            
	    ,SCRT_INFO          
	    ,OBJ_DESCN          
	    ,OBJ_VERS           
	    ,REG_TYP_CD         
	    ,FRS_RQST_DTM       
	    ,FRS_RQST_USER_ID   
	    ,RQST_DTM           
	    ,RQST_USER_ID       
	    ,APRV_DTM           
	    ,APRV_USER_ID       
	    ,DDL_TRG_DCD        
	    ,SRC_DB_SCH_ID      
	    ,SRC_DDL_SEQ_ID     
	    ,RQST_RESN  
	    ,APL_REQ_TYP_CD
        ,APL_REQ_DT 
        ,PRJ_MNG_NO
        ,SR_MNG_NO
        ,PCKG_NM
		,SEQ_CLAS_CD   
		,SEQ_INIT_CD
		,BIZ_IFNC
  </sql>
  
  <sql id="waq_Column_List" >
    A.RQST_NO, A.RQST_SNO, A.DDL_SEQ_ID, A.DDL_SEQ_PNM, A.DDL_SEQ_LNM, A.RQST_DCD, A.RVW_STS_CD, A.RVW_CONTS, 
    A.VRF_CD, A.VRF_RMK, A.DB_CONN_TRG_PNM, A.DB_SCH_ID, A.DB_SCH_PNM, A.INCBY, A.STRTWT, A.MAXVAL, A.MINVAL, 
    A.CYC_YN, A.CACHE_SZ, A.ORD_YN, A.NM_RL_TYP_CD, A.US_TYP_CD, A.PDM_TBL_PNM, A.PDM_COL_PNM, A.L1CD_PNM, 
    A.L3CD_PNM, A.GRT_LST, A.DDL_TRG_DCD , A.SRC_DB_SCH_ID , A.SRC_DDL_SEQ_ID, A.OBJ_DESCN, A.OBJ_VERS, A.REG_TYP_CD, A.FRS_RQST_DTM, A.FRS_RQST_USER_ID, 
    A.RQST_DTM, A.RQST_USER_ID, A.APRV_DTM, A.APRV_USER_ID , A.SCRT_INFO , A.RQST_RESN, A.APL_REQ_TYP_CD, A.APL_REQ_DT
    ,A.PRJ_MNG_NO, A.SR_MNG_NO
    ,A.RQST_RESN
	,A.PCKG_NM
	,A.SEQ_CLAS_CD   
	,A.SEQ_INIT_CD
	,A.BIZ_IFNC    
  </sql>
  
  
  <sql id="Blob_Column_List" >
    SCRT_INFO
  </sql>
  
   <sql id="wam_col">
    ,DDL_SEQ_PNM ,DDL_SEQ_LNM  ,DB_SCH_ID ,INCBY	,STRTWT ,MAXVAL ,MINVAL ,CYC_YN ,CACHE_SZ  ,ORD_YN                        
    ,NM_RL_TYP_CD  ,US_TYP_CD ,PDM_TBL_PNM ,PDM_COL_PNM	,L1CD_PNM ,L3CD_PNM ,GRT_LST , DDL_TRG_DCD , SRC_DB_SCH_ID , SRC_DDL_SEQ_ID    				             
	,SCRT_INFO ,RQST_NO ,RQST_SNO ,OBJ_DESCN ,OBJ_VERS ,REG_TYP_CD ,FRS_RQST_DTM 
	,FRS_RQST_USER_ID  ,RQST_DTM  ,RQST_USER_ID  ,APRV_DTM ,APRV_USER_ID
	,APL_REQ_TYP_CD, APL_REQ_DT,RQST_RESN
	,PRJ_MNG_NO, SR_MNG_NO 
	,PCKG_NM
	,SEQ_CLAS_CD   
	,SEQ_INIT_CD
	,BIZ_IFNC
   </sql>
   
   
  <select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs" parameterType="map" >
    select /* WaqDdlSeqMapper.selectByPrimaryKey */
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from WAQ_DDL_SEQ
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="map" >
    delete /* WaqDdlSeqMapper.deleteByPrimaryKey */
	from WAQ_DDL_SEQ
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    insert /* WaqDdlSeqMapper.insert */
		into WAQ_DDL_SEQ (RQST_NO, RQST_SNO, DDL_SEQ_ID, 
      DDL_SEQ_PNM, DDL_SEQ_LNM, RQST_DCD, 
      RVW_STS_CD, RVW_CONTS, VRF_CD, 
      VRF_RMK, DB_CONN_TRG_PNM, DB_SCH_ID, 
      DB_SCH_PNM, INCBY, STRTWT, 
      MAXVAL, MINVAL, CYC_YN, 
      CACHE_SZ, ORD_YN, NM_RL_TYP_CD, 
      US_TYP_CD, PDM_TBL_PNM, PDM_COL_PNM, 
      L1CD_PNM, L3CD_PNM, GRT_LST, 
      OBJ_DESCN, OBJ_VERS, REG_TYP_CD, 
      FRS_RQST_DTM, FRS_RQST_USER_ID, RQST_DTM, 
      RQST_USER_ID, APRV_DTM, APRV_USER_ID, 
      SCRT_INFO)
    values (#{rqstNo,jdbcType=VARCHAR}, #{rqstSno,jdbcType=DECIMAL}, #{ddlSeqId,jdbcType=VARCHAR}, 
      #{ddlSeqPnm,jdbcType=VARCHAR}, #{ddlSeqLnm,jdbcType=VARCHAR}, #{rqstDcd,jdbcType=VARCHAR}, 
      #{rvwStsCd,jdbcType=VARCHAR}, #{rvwConts,jdbcType=VARCHAR}, #{vrfCd,jdbcType=VARCHAR}, 
      #{vrfRmk,jdbcType=VARCHAR}, #{dbConnTrgPnm,jdbcType=VARCHAR}, #{dbSchId,jdbcType=VARCHAR}, 
      #{dbSchPnm,jdbcType=VARCHAR}, #{incby,jdbcType=VARCHAR}, #{strtwt,jdbcType=VARCHAR}, 
      #{maxval,jdbcType=VARCHAR}, #{minval,jdbcType=VARCHAR}, #{cycYn,jdbcType=VARCHAR}, 
      #{cacheSz,jdbcType=VARCHAR}, #{ordYn,jdbcType=VARCHAR}, #{nmRlTypCd,jdbcType=VARCHAR}, 
      #{usTypCd,jdbcType=VARCHAR}, #{pdmTblPnm,jdbcType=VARCHAR}, #{pdmColPnm,jdbcType=VARCHAR}, 
      #{l1cdPnm,jdbcType=VARCHAR}, #{l3cdPnm,jdbcType=VARCHAR}, #{grtLst,jdbcType=VARCHAR}, 
      #{objDescn,jdbcType=VARCHAR}, #{objVers,jdbcType=DECIMAL}, #{regTypCd,jdbcType=VARCHAR}, 
      #{frsRqstDtm,jdbcType=TIMESTAMP}, #{frsRqstUserId,jdbcType=VARCHAR}, #{rqstDtm,jdbcType=TIMESTAMP}, 
      #{rqstUserId,jdbcType=VARCHAR}, #{aprvDtm,jdbcType=TIMESTAMP}, #{aprvUserId,jdbcType=VARCHAR}, 
      #{scrtInfo,jdbcType=CLOB})
  </insert>
  <insert id="insertSelective" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    <selectKey keyProperty="rqstSno" resultType="int" statementType="PREPARED" order="BEFORE">
		SELECT IFNULL(MAX(RQST_SNO), 0) + 1 FROM WAQ_DDL_SEQ WHERE RQST_NO = #{rqstNo}
  	</selectKey>
    insert /* WaqDdlSeqMapper.insertSelective */
		into WAQ_DDL_SEQ
    <trim prefix="(" suffix=")" suffixOverrides="," >
        RQST_NO,
        RQST_SNO,
        DDL_SEQ_ID,
        DDL_SEQ_PNM,
        DDL_SEQ_LNM,
        RQST_DCD,
        RVW_STS_CD,
        RVW_CONTS,
        VRF_CD,
        VRF_RMK,
        DB_CONN_TRG_PNM,
        DB_SCH_ID,
        DB_SCH_PNM,
        INCBY,
        STRTWT,
        MAXVAL,
        MINVAL,
        CYC_YN,
        CACHE_SZ,
        ORD_YN,
        NM_RL_TYP_CD,
        US_TYP_CD,
        PDM_TBL_PNM,
        PDM_COL_PNM,
        L1CD_PNM,
        L3CD_PNM,
        GRT_LST,
        DDL_TRG_DCD,
        SRC_DB_SCH_ID,
        SRC_DDL_SEQ_ID,
        OBJ_DESCN,
        OBJ_VERS,
        REG_TYP_CD,
        FRS_RQST_DTM,
        FRS_RQST_USER_ID,
        RQST_DTM,
        RQST_USER_ID,
        RQST_RESN,
        APL_REQ_TYP_CD,
        APL_REQ_DT,
      PRJ_MNG_NO,
      SR_MNG_NO,
      PCKG_NM,
      SEQ_CLAS_CD,
      SEQ_INIT_CD,
      BIZ_IFNC,
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
        #{rqstNo,jdbcType=VARCHAR},
        #{rqstSno,jdbcType=DECIMAL},
        #{ddlSeqId,jdbcType=VARCHAR},
        #{ddlSeqPnm,jdbcType=VARCHAR},
        #{ddlSeqLnm,jdbcType=VARCHAR},
        #{rqstDcd,jdbcType=VARCHAR},
        #{rvwStsCd,jdbcType=VARCHAR},
        #{rvwConts,jdbcType=VARCHAR},
        #{vrfCd,jdbcType=VARCHAR},
        #{vrfRmk,jdbcType=VARCHAR},
        #{dbConnTrgPnm,jdbcType=VARCHAR},
        #{dbSchId,jdbcType=VARCHAR},
        #{dbSchPnm,jdbcType=VARCHAR},
        #{incby,jdbcType=VARCHAR},
        #{strtwt,jdbcType=VARCHAR},
        #{maxval,jdbcType=VARCHAR},
        #{minval,jdbcType=VARCHAR},
        #{cycYn,jdbcType=VARCHAR},
        #{cacheSz,jdbcType=VARCHAR},
        #{ordYn,jdbcType=VARCHAR},
        #{nmRlTypCd,jdbcType=VARCHAR},
        #{usTypCd,jdbcType=VARCHAR},
        #{pdmTblPnm,jdbcType=VARCHAR},
        #{pdmColPnm,jdbcType=VARCHAR},
        #{l1cdPnm,jdbcType=VARCHAR},
        #{l3cdPnm,jdbcType=VARCHAR},
        #{grtLst,jdbcType=VARCHAR},
        #{ddlTrgDcd,jdbcType=VARCHAR},
        #{srcDbSchId,jdbcType=VARCHAR},
        #{srcDdlSeqId,jdbcType=VARCHAR},
        #{objDescn,jdbcType=VARCHAR},
        1 ,
        #{regTypCd,jdbcType=VARCHAR},
        NOW() ,
        #{frsRqstUserId,jdbcType=VARCHAR},
        NOW() ,
        #{rqstUserId,jdbcType=VARCHAR},
        #{rqstResn,jdbcType=VARCHAR},
        #{aplReqTypCd,jdbcType=VARCHAR},
        DATE_FORMAT(STR_TO_DATE(#{aplReqdt,jdbcType=VARCHAR}, '%Y-%m-%d'), '%Y-%m-%d'),
      #{prjMngNo,jdbcType=VARCHAR},
      #{srMngNo,jdbcType=VARCHAR},
      
      #{pckgNm,jdbcType=VARCHAR},
      #{seqClasCd,jdbcType=VARCHAR},
      #{seqInitCd,jdbcType=VARCHAR},
      #{bizIfnc,jdbcType=VARCHAR},
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    UPDATE /* WaqDdlSeqMapper.updateByPrimaryKeySelective */
    	WAQ_DDL_SEQ
    <set >
      <if test="ddlSeqId != null" >
        DDL_SEQ_ID = #{ddlSeqId,jdbcType=VARCHAR},
      </if>
      <if test="ddlSeqPnm != null" >
        DDL_SEQ_PNM = TRIM(UPPER(#{ddlSeqPnm,jdbcType=VARCHAR})),
      </if>
      <if test="ddlSeqPnm != null" >
        DDL_SEQ_LNM = TRIM(UPPER(#{ddlSeqPnm,jdbcType=VARCHAR})),
      </if>
      <if test="rqstDcd != null" >
        RQST_DCD = #{rqstDcd,jdbcType=VARCHAR},
      </if>
      <if test="rvwStsCd != null" >
        RVW_STS_CD = #{rvwStsCd,jdbcType=VARCHAR},
      </if>
      <if test="rvwConts != null" >
        RVW_CONTS = #{rvwConts,jdbcType=VARCHAR},
      </if>
      <if test="vrfCd != null" >
        VRF_CD = #{vrfCd,jdbcType=VARCHAR},
      </if>
      <if test="vrfRmk != null" >
        VRF_RMK = #{vrfRmk,jdbcType=VARCHAR},
      </if>
      <if test="dbConnTrgPnm != null" >
        DB_CONN_TRG_PNM = #{dbConnTrgPnm,jdbcType=VARCHAR},
      </if>
      <if test="dbSchId != null" >
        DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR},
      </if>
      <if test="dbSchPnm != null" >
        DB_SCH_PNM = #{dbSchPnm,jdbcType=VARCHAR},
      </if>
      <if test="incby != null" >
        INCBY = #{incby,jdbcType=VARCHAR},
      </if>
      <if test="strtwt != null" >
        STRTWT = #{strtwt,jdbcType=VARCHAR},
      </if>
      <if test="maxval != null" >
        MAXVAL = #{maxval,jdbcType=VARCHAR},
      </if>
      <if test="minval != null" >
        MINVAL = #{minval,jdbcType=VARCHAR},
      </if>
      <if test="cycYn != null" >
        CYC_YN = #{cycYn,jdbcType=VARCHAR},
      </if>
      <if test="cacheSz != null" >
        CACHE_SZ = #{cacheSz,jdbcType=VARCHAR},
      </if>
      <if test="ordYn != null" >
        ORD_YN = #{ordYn,jdbcType=VARCHAR},
    </if>
    <if test="nmRlTypCd != null" >
        NM_RL_TYP_CD = #{nmRlTypCd,jdbcType=VARCHAR},
    </if>
    <if test="usTypCd != null" >
        US_TYP_CD = #{usTypCd,jdbcType=VARCHAR},
    </if>
    <if test="pdmTblPnm != null" >
        PDM_TBL_PNM = #{pdmTblPnm,jdbcType=VARCHAR},
    </if>
    <if test="pdmColPnm != null" >
        PDM_COL_PNM = #{pdmColPnm,jdbcType=VARCHAR},
    </if>
    <if test="l1cdPnm != null" >
        L1CD_PNM = #{l1cdPnm,jdbcType=VARCHAR},
    </if>
    <if test="l3cdPnm != null" >
        L3CD_PNM = #{l3cdPnm,jdbcType=VARCHAR},
    </if>
    <if test="grtLst != null" >
        GRT_LST = #{grtLst,jdbcType=VARCHAR},
    </if>
    <if test="ddlTrgDcd != null" >
        DDL_TRG_DCD = #{ddlTrgDcd,jdbcType=VARCHAR},
      </if>
      <if test="srcDbSchId != null" >
        SRC_DB_SCH_ID = #{srcDbSchId,jdbcType=VARCHAR},
      </if>
      <if test="srcDdlSeqId != null" >
        SRC_DDL_SEQ_ID = #{srcDdlSeqId,jdbcType=VARCHAR},
      </if>      
      <if test="objDescn != null" >
        OBJ_DESCN = #{objDescn,jdbcType=VARCHAR},
      </if>
      <if test="objVers != null" >
        OBJ_VERS = #{objVers,jdbcType=DECIMAL},
      </if>
      <if test="regTypCd != null" >
        REG_TYP_CD = #{regTypCd,jdbcType=VARCHAR},
      </if>
      <if test="frsRqstDtm != null" >
        FRS_RQST_DTM = #{frsRqstDtm,jdbcType=TIMESTAMP},
      </if>
      <if test="frsRqstUserId != null" >
        FRS_RQST_USER_ID = #{frsRqstUserId,jdbcType=VARCHAR},
      </if>
      <if test="rqstDtm != null" >
        RQST_DTM = #{rqstDtm,jdbcType=TIMESTAMP},
      </if>
      <if test="rqstUserId != null" >
        RQST_USER_ID = #{rqstUserId,jdbcType=VARCHAR},
      </if>
      <if test="aprvDtm != null" >
        APRV_DTM = #{aprvDtm,jdbcType=TIMESTAMP},
      </if>
      <if test="aprvUserId != null" >
        APRV_USER_ID = #{aprvUserId,jdbcType=VARCHAR},
      </if>
      <if test="scrtInfo != null" >
        SCRT_INFO = #{scrtInfo,jdbcType=CLOB},
    </if>
    <if test="rqstResn != null" >
        RQST_RESN = #{rqstResn,jdbcType=VARCHAR},
    </if>
    <if test="aplReqTypCd != null" >
        APL_REQ_TYP_CD = #{aplReqTypCd,jdbcType=VARCHAR},
    </if>
    <if test="aplReqdt != null" >
        APL_REQ_DT = DATE_FORMAT(STR_TO_DATE(#{aplReqdt,jdbcType=VARCHAR}, '%Y-%m-%d'), '%Y-%m-%d'),
    </if>
    <if test="prjMngNo != null" >
      PRJ_MNG_NO = #{prjMngNo,jdbcType=VARCHAR},
    </if>
    <if test="srMngNo != null" >
      SR_MNG_NO = #{srMngNo,jdbcType=VARCHAR},   
    </if>
    <if test="pckgNm != null" >
      PCKG_NM = #{pckgNm,jdbcType=VARCHAR},
    </if>
    <if test="seqClasCd != null" >
      SEQ_CLAS_CD = #{seqClasCd,jdbcType=VARCHAR},
    </if>
    <if test="seqInitCd != null" >
      SEQ_INIT_CD = #{seqInitCd,jdbcType=VARCHAR},
    </if>
    <if test="bizIfnc != null" >
      BIZ_IFNC = #{bizIfnc,jdbcType=VARCHAR},
    </if>
      </set>   
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    UPDATE /* WaqDdlSeqMapper.updateByPrimaryKeyWithBLOBs */
		WAQ_DDL_SEQ
    SET DDL_SEQ_ID = #{ddlSeqId,jdbcType=VARCHAR},
      DDL_SEQ_PNM = #{ddlSeqPnm,jdbcType=VARCHAR},
      DDL_SEQ_LNM = #{ddlSeqLnm,jdbcType=VARCHAR},
      RQST_DCD = #{rqstDcd,jdbcType=VARCHAR},
      RVW_STS_CD = #{rvwStsCd,jdbcType=VARCHAR},
      RVW_CONTS = #{rvwConts,jdbcType=VARCHAR},
      VRF_CD = #{vrfCd,jdbcType=VARCHAR},
      VRF_RMK = #{vrfRmk,jdbcType=VARCHAR},
      DB_CONN_TRG_PNM = #{dbConnTrgPnm,jdbcType=VARCHAR},
      DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR},
      DB_SCH_PNM = #{dbSchPnm,jdbcType=VARCHAR},
      INCBY = #{incby,jdbcType=VARCHAR},
      STRTWT = #{strtwt,jdbcType=VARCHAR},
      MAXVAL = #{maxval,jdbcType=VARCHAR},
      MINVAL = #{minval,jdbcType=VARCHAR},
      CYC_YN = #{cycYn,jdbcType=VARCHAR},
      CACHE_SZ = #{cacheSz,jdbcType=VARCHAR},
      ORD_YN = #{ordYn,jdbcType=VARCHAR},
      NM_RL_TYP_CD = #{nmRlTypCd,jdbcType=VARCHAR},
      US_TYP_CD = #{usTypCd,jdbcType=VARCHAR},
      PDM_TBL_PNM = #{pdmTblPnm,jdbcType=VARCHAR},
      PDM_COL_PNM = #{pdmColPnm,jdbcType=VARCHAR},
      L1CD_PNM = #{l1cdPnm,jdbcType=VARCHAR},
      L3CD_PNM = #{l3cdPnm,jdbcType=VARCHAR},
      GRT_LST = #{grtLst,jdbcType=VARCHAR},      
      DDL_TRG_DCD = #{ddlTrgDcd,jdbcType=VARCHAR},
      SRC_DB_SCH_ID = #{srcDbSchId,jdbcType=VARCHAR},
      SRC_DDL_SEQ_ID = #{srcDdlSeqId,jdbcType=VARCHAR},      
      OBJ_DESCN = #{objDescn,jdbcType=VARCHAR},
      OBJ_VERS = #{objVers,jdbcType=DECIMAL},
      REG_TYP_CD = #{regTypCd,jdbcType=VARCHAR},
      FRS_RQST_DTM = #{frsRqstDtm,jdbcType=TIMESTAMP},
      FRS_RQST_USER_ID = #{frsRqstUserId,jdbcType=VARCHAR},
      RQST_DTM = #{rqstDtm,jdbcType=TIMESTAMP},
      RQST_USER_ID = #{rqstUserId,jdbcType=VARCHAR},
      APRV_DTM = #{aprvDtm,jdbcType=TIMESTAMP},
      APRV_USER_ID = #{aprvUserId,jdbcType=VARCHAR},
      SCRT_INFO = #{scrtInfo,jdbcType=CLOB}
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    UPDATE /* WaqDdlSeqMapper.updateByPrimaryKey */
		WAQ_DDL_SEQ
    SET DDL_SEQ_ID = #{ddlSeqId,jdbcType=VARCHAR},
      DDL_SEQ_PNM = #{ddlSeqPnm,jdbcType=VARCHAR},
      DDL_SEQ_LNM = #{ddlSeqLnm,jdbcType=VARCHAR},
      RQST_DCD = #{rqstDcd,jdbcType=VARCHAR},
      RVW_STS_CD = #{rvwStsCd,jdbcType=VARCHAR},
      RVW_CONTS = #{rvwConts,jdbcType=VARCHAR},
      VRF_CD = #{vrfCd,jdbcType=VARCHAR},
      VRF_RMK = #{vrfRmk,jdbcType=VARCHAR},
      DB_CONN_TRG_PNM = #{dbConnTrgPnm,jdbcType=VARCHAR},
      DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR},
      DB_SCH_PNM = #{dbSchPnm,jdbcType=VARCHAR},
      INCBY = #{incby,jdbcType=VARCHAR},
      STRTWT = #{strtwt,jdbcType=VARCHAR},
      MAXVAL = #{maxval,jdbcType=VARCHAR},
      MINVAL = #{minval,jdbcType=VARCHAR},
      CYC_YN = #{cycYn,jdbcType=VARCHAR},
      CACHE_SZ = #{cacheSz,jdbcType=VARCHAR},
      ORD_YN = #{ordYn,jdbcType=VARCHAR},
      NM_RL_TYP_CD = #{nmRlTypCd,jdbcType=VARCHAR},
      US_TYP_CD = #{usTypCd,jdbcType=VARCHAR},
      PDM_TBL_PNM = #{pdmTblPnm,jdbcType=VARCHAR},
      PDM_COL_PNM = #{pdmColPnm,jdbcType=VARCHAR},
      L1CD_PNM = #{l1cdPnm,jdbcType=VARCHAR},
      L3CD_PNM = #{l3cdPnm,jdbcType=VARCHAR},
      GRT_LST = #{grtLst,jdbcType=VARCHAR},      
      DDL_TRG_DCD = #{ddlTrgDcd,jdbcType=VARCHAR},
      SRC_DB_SCH_ID = #{srcDbSchId,jdbcType=VARCHAR},
      SRC_DDL_SEQ_ID = #{srcDdlSeqId,jdbcType=VARCHAR},      
      OBJ_DESCN = #{objDescn,jdbcType=VARCHAR},
      OBJ_VERS = #{objVers,jdbcType=DECIMAL},
      REG_TYP_CD = #{regTypCd,jdbcType=VARCHAR},
      FRS_RQST_DTM = #{frsRqstDtm,jdbcType=TIMESTAMP},
      FRS_RQST_USER_ID = #{frsRqstUserId,jdbcType=VARCHAR},
      RQST_DTM = #{rqstDtm,jdbcType=TIMESTAMP},
      RQST_USER_ID = #{rqstUserId,jdbcType=VARCHAR},
      APRV_DTM = #{aprvDtm,jdbcType=TIMESTAMP},
      APRV_USER_ID = #{aprvUserId,jdbcType=VARCHAR}
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </update>
  
  <select id="selectDdlSeqListbyMst" parameterType="kr.wise.commons.rqstmst.service.WaqMstr" resultMap="BaseResultMap" >
  	<!--DDL 시퀀스 요청서 리스트 조회-->
  	SELECT 
  	 A.RQST_NO, A.RQST_SNO, A.DDL_SEQ_ID, A.DDL_SEQ_PNM, A.DDL_SEQ_LNM, A.RQST_DCD, A.RVW_CONTS, 
    A.VRF_CD, A.VRF_RMK, A.DB_CONN_TRG_PNM, A.DB_SCH_ID, A.DB_SCH_PNM, A.INCBY, A.STRTWT, A.MAXVAL, A.MINVAL, 
    A.CYC_YN, A.CACHE_SZ, A.ORD_YN, A.NM_RL_TYP_CD, A.US_TYP_CD, A.PDM_TBL_PNM, A.PDM_COL_PNM, A.L1CD_PNM, 
    A.L3CD_PNM, A.GRT_LST, A.DDL_TRG_DCD , A.SRC_DB_SCH_ID , A.SRC_DDL_SEQ_ID, A.OBJ_DESCN, A.OBJ_VERS, A.REG_TYP_CD, A.FRS_RQST_DTM, A.FRS_RQST_USER_ID, 
    A.RQST_DTM, A.RQST_USER_ID, A.APRV_DTM, A.APRV_USER_ID
	, A.RQST_RESN
     <choose>
		<when test='rqstStepCd == "Q" '>
			, CASE WHEN A.RVW_STS_CD = '2' THEN '2' ELSE '0' END AS RVW_STS_CD
		</when>
		<otherwise>
			, A.RVW_STS_CD
		</otherwise>
	  </choose>
     
     , CASE WHEN A.VRF_CD = '2' THEN '#FF0000' END AS FontColor
     , U.USER_NM AS RQST_USER_NM
	 , A.APL_REQ_TYP_CD
     , A.APL_REQ_DT 
     , A.PRJ_MNG_NO
	 , A.SR_MNG_NO  
	 , A.PCKG_NM
	 , A.SEQ_CLAS_CD   
	 , A.SEQ_INIT_CD
	 , A.BIZ_IFNC
    FROM WAQ_DDL_SEQ A
    LEFT OUTER JOIN WAA_USER U
      ON A.RQST_USER_ID = U.USER_ID
     AND U.REG_TYP_CD IN ('C', 'U')
     AND U.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d') 
    WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
    <if test='rqstStepCd == "Q" or rqstStepCd == "A" '>
    	AND A.VRF_CD = '1'
    </if>
    ORDER BY A.RQST_SNO  	  	
  </select>
  
  <select id="selectDdlSeqDetail" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" resultMap="ResultMapWithBLOBs">
  	<!-- DDL 시퀀스 요청서 상세조회-->
  	SELECT
      	  <include refid="waq_Column_List" />
      FROM WAQ_DDL_SEQ A 
     WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
       AND A.RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </select>
  
  <delete id="deleteByrqstSno" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    DELETE /* WaqDdlSeqMapper.deleteByrqstSno */
	FROM WAQ_DDL_SEQ
    WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      AND RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </delete>
  
  <update id="updateTsf" parameterType="string">
   UPDATE /* WaqDdlSeqMapper.updateTsf */
		WAQ_DDL_SEQ A
         INNER JOIN WAM_DDL_SEQ B 
            ON A.SRC_DB_SCH_ID = B.DB_SCH_ID
           AND A.DDL_SEQ_PNM = B.DDL_SEQ_PNM
        SET A.DB_SCH_ID = A.TGT_DB_SCH_ID
           ,A.DB_CONN_TRG_PNM = A.TGT_DB_CONN_TRG_PNM
           ,A.DB_SCH_PNM = A.TGT_DB_SCH_PNM
           ,A.DDL_TRG_DCD = CASE WHEN A.DDL_TRG_DCD = 'D' THEN 'T' 
			      						WHEN A.DDL_TRG_DCD = 'T' THEN 'R'
			     						ELSE 'D' END 
			 ,A.SRC_DDL_TRG_DCD = CASE WHEN A.DDL_TRG_DCD = 'D' THEN 'D'
			     							   WHEN A.DDL_TRG_DCD = 'T' THEN 'T' 
			     							ELSE NULL END
			 ,A.TGT_DDL_TRG_DCD =	CASE WHEN A.DDL_TRG_DCD = 'D' THEN 'T' 
			      								WHEN A.DDL_TRG_DCD = 'T' THEN 'R' 
			     							ELSE NULL END 
			 ,A.INCBY = B.INCBY
			 ,A.STRTWT = B.STRTWT
			 ,A.MAXVAL = B.MAXVAL
			 ,A.MINVAL = B.MINVAL
			 ,A.CYC_YN = B.CYC_YN
			 ,A.CACHE_SZ = B.CACHE_SZ
			 ,A.ORD_YN  = B.ORD_YN   	
			 ,A.MAXVAL_YN = B.MAXVAL_YN
			 ,A.OBJ_DESCN  = B.OBJ_DESCN   	
		WHERE A.RQST_NO=#{rqstNo,jdbcType=VARCHAR}
		 AND IFNULL(A.DDL_TRG_DCD,'') = ''
     
  </update>
  
  <update id="updateDbmsId" parameterType="string">
  <!-- DBMS 스키마 ID 업데이트 -->
  UPDATE WAQ_DDL_SEQ A
  		 LEFT JOIN WAA_DB_SCH C
  		   ON C.DB_SCH_PNM   = A.DB_SCH_PNM
		  AND C.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
		  AND C.REG_TYP_CD IN ('C', 'U')
   		 INNER JOIN WAA_DB_CONN_TRG D
			ON D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   AND D.DB_CONN_TRG_PNM = A.DB_CONN_TRG_PNM	
		   AND D.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
		   AND D.REG_TYP_CD IN ('C', 'U')
     SET A.DB_SCH_ID = C.DB_SCH_ID 
   WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
  </update>
  
  <update id="updateDbmsPnm" parameterType="string">
	  UPDATE /* WaqDdlSeqMapper.updateDbmsPnm */
		WAQ_DDL_SEQ A
	 INNER JOIN WAA_DB_SCH B
	    ON B.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	   AND B.REG_TYP_CD IN ('C', 'U')
	   AND B.DB_SCH_ID = A.DB_SCH_ID
	 INNER JOIN WAA_DB_CONN_TRG C 
	    ON C.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID
	   
	   SET A.DB_CONN_TRG_PNM = C.DB_CONN_TRG_PNM
		  , A.DB_SCH_PNM = B.DB_SCH_PNM
		     
	   WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
	     AND EXISTS (SELECT 1
	     			  FROM WAA_DB_SCH B 
	     			       INNER JOIN WAA_DB_CONN_TRG C 
	     			          ON C.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
				   	         AND C.REG_TYP_CD IN ('C', 'U')
				   	         AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID
				   	 WHERE B.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
				   	   AND B.REG_TYP_CD IN ('C', 'U')
				   	   AND B.DB_SCH_ID = A.DB_SCH_ID	
	                )
  </update>
  
  <update id="updateTsfInfo" parameterType="map">
     <!-- 이관정보 업데이트(변경 삭제대상일 경우) -->
     UPDATE WAQ_DDL_SEQ A
      	    LEFT JOIN WAM_DDL_SEQ B
		      ON B.DDL_SEQ_PNM = A.DDL_SEQ_PNM  
		     AND B.DB_SCH_ID   = A.DB_SCH_ID    
		     
        SET A.DDL_TRG_DCD    = B.DDL_TRG_DCD
          , A.SRC_DB_SCH_ID  = B.SRC_DB_SCH_ID
          , A.SRC_DDL_SEQ_ID = B.SRC_DDL_SEQ_ID
		        
  	 WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
  	   AND A.REG_TYP_CD IN ('U', 'D')
   	</update>
  
  <update id="updateCheckInit" parameterType="string">
  	<!-- 요청구분 업데이트 -->
    UPDATE WAQ_DDL_SEQ A
           LEFT JOIN WAM_DDL_SEQ B 
             ON B.DDL_SEQ_PNM = A.DDL_SEQ_PNM
            AND B.REG_TYP_CD IN ('C','U')
           LEFT JOIN WAA_DB_SCH C
              ON B.DB_SCH_ID 	= C.DB_SCH_ID
             AND C.DB_SCH_PNM   = A.DB_SCH_PNM 
             AND C.EXP_DTM 		= STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	   	     AND C.REG_TYP_CD IN ('C', 'U')
	   	   LEFT JOIN WAA_DB_CONN_TRG D
	   	      ON D.DB_CONN_TRG_ID 	= C.DB_CONN_TRG_ID
	   	     AND D.DB_CONN_TRG_PNM  = A.DB_CONN_TRG_PNM
	   	     AND D.EXP_DTM 			= STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	   	     AND D.REG_TYP_CD IN ('C', 'U')
       SET A.REG_TYP_CD = CASE WHEN A.RQST_DCD = 'DD' THEN 'D' ELSE CASE WHEN B.DDL_SEQ_ID IS NULL THEN 'C' ELSE 'U' END END
	     , A.VRF_CD = '4'
     WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
  </update>
  
  <insert id="checkDupSeq" parameterType="map">
  	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
  	<!-- 검증쿼리 : 요청서내 중복(DS001) -->
    AND EXISTS ( SELECT 1
	             FROM WAQ_DDL_SEQ D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DDL_SEQ_PNM = D.DDL_SEQ_PNM
	               AND A.DB_CONN_TRG_PNM	= D.DB_CONN_TRG_PNM
	               AND A.DB_SCH_PNM = D.DB_SCH_PNM
	               AND A.RQST_SNO != D.RQST_SNO
                )
  </insert>
  
  <insert id="checkNotExistSeq" parameterType="map">
  	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
      <!-- 검증쿼리 : 삭제대상 시퀀스 미존재(DS002) -->
      AND A.RQST_DCD = 'DD'
      AND NOT EXISTS ( SELECT 1
	                   FROM WAM_DDL_SEQ D
	                   WHERE A.DDL_SEQ_PNM = D.DDL_SEQ_PNM
	               		 AND A.DB_SCH_ID  = D.DB_SCH_ID
                      )  
  </insert>
  
  <insert id="checkNonDbmsID" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : DBMS 스키마 ID 미존재 (DS003) -->
	  AND A.DB_SCH_ID IS NULL
  </insert>  
  
  <insert id="checkRequestSeq" parameterType="map">
  	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
  	<!--  검증쿼리 : 요청중인 시퀀스 (DS004) -->
    AND EXISTS (
	    		 SELECT 1 
	    		  FROM WAQ_MSTR E
	             INNER JOIN WAQ_DDL_SEQ D
	             	ON E.RQST_NO = D.RQST_NO
	             WHERE E.RQST_NO != #{rqstNo}
	               AND E.RQST_STEP_CD = 'Q'
	               AND A.DDL_SEQ_PNM = D.DDL_SEQ_PNM
	               AND A.DB_CONN_TRG_PNM	= D.DB_CONN_TRG_PNM
	               AND A.DB_SCH_PNM = D.DB_SCH_PNM
	               AND D.VRF_CD = '1'
				   AND IFNULL(D.RVW_STS_CD, '0') != '2'
               )
  </insert>
  
  <insert id="checkSeqPnmEnt" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 시퀀스 명명규칙(엔티티기반) 위반 (DS005) -->
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'E'
      <!--  테이블명+_+S+X(사용용도유형1자리(일반:G/일별:D/일중:E))+##(일련번호2자리) -->
      AND CONCAT(A.PDM_TBL_PNM, '_S', A.US_TYP_CD, '00') 
      	  != CONCAT(SUBSTR(A.DDL_SEQ_PNM, 1, LENGTH(A.PDM_TBL_PNM) + 3 )
      	     , TRANSLATE(SUBSTR(A.DDL_SEQ_PNM, LENGTH(A.PDM_TBL_PNM) + 4),'1234567890', '0000000000'))  
      	        		
  </insert>
  
  <insert id="checkSeqPnmCol" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 시퀀스 명명규칙(컬럼기반) 위반 (DS006) -->
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'C'
      <!--  컬럼명+_+S+X(사용용도유형1자리(일반:G/일별:D/일중:E))+#(일련번호1자리) -->
      AND CONCAT(A.PDM_COL_PNM, '_S', A.US_TYP_CD, '0') 
      	  != CONCAT(SUBSTR(A.DDL_SEQ_PNM, 1, LENGTH(A.PDM_COL_PNM) + 3 )
      	     , TRANSLATE(SUBSTR(A.DDL_SEQ_PNM, LENGTH(A.PDM_COL_PNM) + 4),'1234567890', '0000000000'))
  </insert>
  
    <insert id="checkSeqPnmSubj" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 시퀀스 명명규칙(주제영역기반) 위반 (DS007) -->
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'S'
      <!--  L1코드+L3코드+###(일련번호3자리)+N+_+##(자릿수2자리)+_(옵션)+YYYYMMDD(일자,옵션)_+S+X(사용용도유형1자리(일반:G/일별:D/일중:E)) -->
      AND  CONCAT(A.L1CD_PNM, A.L3CD_PNM, '000', 'N_', '00', '_S', A.US_TYP_CD)
      	   != REGEXP_REPLACE(REGEXP_REPLACE(A.DDL_SEQ_PNM, '_[0-9]{8}_S', '_S'), '[0-9]', '0') 
           <!--  != TRANSLATE(SUBSTR(A.DDL_SEQ_PNM,1,14),'1234567890', '0000000000') -->
  </insert>
  
   <insert id="checkExistsTbl" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 미존재테이블 (DS008) -->
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'E'
      AND NOT EXISTS ( SELECT 1
                         FROM WAM_DDL_TBL T
                        WHERE A.PDM_TBL_PNM = IFNULL(T.DDL_TBL_PNM, '_')
                          AND A.DB_SCH_ID = T.DB_SCH_ID
                        UNION ALL
                       SELECT 1
                         FROM WAQ_DDL_TBL DT
                        WHERE A.RQST_NO = DT.RQST_NO
                          AND A.PDM_TBL_PNM = IFNULL(DT.DDL_TBL_PNM, '_')
                          AND A.DB_SCH_ID = DT.DB_SCH_ID
                          AND DT.VRF_CD = '1' <!-- 등록가능 -->
                     ) 
  </insert>
  
  <insert id="checkExistsCol" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 미존재컬럼 (DS009) -->
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'C'
      AND NOT EXISTS ( SELECT 1
                         FROM WAM_DDL_TBL T
                              INNER JOIN WAM_DDL_COL C
                                 ON T.DDL_TBL_ID = C.DDL_TBL_ID
                        WHERE A.PDM_COL_PNM = IFNULL(C.DDL_COL_PNM, '_')
                          AND A.DB_SCH_ID = T.DB_SCH_ID
                        UNION ALL
                       SELECT 1
                         FROM WAQ_DDL_TBL RT
                              INNER JOIN WAQ_DDL_COL RC
                                 ON RT.RQST_NO = RC.RQST_NO
                                AND RT.RQST_SNO = RC.RQST_SNO
                        WHERE A.PDM_COL_PNM = IFNULL(RC.DDL_COL_PNM, '_')
                          AND A.DB_SCH_ID = RT.DB_SCH_ID
                     ) 
  </insert>
  
  <insert id="checkExistsL1L3Cd" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 미존재 L1코드 또는 L3코드 (DS010) -->
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'S'
      AND ( NOT EXISTS ( SELECT 1
	                     FROM WAA_APP_CODE CD
	                     WHERE CD.L1CD_PNM = IFNULL(A.L1CD_PNM, '_')
	                   ) 
	        OR
	        NOT EXISTS ( SELECT 1
	                     FROM WAA_APP_CODE CD
	                     WHERE CD.L3CD_PNM = IFNULL(A.L3CD_PNM, '_')
	                   ) 
	      )
  </insert>
  
  <insert id="checkExistsGrtLst" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 미존재 권한 포함 (DS011) -->
      AND A.RQST_DCD = 'CU'
      <![CDATA[
      AND EXISTS (  SELECT 1
                    FROM ( SELECT REGEXP_SUBSTR(E.TXT, '[^;]+', 1,LEVEL) AS GRT, E.RQST_NO, E.RQST_SNO
                            FROM (  SELECT GRT_LST AS TXT, D.RQST_NO, D.RQST_SNO
                                    FROM WAQ_DDL_SEQ D
                                    WHERE D.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
                                 ) E
                            CONNECT BY LEVEL <= LENGTH(REGEXP_REPLACE(E.TXT, '[^;]+',''))+1
                            AND REGEXP_SUBSTR(E.TXT, '[^;]+', 1,LEVEL) IS NOT NULL
                         ) F
                    WHERE F.RQST_NO = A.RQST_NO
                      AND F.RQST_SNO = A.RQST_SNO
                      AND NOT EXISTS ( SELECT 1
                                       FROM WAA_APP_CODE G
                                       WHERE G.L3CD_PNM = F.GRT
                                     )                                         
                 )
      ]]>
  </insert>
  
  
  <insert id="checkNotChgData" parameterType="map">
	 <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.updateVrfNotChg"/>
	  <!--  검증쿼리 : 변경일 때 변경된 데이터가 없을 경우 (DS000) -->
      AND A.REG_TYP_CD = 'U'
      AND EXISTS (
      		SELECT 1 FROM WAM_DDL_SEQ D
      		 WHERE A.DDL_SEQ_PNM = D.DDL_SEQ_PNM
               AND A.DB_SCH_ID  = D.DB_SCH_ID
      		   AND IFNULL(A.INCBY, '_') 		= IFNULL(D.INCBY, '_')
      		   AND IFNULL(A.STRTWT, '_') 		= IFNULL(D.STRTWT, '_')
      		   AND IFNULL(A.MAXVAL, '_') 		= IFNULL(D.MAXVAL, '_')
      		   AND IFNULL(A.MINVAL, '_') 		= IFNULL(D.MINVAL, '_')
      		   AND IFNULL(A.CYC_YN, '_') 		= IFNULL(D.CYC_YN, '_')
      		   AND IFNULL(A.CACHE_SZ, '_') 	    = IFNULL(D.CACHE_SZ, '_')
      		   AND IFNULL(A.ORD_YN, '_') 		= IFNULL(D.ORD_YN, '_')
      		   AND IFNULL(A.GRT_LST, '_') 		= IFNULL(D.GRT_LST, '_')
      		   AND IFNULL(A.PCKG_NM, '_') 		= IFNULL(D.PCKG_NM, '_')
      		   AND IFNULL(A.SEQ_CLAS_CD, '_') 	= IFNULL(D.SEQ_CLAS_CD, '_')
      		   AND IFNULL(A.SEQ_INIT_CD, '_') 	= IFNULL(D.SEQ_INIT_CD, '_')
      		   AND IFNULL(A.BIZ_IFNC, '_') 	    = IFNULL(D.BIZ_IFNC, '_')
      		)
  </insert>
  
  <update id="updateDdlScriptWaq" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq">
  	<!--  DDL 스크립트 업데이트... -->
  	UPDATE /* WaqDdlSeqMapper.updateDdlScriptWaq */
		WAQ_DDL_SEQ
  	   SET SCRT_INFO = #{scrtInfo,jdbcType=VARCHAR}
  	 WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
       AND RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </update>
  
  <!-- 승인/반려 업데이트 -->
  <update id="updatervwStsCd" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
  	UPDATE /* WaqDdlSeqMapper.updatervwStsCd */
		WAQ_DDL_SEQ
  	<set>
  	    RVW_STS_CD 	= #{rvwStsCd} , 
  		RVW_CONTS 	= #{rvwConts} , 
  		APRV_DTM	= NOW() ,
  		APRV_USER_ID = #{aprvUserId} ,
  	</set>
    WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      AND RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
      AND VRF_CD = '1'
      AND IFNULL(RVW_STS_CD, '_') != '2'
  </update> 
  
     <update id="updateidByKey" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq">
     <!--  신규 적재 대상 ID 업데이트 -->
     UPDATE /* WaqDdlSeqMapper.updateidByKey */
		WAQ_DDL_SEQ SET DDL_SEQ_ID = #{ddlSeqId,jdbcType=VARCHAR}
  	 WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
       AND RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
   </update>
   
   <select id="selectWaqC" parameterType="map" resultMap="BaseResultMap">
   	<!--  신규 적재 대상 추출 -->
   	SELECT /* WaqDdlSeqMapper.selectWaqC */
		   *
   	  FROM WAQ_DDL_SEQ
   	 WHERE RQST_NO = #{rqstNo}
   	   AND RVW_STS_CD = '1'  <!--  승인 -->
   	   AND REG_TYP_CD = 'C'
   </select>  
   
   <update id="updateWaqCUD" parameterType="map">
   	<!--  WAQ ID, VERS 등을 업데이트... -->
	UPDATE /* WaqDdlSeqMapper.updateWaqCUD */
		   WAQ_DDL_SEQ A
		   INNER JOIN WAM_DDL_SEQ B
		      ON B.DDL_SEQ_PNM = A.DDL_SEQ_PNM
			 AND B.DB_SCH_ID = A.DB_SCH_ID
			 
	   SET A.DDL_SEQ_ID 	  = B.DDL_SEQ_ID
		 , A.OBJ_VERS  		  = IFNULL(B.OBJ_VERS, 0) + 1
		 , A.FRS_RQST_DTM 	  = B.FRS_RQST_DTM
		 , A.FRS_RQST_USER_ID = B.FRS_RQST_USER_ID
		
     WHERE A.RQST_NO = #{rqstNo}
	   AND A.RVW_STS_CD = '1' <!-- 승인 -->
	   AND EXISTS (
				   SELECT 1 
				     FROM WAM_DDL_SEQ B
			        WHERE B.DDL_SEQ_PNM = A.DDL_SEQ_PNM
			          AND B.DB_SCH_ID = A.DB_SCH_ID
	              )
   </update>
   
    <delete id="deleteWAM" parameterType="map">
    <!--  WAM 삭제 (등록유형코드가REG_TYP_CD 변경, 삭제일 경우) -->
	DELETE /* WaqDdlSeqMapper.deleteWAM */
		   A FROM WAM_DDL_SEQ A
	WHERE EXISTS (
	    SELECT 1 FROM WAQ_DDL_SEQ B
	     WHERE B.RQST_NO = #{rqstNo}
	       AND B.RVW_STS_CD = '1'
	       AND B.DB_SCH_ID = A.DB_SCH_ID
	       AND B.DDL_SEQ_ID = A.DDL_SEQ_ID
	)
   </delete>   

   <insert id="insertWAM" parameterType="map">
   	<!--  WAM 추가 (WAQ 내용을 추가, REG_TYP_CD 가 신규,변경일 경우) -->
	INSERT /* WaqDdlSeqMapper.insertWAM */
		INTO WAM_DDL_SEQ (DDL_SEQ_ID <include refid="wam_col"/> )
	SELECT 
		DDL_SEQ_ID 	
	<include refid="wam_col"/>
	
	FROM WAQ_DDL_SEQ A
	WHERE A.RQST_NO = #{rqstNo}
	AND A.RVW_STS_CD = '1'
	AND A.REG_TYP_CD IN ('C', 'U')
   </insert>  
   
   <update id="updateWAH"  parameterType="map">
   	<!--  WAH 이력 만료... -->
	UPDATE /* WaqDdlSeqMapper.updateWAH */
		WAH_DDL_SEQ A
	SET EXP_DTM = NOW()
	WHERE EXISTS (
	   SELECT 1 FROM WAQ_DDL_SEQ B
	    WHERE B.RQST_NO = #{rqstNo}
	      AND B.RVW_STS_CD = '1'
	      AND B.DB_SCH_ID = A.DB_SCH_ID
	      AND B.DDL_SEQ_ID = A.DDL_SEQ_ID
	    )
	AND EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%D')
   </update>  

   <insert id="insertWAH"  parameterType="map">
   	<!--  WAH이력 적재... -->
	INSERT /* WaqDdlSeqMapper.insertWAH */
		INTO WAH_DDL_SEQ (DDL_SEQ_ID, EXP_DTM, STR_DTM <include refid="wam_col"/>)
	SELECT
	    A.DDL_SEQ_ID AS DDL_SEQ_ID
	    , STR_TO_DATE( '9999-12-31', '%Y-%m-%D') AS EXP_DTM
	    , NOW() AS STR_DTM 
	
	<include refid="wam_col"/>
   
	 FROM WAQ_DDL_SEQ A
	WHERE A.RQST_NO = #{rqstNo}
	  AND A.RVW_STS_CD = '1'
	  AND A.DDL_SEQ_ID IS NOT NULL
   </insert> 
   
   <select id="selectwamseqlist" parameterType="map" resultMap="BaseResultMap">
  	<!--  DDL 시퀀스 추가대상 조회... -->
  	SELECT /* WaqDdlSeqMapper.selectwamseqlist */
 		   'I' AS IBS_STATUS
	  	  , #{reqmst.rqstDcd} AS RQST_DCD 
          , A.DDL_SEQ_ID, A.DDL_SEQ_PNM, A.DDL_SEQ_LNM
	      , A.DB_SCH_ID
	      , S.DB_SCH_PNM
	      , DB.DB_CONN_TRG_PNM
	      , A.INCBY, A.STRTWT, A.MAXVAL, A.MINVAL 
	      , A.CYC_YN, A.CACHE_SZ, A.ORD_YN, A.NM_RL_TYP_CD, A.US_TYP_CD, A.PDM_TBL_PNM, A.PDM_COL_PNM
	      , A.L1CD_PNM, A.L3CD_PNM, A.GRT_LST
	      , A.DDL_TRG_DCD , A.SRC_DB_SCH_ID , A.SRC_DDL_SEQ_ID
	      , A.OBJ_DESCN
	      , A.PRJ_MNG_NO
		  , A.SR_MNG_NO  
		  , A.PCKG_NM
		  , A.SEQ_CLAS_CD   
		  , A.SEQ_INIT_CD
		  , A.BIZ_IFNC
	  FROM WAM_DDL_SEQ A
	 INNER JOIN WAA_DB_SCH S
	    ON A.DB_SCH_ID = S.DB_SCH_ID
	   AND S.REG_TYP_CD IN ('C', 'U')
	   AND S.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	 INNER JOIN WAA_DB_CONN_TRG DB
	    ON S.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
	   AND DB.REG_TYP_CD IN ('C', 'U')
	   AND DB.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	  LEFT OUTER JOIN WAA_USER U
	    ON A.FRS_RQST_USER_ID = U.USER_ID
	   AND U.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	   AND U.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_USER U1
	    ON A.RQST_USER_ID = U1.USER_ID
	   AND U1.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	   AND U1.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_USER U2
	    ON A.APRV_USER_ID = U2.USER_ID
	   AND U2.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	   AND U2.REG_TYP_CD IN ('C', 'U')
	  <where>
	  	 AND  A.DDL_SEQ_ID IN 
		 <foreach collection="list" item="item" open="(" separator="," close=")">
		  	#{item.ddlSeqId}
		 </foreach>	  
	  </where>

  </select>     
   
   <insert id="checkSeqPnmConst" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 시퀀스 명명규칙 위반 (DS005) -->
      AND A.RQST_DCD = 'CU'
	  AND (SUBSTR(A.DDL_SEQ_PNM,0,2) != 'SQ'
		    OR SUBSTR(A.DDL_SEQ_PNM,LENGTH(A.DDL_SEQ_PNM),1) NOT IN ('0','1','2','3','4','5','6','7','8','9','0')
		    OR SUBSTR(A.DDL_SEQ_PNM,LENGTH(A.DDL_SEQ_PNM)-1,1) = '0'
		    OR NOT EXISTS (SELECT 1 FROM WAM_DDL_TBL B
		                    INNER JOIN WAA_DB_SCH S
		                       ON B.DB_SCH_ID = S.DB_SCH_ID
		                      AND S.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D')
		                      AND S.REG_TYP_CD IN ('C','U')
		                    WHERE A.DB_SCH_PNM = S.DB_SCH_PNM
		                      AND SUBSTR(SUBSTR(A.DDL_SEQ_PNM,0,INSTR(DDL_SEQ_PNM,'_',-1)-1),INSTR(DDL_SEQ_PNM,'_')+1) = B.DDL_TBL_PNM
		                      )
		    )
      	        		
  </insert>
  
  <insert id="chekcValueMinStart" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 시퀀스 값 위반 MINVALUE > START WITH (DS006) -->
      AND A.RQST_DCD = 'CU'
	  AND A.MINVAL > A.STRTWT
  </insert>
  
  <insert id="chekcValueMinMax" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 시퀀스 값 위반 MINVALUE > MAXVALUE (DS007) -->
      AND A.RQST_DCD = 'CU'
      AND A.MAXVAL_YN = 'Y'
	  AND A.MINVAL > A.MAXVAL
  </insert>
  
  <insert id="chekcValueCache" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : CACHE 값 위반(DS008) -->
      AND A.RQST_DCD = 'CU'
	  AND A.CACHE_SZ = '0'
  	  AND A.CACHE_SZ IS NOT NULL
  </insert>
  
  
  <update id="updateMaxvalN" parameterType="map">
		UPDATE WAQ_DDL_SEQ SET MAXVAL =''
		WHERE RQST_NO = #{rqstNo}
		 AND MAXVAL_YN ='N'
  </update>
  
  <insert id="chekcValueIncbyChar" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : (INCREMENT BY 문자오류 DS016) -->
      AND A.RQST_DCD = 'CU'
      AND A.INCBY REGEXP '[^0-9]' 
  </insert>
  
  <insert id="chekcValueStartChar" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	    <!--  검증쿼리 : (START WITH 문자오류 DS017) -->
      AND A.RQST_DCD = 'CU'
      AND A.STRTWT REGEXP '[^0-9]' 
  </insert>
  
  <insert id="chekcValueMaxChar" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	   <!--  검증쿼리 : (MAX VALUE 문자오류 DS018) -->
      AND A.RQST_DCD = 'CU'
      AND A.MAXVAL REGEXP '[^0-9]' 
      AND A.MAXVAL_YN ='Y'
  </insert>
  
  <insert id="chekcValueMinChar" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  	   <!--  검증쿼리 : (MIN VALUE 문자오류 DS019) -->
      AND A.RQST_DCD = 'CU'
      AND A.MINVAL REGEXP '[^0-9]' 
  </insert>
  
  <insert id="chekcValueCacheChar" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  	   <!--  검증쿼리 : (CACHE SIZE 문자오류 DS020) -->
      AND A.RQST_DCD = 'CU'
      AND A.CACHE_SZ REGEXP '[^0-9]' 
      AND IFNULL(A.CACHE_SZ,'') != ''
  </insert>
  
  <select id="selectDdlTsfSeqRqstList" parameterType="kr.wise.commons.rqstmst.service.WaqMstr" resultMap="BaseResultMap" >
  	<!--  DDL 테이블 요청서 리스트 조회 -->
	  	SELECT /* WaqDdlSeqMapper.selectDdlTsfSeqRqstList */
		      A.RQST_NO
		    , A.RQST_SNO
		    , NULL AS RQST_DTL_SNO
		    , A.DDL_SEQ_ID
		    , A.DDL_SEQ_PNM
		    , A.DDL_SEQ_LNM
		    , A.RQST_DCD
		    , A.REG_TYP_CD     
		    , A.RVW_CONTS
		    , A.VRF_CD
		    , A.VRF_RMK  
		    , A.DB_CONN_TRG_PNM
		    , A.DB_SCH_ID
		    , A.DB_SCH_PNM
		    , A.OBJ_DESCN
		    , A.OBJ_VERS
		    , A.FRS_RQST_DTM
		    , A.FRS_RQST_USER_ID
		    , A.RQST_DTM
		    , A.RQST_USER_ID
		    , A.APRV_DTM
		    , A.APRV_USER_ID
		    , A.DDL_TRG_DCD
		    , A.SRC_DDL_TRG_DCD
		    , A.SRC_DB_SCH_ID
		    , A.TGT_DDL_TRG_DCD     
		    , A.TGT_DB_SCH_ID
		    , A.META_ONLY_YN
		    
		    <if test='rqstStepCd == "Q" '>
		     , CASE WHEN A.RVW_STS_CD = '2' THEN '2' ELSE '0' END AS RVW_STS_CD
		     </if>
		     <if test='rqstStepCd != "Q" '>
		     , A.RVW_STS_CD
		     </if> 	     
		     <!--  , CASE WHEN A.VRF_CD = '2' THEN '#FF0000' END AS FontColor -->
		     , CASE WHEN A.VRF_CD = '2' THEN '#FF0000' ELSE CASE WHEN A.VRF_CD = '5' THEN '#0000FF'  END END AS FontColor  
		     , GET_USER_NM(A.RQST_USER_ID) AS RQST_USER_NM
		     , C.DB_CONN_TRG_PNM AS SRC_DB_CONN_TRG_PNM
		     , B.DB_SCH_PNM      AS SRC_DB_SCH_PNM
		     , E.DB_CONN_TRG_ID  AS TGT_DB_CONN_TRG_ID 
		     , E.DB_CONN_TRG_PNM AS TGT_DB_CONN_TRG_PNM
		     , D.DB_SCH_PNM      AS TGT_DB_SCH_PNM
		     , 'SEQ'             AS OBJ_DCD 
		     , A.RQST_RSN
		     , DATE_FORMAT(MSTR.DDL_MIG_DTM,'%Y-%m-%d %H:%i:%S') AS DDL_MIG_DTM_TSF
		     , A.MAXVAL_YN
	     FROM WAQ_DDL_SEQ A	      
		      LEFT JOIN WAA_DB_SCH B
		        ON B.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D')
		       AND B.DB_SCH_ID = A.SRC_DB_SCH_ID
		      LEFT JOIN WAA_DB_CONN_TRG C
		        ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D')    
		       AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID
		      LEFT JOIN WAA_DB_SCH D
		        ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D') 
		       AND D.DB_SCH_ID = A.TGT_DB_SCH_ID
		      LEFT JOIN WAA_DB_CONN_TRG E
		        ON E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D') 
		       AND E.DB_CONN_TRG_ID = D.DB_CONN_TRG_ID 	            
		       LEFT JOIN WAQ_MSTR MSTR
	        	ON A.RQST_NO = MSTR.RQST_NO   
	    WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
	    <if test='rqstStepCd == "Q" or rqstStepCd == "A" '>
	    	AND A.VRF_CD = '1'
	    </if>
    ORDER BY A.RQST_SNO  	  	
  </select>
  
  
  <select id="selectTsfDdlSeqList" parameterType="map" resultMap="BaseResultMap">
  	<!--  DDL 테이블 추가대상 조회... -->
   	 SELECT /* WaqDdlSeqMapper.selectTsfDdlSeqList */
			'I' AS IBS_STATUS
		  , '' AS DDL_SEQ_ID
		  , 'SEQ' AS OBJ_DCD
		  , #{reqmst.tgtDbSchId,jdbcType=VARCHAR}  AS DB_SCH_ID 
		  , #{reqmst.tgtDbSchPnm,jdbcType=VARCHAR} AS DB_SCH_PNM
		  , A.DDL_SEQ_PNM AS DDL_SEQ_PNM
		  , A.DDL_SEQ_LNM AS DDL_SEQ_LNM
		  , ''            AS UK_IDX_YN
		  , D.DDL_TRG_DCD AS DDL_TRG_DCD 
		  , #{reqmst.rqstDcd,jdbcType=VARCHAR} AS RQST_DCD  
		  , A.INCBY
		  , A.STRTWT
		  , A.MAXVAL
		  , A.MINVAL
		  , A.CYC_YN
		  , A.CACHE_SZ
		  , A.ORD_YN
		  , A.OBJ_DESCN		  
		  , B.DDL_TRG_DCD      AS SRC_DDL_TRG_DCD 
		  , B.DB_SCH_ID        AS SRC_DB_SCH_ID
		  , B.DB_SCH_PNM       AS SRC_DB_SCH_PNM		 
		  , C.DB_CONN_TRG_PNM  AS SRC_DB_CONN_TRG_PNM 
		  , D.DDL_TRG_DCD      AS TGT_DDL_TRG_DCD
		  , D.DB_SCH_ID        AS TGT_DB_SCH_ID 
		  , D.DB_SCH_PNM       AS TGT_DB_SCH_PNM
		  , E.DB_CONN_TRG_PNM AS TGT_DB_CONN_TRG_PNM

		  , A.DDL_SEQ_ID AS SRC_DDL_SEQ_ID
		  , CONCAT(DATE_FORMAT(date_add(NOW(),INTERVAL+1 day),'%Y-%m-%d'),' 23:00:00')  AS DDL_MIG_DTM
		  , A.MAXVAL_YN
	   FROM WAM_DDL_SEQ A  
	        INNER JOIN WAA_DB_SCH B
	          ON B.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D')         
	         AND B.DB_SCH_ID = A.DB_SCH_ID  	         
	       INNER JOIN WAA_DB_CONN_TRG C
	          ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D')
	         AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID   
	       INNER JOIN WAA_DB_SCH D
	          ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D')          
	         AND D.DB_SCH_ID = #{reqmst.tgtDbSchId,jdbcType=VARCHAR} 
	       INNER JOIN WAA_DB_CONN_TRG E
	          ON E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D') 
	         AND E.DB_CONN_TRG_ID = D.DB_CONN_TRG_ID                	       
	  WHERE 1 = 1
	    AND A.DDL_SEQ_ID IN 
	 <foreach collection="list" item="item" open="(" separator="," close=")">
	  	#{item.ddlSeqId} 
	 </foreach> 
	
  </select>
  
  <insert id="checkRqstDevDdlTrgDcd" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 이관이 아닌경우 개발/테스트 에만 요청가능(DS091) -->
      <![CDATA[
      AND EXISTS (SELECT 1
                    FROM WAA_DB_SCH C 
                   INNER JOIN WAA_DB_CONN_TRG D
                      ON D.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%D')
                     AND D.REG_TYP_CD IN ('C', 'U')
                     AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
                   WHERE C.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%D')
                     AND C.REG_TYP_CD IN ('C', 'U')
                     AND D.DB_CONN_TRG_PNM = A.DB_CONN_TRG_PNM
                     AND C.DB_SCH_PNM      = A.DB_SCH_PNM                           
                     AND C.DDL_TRG_DCD NOT IN ('D','T')
               )
      ]]>
  </insert>
  
  
  <select id="selectDdlTsfSeqDetail" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" resultMap="ResultMapWithBLOBs">
  	<!--  DDL 이관 요청서 상세조회 -->
  	SELECT /* WaqDdlSeqMapper.selectDdlTsfSeqDetail */
			A.*
      	 , 'SEQ' AS OBJ_DCD
      	 , C.DB_CONN_TRG_ID AS TGT_DB_CONN_TRG_ID
      	 , DATE_FORMAT(DDL_MIG_DTM,'%Y-%m-%d') AS DDL_MIG_DTM
         , DATE_FORMAT(M.DDL_MIG_DTM,'%H') AS DDL_RQST_HR
         , DATE_FORMAT(M.DDL_MIG_DTM,'%i') AS DDL_RQST_MIN 
         , M.SMS_SND_EXP
         , A.MAXVAL_YN
      FROM WAQ_DDL_SEQ A 
           LEFT JOIN WAA_DB_SCH B
             ON B.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D')
            AND B.DB_SCH_ID = A.TGT_DB_SCH_ID
           LEFT JOIN WAA_DB_CONN_TRG C
             ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%D')
            AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID
           LEFT JOIN WAQ_MSTR M
	         ON A.RQST_NO = M.RQST_NO
     WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
       AND A.RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </select>
  
  
  <select id="selectDbaId" parameterType="kr.wise.commons.rqstmst.service.WaqMstr" resultType="java.lang.String">
  	SELECT /* WaqDdlSeqMapper.selectDbaId */
  	       APRG_ID
	  FROM WAA_RQST_BIZ_APR A
	 WHERE APR_LVL = 
	 (
	  	SELECT MAX(APR_LVL) AS APR_LVL
	           FROM WAA_RQST_BIZ_APR A
	  	 WHERE  A.EXP_DTM = STR_TO_DATE('9999-12-31', '%Y-%m-%d')
	  	   AND A.REG_TYP_CD IN ('C', 'U') 
	  	   AND BIZ_DCD = #{reqmst.rqstNo}
	)
	AND BIZ_DCD = #{reqmst.bizDcd}
	
  </select>
  
  
  <update id="updatervwStsCdDba" parameterType="kr.wise.commons.rqstmst.service.WaqMstr" >
  	UPDATE /* WaqDdlSeqMapper.updatervwStsCdDba */
		WAQ_DDL_SEQ
  	<set>
  	    RVW_STS_CD 	= '1', 
  		RVW_CONTS 	= '' , 
  		APRV_DTM	= NOW() ,
  		APRV_USER_ID = 'meta' ,
  	</set>
    WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      AND VRF_CD = '1'
      AND IFNULL(RVW_STS_CD, '_') != '2'
  </update>
  
  
  <!-- DdlSeqRqstServiceImpl.java의 check메소드에 주석으로 추가 되어있으면서 
         오라클버전에 있지만 마리아에는없는 검증쿼리 일단 넣어둠 2020.10.16 - 이상후 -->
  
  <insert id="checkAplRegDd" parameterType="map">
  <!--  검증쿼리 : 적용예정일자 오늘날자보다 작은지 체크 (DS012) -->
  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
<!--   AND A.RQST_DCD = 'CU' -->
  AND A.APL_REQ_DT IS NOT NULL
  <![CDATA[
  AND DATE_FORMAT(A.APL_REQ_DT, '%Y-%m-%d') < DATE_FORMAT(NOW(), '%Y-%m-%d')
   ]]>
   </insert>
   
   <insert id="checkExistsTsfSeq" parameterType="map">
  	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
  	<!-- 검증쿼리 : 등록요청에서 테스트,운영DB신청시(DS013) 이관아닐때 -->
    AND A.DB_SCH_ID IN (SELECT DB_SCH_ID
                      FROM WAA_DB_SCH 
                      WHERE EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                      AND REG_TYP_CD IN ('C', 'U')
                      AND DDL_TRG_DCD IN ('T','R')
                      )
  </insert>   
   
   <insert id="checkRealSrMngNo" parameterType="map"> 
	  <!--  검증쿼리 : 운영반영시 SR번호 필수 체크 (DT014) -->
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  AND A.DDL_TRG_DCD = 'R'
	  AND (A.SR_MNG_NO IS NULL OR A.PRJ_MNG_NO IS NULL)	  	  
  </insert>	 


 <insert id="checkAplReqDtByDdlTrgDcd" parameterType="map"> 
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	<!--  검증쿼리 : 운영이관 시 체크카드여부 테이블의 적용요청일자 는 매월둘째주금요일 임(DT018) -->
	AND A.DDL_TRG_DCD = 'R' <!-- 운영이관 -->
	 <!-- AND A.REG_TYP_CD = 'U' # 변경 -->
	AND A.NM_RL_TYP_CD = 'E' <!-- 엔티티기반 -->
	AND IFNULL(A.APL_REQ_DT, 'YYYY')
	    != IFNULL((SELECT TO_CHAR(TRUNC(TRUNC(STR_TO_DATE(A.APL_REQ_DT, '%Y-%m-%d'), 'MONTH'), 'd')+12, '%Y-%m-%d') FROM DUAL),'XXXX')
	AND EXISTS (SELECT 1
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               <!--  AND D.VRF_CD = '1' -->		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' <!-- 운영이관 --> 	                
	              )	
 </insert>   

   <insert id="checkAplInfoByDdlTrgDcd" parameterType="map"> 
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 운영이관시 적용요청구분,적용요청일자 필수 (DT019) -->
	  <!--  AND A.DDL_TRG_DCD = 'R' # 운영이관 -->
	  <!--  AND A.REG_TYP_CD = 'U' # 변경 -->
	  
<!-- 	  AND (A.APL_REQ_TYP_CD IS NULL OR A.APL_REQ_DT IS NULL) -->
<!-- 201803015 우동원차장 요청으로 개발,테스트, 운영 구분 없이 적용요청일자는 필수로 변경 -->
	     AND A.APL_REQ_DT IS NULL
  </insert> 
  
  <insert id="checkAplReqDtByDdlTrgDcdReal" parameterType="map"> 
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : 적용요청구분이 정기 이고 계정계이고 운영이관일 경우 적용요청일자는 매주 금요일(DT020) -->
	  AND A.DDL_TRG_DCD = 'R' <!-- 운영이관 -->
	  <!--  AND A.REG_TYP_CD = 'U' # 변경 -->
	  AND IFNULL(A.APL_REQ_TYP_CD, 'F') != 'U' <!-- 적용요청구분 긴급이 아닐경우 F:정기, U:긴급 -->
	  AND A.NM_RL_TYP_CD != 'E' <!-- 엔티티기반 -->
	  AND A.APL_REQ_DT IS NOT NULL
	  AND EXISTS (SELECT 1
	                FROM WAA_DB_CONN_TRG DB
	                     INNER JOIN WAA_DB_SCH S
	                        ON DB.DB_CONN_TRG_ID = S.DB_CONN_TRG_ID
	                       AND S.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	                       AND S.REG_TYP_CD IN ('C','U')
	               WHERE DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	                 AND DB.REG_TYP_CD IN ('C','U') 
	                 AND A.DB_SCH_ID = S.DB_SCH_ID )
	  AND IFNULL(A.APL_REQ_DT, 'YYYY')
	      != IFNULL((SELECT TO_CHAR(TRUNC(TRUNC(STR_TO_DATE(A.APL_REQ_DT, '%Y-%m-%d'), 'IW'), 'd')+5, '%Y-%m-%d') FROM DUAL),'XXXX')	
  </insert>
  
  <update id="checkAplReqDt" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	<!-- 검증쿼리 : 운영이관시 적용요청일자는 항상 금요일 이다. 화 목도 추가 될수 있다?(DT022) -->
	 AND A.NM_RL_TYP_CD = 'E' <!-- 엔티티기반 -->
	 AND A.DDL_TRG_DCD = 'R' <!-- 운영이관 -->
	 AND IFNULL(A.APL_REQ_TYP_CD, 'F') != 'U' <!--  긴급제외 #적용요청구분 긴급이 아닐경우 F:정기, U:긴급 -->	 
	 AND EXISTS (SELECT 1  <!--  체크카드여부 제외 DT018 참조 -->
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               <!--  AND D.VRF_CD = '1' -->		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' <!-- 운영이관 --> 	                
	              )		 
     AND TO_CHAR(STR_TO_DATE(A.APL_REQ_DT, '%Y-%m-%d'), 'D') != (SELECT MAX(X.APL_REQ_WKD) 
                                                                FROM V_WAA_SUBJ X
                                                                     INNER JOIN WAH_PDM_TBL Y
                                                                        ON X.SUBJ_ID = Y.SUBJ_ID
                                                                       AND Y.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')                                                                      
                                                               WHERE A.PDM_TBL_PNM = Y.PDM_TBL_PNM)
  </update>
  
   <update id="checkAplReqDt3" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	<!-- 검증쿼리 : 엔티티기반 아닐경우 운영이관시 적용요청일자는 항상 금요일 이다. 화 목도 추가 될수 있다?(DT024) -->
	 AND A.NM_RL_TYP_CD != 'E' <!-- 엔티티기반 -->
	 AND A.DDL_TRG_DCD = 'R' <!-- 운영이관 -->
	 AND IFNULL(A.APL_REQ_TYP_CD, 'F') != 'U' <!--  긴급제외 # 적용요청구분 긴급이 아닐경우 F:정기, U:긴급 -->	 
	 AND EXISTS (SELECT 1  <!--  체크카드여부 제외 DT018 참조 -->
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               <!--  AND D.VRF_CD = '1' -->		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' <!-- 운영이관 -->
	              )		 
     AND TO_CHAR(STR_TO_DATE(A.APL_REQ_DT, '%Y-%m-%d'), 'D') != '6' <!-- 금요일 -->
  </update>  
  
  <update id="checkAplReqDt2" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	<!-- 검증쿼리 : 운영이관시 적용요청일자가 수, 목, 금 일경우 차주 금요일이다...(DT023) -->
	
	 AND A.NM_RL_TYP_CD = 'E' <!-- 엔티티기반 -->
	 AND A.DDL_TRG_DCD = 'R' <!-- 운영이관 -->
	 AND IFNULL(A.APL_REQ_TYP_CD, 'F') != 'U' <!--  긴급제외 #적용요청구분 긴급이 아닐경우 F:정기, U:긴급 -->	 
	 AND EXISTS (SELECT 1  <!--  체크카드여부 제외 DT018 참조 -->
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               <!--  AND D.VRF_CD = '1' -->		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' <!-- 운영이관 --> 
	              )		 
	 AND TO_CHAR(STR_TO_DATE(TO_CHAR(A.RQST_DTM, '%Y-%m-%d'), '%Y-%m-%d'), 'D')<![CDATA[ >= ]]>(SELECT MAX(X.APL_REQ_CHK_WKD) 
					                                                                FROM V_WAA_SUBJ X
					                                                                     INNER JOIN WAH_PDM_TBL Y
					                                                                        ON X.SUBJ_ID = Y.SUBJ_ID
					                                                                       AND Y.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')                                                                     
					                                                               WHERE A.PDM_TBL_PNM = Y.PDM_TBL_PNM)
     AND A.APL_REQ_DT
         = (SELECT TO_CHAR(TRUNC(STR_TO_DATE(TO_CHAR(NOW(), '%Y-%m-%d'), '%Y-%m-%d'), 'IW') + (MAX(X.APL_REQ_WKD) -2 ), '%Y-%m-%d') AS APL_REQ_DT 
              FROM WAQ_DDL_SEQ B
                   INNER JOIN WAH_PDM_TBL Y
                      ON B.PDM_TBL_PNM = Y.PDM_TBL_PNM
                     AND Y.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
                   INNER JOIN V_WAA_SUBJ X
                      ON X.SUBJ_ID = Y.SUBJ_ID
              WHERE 1 = 1
                AND B.NM_RL_TYP_CD = 'E' <!-- 엔티티기반 -->
                AND A.RQST_NO = B.RQST_NO
                AND A.RQST_SNO = B.RQST_SNO) 
      
  </update> 
  
  <update id="checkAplReqDt4" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	<!-- 검증쿼리 : 엔티티기반 아닐경우 운영이관시 적용요청일자가 수, 목, 금 일경우 차주 금요일이다...(DT025) -->
	
	 AND A.NM_RL_TYP_CD != 'E' <!-- 엔티티기반 -->
	 AND A.DDL_TRG_DCD = 'R' <!-- 운영이관 -->
	 AND IFNULL(A.APL_REQ_TYP_CD, 'F') != 'U' <!--  긴급제외 # 적용요청구분 긴급이 아닐경우 F:정기, U:긴급 -->	 
	 AND EXISTS (SELECT 1  <!--  체크카드여부 제외 DT018 참조 -->
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	                AND D.VRF_CD = '1'		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' <!-- 운영이관 --> 
	              )		 
	 AND TO_CHAR(STR_TO_DATE(TO_CHAR(A.RQST_DTM, '%Y-%m-%d'), '%Y-%m-%d'), 'D') <![CDATA[>=]]>  '4' <!-- 수요일 -->
     AND A.APL_REQ_DT =  TO_CHAR(TRUNC(STR_TO_DATE(TO_CHAR(NOW(), '%Y-%m-%d'), '%Y-%m-%d'), 'IW') + 4, '%Y-%m-%d') <!--  금요일 -->
     
  </update> 
  
  <insert id="checkSeqInitCdExists" parameterType="map"> 
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : INIT유형 사용용도 일별(D) 일경우 필수  체크 DS014 -->
	   AND A.RQST_DCD = 'CU'
	   AND A.US_TYP_CD = 'D' <!-- 일별 -->
	   AND A.SEQ_INIT_CD IS NULL
  </insert> 
   <insert id="checkSeqBizIfncByInitCd" parameterType="map"> 
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  <!--  검증쿼리 : INIT유형 8, 9 일경우 업무영향도 필수 체크 DS015 -->
	   AND A.RQST_DCD = 'CU'
	   AND A.SEQ_INIT_CD IN ('8','9')
	   AND A.BIZ_IFNC IS NULL  
  </insert>          
</mapper>