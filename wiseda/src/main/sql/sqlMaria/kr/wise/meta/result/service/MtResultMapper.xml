<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.meta.result.service.MtResultMapper" >
	<resultMap id="BaseResultMap" type="kr.wise.meta.result.service.MtResultVO"  extends="kr.wise.commons.cmm.service.CommonMapper.BaseResultMap">
		<result column="UPP_DQI_LNM"  property="uppDqiLnm"  jdbcType="VARCHAR"  />
		<result column="DQI_LNM"      property="dqiLnm"     jdbcType="VARCHAR"  />
		
		<result column="UPP_DQI_LNM"  property="cntName"    jdbcType="VARCHAR"  />
		<result column="TOT_CNT"      property="totCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_CNT"      property="errCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_RATE"     property="errRate"    jdbcType="VARCHAR"  />
		<result column="NO_EXE"       property="noExe"      jdbcType="VARCHAR"  />
		<result column="COL_CNT"      property="colCnt"     jdbcType="VARCHAR"  />
		<result column="TBL_CNT"      property="tblCnt"     jdbcType="VARCHAR"  />
		<result column="SUM_RATE"     property="sumRate"    jdbcType="VARCHAR"  />
		
		<result column="ANA_STR_DTM"  property="anaStrDtm"  jdbcType="VARCHAR"  />
		<result column="ANA_END_DTM"  property="anaEndDtm"  jdbcType="VARCHAR"  />
		
		<result column="ERR_SQL"  property="errSql"  jdbcType="CLOB"  />
		<result column="DBC_TBL_KOR_NM"  property="dbcTblKorNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_KOR_NM"  property="dbcColKorNm"  jdbcType="VARCHAR"  />
		<result column="PRF_KND_CD"  property="prfKndCd"  jdbcType="VARCHAR"  />
		<result column="PRF_TYP"  property="prfTyp"  jdbcType="VARCHAR"  />
		<result column="PRF_NM"  property="prfNm"  jdbcType="VARCHAR"  />
		<result column="PRF_ID"  property="prfId"  jdbcType="VARCHAR"  />
		<result column="PRF_YN"  property="prfYn"  jdbcType="VARCHAR"  />
		<result column="DATA_TYPE"  property="dataType"  jdbcType="VARCHAR"  />
		<result column="EXP_YN"  property="expYn"  jdbcType="VARCHAR"  />
		<result column="EXP_RSN_CNTN"  property="expRsnCntn"  jdbcType="VARCHAR"  />
		
		<result column="DB_SCH_PNM"  property="dbSchPnm"  jdbcType="VARCHAR"  />
		<result column="DB_SCH_LNM"  property="dbSchLnm"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_NM"  property="dbcTblNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_NM"  property="dbcColNm"  jdbcType="VARCHAR"  />
		
		<result column="STND_RATE"     property="stndRate"    jdbcType="VARCHAR"  />
		<result column="GOAL"     property="goal"    jdbcType="VARCHAR"  />
		
		<result column="PDM_TBL_PNM"     property="pdmTblPnm"    jdbcType="VARCHAR"  />
		<result column="PDM_COL_PNM"     property="pdmColPnm"    jdbcType="VARCHAR"  />
		<result column="PDM_TBL_LNM"     property="pdmTblLnm"    jdbcType="VARCHAR"  />
		<result column="PDM_COL_LNM"     property="pdmColLnm"    jdbcType="VARCHAR"  />
		<result column="DATA_TYPE"     property="dataType"    jdbcType="VARCHAR"  />
		<result column="GAP_STATUS"     property="gapStatus"    jdbcType="VARCHAR"  />
		
		<result column="SDITM_LNM"     property="sditmLnm"    jdbcType="VARCHAR"  />
		<result column="SDITM_PNM"     property="sditmPnm"    jdbcType="VARCHAR"  />
		<result column="OBJ_DESCN"     property="objDescn"    jdbcType="VARCHAR"  />
		<result column="INFOTP_LNM"     property="infotpLnm"    jdbcType="VARCHAR"  />
		
		<result column="DMN_LNM"     property="dmnLnm"    jdbcType="VARCHAR"  />
		<result column="DMN_PNM"     property="dmnPnm"    jdbcType="VARCHAR"  />
		<result column="OBJ_DESCN"     property="objDescn"    jdbcType="VARCHAR"  />
		<result column="DATA_LEN"     property="dataLen"    jdbcType="VARCHAR"  />
		<result column="DATA_SCAL"     property="dataScal"    jdbcType="VARCHAR"  />
		<result column="NONUL_YN"     property="noNullYn"    jdbcType="VARCHAR"  />
		<result column="PK_ORD"     property="pkOrd"    jdbcType="VARCHAR"  />
		<result column="PK_YN"     property="pkYn"    jdbcType="VARCHAR"  />
		
		<result column="ITEM_NM"     property="itemNm"    jdbcType="VARCHAR"  />
		<result column="GAP_RATE"     property="gapRate"    jdbcType="VARCHAR"  />
		<result column="RESULT_DATE"     property="resultDate"    jdbcType="VARCHAR"  />
		<result column="OBJ_CNT"     property="objCnt"    jdbcType="VARCHAR"  />
		<result column="ERROR_CNT"     property="errorCnt"    jdbcType="VARCHAR"  />
		
		<result column="TBL_NM"     property="tblNm"    jdbcType="VARCHAR"  />
		<result column="STATE"     property="state"    jdbcType="VARCHAR"  />
		<result column="DETAIL_STATUS"     property="detailStatus"    jdbcType="VARCHAR"  />
		<result column="COL_NM"     property="colNm"    jdbcType="VARCHAR"  />
	</resultMap>
  
	<resultMap id="DataResultMap" type="kr.wise.meta.result.service.MtResultDataVO"  extends="kr.wise.commons.cmm.service.CommonMapper.BaseResultMap">
		<result column="DQI_LNM"      property="dqiLnm"     jdbcType="VARCHAR"  />
		<result column="ANA_CNT"      property="anaCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_CNT"      property="errCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_RATE"     property="errRate"    jdbcType="VARCHAR"  />
		<result column="PRF_KND_CD"  property="prfKndCd"  jdbcType="VARCHAR"  />
		<result column="PRF_NM"  property="prfNm"  jdbcType="VARCHAR"  />
		<result column="PRF_ID"  property="prfId"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_NM"  property="dbcTblNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_NM"  property="dbcColNm"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_KOR_NM"  property="dbcTblKorNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_KOR_NM"  property="dbcColKorNm"  jdbcType="VARCHAR"  />
		
		<result column="RNG"  property="rng" jdbcType="VARCHAR" />
		<result column="DTM"  property="dtm" jdbcType="VARCHAR" />
		<result column="REL"  property="rel" jdbcType="VARCHAR" />
		<result column="PTR"  property="ptr" jdbcType="VARCHAR" />
		<result column="EFVA" property="efva" jdbcType="VARCHAR" />
		<result column="UNQ"  property="unq" jdbcType="VARCHAR" />
		
		<result column="ERR_SQL"  property="errSql"  jdbcType="CLOB"  />
		
		<result column="COL_CNT" property="colCnt" jdbcType="DECIMAL" />
		
		<result column="COL_NM1" property="colNm1" jdbcType="VARCHAR" />
		<result column="COL_NM2" property="colNm2" jdbcType="VARCHAR" />
		<result column="COL_NM3" property="colNm3" jdbcType="VARCHAR" />
		<result column="COL_NM4" property="colNm4" jdbcType="VARCHAR" />
		<result column="COL_NM5" property="colNm5" jdbcType="VARCHAR" />
		<result column="COL_NM6" property="colNm6" jdbcType="VARCHAR" />
		<result column="COL_NM7" property="colNm7" jdbcType="VARCHAR" />
		<result column="COL_NM8" property="colNm8" jdbcType="VARCHAR" />
		<result column="COL_NM9" property="colNm9" jdbcType="VARCHAR" />
		<result column="COL_NM10" property="colNm10" jdbcType="VARCHAR" />
		
		<result column="COL_NM11" property="colNm11" jdbcType="VARCHAR" />
		<result column="COL_NM12" property="colNm12" jdbcType="VARCHAR" />
		<result column="COL_NM13" property="colNm13" jdbcType="VARCHAR" />
		<result column="COL_NM14" property="colNm14" jdbcType="VARCHAR" />
		<result column="COL_NM15" property="colNm15" jdbcType="VARCHAR" />
		<result column="COL_NM16" property="colNm16" jdbcType="VARCHAR" />
		<result column="COL_NM17" property="colNm17" jdbcType="VARCHAR" />
		<result column="COL_NM18" property="colNm18" jdbcType="VARCHAR" />
		<result column="COL_NM19" property="colNm19" jdbcType="VARCHAR" />
		<result column="COL_NM20" property="colNm20" jdbcType="VARCHAR" />
		
		<result column="COL_NM21" property="colNm21" jdbcType="VARCHAR" />
		<result column="COL_NM22" property="colNm22" jdbcType="VARCHAR" />
		<result column="COL_NM23" property="colNm23" jdbcType="VARCHAR" />
		<result column="COL_NM24" property="colNm24" jdbcType="VARCHAR" />
		<result column="COL_NM25" property="colNm25" jdbcType="VARCHAR" />
		<result column="COL_NM26" property="colNm26" jdbcType="VARCHAR" />
		<result column="COL_NM27" property="colNm27" jdbcType="VARCHAR" />
		<result column="COL_NM28" property="colNm28" jdbcType="VARCHAR" />
		<result column="COL_NM29" property="colNm29" jdbcType="VARCHAR" />
		<result column="COL_NM30" property="colNm30" jdbcType="VARCHAR" />
		
		<result column="COL_NM31" property="colNm31" jdbcType="VARCHAR" />
		<result column="COL_NM32" property="colNm32" jdbcType="VARCHAR" />
		<result column="COL_NM33" property="colNm33" jdbcType="VARCHAR" />
		<result column="COL_NM34" property="colNm34" jdbcType="VARCHAR" />
		<result column="COL_NM35" property="colNm35" jdbcType="VARCHAR" />
		<result column="COL_NM36" property="colNm36" jdbcType="VARCHAR" />
		<result column="COL_NM37" property="colNm37" jdbcType="VARCHAR" />
		<result column="COL_NM38" property="colNm38" jdbcType="VARCHAR" />
		<result column="COL_NM39" property="colNm39" jdbcType="VARCHAR" />
		<result column="COL_NM40" property="colNm40" jdbcType="VARCHAR" />
		
		<result column="COL_NM41" property="colNm41" jdbcType="VARCHAR" />
		<result column="COL_NM42" property="colNm42" jdbcType="VARCHAR" />
		<result column="COL_NM43" property="colNm43" jdbcType="VARCHAR" />
		<result column="COL_NM44" property="colNm44" jdbcType="VARCHAR" />
		<result column="COL_NM45" property="colNm45" jdbcType="VARCHAR" />
		<result column="COL_NM46" property="colNm46" jdbcType="VARCHAR" />
		<result column="COL_NM47" property="colNm47" jdbcType="VARCHAR" />
		<result column="COL_NM48" property="colNm48" jdbcType="VARCHAR" />
		<result column="COL_NM49" property="colNm49" jdbcType="VARCHAR" />
		<result column="COL_NM50" property="colNm50" jdbcType="VARCHAR" />
	</resultMap>

<select id="selectResultList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
  SELECT CASE WHEN B.NO = 1 THEN A.UPP_DQI_LNM ELSE '값진단종합결과' END AS UPP_DQI_LNM 
       , CASE WHEN B.NO = 1 THEN A.DQI_LNM END AS DQI_LNM
       , SUM(A.TBL_CNT ) AS TBL_CNT    
	   , SUM(A.COL_CNT ) AS COL_CNT 
       , SUM(A.ERR_CNT ) AS ERR_CNT 
       , NVL(ROUND(SUM(A.ERR_CNT ) / NULLIF(SUM(A.TOT_CNT ),0) * 100, 4),0) AS ERR_RATE 
       , SUM(A.TOT_CNT ) AS TOT_CNT 
       , SUM(A.NO_EXE  ) AS NO_EXE 
  	   , CASE WHEN B.NO = 2 THEN NULL ELSE SUM(A.SUM_RATE) END AS SUM_RATE
  	   , ROUND(100 - (SUM(A.ERR_CNT ) / NULLIF(SUM(A.TOT_CNT ),0) * 100), 4) AS STND_RATE
  	   , A.GOAL
    FROM (
  SELECT DQI.UPP_DQI_LNM AS UPP_DQI_LNM
	   , DQI.DQI_LNM
	   , S.TBL_CNT
	   , S.COL_CNT
       , S.ERR_CNT
       , S.ERR_RATE
       , S.TOT_CNT
       , S.NO_EXE
  	   , ROUND(S.ERR_RATE * 100 / SUM(S.ERR_RATE) OVER (),2) AS SUM_RATE
  	   , DQI.GOAL
  	 FROM 
  	   (SELECT B.DQI_LNM AS UPP_DQI_LNM   
	         , A.DQI_LNM
	         , A.GOAL
	      FROM WAM_DQI A
	           INNER JOIN WAM_DQI B
	              ON B.DQI_ID = A.UPP_DQI_ID
	     WHERE 1 = 1        
  	   ) DQI
  	   LEFT JOIN    	    
  	   (  	   
	   SELECT UPP_DQI_LNM
	        , DQI_LNM
			, COUNT(DISTINCT DB_CONN_TRG_PNM||DB_SCH_PNM||DBC_TBL_NM) AS TBL_CNT
			, COUNT(DISTINCT DB_CONN_TRG_PNM||DB_SCH_PNM||DBC_TBL_NM||DBC_COL_NM) AS COL_CNT
		    , SUM(ESN_ER_CNT)            AS ERR_CNT
		    , ROUND((SUM(ESN_ER_CNT) / NULLIF(SUM(ANA_CNT),0)) * 100, 2) AS ERR_RATE
		    , SUM(ANA_CNT)               AS TOT_CNT
		    , COUNT(ANA_STR_DTM)         AS NO_EXE
		    , GOAL
		FROM (		     
			    SELECT A.PRF_ID
					 , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM   
					 , B.DBC_TBL_NM
					 , B.OBJ_NM AS DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / NULLIF(A.ANA_CNT,0) * 100, 4) AS ER_RATE
					 , 'PT01' AS PRF_KND_CD
					 , DQI.GOAL
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						  ON B.REG_TYP_CD IN ('C', 'U')
						 AND B.PRF_ID = A.PRF_ID
						 AND B.PRF_KND_CD IN ('PC02', 'PC03', 'PC04', 'PC05')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   LEFT JOIN WAM_PRF_DQI_MAP E
						 ON E.PRF_ID = B.PRF_ID
					   LEFT JOIN WAM_DQI DQI
						 ON E.DQI_ID = DQI.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U') 
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
				 WHERE  1 = 1  
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )   
				   AND NVL(EX.EXP_YN,'N')='N' 
				   AND NOT exists (SELECT 1
		   			         		 FROM WAA_EXP_TBL_RULE EXR
		   			   				WHERE EXR.REG_TYP IN ('C', 'U')
		   			    	  		  AND EXR.DB_SCH_ID = B.DB_SCH_ID
	        				  		  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	        				  		  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
														 		  WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
					)  
				   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
					</if>
				UNION ALL
				SELECT A.PRF_ID
					 , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM   
					 , B.DBC_TBL_NM AS DBC_TBL_NM
					 , B.OBJ_NM AS DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / NULLIF(A.ANA_CNT,0) * 100, 4) AS ER_RATE
					 , 'PT01' AS PRF_KND_CD
					 , DQI.GOAL
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						  ON B.REG_TYP_CD IN ('C', 'U')
						 AND B.PRF_ID = A.PRF_ID
						 AND B.PRF_KND_CD = 'PT01'
				-- 	   INNER JOIN WAM_PRF_REL_COL COL
				-- 	      ON COL.PRF_ID = B.PRF_ID
				-- 		 AND COL.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
				-- 		 AND C.DB_SCH_ID = RCOL.CH_TBL_DBC_SCH_ID
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
					   LEFT JOIN WAM_PRF_DQI_MAP E
						 ON E.PRF_ID = B.PRF_ID
					   LEFT JOIN WAM_DQI DQI
						 ON E.DQI_ID = DQI.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U') 
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
				 WHERE  1 = 1  
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )   
				   AND NVL(EX.EXP_YN,'N')='N'  
				   AND NOT exists (SELECT 1
		   			         		 FROM WAA_EXP_TBL_RULE EXR
		   			   				WHERE EXR.REG_TYP IN ('C', 'U')
		   			    	  		  AND EXR.DB_SCH_ID = B.DB_SCH_ID
	        				  		  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	        				  		  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
														 		  WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
					)   
				   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.OBJ_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.OBJ_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
					</if>
				UNION ALL
				SELECT A.PRF_ID
					 , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM   
					 , B.DBC_TBL_NM
					 , B.OBJ_NM AS DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / NULLIF(A.ANA_CNT,0) * 100, 4) AS ER_RATE
					 , 'PT01' AS PRF_KND_CD
					 , DQI.GOAL
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						  ON B.REG_TYP_CD IN ('C', 'U')
						 AND B.PRF_ID = A.PRF_ID
						 AND B.PRF_KND_CD = 'PT02'
				--	   INNER JOIN WAM_PRF_UNQ_COL COL
				--	      ON COL.PRF_ID = B.PRF_ID
				--		 AND COL.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   LEFT JOIN WAM_PRF_DQI_MAP E
						 ON E.PRF_ID = B.PRF_ID
					   LEFT JOIN WAM_DQI DQI
						 ON E.DQI_ID = DQI.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U') 
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
				 WHERE  1 = 1  
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )   
				   AND NVL(EX.EXP_YN,'N')='N'
				   AND NOT exists (SELECT 1
		   			         		 FROM WAA_EXP_TBL_RULE EXR
		   			   				WHERE EXR.REG_TYP IN ('C', 'U')
		   			    	  		  AND EXR.DB_SCH_ID = B.DB_SCH_ID
	        				  		  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	        				  		  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
														 		  WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
					) 
				   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
					</if>
			    UNION ALL     
				SELECT A.BR_ID
				     , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM
					 , B.DBC_TBL_NM
					 , B.DBC_COL_NM
					 , A.ANA_CNT
					 , A.ER_CNT AS ESN_ER_CNT
					 , ROUND(A.ER_CNT / NULLIF(A.ANA_CNT,0) * 100, 4) AS ER_RATE
					 , 'BR' AS PRF_KND_CD
					 , DQI.GOAL
				  FROM WAM_BR_RESULT A
					   INNER JOIN WAM_BR_MSTR B
						  ON B.BR_ID = A.BR_ID
						 AND B.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   LEFT JOIN WAM_BR_DQI_MAP M
					     ON M.BR_ID = B.BR_ID	 
					   LEFT JOIN WAM_DQI DQI
						 ON DQI.DQI_ID = M.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
				 WHERE  1 = 1     
				   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
													  FROM WAM_BR_RESULT
													GROUP BY BR_ID 
													)
		           AND NVL(EX.EXP_YN,'N')='N'     
				   AND NOT exists (SELECT 1
		   			         		 FROM WAA_EXP_TBL_RULE EXR
		   			   				WHERE EXR.REG_TYP IN ('C', 'U')
		   			    	  		  AND EXR.DB_SCH_ID = B.DB_SCH_ID
	        				  		  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	        				  		  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
														 		  WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
					)
					<if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
					</if>                  
		 ) X
		 GROUP BY UPP_DQI_LNM
		        , DQI_LNM
		        , GOAL
      ) S
      ON DQI.DQI_LNM = S.DQI_LNM 		        
 WHERE 1 = 1
 ) A
 LEFT JOIN
 (SELECT 1 AS NO FROM DUAL
   UNION
  SELECT 2 AS NO FROM DUAL 
 ) B
 ON 1 = 1
 WHERE 1 = 1
 GROUP BY CASE WHEN B.NO = 1 THEN A.UPP_DQI_LNM ELSE '값진단종합결과' END
        , CASE WHEN B.NO = 1 THEN A.DQI_LNM END     
        , B.NO
        , A.GOAL
  ORDER BY B.NO
          ,UPP_DQI_LNM
          ,DQI_LNM
<!--          , CASE WHEN DQI_LNM = '관계키'  THEN 1 -->
<!--                 WHEN DQI_LNM = '필수값'  THEN 2 -->
<!--                 WHEN DQI_LNM = '금액'   THEN 3 -->
<!--                 WHEN DQI_LNM = '날짜'   THEN 4 -->
<!--                 WHEN DQI_LNM = '수량'   THEN 5 -->
<!--                 WHEN DQI_LNM = '여부'   THEN 6 -->
<!--                 WHEN DQI_LNM = '율'    THEN 7 -->
<!--                 WHEN DQI_LNM = '코드'   THEN 8 -->
<!--                 WHEN DQI_LNM = '계산 및 집계'  THEN 9 -->
<!--                 WHEN DQI_LNM = '시간순서'  THEN 10 -->
<!--                 WHEN DQI_LNM = '컬럼 간 논리관계'  THEN 11 -->
<!--                 WHEN DQI_LNM = '명칭'  THEN 12 -->
<!--                 WHEN DQI_LNM = '번호'  THEN 13 -->
<!--             END  -->
 
</select>

<select id="selectDtm" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT MIN(STR_DTM) AS ANA_STR_DTM
	      ,MAX(END_DTM) AS ANA_END_DTM
	  FROM (
	  (SELECT MIN(A.ANA_STR_DTM) AS STR_DTM
	     , MAX(A.ANA_END_DTM) AS END_DTM
	  FROM WAM_PRF_RESULT A
	       INNER JOIN WAM_PRF_MSTR B
	          ON B.REG_TYP_CD IN ('C', 'U')
	         AND B.PRF_ID = A.PRF_ID
	       INNER JOIN WAA_DB_SCH C
	          ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	         AND C.REG_TYP_CD IN ('C', 'U')
	         AND C.DB_SCH_ID = B.DB_SCH_ID 
	       INNER JOIN WAA_DB_CONN_TRG D
	          ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	         AND D.REG_TYP_CD IN ('C', 'U')
	         AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
	       LEFT JOIN WAM_PRF_DQI_MAP E
	         ON E.PRF_ID = B.PRF_ID
	       LEFT JOIN WAM_DQI DQI
	         ON E.DQI_ID = DQI.DQI_ID 
	        AND DQI.REG_TYP_CD IN ('C', 'U')
	       LEFT JOIN WAM_DQI U
	         ON U.DQI_ID = DQI.UPP_DQI_ID
	        AND U.REG_TYP_CD IN ('C', 'U') 
	       LEFT JOIN WAA_EXP_TBL EX          
		     ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		    AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
	                                       FROM WAM_PRF_RESULT
	                                      GROUP BY PRF_ID 
	                                     )
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		</if>
		)
	  UNION ALL
	  (SELECT MIN(A.ANA_STR_DTM) AS STR_DTM
	     , MAX(A.ANA_END_DTM) AS END_DTM
	  FROM WAM_BR_RESULT A
	       INNER JOIN WAM_BR_MSTR B
	          ON B.BR_ID = A.BR_ID
	         AND B.REG_TYP_CD IN ('C', 'U')
	       INNER JOIN WAA_DB_SCH C
	          ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	         AND C.REG_TYP_CD IN ('C', 'U')
	         AND C.DB_SCH_ID = B.DB_SCH_ID 
	       INNER JOIN WAA_DB_CONN_TRG D
	          ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	         AND D.REG_TYP_CD IN ('C', 'U')
	         AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
	       LEFT JOIN WAM_BR_DQI_MAP M
	         ON M.BR_ID = B.BR_ID	 
	       LEFT JOIN WAM_DQI DQI
	         ON DQI.DQI_ID = M.DQI_ID 
	        AND DQI.REG_TYP_CD IN ('C', 'U')
	       LEFT JOIN WAM_DQI U
	         ON U.DQI_ID = DQI.UPP_DQI_ID
	        AND U.REG_TYP_CD IN ('C', 'U')
	       LEFT JOIN WAA_EXP_TBL EX          
			 ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1    
	   AND NVL(EX.EXP_YN, 'N') = 'N' 
	   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
	                                      FROM WAM_BR_RESULT
	                                    GROUP BY BR_ID 
	                                    )
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	   </if>
		)
	  )
</select>

<select id="selectTotCnt" resultType="java.math.BigDecimal" parameterType="kr.wise.meta.result.service.MtResultVO">
SELECT COUNT(*) AS TOT_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_PRF_MSTR PRF
    ON PRF.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND PRF.DB_SCH_ID = SCH.DB_SCH_ID
   AND PRF.PRF_KND_CD != 'PC01'
  LEFT OUTER JOIN WAM_BR_MSTR BR
    ON BR.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND BR.DB_SCH_ID = SCH.DB_SCH_ID
 WHERE DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR SCH.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (PRF.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR PRF.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
   	AND (BR.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR BR.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (PRF.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR PRF.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
   	AND (BR.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR BR.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
   </if>
</select>

<select id="selectRunCnt" resultType="java.math.BigDecimal" parameterType="kr.wise.meta.result.service.MtResultVO">
SELECT SUM(RUN_CNT) AS TOT_CNT 
  FROM ( 
SELECT COUNT(*) AS RUN_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_PRF_MSTR PRF
    ON PRF.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND PRF.DB_SCH_ID = SCH.DB_SCH_ID
   AND PRF.PRF_KND_CD != 'PC01'
  INNER JOIN WAM_PRF_RESULT PR
    ON PR.PRF_ID = PRF.PRF_ID
  INNER JOIN (SELECT PRF_ID, MAX(ANA_STR_DTM) AS ANA_STR_DTM
                         FROM WAM_PRF_RESULT
                       GROUP BY PRF_ID ) R1
           ON R1.PRF_ID = PR.PRF_ID
          AND R1.ANA_STR_DTM = PR.ANA_STR_DTM
 WHERE DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR SCH.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (PRF.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR PRF.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (PRF.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR PRF.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
   </if>
UNION ALL
SELECT COUNT(*) AS RUN_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_BR_MSTR BR
    ON BR.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND BR.DB_SCH_ID = SCH.DB_SCH_ID
 INNER JOIN WAM_BR_RESULT BRES
    ON BRES.BR_ID = BR.BR_ID
 INNER JOIN (SELECT BR_ID, MAX(ANA_STR_DTM) AS ANA_STR_DTM
                         FROM WAM_BR_RESULT
                       GROUP BY BR_ID ) R2
           ON R2.BR_ID = BRES.BR_ID
          AND R2.ANA_STR_DTM = BRES.ANA_STR_DTM
 WHERE DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR SCH.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (BR.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR BR.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (BR.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR BR.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
   </if>
   )
</select>

<select id="selectTblList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	-- SHEET 2 테이블목록
	-- 번호	 SCHEMA	 테이블	         테이블(한글)	    수집여부	진단여부	제외사유	    관련 검토기준
	-- 1	OO_USER	 AA_AAA_BBBB	자료실 조회 기록	Y	     N	    미사용테이블	
	
	SELECT DISTINCT A.DB_SCH_PNM AS DB_SCH_PNM
	    --  ,A.DB_SCH_LNM AS DB_SCH_LNM
	      ,B.DBC_TBL_NM AS DBC_TBL_NM
	      ,NVL(B.DBC_TBL_KOR_NM, B.DBC_TBL_NM) AS DBC_TBL_KOR_NM
	      ,NVL(E.EXP_YN, 'N') AS EXP_YN
	      ,CASE WHEN (D.PRF_ID IS NULL AND G.BR_ID IS NULL) 
	            THEN 'N' 
	            ELSE 'Y'
	            END AS PRF_YN
	      ,E.EXP_RSN_CNTN AS EXP_RSN_CNTN
	    --  ,'' AS DESCN
	  FROM WAA_DB_SCH A
	 INNER JOIN WAT_DBC_TBL B
	    ON B.DB_SCH_ID = A.DB_SCH_ID
	  LEFT OUTER JOIN WAM_PRF_MSTR C
	    ON C.DB_SCH_ID = B.DB_SCH_ID
	   AND C.DBC_TBL_NM = B.DBC_TBL_NM
	   AND C.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_PRF_RESULT D
	    ON D.PRF_ID = C.PRF_ID
	  LEFT OUTER JOIN WAM_PRF_DQI_MAP PDQIMAP
	    ON PDQIMAP.PRF_ID = C.PRF_ID
	  LEFT OUTER JOIN WAM_BR_MSTR F
	    ON F.DB_SCH_ID = B.DB_SCH_ID
	   AND F.DBC_TBL_NM = B.DBC_TBL_NM
	   AND F.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_BR_RESULT G
	    ON G.BR_ID = F.BR_ID
	  LEFT OUTER JOIN WAM_BR_DQI_MAP BDQIMAP
	    ON BDQIMAP.BR_ID = F.BR_ID
	  LEFT OUTER JOIN WAA_EXP_TBL E
	    ON E.DB_SCH_ID = B.DB_SCH_ID
	   AND E.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE 1=1
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = A.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND A.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (A.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR A.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	   </if>
	 ORDER BY A.DB_SCH_PNM, B.DBC_TBL_NM
</select>

<select id="selectDmnRule" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	-- SHEET 3 도메인규칙
	-- 번호	테이블명	                    한글테이블명	컬럼명	        한글컬럼명	데이터타입	검증유형	도메인	검증기준ID	검증기준명	검증형식	            분류코드	          제외데이터	제외데이터 구분자	도메인 검토내역	관련 검토기준	제외사유
	-- 1	NEWS_USER.BATCH_JOB_INFO	배치 잡 정보	BJI_STAT_CODE	상태	        CHAR(1)	    코드	    코드	    A10024	    공통코드		                    batch_job_status
	-- 2	NEWS_USER.BATCH_JOB_INFO	배치 잡 정보	BJI_REGI_DATE	등록일	    DATE(7)	    날짜	    날짜	    A10008	    년월일시분초	YYYYMMDDHH24MISS						
	
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,A.OBJ_NM AS DBC_COL_NM
	      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,E.DATA_TYPE || '(' || E.DATA_LEN || ')' AS DATA_TYPE
	      ,GET_CMCD_DTL_NM('PRF_KND_CD', A.PRF_KND_CD) AS PRF_KND_CD
	      ,DQI.DQI_LNM AS DQI_LNM
	      ,A.PRF_ID AS PRF_ID
	      ,A.PRF_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	   --   ,'' AS 분류코드
	   --   ,'' AS 제외데이터
	   --   ,'' AS 제외데이터_구분자
	   --   ,'' AS 도메인_검토내역
	   --   ,'' AS 관련_검토기준
	   --   ,'' AS 제외사유
	  FROM WAM_PRF_MSTR A
	 INNER JOIN WAM_PRF_RESULT B
	    ON B.PRF_ID = A.PRF_ID
	  LEFT OUTER JOIN WAM_PRF_DQI_MAP WPDM
	    ON WPDM.PRF_ID = B.PRF_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	  LEFT JOIN WAA_EXP_TBL EX          
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND A.PRF_KND_CD != 'PC01'
	   AND DQI.DQI_LNM IS NOT NULL
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = A.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND A.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR E.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	   </if>
	 ORDER BY  A.PRF_ID
	 		  ,A.PRF_NM
	 		  ,D.DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM
		      ,E.DBC_COL_NM
		      ,E.DBC_COL_KOR_NM
	UNION ALL
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,A.DBC_COL_NM AS DBC_COL_NM
	      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,E.DATA_TYPE || '(' || E.DATA_LEN || ')' AS DATA_TYPE
	      ,'업무규칙' AS PRF_KND_CD
	      ,DQI.DQI_LNM AS DQI_LNM
	      ,A.BR_ID AS PRF_ID
	      ,A.BR_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	    --  ,'' AS 분류코드
	    --  ,'' AS 제외데이터
	    --  ,'' AS 제외데이터_구분자
	    --  ,'' AS 도메인_검토내역
	    --  ,'' AS 관련_검토기준
	    --  ,'' AS 제외사유
	  FROM WAM_BR_MSTR A
	 INNER JOIN WAM_BR_RESULT B
	    ON B.BR_ID = A.BR_ID
	  LEFT OUTER JOIN WAM_BR_DQI_MAP WPDM
	    ON WPDM.BR_ID = B.BR_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	   AND E.DBC_COL_NM = A.DBC_COL_NM
	  LEFT JOIN WAA_EXP_TBL EX          
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND DQI.DQI_LNM IS NOT NULL
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = A.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND A.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR E.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	   </if>
	 ORDER BY  A.BR_ID
	 		  ,A.BR_NM
	 		  ,D.DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM
		      ,E.DBC_COL_NM
		      ,E.DBC_COL_KOR_NM
</select>

<select id="selectExecList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	-- SHEET 4 실행목록
	-- 번호	테이블명	                    컬럼명	        검증유형	검증기준ID	검증기준명	 검증형식	                        실행여부
	-- 1	NEWS_USER.BATCH_JOB_INFO	BJI_SERVER_ID	참조	    C99999	    참조값	     NEWS_USER.BATCH_SERVER_INFO	Y
	-- 2	NEWS_USER.BATCH_JOB_INFO	BJI_APPL_DATE	날짜	    A10008	    년월일시분초	 YYYYMMDDHH24MISS	            Y
	SELECT DISTINCT *
	  FROM (
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,CASE WHEN A.PRF_KND_CD = 'PT01' THEN (SELECT LISTAGG(RCOL.CH_TBL_DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
												     FROM WAM_PRF_MSTR M
												    INNER JOIN WAM_PRF_REL_COL RCOL
												       ON RCOL.PRF_ID = M.PRF_ID
												    WHERE M.PRF_KND_CD = 'PT01'
												      AND B.PRF_ID = M.PRF_ID
												    GROUP BY M.PRF_ID)
	            WHEN A.PRF_KND_CD = 'PT02' THEN (SELECT LISTAGG(UCOL.DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
													  FROM WAM_PRF_MSTR M
													 INNER JOIN WAM_PRF_UNQ_COL UCOL
													    ON UCOL.PRF_ID = M.PRF_ID
													 WHERE M.PRF_KND_CD = 'PT02'
													   AND B.PRF_ID = M.PRF_ID
													 GROUP BY M.PRF_ID)
				ELSE A.OBJ_NM
			END AS DBC_COL_NM
	      ,GET_CMCD_DTL_NM('PRF_KND_CD', A.PRF_KND_CD) AS PRF_KND_CD
	      ,A.PRF_ID AS PRF_ID
	      ,A.PRF_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	      ,CASE WHEN B.PRF_ID IS NOT NULL
	            THEN CASE WHEN WPDM.PRF_ID IS NOT NULL
	                      THEN 'Y'
	                      ELSE 'N' END
	            ELSE 'N' END AS PRF_YN
	  FROM WAM_PRF_MSTR A
	  LEFT OUTER JOIN WAM_PRF_RESULT B
	    ON B.PRF_ID = A.PRF_ID
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	  LEFT JOIN WAA_EXP_TBL EX
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAM_PRF_DQI_MAP WPDM
	    ON WPDM.PRF_ID = A.PRF_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	 WHERE 1=1
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND PRF_KND_CD != 'PC01'
	   AND DQI.DQI_LNM IS NOT NULL
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = A.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND A.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (D.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR D.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR E.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	   </if>
	UNION ALL
		    SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,B.DBC_COL_NM AS DBC_COL_NM
				,GET_CMCD_DTL_NM('CD_TYP_CD', E.CD_TYP_CD) AS PRF_KND_CD
				,E.CD_RULE_ID AS PRF_ID
				,E.CD_RULE_NM AS PRF_NM
				,'코드' AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAA_COL_RULE_REL B
					  ON B.RULE_REL_ID = A.PRF_ID
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
				   INNER JOIN WAA_CD_RULE E
					  ON E.CD_RULE_ID = B.VRFC_ID  		  
				  LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
			 WHERE  1 = 1  
	           AND NVL(EX.EXP_YN,'N')='N'
			   AND NOT exists (SELECT 1
			   			         FROM WAA_EXP_TBL_RULE EXR
			   			   		WHERE EXR.REG_TYP IN ('C', 'U')
			   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
		        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
		        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
															 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
				)
			   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>
		    UNION ALL     
			SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,B.OBJ_NM AS DBC_COL_NM
				,'참조무결성' AS PRF_KND_CD 
				,B.PRF_ID AS PRF_ID
				,B.PRF_NM AS PRF_NM
				,'관계키' AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN					 
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAM_PRF_MSTR B
					 ON B.PRF_ID = A.PRF_ID
					 AND B.REG_TYP_CD IN ('C', 'U')
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID					   
					LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
			 WHERE  1 = 1  
			   AND B.PRF_KND_CD = 'PT01'
	           AND NVL(EX.EXP_YN,'N')='N'  
			   AND NOT exists (SELECT 1
			   			         FROM WAA_EXP_TBL_RULE EXR
			   			   		WHERE EXR.REG_TYP IN ('C', 'U')
			   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
		        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
		        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
															 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
				)
	           <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR B.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>	
	UNION ALL			   
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,A.DBC_COL_NM AS DBC_COL_NM
	      ,'업무규칙' AS PRF_KND_CD
	      ,A.BR_ID AS PRF_ID
	      ,A.BR_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	      ,CASE WHEN B.BR_ID IS NOT NULL
	            THEN CASE WHEN WPDM.BR_ID IS NOT NULL
	                      THEN 'Y'
	                      ELSE 'N' END
	            ELSE 'N' END AS PRF_YN
	  FROM WAM_BR_MSTR A
	  LEFT OUTER JOIN WAM_BR_RESULT B
	    ON B.BR_ID = A.BR_ID
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	  LEFT JOIN WAA_EXP_TBL EX          
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAM_BR_DQI_MAP WPDM
	    ON WPDM.BR_ID = A.BR_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	 WHERE 1=1
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND DQI.DQI_LNM IS NOT NULL
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = A.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND A.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (D.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR D.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR E.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	   </if>
	 ORDER BY  PRF_ID
	 		  ,PRF_NM
	 		  ,DBC_TBL_NM
		      ,DBC_COL_NM
      )
</select>

<select id="selectErrList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
<!-- 	SHEET 5 오류목록 -->
<!-- 	번호	진단유형	진단룰명	진단테이블(영문)	        진단테이블(한글)	진단칼럼(영문)	 진단칼럼(한글)	전체건수	오류건수	오류율(%)	오류추정건수 SQL -->
<!-- 	1	여부	    여부10	NEWS_USER.CONN_GROUP_IN	연계 유입업체	    CGI_FLAG_ENABLE	 사용여부	        77	    5	    6.49	 -->
<!-- 	2	여부	    여부10	NEWS_USER.CONN_GROUP_IN	연계 유입업체	    CGI_STDXML_YN	 표준XML사용여부	77	    1	    1.30 -->
	SELECT DISTINCT *
	  FROM (
	SELECT DQI.DQI_LNM
		 , GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
		 , B.DBC_TBL_NM AS DBC_TBL_NM
		 , TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		 , COL.DBC_COL_NM AS DBC_COL_NM
		 , COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		 , A.ANA_CNT AS TOT_CNT
		 , A.ESN_ER_CNT AS ERR_CNT
		 , ((A.ESN_ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD IN ('PC02', 'PC03', 'PC04', 'PC05')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
		     AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
		      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
		     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
		     AND COL.DBC_COL_NM = B.OBJ_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
		      ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
		      ON E.DQI_ID = DQI.DQI_ID 
		     AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
		      ON U.DQI_ID = DQI.UPP_DQI_ID
		     AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
		      ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		     AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND A.ESN_ER_CNT > 0
	   AND DQI.DQI_LNM IS NOT NULL
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (COL.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR COL.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		</if>
		
		UNION ALL
		SELECT DQI.DQI_LNM
			 , GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
			 , B.DBC_TBL_NM AS DBC_TBL_NM
			 , TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
			 , (SELECT LISTAGG(RCOL.CH_TBL_DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_REL_COL RCOL
				    ON RCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT01'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
			 , '' AS DBC_COL_KOR_NM
			 , A.ANA_CNT AS TOT_CNT
			 , A.ESN_ER_CNT AS ERR_CNT
			 , ((A.ESN_ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
		  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD = 'PT01'
	--	   INNER JOIN WAM_PRF_REL_COL RCOL
	--	      ON RCOL.PRF_ID = B.PRF_ID
	--		 AND RCOL.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID
	--		 AND C.DB_SCH_ID = RCOL.CH_TBL_DBC_SCH_ID
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	--		 AND TBL.DBC_TBL_NM = RCOL.CH_TBL_DBC_TBL_NM
	--	   INNER JOIN WAT_DBC_COL COL
	--	      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
	--		 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	--		 AND COL.DBC_COL_NM = RCOL.CH_TBL_DBC_COL_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
			  ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
			  ON E.DQI_ID = DQI.DQI_ID 
			 AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
			  ON U.DQI_ID = DQI.UPP_DQI_ID
			 AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND A.ESN_ER_CNT > 0
	   AND DQI.DQI_LNM IS NOT NULL
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		</if>
		
					    UNION ALL     
			    SELECT '코드' AS DQI_LNM
					  ,B.VRFC_NM AS PRF_KND_CD
					  ,B.DBC_TBL_NM AS DBC_TBL_NM
					  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
					  ,B.DBC_COL_NM AS DBC_COL_NM
					  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
					  ,A.ANA_CNT AS TOT_CNT
					  ,A.ESN_ER_CNT AS ERR_CNT
					  ,((A.ESN_ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAA_COL_RULE_REL B
						  ON B.RULE_REL_ID = A.PRF_ID
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   INNER JOIN WAT_DBC_TBL TBL
                          ON TBL.DB_SCH_ID = C.DB_SCH_ID
						 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
					   INNER JOIN WAT_DBC_COL COL
                          ON COL.DB_SCH_ID = TBL.DB_SCH_ID
						 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
                         AND COL.DBC_TBL_NM = B.DBC_TBL_NM
                         AND COL.DBC_COL_NM = B.DBC_COL_NM
					   INNER JOIN WAA_CD_RULE E
						  ON E.CD_RULE_ID = B.VRFC_ID  		  
					  LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
				 WHERE  1 = 1  
		           AND NVL(EX.EXP_YN,'N')='N'
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )
				   AND NOT exists (SELECT 1
				   			         FROM WAA_EXP_TBL_RULE EXR
				   			   		WHERE EXR.REG_TYP IN ('C', 'U')
				   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
			        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
			        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
																 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
					)
				<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (COL.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR COL.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>
			    UNION ALL     
				SELECT '관계키' AS DQI_LNM
					  ,'참조무결성' AS PRF_KND_CD
					  ,B.DBC_TBL_NM AS DBC_TBL_NM
					  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
					  ,B.OBJ_NM AS DBC_COL_NM
					  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
					  ,A.ANA_CNT AS TOT_CNT
					  ,A.ESN_ER_CNT AS ERR_CNT
					  ,((A.ESN_ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						 ON B.PRF_ID = A.PRF_ID
						 AND B.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
					   INNER JOIN WAT_DBC_TBL TBL
                          ON TBL.DB_SCH_ID = C.DB_SCH_ID
						 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
					   INNER JOIN WAT_DBC_COL COL
                          ON COL.DB_SCH_ID = TBL.DB_SCH_ID
						 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
                         AND COL.DBC_TBL_NM = B.DBC_TBL_NM
                         AND COL.DBC_COL_NM = B.OBJ_NM
						LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
				 WHERE  1 = 1  
				   AND B.PRF_KND_CD = 'PT01'
		           AND NVL(EX.EXP_YN,'N')='N'
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )
				   AND NOT exists (SELECT 1
				   			         FROM WAA_EXP_TBL_RULE EXR
				   			   		WHERE EXR.REG_TYP IN ('C', 'U')
				   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
			        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
			        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
																 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
					)
				<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (COL.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR COL.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>
				UNION ALL
		SELECT DQI.DQI_LNM
			 , GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
			 , B.DBC_TBL_NM AS DBC_TBL_NM
			 , TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
			 , (SELECT LISTAGG(UCOL.DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_UNQ_COL UCOL
				    ON UCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT02'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
			 , '' AS DBC_COL_KOR_NM
			 , A.ANA_CNT AS TOT_CNT
			 , A.ESN_ER_CNT AS ERR_CNT
			 , ((A.ESN_ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
		  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD = 'PT02'
	--	   INNER JOIN WAM_PRF_UNQ_COL COL
	--	      ON COL.PRF_ID = B.PRF_ID
	--		 AND COL.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
		     AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	--	   INNER JOIN WAT_DBC_COL COL
	--	      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
	--	     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	--	     AND COL.DBC_COL_NM = B.OBJ_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
			  ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
			  ON E.DQI_ID = DQI.DQI_ID 
			 AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
			  ON U.DQI_ID = DQI.UPP_DQI_ID
			 AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND A.ESN_ER_CNT > 0
	   AND DQI.DQI_LNM IS NOT NULL
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		</if>
		
		UNION ALL
		SELECT DQI.DQI_LNM AS DQI_LNM
		      ,'업무규칙' AS PRF_KND_CD
		      ,A.DBC_TBL_NM AS DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		      ,A.DBC_COL_NM AS DBC_COL_NM
		      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		      ,B.ANA_CNT AS TOT_CNT
		      ,B.ER_CNT AS ERR_CNT
		      ,((B.ER_CNT / B.ANA_CNT) * 100) AS ERR_RATE
		  FROM WAM_BR_MSTR A
		 INNER JOIN WAM_BR_RESULT B
		    ON B.BR_ID = A.BR_ID
		   AND B.ER_CNT > 0
		 INNER JOIN WAA_DB_SCH C
		    ON C.DB_SCH_ID = A.DB_SCH_ID
		   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		   AND C.REG_TYP_CD IN ('C', 'U')
		 INNER JOIN WAT_DBC_TBL D
		    ON D.DB_SCH_ID = C.DB_SCH_ID
		   AND D.DBC_TBL_NM = A.DBC_TBL_NM
		 INNER JOIN WAT_DBC_COL E
		    ON E.DB_SCH_ID = D.DB_SCH_ID
		   AND E.DBC_TBL_NM = D.DBC_TBL_NM
		   AND E.DBC_COL_NM = A.DBC_COL_NM
		  LEFT OUTER JOIN WAM_BR_DQI_MAP F
		    ON F.BR_ID = A.BR_ID
		   AND F.REG_TYP_CD IN ('C', 'U')
		  LEFT OUTER JOIN WAM_DQI DQI
		    ON DQI.DQI_ID = F.DQI_ID
		   AND DQI.REG_TYP_CD IN ('C', 'U')
		  LEFT JOIN WAA_EXP_TBL EX          
		    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
		   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
		 WHERE A.REG_TYP_CD IN ('C', 'U')
		   AND NVL(EX.EXP_YN, 'N') = 'N'
		   AND (B.BR_ID, B.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
									   FROM WAM_BR_RESULT
									  GROUP BY BR_ID 
									 )
		   AND DQI.DQI_LNM IS NOT NULL
		   AND NOT exists (SELECT 1
		   			         FROM WAA_EXP_TBL_RULE EXR
		   			   		WHERE EXR.REG_TYP IN ('C', 'U')
		   			    	  AND EXR.DB_SCH_ID = A.DB_SCH_ID
	        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	        				  AND A.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
														 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
			)
		   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchId != null and dbSchId != ''" >
		   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchPnm != null and dbSchPnm != ''" >
		   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		   </if>
		   <if test="dbcTblNm != null and dbcTblNm != ''" >
		   	AND (D.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR D.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		   </if>
		   <if test="dbcColNm != null and dbcColNm != ''" >
		   	AND (E.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR E.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		   </if>
		 ORDER BY  DBC_TBL_NM
			      ,DBC_TBL_KOR_NM
			      ,DBC_COL_NM
			      ,DBC_COL_KOR_NM
		)
</select>

<select id="selectErrListByDqi" resultMap="DataResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT DQI.DQI_LNM
		  ,B.PRF_ID
		  ,B.PRF_NM
		  ,TBL.DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM
		  ,COL.DBC_COL_NM
		  ,COL.DBC_COL_KOR_NM
		  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
		  ,NVL(A.ANA_CNT, 0) AS ANA_CNT
		  ,NVL(A.ESN_ER_CNT, 0) AS ERR_CNT
		  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD IN ('PC02', 'PC03', 'PC04', 'PC05')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
		     AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
		      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
		     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
		     AND COL.DBC_COL_NM = B.OBJ_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
		      ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
		      ON E.DQI_ID = DQI.DQI_ID 
		     AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
		      ON U.DQI_ID = DQI.UPP_DQI_ID
		     AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
		      ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		     AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (COL.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR COL.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		</if>
		
		UNION ALL
		SELECT DQI.DQI_LNM
			  ,B.PRF_ID
			  ,B.PRF_NM
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  , (SELECT LISTAGG(RCOL.CH_TBL_DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_REL_COL RCOL
				    ON RCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT01'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
			  ,'' AS DBC_COL_KOR_NM
			  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
			  ,NVL(A.ANA_CNT, 0) AS ANA_CNT
			  ,NVL(A.ESN_ER_CNT, 0) AS ERR_CNT
			  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD = 'PT01'
	--	   INNER JOIN WAM_PRF_REL_COL RCOL
	--	      ON RCOL.PRF_ID = B.PRF_ID
	--		 AND RCOL.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	--	   INNER JOIN WAT_DBC_COL COL
	--	      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
	--		 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	--		 AND COL.DBC_COL_NM = RCOL.CH_TBL_DBC_COL_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
			  ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
			  ON E.DQI_ID = DQI.DQI_ID 
			 AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
			  ON U.DQI_ID = DQI.UPP_DQI_ID
			 AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		</if>
		
		UNION ALL
		SELECT DQI.DQI_LNM
			  ,B.PRF_ID
			  ,B.PRF_NM
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  , (SELECT LISTAGG(UCOL.DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_UNQ_COL UCOL
				    ON UCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT02'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
			  ,'' AS DBC_COL_KOR_NM
			  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
			  ,NVL(A.ANA_CNT, 0) AS ANA_CNT
			  ,NVL(A.ESN_ER_CNT, 0) AS ERR_CNT
			  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.REG_TYP_CD IN ('C', 'U')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.PRF_KND_CD = 'PT02'
	--	   INNER JOIN WAM_PRF_UNQ_COL COL
	--	      ON COL.PRF_ID = B.PRF_ID
	--		 AND COL.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
		      ON TBL.DB_SCH_ID = C.DB_SCH_ID
		     AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	--	   INNER JOIN WAT_DBC_COL COL
	--	      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
	--	     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	--	     AND COL.DBC_COL_NM = B.OBJ_NM
		    LEFT JOIN WAM_PRF_DQI_MAP E
			  ON E.PRF_ID = B.PRF_ID
		    LEFT JOIN WAM_DQI DQI
			  ON E.DQI_ID = DQI.DQI_ID 
			 AND DQI.REG_TYP_CD IN ('C', 'U')
		    LEFT JOIN WAM_DQI U
			  ON U.DQI_ID = DQI.UPP_DQI_ID
			 AND U.REG_TYP_CD IN ('C', 'U') 
		    LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
	 WHERE  1 = 1  
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )   
	   AND NVL(EX.EXP_YN,'N')='N'
	   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		</if>
		
		UNION ALL
		SELECT DQI.DQI_LNM AS DQI_LNM
		      ,A.BR_ID AS PRF_ID
		      ,A.BR_NM AS PRF_NM
		      ,A.DBC_TBL_NM AS DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		      ,A.DBC_COL_NM AS DBC_COL_NM
		      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		      ,'업무규칙' AS PRF_KND_CD
		      ,NVL(B.ANA_CNT, 0) AS ANA_CNT
		      ,NVL(B.ER_CNT, 0) AS ERR_CNT
		      ,CASE WHEN B.ANA_CNT=0 THEN 0 ELSE ROUND(B.ER_CNT*100/B.ANA_CNT,2) END AS ERR_RATE
		  FROM WAM_BR_MSTR A
		 INNER JOIN WAM_BR_RESULT B
		    ON B.BR_ID = A.BR_ID
		 INNER JOIN WAA_DB_SCH C
		    ON C.DB_SCH_ID = A.DB_SCH_ID
		   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		   AND C.REG_TYP_CD IN ('C', 'U')
		 INNER JOIN WAT_DBC_TBL D
		    ON D.DB_SCH_ID = C.DB_SCH_ID
		   AND D.DBC_TBL_NM = A.DBC_TBL_NM
		 INNER JOIN WAT_DBC_COL E
		    ON E.DB_SCH_ID = D.DB_SCH_ID
		   AND E.DBC_TBL_NM = D.DBC_TBL_NM
		   AND E.DBC_COL_NM = A.DBC_COL_NM
		  LEFT OUTER JOIN WAM_BR_DQI_MAP F
		    ON F.BR_ID = A.BR_ID
		   AND F.REG_TYP_CD IN ('C', 'U')
		  LEFT OUTER JOIN WAM_DQI DQI
		    ON DQI.DQI_ID = F.DQI_ID
		   AND DQI.REG_TYP_CD IN ('C', 'U')
		  LEFT JOIN WAA_EXP_TBL EX          
		    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
		   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
		 WHERE A.REG_TYP_CD IN ('C', 'U')
		   AND NVL(EX.EXP_YN, 'N') = 'N'
		   AND (B.BR_ID, B.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
									   FROM WAM_BR_RESULT
									  GROUP BY BR_ID 
									 )
		   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
		   AND NOT exists (SELECT 1
		   			         FROM WAA_EXP_TBL_RULE EXR
		   			   		WHERE EXR.REG_TYP IN ('C', 'U')
		   			    	  AND EXR.DB_SCH_ID = A.DB_SCH_ID
	        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	        				  AND A.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
														 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
			)	
		   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchId != null and dbSchId != ''" >
		   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchPnm != null and dbSchPnm != ''" >
		   	AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		   </if>
		   <if test="dbcTblNm != null and dbcTblNm != ''" >
		   	AND (D.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR D.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		   </if>
		   <if test="dbcColNm != null and dbcColNm != ''" >
		   	AND (E.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR E.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
		   </if>
		 ORDER BY  DBC_TBL_NM
			      ,DBC_TBL_KOR_NM
			      ,DBC_COL_NM
			      ,DBC_COL_KOR_NM
</select>

<select id="selectErrDataMaxColCnt" resultMap="DataResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
		SELECT DISTINCT *
		  FROM (
			SELECT PERR.COL_CNT
			     , B.PRF_KND_CD
			     , B.PRF_ID
			  FROM WAM_PRF_RESULT A
			   INNER JOIN WAM_PRF_MSTR B
				  ON B.REG_TYP_CD IN ('C', 'U')
				 AND B.PRF_ID = A.PRF_ID
				 AND B.PRF_KND_CD = 'PT01'
			   INNER JOIN WAM_PRF_ERR_DATA PERR
				  ON PERR.PRF_ID = B.PRF_ID
				 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
				LEFT JOIN WAM_PRF_DQI_MAP E
				  ON E.PRF_ID = B.PRF_ID
				LEFT JOIN WAM_DQI DQI
				  ON E.DQI_ID = DQI.DQI_ID 
				 AND DQI.REG_TYP_CD IN ('C', 'U')
				LEFT JOIN WAM_DQI U
				  ON U.DQI_ID = DQI.UPP_DQI_ID
				 AND U.REG_TYP_CD IN ('C', 'U') 
				LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
		 WHERE  1 = 1  
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )   
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
		   AND NOT exists (SELECT 1
		   			         FROM WAA_EXP_TBL_RULE EXR
		   			   		WHERE EXR.REG_TYP IN ('C', 'U')
		   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
	        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
														 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
			)
		   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
				AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			</if>
			<if test="dbSchId != null and dbSchId != ''" >
				AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			</if>
			<if test="dbSchPnm != null and dbSchPnm != ''" >
				AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			</if>
			<if test="dbcTblNm != null and dbcTblNm != ''" >
				AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			</if>
			<if test="dbcColNm != null and dbcColNm != ''" >
				AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			</if>
			
			UNION ALL
			SELECT PERR.COL_CNT
			     , B.PRF_KND_CD
			     , B.PRF_ID
			  FROM WAM_PRF_RESULT A
			   INNER JOIN WAM_PRF_MSTR B
				  ON B.REG_TYP_CD IN ('C', 'U')
				 AND B.PRF_ID = A.PRF_ID
				 AND B.PRF_KND_CD = 'PT02'
			   INNER JOIN WAM_PRF_ERR_DATA PERR
				  ON PERR.PRF_ID = B.PRF_ID
				 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
				LEFT JOIN WAM_PRF_DQI_MAP E
				  ON E.PRF_ID = B.PRF_ID
				LEFT JOIN WAM_DQI DQI
				  ON E.DQI_ID = DQI.DQI_ID 
				 AND DQI.REG_TYP_CD IN ('C', 'U')
				LEFT JOIN WAM_DQI U
				  ON U.DQI_ID = DQI.UPP_DQI_ID
				 AND U.REG_TYP_CD IN ('C', 'U') 
				LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
		 WHERE  1 = 1  
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
		   AND NOT exists (SELECT 1
		   			         FROM WAA_EXP_TBL_RULE EXR
		   			   		WHERE EXR.REG_TYP IN ('C', 'U')
		   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
	        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	        				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
														 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
			)
		   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
				AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			</if>
			<if test="dbSchId != null and dbSchId != ''" >
				AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			</if>
			<if test="dbSchPnm != null and dbSchPnm != ''" >
				AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			</if>
			<if test="dbcTblNm != null and dbcTblNm != ''" >
				AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			</if>
			<if test="dbcColNm != null and dbcColNm != ''" >
				AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			</if>
			
			UNION ALL
			SELECT BERR.COL_CNT
			     , 'BR' AS PRF_KND_CD
			     , A.BR_ID AS PRF_ID
			  FROM WAM_BR_MSTR A
			 INNER JOIN WAM_BR_RESULT B
				ON B.BR_ID = A.BR_ID
			 INNER JOIN WAM_BR_ERR_DATA BERR
				ON BERR.BR_ID = A.BR_ID
			   AND BERR.ANA_STR_DTM = B.ANA_STR_DTM
			 INNER JOIN WAA_DB_SCH C
				ON C.DB_SCH_ID = A.DB_SCH_ID
			   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
			   AND C.REG_TYP_CD IN ('C', 'U')
			 INNER JOIN WAT_DBC_TBL D
				ON D.DB_SCH_ID = C.DB_SCH_ID
			   AND D.DBC_TBL_NM = A.DBC_TBL_NM
			 INNER JOIN WAT_DBC_COL E
				ON E.DB_SCH_ID = D.DB_SCH_ID
			   AND E.DBC_TBL_NM = D.DBC_TBL_NM
			   AND E.DBC_COL_NM = A.DBC_COL_NM
			  LEFT OUTER JOIN WAM_BR_DQI_MAP F
				ON F.BR_ID = A.BR_ID
			   AND F.REG_TYP_CD IN ('C', 'U')
			  LEFT OUTER JOIN WAM_DQI DQI
				ON DQI.DQI_ID = F.DQI_ID
			   AND DQI.REG_TYP_CD IN ('C', 'U')
			  LEFT JOIN WAA_EXP_TBL EX          
				ON EX.DB_SCH_ID  = A.DB_SCH_ID  
			   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
			 WHERE A.REG_TYP_CD IN ('C', 'U')
			   AND (B.BR_ID, B.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
											   FROM WAM_BR_RESULT
											  GROUP BY BR_ID 
											 )
			   AND NVL(EX.EXP_YN, 'N') = 'N'
			   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
			   AND NOT exists (SELECT 1
			   			         FROM WAA_EXP_TBL_RULE EXR
			   			   		WHERE EXR.REG_TYP IN ('C', 'U')
			   			    	  AND EXR.DB_SCH_ID = A.DB_SCH_ID
		        				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
		        				  AND A.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
															 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
				)
			   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
				AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
				AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
				AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
				AND (D.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR D.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
				AND (E.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR E.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
			   </if>
		)
</select>

<select id="selectErrDataByDqi" resultMap="DataResultMap" parameterType="map">
<!-- SELECT DISTINCT * -->
<!--   FROM ( -->
	SELECT DQI.DQI_LNM
	  ,B.PRF_ID
	  ,B.PRF_NM
	  ,TBL.DBC_TBL_NM
	  ,TBL.DBC_TBL_KOR_NM
	  ,COL.DBC_COL_NM
	  ,COL.DBC_COL_KOR_NM
	  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
	  ,PERR.COL_NM1 AS COL_NM1
	  ,NVL(PERR.COL_NM2, 0) AS ERR_CNT
  FROM WAM_PRF_RESULT A
	   INNER JOIN WAM_PRF_MSTR B
		  ON B.REG_TYP_CD IN ('C', 'U')
		 AND B.PRF_ID = A.PRF_ID
		 AND B.PRF_KND_CD IN ('PC02', 'PC03', 'PC04', 'PC05')
	   INNER JOIN WAM_PRF_ERR_DATA PERR
		  ON PERR.PRF_ID = B.PRF_ID
		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
		 AND PERR.ESN_ER_DATA_SNO > 0
	   INNER JOIN WAA_DB_SCH C
		  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		 AND C.REG_TYP_CD IN ('C', 'U')
		 AND C.DB_SCH_ID = B.DB_SCH_ID 
	   INNER JOIN WAA_DB_CONN_TRG D
		  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		 AND D.REG_TYP_CD IN ('C', 'U')
		 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
	   INNER JOIN WAT_DBC_TBL TBL
		  ON TBL.DB_SCH_ID = C.DB_SCH_ID
		 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
	   INNER JOIN WAT_DBC_COL COL
		  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
		 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
		 AND COL.DBC_COL_NM = B.OBJ_NM
		LEFT JOIN WAM_PRF_DQI_MAP E
		  ON E.PRF_ID = B.PRF_ID
		LEFT JOIN WAM_DQI DQI
		  ON E.DQI_ID = DQI.DQI_ID 
		 AND DQI.REG_TYP_CD IN ('C', 'U')
		LEFT JOIN WAM_DQI U
		  ON U.DQI_ID = DQI.UPP_DQI_ID
		 AND U.REG_TYP_CD IN ('C', 'U') 
		LEFT JOIN WAA_EXP_TBL EX          
		  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
 WHERE  1 = 1  
   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
									   FROM WAM_PRF_RESULT
									  GROUP BY PRF_ID 
									 )   
   AND NVL(EX.EXP_YN,'N')='N'
   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
   AND NOT exists (SELECT 1
   			         FROM WAA_EXP_TBL_RULE EXR
   			   		WHERE EXR.REG_TYP IN ('C', 'U')
   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
    				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
    				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
												 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
	)
   <if test="prfId != null and prfId != ''">
   		AND B.PRF_ID = #{prfId, jdbcType=VARCHAR}
   </if>
   <if test="notIn != null and notIn != '' and (prfId == null or prfId == '')">
   		AND B.PRF_ID NOT IN (${notIn})
   </if>
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchId != null and dbSchId != ''" >
		AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchPnm != null and dbSchPnm != ''" >
		AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	</if>
	<if test="dbcTblNm != null and dbcTblNm != ''" >
		AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	</if>
	<if test="dbcColNm != null and dbcColNm != ''" >
		AND (COL.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR COL.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	</if>
	
	UNION ALL
	SELECT DQI.DQI_LNM
		  ,B.PRF_ID
		  ,B.PRF_NM
		  ,TBL.DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM
		  , (SELECT LISTAGG(RCOL.CH_TBL_DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_REL_COL RCOL
				    ON RCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT01'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
		  ,'' AS DBC_COL_KOR_NM
		  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
		  ,${pcolnm}
	  FROM WAM_PRF_RESULT A
	   INNER JOIN WAM_PRF_MSTR B
		  ON B.REG_TYP_CD IN ('C', 'U')
		 AND B.PRF_ID = A.PRF_ID
		 AND B.PRF_KND_CD = 'PT01'
	   INNER JOIN WAM_PRF_ERR_DATA PERR
		  ON PERR.PRF_ID = B.PRF_ID
		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
		 AND PERR.ESN_ER_DATA_SNO > 0
	   INNER JOIN WAA_DB_SCH C
		  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		 AND C.REG_TYP_CD IN ('C', 'U')
		 AND C.DB_SCH_ID = B.DB_SCH_ID
	   INNER JOIN WAA_DB_CONN_TRG D
		  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		 AND D.REG_TYP_CD IN ('C', 'U')
		 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
	   INNER JOIN WAT_DBC_TBL TBL
		  ON TBL.DB_SCH_ID = C.DB_SCH_ID
		 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		LEFT JOIN WAM_PRF_DQI_MAP E
		  ON E.PRF_ID = B.PRF_ID
		LEFT JOIN WAM_DQI DQI
		  ON E.DQI_ID = DQI.DQI_ID 
		 AND DQI.REG_TYP_CD IN ('C', 'U')
		LEFT JOIN WAM_DQI U
		  ON U.DQI_ID = DQI.UPP_DQI_ID
		 AND U.REG_TYP_CD IN ('C', 'U') 
		LEFT JOIN WAA_EXP_TBL EX          
		  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
 WHERE  1 = 1  
   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
									   FROM WAM_PRF_RESULT
									  GROUP BY PRF_ID 
									 )   
   AND NVL(EX.EXP_YN,'N')='N'
   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
   AND NOT exists (SELECT 1
   			         FROM WAA_EXP_TBL_RULE EXR
   			   		WHERE EXR.REG_TYP IN ('C', 'U')
   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
    				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
    				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
												 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
	)
   <if test="prfId != null and prfId != ''">
   		AND B.PRF_ID = #{prfId, jdbcType=VARCHAR}
   </if>
   <if test="notIn != null and notIn != '' and (prfId == null or prfId == '')">
   		AND B.PRF_ID NOT IN (${notIn})
   </if>
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchId != null and dbSchId != ''" >
		AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchPnm != null and dbSchPnm != ''" >
		AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	</if>
	<if test="dbcTblNm != null and dbcTblNm != ''" >
		AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	</if>
	<if test="dbcColNm != null and dbcColNm != ''" >
		AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	</if>
	
	UNION ALL
	SELECT DQI.DQI_LNM
		  ,B.PRF_ID
		  ,B.PRF_NM
		  ,TBL.DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM
		  , (SELECT LISTAGG(UCOL.DBC_COL_NM, ', ') WITHIN GROUP (ORDER BY M.PRF_ID) AS DBC_COL_NM
				  FROM WAM_PRF_MSTR M
				 INNER JOIN WAM_PRF_UNQ_COL UCOL
				    ON UCOL.PRF_ID = M.PRF_ID
				 WHERE M.PRF_KND_CD = 'PT02'
				   AND B.PRF_ID = M.PRF_ID
				 GROUP BY M.PRF_ID) AS DBC_COL_NM
		  ,'' AS DBC_COL_KOR_NM
		  ,GET_CMCD_DTL_NM('PRF_KND_CD', B.PRF_KND_CD) AS PRF_KND_CD
		  ,${pcolnm}
	  FROM WAM_PRF_RESULT A
	   INNER JOIN WAM_PRF_MSTR B
		  ON B.REG_TYP_CD IN ('C', 'U')
		 AND B.PRF_ID = A.PRF_ID
		 AND B.PRF_KND_CD = 'PT02'
	   INNER JOIN WAM_PRF_ERR_DATA PERR
		  ON PERR.PRF_ID = B.PRF_ID
		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
		 AND PERR.ESN_ER_DATA_SNO > 0
	   INNER JOIN WAA_DB_SCH C
		  ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		 AND C.REG_TYP_CD IN ('C', 'U')
		 AND C.DB_SCH_ID = B.DB_SCH_ID 
	   INNER JOIN WAA_DB_CONN_TRG D
		  ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
		 AND D.REG_TYP_CD IN ('C', 'U')
		 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
	   INNER JOIN WAT_DBC_TBL TBL
		  ON TBL.DB_SCH_ID = C.DB_SCH_ID
		 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		LEFT JOIN WAM_PRF_DQI_MAP E
		  ON E.PRF_ID = B.PRF_ID
		LEFT JOIN WAM_DQI DQI
		  ON E.DQI_ID = DQI.DQI_ID 
		 AND DQI.REG_TYP_CD IN ('C', 'U')
		LEFT JOIN WAM_DQI U
		  ON U.DQI_ID = DQI.UPP_DQI_ID
		 AND U.REG_TYP_CD IN ('C', 'U') 
		LEFT JOIN WAA_EXP_TBL EX          
		  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
 WHERE  1 = 1  
   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
									   FROM WAM_PRF_RESULT
									  GROUP BY PRF_ID 
									 )
   AND NVL(EX.EXP_YN,'N')='N'
   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
   AND NOT exists (SELECT 1
   			         FROM WAA_EXP_TBL_RULE EXR
   			   		WHERE EXR.REG_TYP IN ('C', 'U')
   			    	  AND EXR.DB_SCH_ID = B.DB_SCH_ID
    				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
    				  AND B.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
												 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
	)
   <if test="prfId != null and prfId != ''">
   		AND B.PRF_ID = #{prfId, jdbcType=VARCHAR}
   </if>
   <if test="notIn != null and notIn != '' and (prfId == null or prfId == '')">
   		AND B.PRF_ID NOT IN (${notIn})
   </if>
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchId != null and dbSchId != ''" >
		AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
	<if test="dbSchPnm != null and dbSchPnm != ''" >
		AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	</if>
	<if test="dbcTblNm != null and dbcTblNm != ''" >
		AND (TBL.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR TBL.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	</if>
	<if test="dbcColNm != null and dbcColNm != ''" >
		AND (B.OBJ_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR B.OBJ_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	</if>
	
	UNION ALL
	SELECT DQI.DQI_LNM
	      ,A.BR_ID
	      ,A.BR_NM
	      ,D.DBC_TBL_NM
	      ,D.DBC_TBL_KOR_NM
	      ,E.DBC_COL_NM
	      ,E.DBC_COL_KOR_NM
	      ,'업무규칙' AS PRF_KND_CD
	      ,${bcolnm}
	      ,NVL(BERR.COL_NM1, 0) AS ERR_CNT
	  FROM WAM_BR_MSTR A
	 INNER JOIN WAM_BR_RESULT B
		ON B.BR_ID = A.BR_ID
	 INNER JOIN WAM_BR_ERR_DATA BERR
		ON BERR.BR_ID = A.BR_ID
	   AND BERR.ANA_STR_DTM = B.ANA_STR_DTM
	   AND BERR.ER_DATA_SNO > 0
	 INNER JOIN WAA_DB_SCH C
		ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	   AND C.REG_TYP_CD IN ('C', 'U')
	 INNER JOIN WAT_DBC_TBL D
		ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	 INNER JOIN WAT_DBC_COL E
		ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	   AND E.DBC_COL_NM = A.DBC_COL_NM
	  LEFT OUTER JOIN WAM_BR_DQI_MAP F
		ON F.BR_ID = A.BR_ID
	   AND F.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
		ON DQI.DQI_ID = F.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	  LEFT JOIN WAA_EXP_TBL EX          
		ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND (B.BR_ID, B.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
									   FROM WAM_BR_RESULT
									  GROUP BY BR_ID 
									 )
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND DQI.DQI_LNM = #{dqiLnm, jdbcType=VARCHAR}
	   AND NOT exists (SELECT 1
	   			         FROM WAA_EXP_TBL_RULE EXR
	   			   		WHERE EXR.REG_TYP IN ('C', 'U')
	   			    	  AND EXR.DB_SCH_ID = A.DB_SCH_ID
	    				  AND EXR.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
	    				  AND A.DBC_TBL_NM LIKE (CASE WHEN (EXR.RELATION = 'F') THEN EXR.EXC_STND_RULE || '_' || '%' 
													 WHEN (EXR.RELATION = 'B') THEN  '%' || '_' || EXR.EXC_STND_RULE END) 
		)
	   <if test="prfId != null and prfId != ''">
   		AND A.BR_ID = #{prfId, jdbcType=VARCHAR}
   		</if>
   		<if test="notIn != null and notIn != '' and (prfId == null or prfId == '')">
   		AND A.BR_ID NOT IN (${notIn})
   		</if>
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
		AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
		AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
		AND (C.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR C.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
		AND (D.DBC_TBL_NM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR D.DBC_TBL_NM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
		AND (E.DBC_COL_NM LIKE '%'||#{dbcColNm,jdbcType=VARCHAR}||'%' OR E.DBC_COL_NM LIKE '%'||UPPER(#{dbcColNm,jdbcType=VARCHAR})||'%')
	   </if>
	 ORDER BY  DBC_TBL_NM
			  ,DBC_TBL_KOR_NM
			  ,DBC_COL_NM
			  ,DBC_COL_KOR_NM
<!--       ) -->
</select>

<select id="getDqiLnmLst" resultType="String">
	SELECT DQI_LNM
	  FROM WAM_DQI
	 WHERE UPP_DQI_ID IS NOT NULL
	   AND DQI_LVL = (SELECT MAX(DQI_LVL) AS DQI_LVL FROM WAM_DQI)
	 ORDER BY UPP_DQI_ID
</select>


<select id="selectStndDtm" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT MIN(DB.STR_DTM) AS ANA_STR_DTM
	     , NOW() AS ANA_END_DTM
	  FROM WAA_DB_CONN_TRG DB
	 INNER JOIN WAA_DB_SCH SCH
	    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
	   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	   AND SCH.REG_TYP_CD IN ('C', 'U')
	 WHERE 1=1
	   AND DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	   AND DB.REG_TYP_CD IN ('C', 'U')
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (SCH.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR SCH.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		</if>
</select>

<select id="selectCnt" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT /*+ LEADING(D A) */  
		 COUNT(CASE 
		        WHEN B.DBC_COL_KOR_NM IS NULL THEN '컬럼한글명 미존재'
		        WHEN C.SDITM_LNM IS NULL THEN '용어미존재'
		          WHEN B.DBC_COL_KOR_NM != C.SDITM_LNM THEN '컬럼한글명불일치'
		          WHEN NVL(B.DATA_TYPE, ' ') != NVL(E.DATA_TYPE, ' ') THEN '데이터타입 불일치'
		          WHEN NVL(B.DATA_LEN, 0) != NVL(E.DATA_LEN, 0) THEN '데이터길이 불일치'
		          WHEN NVL(B.DATA_PNT, 0) != NVL(E.DATA_SCAL, 0) THEN '데이터소수점 자리수 불일치'
		         END
		   )  AS ERR_CNT
		  , COUNT(*) AS TOT_CNT
	   FROM WAA_DB_CONN_TRG DB
	  INNER JOIN WAA_DB_SCH SCH
		 ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		AND SCH.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		AND SCH.REG_TYP_CD IN ('C', 'U')
	  INNER JOIN WAT_DBC_TBL A
		 ON A.DB_SCH_ID = SCH.DB_SCH_ID
		AND A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
	  INNER JOIN WAT_DBC_COL B
		 ON B.DBC_TBL_NM = A.DBC_TBL_NM 
		AND B.DB_SCH_ID = A.DB_SCH_ID
	   LEFT JOIN ( SELECT C.SDITM_PNM SDITM_PNM
						, C.SDITM_LNM SDITM_LNM
						, C.SDITM_ID SDITM_ID
						, C.REG_TYP_CD REG_TYP_CD
						, D.DMN_ID DMN_ID
						, C.INFOTP_ID INFOTP_ID
						, D.DMN_LNM DMN_LNM
						, D.DMN_PNM DMN_PNM
					 FROM WAM_SDITM C
					 LEFT JOIN WAM_DMN D
					   ON D.DMN_ID = C.DMN_ID
					  AND D.REG_TYP_CD IN ('C', 'U')
				  <where> 1=1
				   
				   <if test="stndAsrt != null">
				   		AND C.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR} 
				   </if>
				  </where>
		) C 
		  ON C.SDITM_PNM = RTRIM(REPLACE(B.DBC_COL_NM,'_0123456789','')) 
		 AND C.REG_TYP_CD IN ('C', 'U')
		LEFT OUTER JOIN WAA_INFO_TYPE E
	      ON C.INFOTP_ID = E.INFOTP_ID
	     AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	   WHERE 1 = 1   
		 AND DB.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		 AND DB.REG_TYP_CD IN ('C', 'U')

	   <if test="dbConnTrgId != null">
   	   	  AND A.DB_CONN_TRG_ID = #{dbConnTrgId, jdbcType=VARCHAR}
	   </if> 
	   <if test="dbSchId != null">
   	   	  AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
	   </if> 
	 ORDER BY 
	 	   A.DBC_TBL_NM
	     , A.DBC_TBL_KOR_NM
	     , B.DBC_COL_NM
	     , B.DBC_COL_KOR_NM
</select>

<select id="selectGovCnt" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
SELECT /*+ LEADING(D A) */  
		 COUNT(CASE 
		        WHEN B.DBC_COL_KOR_NM IS NULL THEN '컬럼한글명 미존재'
		        WHEN C.SDITM_LNM IS NULL THEN '용어미존재'
		          WHEN B.DBC_COL_KOR_NM != C.SDITM_LNM THEN '컬럼한글명불일치'
		          WHEN B.DATA_TYPE != C.DATA_TYPE THEN '데이터타입 불일치'
		          WHEN B.DATA_LEN != C.DATA_LEN THEN '데이터길이 불일치'
		          WHEN B.DATA_PNT != C.DATA_SCAL THEN '데이터소수점 자리수 불일치'
		         END
		   )  AS ERR_CNT
		  , COUNT(*) AS TOT_CNT
		FROM WAA_DB_CONN_TRG DB
		 INNER JOIN WAA_DB_SCH SCH
		   ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		   AND SCH.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		   AND SCH.REG_TYP_CD IN ('C', 'U')
		 INNER JOIN WAT_DBC_TBL A
		   ON A.DB_SCH_ID = SCH.DB_SCH_ID
		   AND A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		INNER JOIN WAT_DBC_COL B
		  ON B.DBC_TBL_NM = A.DBC_TBL_NM 
		 AND B.DB_SCH_ID = A.DB_SCH_ID
		LEFT JOIN GOV_SDITM C
<!-- 		  ON C.SDITM_PNM = RTRIM(REPLACE(B.DBC_COL_NM,'_0123456789',''))  -->
			ON C.SDITM_PNM = B.DBC_COL_NM
		LEFT JOIN GOV_DMN D
		   ON D.DMN_ID = C.DMN_ID
		LEFT OUTER JOIN WAA_INFO_TYPE E
	      ON D.DMN_NM = E.INFOTP_LNM 
	     AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		WHERE 1 = 1   
		  AND DB.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		  AND DB.REG_TYP_CD IN ('C', 'U')

	   <if test="dbConnTrgId != null">
   	   	  AND A.DB_CONN_TRG_ID = #{dbConnTrgId, jdbcType=VARCHAR}
	   </if> 
	   <if test="dbSchId != null">
   	   	  AND A.DB_SCH_ID = #{dbSchId, jdbcType=VARCHAR}
	   </if> 		           
	 ORDER BY 
	 	   A.DBC_TBL_NM
	     , A.DBC_TBL_KOR_NM
	     , B.DBC_COL_NM
	     , B.DBC_COL_KOR_NM
</select>

<select id="selectModelDtm" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT NOW() AS ANA_END_DTM
	      ,MIN(RQST_DTM) AS ANA_STR_DTM
	  FROM WDQM_PDM_TBL
	 WHERE 1=1
	  <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (PDM_TBL_PNM LIKE '%'||#{dbcTblNm,jdbcType=VARCHAR}||'%' OR PDM_TBL_LNM LIKE '%'||UPPER(#{dbcTblNm,jdbcType=VARCHAR})||'%')
		</if>
</select>

<select id="selectDbConnTrgURL" resultType="String" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT CONN_TRG_LNK_URL
	  FROM WAA_DB_CONN_TRG
	<where> 1=1
	       <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
	   AND EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	</where>
</select>

<select id="selectSditmTblList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT AA.PDM_TBL_PNM, AA.PDM_COL_PNM, WAT_DATA_TYPE AS DATA_TYPE
		, LTRIM(CASE 
			        WHEN AA.SDITM_LNM IS NULL THEN '표준용어에 존재하지 않는 컬럼명 입니다.'
			          WHEN AA.WAT_DATA_TYPE != AA.WAM_DATA_TYPE THEN '데이터타입이 일치하지 않습니다.'
			          ELSE '표준을 준수하였습니다.'
			         END )  AS GAP_STATUS
	FROM
	(	SELECT /*+ LEADING(D A) */  
				  SCH.DB_SCH_PNM||'.'||A.DBC_TBL_NM AS PDM_TBL_PNM
				  , B.DBC_COL_NM               AS PDM_COL_PNM
				  , B.ORD 
				  , CASE WHEN B.DATA_LEN IS NULL 
			         THEN B.DATA_TYPE
			         ELSE (CASE WHEN B.DATA_PNT IS NOT NULL AND B.DATA_PNT != 0 
			                    THEN B.DATA_TYPE||'('||B.DATA_LEN||','||B.DATA_PNT||')' 
			                    ELSE B.DATA_TYPE||'('||B.DATA_LEN||')'
			                     END )
			         END AS WAT_DATA_TYPE
			      , CASE WHEN E.DATA_LEN IS NULL 
			         THEN E.DATA_TYPE
			         ELSE (CASE WHEN E.DATA_SCAL IS NOT NULL
			                    THEN E.DATA_TYPE||'('||E.DATA_LEN||','||E.DATA_SCAL||')' 
			                    ELSE E.DATA_TYPE||'('||E.DATA_LEN||')'
			                     END )
			         END AS WAM_DATA_TYPE
			      , C.SDITM_LNM
		FROM WAA_DB_CONN_TRG DB
		 INNER JOIN WAA_DB_SCH SCH
		   ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		   AND SCH.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		   AND SCH.REG_TYP_CD IN ('C', 'U')
		 INNER JOIN WAT_DBC_TBL A
		   ON A.DB_SCH_ID = SCH.DB_SCH_ID
		   AND A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		INNER JOIN WAT_DBC_COL B
		  ON B.DBC_TBL_NM = A.DBC_TBL_NM 
		 AND B.DB_SCH_ID = A.DB_SCH_ID
		LEFT JOIN ( SELECT C.SDITM_PNM SDITM_PNM
						, C.SDITM_LNM SDITM_LNM
						, C.SDITM_ID SDITM_ID
						, C.REG_TYP_CD REG_TYP_CD
						, D.DMN_ID DMN_ID
						, C.INFOTP_ID INFOTP_ID
						, D.DMN_LNM DMN_LNM
						, D.DMN_PNM DMN_PNM
					 FROM WAM_SDITM C
					 LEFT JOIN WAM_DMN D
					   ON D.DMN_ID = C.DMN_ID
					  AND D.REG_TYP_CD IN ('C', 'U')
				  <where>
				   <if test="stndAsrt != null">
				   		AND C.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR} 
				   </if>
				  </where>
		) C 
		  ON C.SDITM_PNM = RTRIM(REPLACE(B.DBC_COL_NM,'_0123456789','')) 
		 AND C.REG_TYP_CD IN ('C', 'U')
		LEFT OUTER JOIN WAA_INFO_TYPE E
	      ON C.INFOTP_ID = E.INFOTP_ID
	      AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		WHERE 1 = 1   
		  AND DB.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		  AND DB.REG_TYP_CD IN ('C', 'U')
		 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		 </if>
		 <if test="dbSchId != null and dbSchId != ''" >
			AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		 </if>
		 <if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (SCH.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR SCH.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
		 </if>
	   	  
	) AA		      
	ORDER BY AA.PDM_TBL_PNM, AA.PDM_COL_PNM, AA.ORD
</select>

<select id="selectGovSditmTblList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT AA.PDM_TBL_PNM, AA.PDM_COL_PNM, WAT_DATA_TYPE AS DATA_TYPE
		, LTRIM(CASE 
			        WHEN AA.SDITM_LNM IS NULL THEN '표준용어에 존재하지 않는 컬럼명 입니다.'
			          WHEN AA.WAT_DATA_TYPE != AA.WAM_DATA_TYPE THEN '데이터타입이 일치하지 않습니다.'
			          ELSE '표준을 준수하였습니다.'
			         END )  AS GAP_STATUS
	FROM
	(	SELECT /*+ LEADING(D A) */  
				  SCH.DB_SCH_PNM||'.'||A.DBC_TBL_NM AS PDM_TBL_PNM
				  , B.DBC_COL_NM               AS PDM_COL_PNM
				  , B.ORD 
				  , CASE WHEN B.DATA_LEN IS NULL 
			         THEN B.DATA_TYPE
			         ELSE (CASE WHEN B.DATA_PNT IS NOT NULL AND B.DATA_PNT != 0 
			                    THEN B.DATA_TYPE||'('||B.DATA_LEN||','||B.DATA_PNT||')' 
			                    ELSE B.DATA_TYPE||'('||B.DATA_LEN||')'
			                     END )
			         END AS WAT_DATA_TYPE
			      , CASE WHEN C.DATA_LEN IS NULL 
			         THEN C.DATA_TYPE
			         ELSE (CASE WHEN C.DATA_SCAL IS NOT NULL
			                    THEN C.DATA_TYPE||'('||C.DATA_LEN||','||C.DATA_SCAL||')' 
			                    ELSE C.DATA_TYPE||'('||C.DATA_LEN||')'
			                     END )
			         END AS WAM_DATA_TYPE
			      , C.SDITM_LNM
		FROM WAA_DB_CONN_TRG DB
		 INNER JOIN WAA_DB_SCH SCH
		   ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		   AND SCH.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		   AND SCH.REG_TYP_CD IN ('C', 'U')
		 INNER JOIN WAT_DBC_TBL A
		   ON A.DB_SCH_ID = SCH.DB_SCH_ID
		   AND A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		INNER JOIN WAT_DBC_COL B
		  ON B.DBC_TBL_NM = A.DBC_TBL_NM 
		 AND B.DB_SCH_ID = A.DB_SCH_ID
		LEFT JOIN ( SELECT C.SDITM_PNM SDITM_PNM
						, C.SDITM_LNM SDITM_LNM
						, C.SDITM_ID SDITM_ID
						, C.REG_TYP_CD REG_TYP_CD
						, D.DMN_ID DMN_ID
<!-- 						, C.INFOTP_ID INFOTP_ID -->
						, D.DMN_NM DMN_LNM
						, C.DATA_TYPE
						, C.DATA_LEN
						, C.DATA_SCAL
						, C.DB_CONN_TRG_ID
						, C.DB_SCH_ID
					 FROM GOV_SDITM C
					 LEFT JOIN GOV_DMN D
					   ON D.DMN_ID = C.DMN_ID
					  AND D.REG_TYP_CD IN ('C','U')
					  AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
					  AND C.DB_CONN_TRG_ID = D.DB_CONN_TRG_ID
					  AND C.DB_SCH_ID = D.DB_SCH_ID
					WHERE 1=1
					  AND C.REG_TYP_CD IN ('C','U')
					  AND C.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
					  <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					 </if>
					 <if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					 </if>
		) C 
		  ON C.SDITM_PNM = RTRIM(REPLACE(B.DBC_COL_NM,'_0123456789','')) 
		 AND C.REG_TYP_CD IN ('C', 'U')
		 AND C.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
		 AND C.DB_SCH_ID = SCH.DB_SCH_ID
<!-- 		LEFT OUTER JOIN WAA_INFO_TYPE E -->
<!-- 	      ON C.DMN_LNM = E.INFOTP_LNM -->
<!-- 	      AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d') -->
		WHERE 1 = 1   
		  AND DB.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
		  AND DB.REG_TYP_CD IN ('C', 'U')
		 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		 </if>
		 <if test="dbSchId != null and dbSchId != ''" >
			AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		 </if>
		 <if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (SCH.DB_SCH_PNM LIKE '%'||#{dbSchPnm,jdbcType=VARCHAR}||'%' OR SCH.DB_SCH_PNM LIKE '%'||UPPER(#{dbSchPnm,jdbcType=VARCHAR})||'%')
		 </if>
	   	  
	) AA		      
	ORDER BY AA.PDM_TBL_PNM, AA.PDM_COL_PNM, AA.ORD
</select>

<select id="selectSditmList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT A.SDITM_LNM, A.SDITM_PNM, A.OBJ_DESCN, C.INFOTP_LNM 
	  FROM WAM_SDITM A
	  LEFT OUTER JOIN WAM_DMN B 
	    ON A.DMN_ID = B.DMN_ID
	   AND B.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_INFO_TYPE C
	    ON A.INFOTP_ID = C.INFOTP_ID 
	   AND C.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
<!-- 	   AND C.REG_TYP_CD IN ('C', 'U') -->
	   <where> 1=1
	    AND A.REG_TYP_CD IN ('C','U')
	
		<if test="stndAsrt != null">
			AND A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR} 
		</if>
	   </where>
</select>

<select id="selectGovSditmList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
<!-- 	SELECT A.SDITM_LNM, A.SDITM_PNM, A.OBJ_DESCN, C.INFOTP_LNM  -->
	SELECT A.SDITM_LNM, A.SDITM_PNM, C.INFOTP_LNM 
	  FROM GOV_SDITM A
	  LEFT OUTER JOIN GOV_DMN B 
	    ON A.DMN_ID = B.DMN_ID
	   AND B.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_INFO_TYPE C
	    ON B.DMN_NM = C.INFOTP_LNM
	   AND C.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
	 WHERE A.REG_TYP_CD IN ('C','U')
	 AND A.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
</select>

<select id="selectDmnList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT A.DMN_LNM, A.DMN_PNM, A.OBJ_DESCN, B.DATA_TYPE, B.DATA_LEN, B.DATA_SCAL 
	FROM WAM_DMN A
	LEFT OUTER JOIN WAA_INFO_TYPE B
	 ON A.INFOTP_ID = B.INFOTP_ID 
	 AND B.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
<!-- 	 AND B.REG_TYP_CD IN ('C','U') -->
	WHERE A.REG_TYP_CD IN ('C','U')
	
		<if test="stndAsrt != null">
			AND A.STND_ASRT = #{stndAsrt, jdbcType=VARCHAR} 
		</if>
  	
</select>

<select id="selectGovDmnList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT A.DMN_NM AS DMN_LNM, A.DMN_NM AS DMN_PNM, B.DATA_TYPE, B.DATA_LEN, B.DATA_SCAL 
	  FROM GOV_DMN A
	  LEFT OUTER JOIN WAA_INFO_TYPE B
	    ON A.DMN_NM = B.INFOTP_LNM
	   AND B.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
	 WHERE 1=1
	   AND A.REG_TYP_CD IN ('C','U')
	   AND A.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
</select>

<select id="selectModelStatus" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT ITEM_NM, OBJ_CNT, ERROR_CNT
		,GAP_RATE, 100-GAP_RATE AS STND_RATE
		,DATE_FORMAT(NOW(), '%Y-%m-%d') AS RESULT_DATE
	FROM 
	(
		SELECT '물리DB기준 테이블 현행화' AS ITEM_NM, OBJ_CNT, ERROR_CNT
				,CASE WHEN OBJ_CNT != 0 THEN (ERROR_CNT/OBJ_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS OBJ_CNT
						,COUNT(CASE WHEN B.PDM_TBL_PNM IS NULL THEN 1 END) AS ERROR_CNT
				FROM WAT_DBC_TBL A
				LEFT OUTER JOIN WAA_SUBJ_DB_SCH_MAP C
				ON C.DB_SCH_ID = A.DB_SCH_ID 
					AND C.REG_TYP_CD IN ('C','U')
					AND C.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				LEFT OUTER JOIN WAM_PDM_TBL B
				ON A.DBC_TBL_NM = B.PDM_TBL_PNM 
				AND A.DBC_TBL_KOR_NM  = B.PDM_TBL_LNM 
				AND C.SUBJ_ID = B.SUBJ_ID 
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		)
		
		UNION ALL 
		SELECT '물리DB기준 컬럼 현행화' AS ITEM_NM, OBJ_CNT, ERROR_CNT
				,CASE WHEN OBJ_CNT !=0 THEN (ERROR_CNT/OBJ_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS OBJ_CNT
						,COUNT(CASE WHEN D.PDM_TBL_PNM IS NULL THEN 1 END) AS ERROR_CNT
				FROM WAT_DBC_TBL A
				INNER JOIN WAT_DBC_COL AA
				ON A.DB_SCH_ID = AA.DB_SCH_ID 
				 AND A.DBC_TBL_NM = AA.DBC_TBL_NM 
				LEFT OUTER JOIN WAA_SUBJ_DB_SCH_MAP C
				ON C.DB_SCH_ID = A.DB_SCH_ID 
				 AND C.REG_TYP_CD IN ('C','U')
				 AND C.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				LEFT OUTER JOIN 
				(
					SELECT B.PDM_TBL_PNM, B.PDM_TBL_LNM, B.SUBJ_ID, BB.PDM_COL_PNM
					FROM WAM_PDM_TBL B
					INNER JOIN WAM_PDM_COL BB
					ON BB.PDM_TBL_ID = B.PDM_TBL_ID 
				) D
				ON A.DBC_TBL_NM = D.PDM_TBL_PNM
				 AND C.SUBJ_ID = D.SUBJ_ID
				 AND D.PDM_COL_PNM = AA.DBC_COL_NM 
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
				
		)
		
		UNION ALL 
		
		SELECT '테이블정의서 기준  테이블 현행화' AS ITEM_NM, OBJ_CNT, ERROR_CNT
				,CASE WHEN OBJ_CNT != 0 THEN (ERROR_CNT/OBJ_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS OBJ_CNT
						,COUNT(CASE WHEN B.DBC_TBL_NM IS NULL THEN 1 END) AS ERROR_CNT
				FROM WAM_PDM_TBL A
				LEFT OUTER JOIN WAA_SUBJ_DB_SCH_MAP C
				ON C.SUBJ_ID = A.SUBJ_ID 
					AND C.REG_TYP_CD IN ('C','U')
					AND C.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				LEFT OUTER JOIN WAT_DBC_TBL B
				ON B.DBC_TBL_NM = A.PDM_TBL_PNM 
				--AND A.DBC_TBL_KOR_NM  = B.PDM_TBL_LNM 
				AND C.DB_SCH_ID = B.DB_SCH_ID 
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		)
		
		UNION ALL 
		SELECT '컬럼정의서 기준 컬럼 현행화' AS ITEM_NM, COL_CNT, ERROR_CNT
				,CASE WHEN COL_CNT !=0 THEN (ERROR_CNT/COL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS COL_CNT
						,COUNT(CASE WHEN D.DBC_COL_NM IS NULL THEN 1 END) AS ERROR_CNT
				FROM WAM_PDM_TBL A
				INNER JOIN WAM_PDM_COL AA
				 ON A.PDM_TBL_ID = AA.PDM_TBL_ID 
				LEFT OUTER JOIN WAA_SUBJ_DB_SCH_MAP C
				ON C.SUBJ_ID = A.SUBJ_ID 
				 AND C.REG_TYP_CD IN ('C','U')
				 AND C.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				LEFT OUTER JOIN 
				(
					SELECT B.DBC_TBL_NM, B.DBC_TBL_KOR_NM, B.DB_SCH_ID, BB.DBC_COL_NM
					FROM WAT_DBC_TBL B
					INNER JOIN WAT_DBC_COL BB
					ON B.DB_SCH_ID = BB.DB_SCH_ID 
				 	AND B.DBC_TBL_NM = BB.DBC_TBL_NM 
				) D
				ON D.DBC_TBL_NM = A.PDM_TBL_PNM
				 AND C.DB_SCH_ID = D.DB_SCH_ID 
				 AND AA.PDM_COL_PNM = D.DBC_COL_NM 
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
				
		)
		
		
	)	
</select>

<select id="selectStructResultList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT ITEM_NM, TBL_CNT, ERR_CNT
		, FORMAT(GAP_RATE, '3') AS GAP_RATE
		, FORMAT(100-GAP_RATE, '3') AS STND_RATE
		, DATE_FORMAT(NOW(), '%Y-%m-%d') AS RESULT_DATE
	FROM 
	(
		SELECT '물리DB기준 테이블 현행화' AS ITEM_NM, TBL_CNT, ERR_CNT
				,CASE WHEN TBL_CNT != 0 THEN (ERR_CNT/TBL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS TBL_CNT
						,COUNT(CASE WHEN B.PDM_TBL_PNM IS NULL THEN 1 END) AS ERR_CNT
				  FROM WAT_DBC_TBL A
				  LEFT OUTER JOIN WAA_DB_SCH D
				    ON A.DB_SCH_ID = D.DB_SCH_ID 
			       AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				  LEFT OUTER JOIN WAM_PDM_TBL B
				    ON A.DBC_TBL_NM = B.PDM_TBL_PNM 
				 WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		) AA
		
		UNION ALL 
		SELECT '물리DB기준 컬럼 현행화' AS ITEM_NM, COL_CNT, ERR_CNT
				,CASE WHEN COL_CNT !=0 THEN (ERR_CNT/COL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS COL_CNT
						,COUNT(CASE WHEN D.PDM_TBL_PNM IS NULL THEN 1 END) AS ERR_CNT
				FROM WAT_DBC_TBL A
			    LEFT OUTER JOIN WAA_DB_SCH E
			      ON A.DB_SCH_ID = E.DB_SCH_ID
				 AND E.REG_TYP_CD IN ('C','U')
				 AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
			   INNER JOIN WAT_DBC_COL AA
			      ON A.DB_SCH_ID = AA.DB_SCH_ID 
				 AND A.DBC_TBL_NM = AA.DBC_TBL_NM 
				LEFT OUTER JOIN 
				(
					SELECT B.PDM_TBL_PNM, B.PDM_TBL_LNM, B.SUBJ_ID, BB.PDM_COL_PNM, PDM_COL_LNM, PK_YN
					     , DATA_TYPE, DATA_LEN, DATA_SCAL, COL_ORD, NONUL_YN, DEFLT_VAL
					  FROM WAM_PDM_TBL B
				     INNER JOIN WAM_PDM_COL BB
					    ON BB.PDM_TBL_ID = B.PDM_TBL_ID 
				) D
				ON A.DBC_TBL_NM = D.PDM_TBL_PNM
				 AND D.PDM_COL_PNM = AA.DBC_COL_NM 
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		) BB
		
		UNION ALL 
		
		SELECT '테이블정의서 기준  테이블 현행화' AS ITEM_NM, TBL_CNT, ERR_CNT
				,CASE WHEN TBL_CNT != 0 THEN (ERR_CNT/TBL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS TBL_CNT
						,COUNT(CASE WHEN B.DBC_TBL_NM IS NULL THEN 1 END) AS ERR_CNT
				FROM WAM_PDM_TBL A
				LEFT OUTER JOIN WAM_DDL_TBL C
				  ON C.PDM_TBL_ID = A.PDM_TBL_ID
				LEFT OUTER JOIN WAA_DB_SCH D
				  ON D.DB_SCH_ID = C.DB_SCH_ID
				 AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				LEFT OUTER JOIN WAT_DBC_TBL B
				  ON B.DBC_TBL_NM = A.PDM_TBL_PNM
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND D.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		) CC
		
		UNION ALL 
		SELECT '컬럼정의서 기준 컬럼 현행화' AS ITEM_NM, COL_CNT, ERR_CNT
				,CASE WHEN COL_CNT !=0 THEN (ERR_CNT/COL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS COL_CNT
						,COUNT(CASE WHEN D.DBC_COL_NM IS NULL THEN 1 END) AS ERR_CNT
				  FROM WAM_PDM_TBL A
				 INNER JOIN WAM_PDM_COL AA
				    ON A.PDM_TBL_ID = AA.PDM_TBL_ID 
				 INNER JOIN WAM_DDL_TBL C
				    ON A.PDM_TBL_ID = C.PDM_TBL_ID 
				  LEFT OUTER JOIN WAA_DB_SCH E
				    ON C.DB_SCH_ID = E.DB_SCH_ID
				   AND E.REG_TYP_CD IN ('C','U')
				   AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				  LEFT OUTER JOIN 
				  (
					SELECT B.DBC_TBL_NM, B.DBC_TBL_KOR_NM, B.DB_SCH_ID, BB.DBC_COL_NM
						 , BB.DBC_COL_KOR_NM, BB.PK_YN, BB.DATA_TYPE, BB.DATA_LEN
						 , BB.DATA_PNT, BB.ORD, BB.NULL_YN, BB.DEFLT_VAL
					  FROM WAT_DBC_TBL B
					 INNER JOIN WAT_DBC_COL BB
				    	ON B.DB_SCH_ID = BB.DB_SCH_ID 
				       AND B.DBC_TBL_NM = BB.DBC_TBL_NM 
				  ) D
				   ON D.DBC_TBL_NM = A.PDM_TBL_PNM
				  AND D.DBC_TBL_KOR_NM = A.PDM_TBL_LNM
				  AND C.DB_SCH_ID = D.DB_SCH_ID 
				  AND AA.PDM_COL_PNM = D.DBC_COL_NM 
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND E.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		) DD
		
	)	EE
</select>

<select id="selectDbcTblList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT TBL_NM
		 , CASE WHEN DETAIL_STATUS IS NULL THEN '일치' ELSE '불일치' END AS STATE
		 , DETAIL_STATUS
	  FROM (
	  		SELECT D.DB_SCH_PNM||'.'||A.DBC_TBL_NM AS TBL_NM
	  		     , CASE WHEN B.PDM_TBL_ID IS NULL THEN '물리모델 미존재' END AS DETAIL_STATUS
	  		  FROM WAT_DBC_TBL A
	  		  LEFT OUTER JOIN WAA_DB_SCH D
	  		    ON A.DB_SCH_ID = D.DB_SCH_ID
	  		   AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	  		  LEFT OUTER JOIN WAM_PDM_TBL B
	  		    ON A.DBC_TBL_NM = B.PDM_TBL_PNM
	  		 WHERE 1=1
	  		 <if test="dbSchId != null and dbSchId != ''" >
			   AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			 </if>
	  		) AA
	 ORDER BY TBL_NM		
</select>

<select id="selectDbcColList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT TBL_NM, COL_NM, DATA_TYPE
	     , CASE WHEN DETAIL_STATUS IS NULL THEN '일치' ELSE '불일치' END AS STATE
	     , DETAIL_STATUS
	  FROM (
	  		SELECT E.DB_SCH_PNM||'.'||A.DBC_TBL_NM AS TBL_NM
	  			 , AA.DBC_COL_NM AS COL_NM
	  			 , CASE WHEN AA.DATA_LEN IS NULL THEN AA.DATA_TYPE ELSE (
	  			 						CASE WHEN AA.DATA_PNT IS NOT NULL AND AA.DATA_PNT != 0
	  			 							THEN (AA.DATA_TYPE||'('||AA.DATA_LEN||','||AA.DATA_PNT||')')
	  			 							ELSE (AA.DATA_TYPE||'('||AA.DATA_LEN||')')
	  			 							END )
	  			   END AS DATA_TYPE
	  			 , CASE WHEN D.PDM_TBL_PNM IS NULL THEN '물리모델 미존재'
	  			 		WHEN D.PDM_COL_PNM IS NULL THEN '물리모델 컬럼 미존재'
	  			 		WHEN NVL(D.PDM_COL_LNM,'_') != NVL(AA.DBC_COL_KOR_NM,'_') THEN '컬럼한글명불일치'
	  			 		WHEN NVL(D.PK_YN,'N') != NVL(AA.PK_YN,'N') THEN 'PK여부불일치'
	  			 		WHEN RTRIM(D.DATA_TYPE,'2') != RTRIM(AA.DATA_TYPE,'2') THEN '데이터타입불일치'
	  			 		WHEN NVL(D.DATA_LEN,0) != NVL(AA.DATA_LEN,0) THEN '데이터길이불일치'
	  			 		WHEN NVL(D.DATA_SCAL,0) != NVL(AA.DATA_PNT,0) THEN '소수점불일치'
	  			 		WHEN D.COL_ORD != AA.ORD THEN '컬럼순서불일치'
	  			 		WHEN NVL(D.NONUL_YN,'N') != (CASE WHEN AA.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) THEN 'NOT NULL여부불일치'
	  			 		WHEN NVL(D.DEFLT_VAL,'_') != NVL(AA.DEFLT_VAL, '_') THEN 'DEFAULT불일치'
	  			   END AS DETAIL_STATUS
	  		  FROM WAT_DBC_TBL A
	  		  LEFT OUTER JOIN WAA_DB_SCH E
	  		    ON A.DB_SCH_ID = E.DB_SCH_ID
	  		   AND E.REG_TYP_CD IN('C','U')
	  		   AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	  		 INNER JOIN WAT_DBC_COL AA
	  		    ON A.DB_SCH_ID = AA.DB_SCH_ID
	  		   AND A.DBC_TBL_NM = AA.DBC_TBL_NM
	  		  LEFT OUTER JOIN
	  		  ( SELECT B.PDM_TBL_PNM, B.PDM_TBL_LNM, B.SUBJ_ID
	  		  		 , BB.PDM_COL_PNM, PDM_COL_LNM, PK_YN
	  		  		 , DATA_TYPE, DATA_LEN, DATA_SCAL
	  		  		 , COL_ORD, NONUL_YN, DEFLT_VAL
	  		  	  FROM WAM_PDM_TBL B
	  		  	 INNER JOIN WAM_PDM_COL BB
	  		  	    ON BB.PDM_TBL_ID = B.PDM_TBL_ID
	  		   ) D
	  		    ON A.DBC_TBL_NM = D.PDM_TBL_PNM
	  		   AND D.PDM_COL_PNM = AA.DBC_COL_NM
			 WHERE 1=1
			 <if test="dbSchId != null and dbSchId != ''" >
			   AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			 </if>
	 		) AB
</select>

<select id="selectPdmTblList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT TBL_NM
	     , CASE WHEN DETAIL_STATUS IS NULL THEN '일치' ELSE '불일치' END AS STATE
	     , DETAIL_STATUS
	  FROM (
	  		SELECT D.DB_SCH_PNM||'.'||A.PDM_TBL_PNM AS TBL_NM
	  			 , CASE WHEN B.DBC_TBL_NM IS NULL THEN '물리DB에 미존재' END AS DETAIL_STATUS
	  		  FROM WAM_PDM_TBL A
	  		 INNER JOIN WAM_DDL_TBL C
	  		    ON C.PDM_TBL_ID = A.PDM_TBL_ID
	  		  LEFT OUTER JOIN WAA_DB_SCH D
	  		    ON D.DB_SCH_ID = C.DB_SCH_ID
	  		   AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	  		  LEFT OUTER JOIN WAT_DBC_TBL B
	  		    ON B.DBC_TBL_NM = A.PDM_TBL_PNM
	  		 WHERE 1=1
	  		 <if test="dbSchId != null and dbSchId != ''" >
			   AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			 </if>
	       ) AA
	  ORDER BY TBL_NM
</select>

<select id="selectPdmColList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
SELECT TBL_NM, COL_NM, DATA_TYPE, DETAIL_STATUS
      ,CASE WHEN DETAIL_STATUS IS NULL THEN '일치' ELSE '불일치' END AS STATE
FROM (
   SELECT E.DB_SCH_PNM||'.'||A.PDM_TBL_PNM AS TBL_NM
        , AA.PDM_COL_PNM AS COL_NM
        , CASE WHEN AA.DATA_LEN IS NULL THEN AA.DATA_TYPE
          				ELSE (CASE WHEN AA.DATA_SCAL IS NOT NULL AND AA.DATA_SCAL!=0
                  		THEN (AA.DATA_TYPE||'('||AA.DATA_LEN||','||AA.DATA_SCAL||')' )
                  		ELSE (AA.DATA_TYPE||'('||AA.DATA_LEN||')')
                  		 END )
          END AS DATA_TYPE
        , CASE WHEN D.DBC_TBL_NM IS NULL THEN '물리DB 테이블 미존재'
         	   WHEN D.DBC_COL_NM IS NULL THEN '물리DB 컬럼 미존재'
         	   WHEN NVL(AA.PDM_COL_LNM,'_') != NVL(D.DBC_COL_KOR_NM,'_') THEN '컬럼한글명불일치'
         	   WHEN NVL(AA.PK_YN,'N') != NVL(D.PK_YN,'N') THEN 'PK여부불일치'
         	   WHEN RTRIM(AA.DATA_TYPE ,'2') != RTRIM(D.DATA_TYPE ,'2') THEN '데이터타입불일치'
         	   WHEN NVL(AA.DATA_LEN,0) != NVL(D.DATA_LEN,0) THEN '데이터길이불일치'
         	   WHEN NVL(AA.DATA_SCAL,0) != NVL(D.DATA_PNT,0) THEN '소수점불일치'
         	   WHEN AA.COL_ORD != D.ORD THEN '컬럼순서불일치'
         	   WHEN NVL(AA.NONUL_YN ,'N') != (CASE WHEN D.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) THEN 'NOT NULL여부불일치'
         	   WHEN NVL(AA.DEFLT_VAL ,'_') != NVL(D.DEFLT_VAL,'_') THEN 'DEFAULT불일치'
      	  END AS DETAIL_STATUS
   	 FROM WAM_PDM_TBL A
    INNER JOIN WAM_PDM_COL AA
       ON A.PDM_TBL_ID = AA.PDM_TBL_ID
    INNER JOIN WAM_DDL_TBL C
       ON A.PDM_TBL_ID = C.PDM_TBL_ID 
     LEFT OUTER JOIN WAA_DB_SCH E
       ON C.DB_SCH_ID = E.DB_SCH_ID 
      AND E.REG_TYP_CD IN ('C','U')
      AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
     LEFT OUTER JOIN
      (
          SELECT B.DBC_TBL_NM, B.DBC_TBL_KOR_NM, B.DB_SCH_ID, BB.DBC_COL_NM
               , BB.DBC_COL_KOR_NM, BB.PK_YN, BB.DATA_TYPE, BB.DATA_LEN 
               , BB.DATA_PNT, BB.ORD, BB.NULL_YN, BB.DEFLT_VAL 
            FROM WAT_DBC_TBL B
           INNER JOIN WAT_DBC_COL BB
              ON B.DB_SCH_ID = BB.DB_SCH_ID 
             AND B.DBC_TBL_NM = BB.DBC_TBL_NM 
       )  D 
       ON D.DBC_TBL_NM = A.PDM_TBL_PNM 
      AND D.DB_SCH_ID = C.DB_SCH_ID 
      AND AA.PDM_COL_PNM = D.DBC_COL_NM
	WHERE 1=1
	<if test="dbSchId != null and dbSchId != ''" >
	  AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
) AA
      
</select>

<select id="selectGovStructResultList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT ITEM_NM, TBL_CNT, ERR_CNT
		, FORMAT(GAP_RATE, '3') AS GAP_RATE
		, FORMAT(100-GAP_RATE, '3') AS STND_RATE
		, DATE_FORMAT(NOW(), '%Y-%m-%d') AS RESULT_DATE
	FROM 
	(
		SELECT '개별DB기준 테이블 현행화' AS ITEM_NM, TBL_CNT, ERR_CNT
				,CASE WHEN TBL_CNT != 0 THEN (ERR_CNT/TBL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS TBL_CNT
						,COUNT(CASE WHEN B.TBL_PNM IS NULL THEN 1 END) AS ERR_CNT
				  FROM WAT_DBC_TBL A
				  LEFT OUTER JOIN WAA_DB_SCH D
				    ON A.DB_SCH_ID = D.DB_SCH_ID 
			       AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				  LEFT OUTER JOIN GOV_TBL B
				    ON A.DBC_TBL_NM = B.TBL_PNM 
				 WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		)
		
		UNION ALL 
		SELECT '개별DB기준 컬럼 현행화' AS ITEM_NM, COL_CNT, ERR_CNT
				,CASE WHEN COL_CNT !=0 THEN (ERR_CNT/COL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS COL_CNT
						,COUNT(CASE WHEN D.TBL_PNM IS NULL THEN 1 END) AS ERR_CNT
				FROM WAT_DBC_TBL A
			    LEFT OUTER JOIN WAA_DB_SCH E
			      ON A.DB_SCH_ID = E.DB_SCH_ID
				 AND E.REG_TYP_CD IN ('C','U')
				 AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
			   INNER JOIN WAT_DBC_COL AA
			      ON A.DB_SCH_ID = AA.DB_SCH_ID 
				 AND A.DBC_TBL_NM = AA.DBC_TBL_NM 
				LEFT OUTER JOIN 
				(
					SELECT B.TBL_PNM, B.TBL_LNM, B.COL_PNM, COL_LNM, 
						   DATA_TYPE, DATA_LEN, SCAL, NULL_YN
					  FROM GOV_TBL B
				) D
				ON A.DBC_TBL_NM = D.TBL_PNM
				 AND D.COL_PNM = AA.DBC_COL_NM 
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		)
		
		UNION ALL 
		
		SELECT '테이블정의서 기준  테이블 현행화' AS ITEM_NM, TBL_CNT, ERR_CNT
				,CASE WHEN TBL_CNT != 0 THEN (ERR_CNT/TBL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS TBL_CNT
						,COUNT(CASE WHEN B.DBC_TBL_NM IS NULL THEN 1 END) AS ERR_CNT
				FROM GOV_TBL A
				LEFT OUTER JOIN WAM_DDL_TBL C
				  ON C.PDM_TBL_ID = A.TBL_ID
				LEFT OUTER JOIN WAA_DB_SCH D
				  ON D.DB_SCH_ID = C.DB_SCH_ID
				 AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				LEFT OUTER JOIN WAT_DBC_TBL B
				  ON B.DBC_TBL_NM = A.TBL_PNM
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND D.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		)
		
		UNION ALL 
		SELECT '컬럼정의서 기준 컬럼 현행화' AS ITEM_NM, COL_CNT, ERR_CNT
				,CASE WHEN COL_CNT !=0 THEN (ERR_CNT/COL_CNT*100) ELSE 0 END AS GAP_RATE
		FROM (
				SELECT COUNT(*) AS COL_CNT
						,COUNT(CASE WHEN D.DBC_COL_NM IS NULL THEN 1 END) AS ERR_CNT
				  FROM GOV_TBL A
				 INNER JOIN WAM_DDL_TBL C
				    ON A.TBL_ID = C.PDM_TBL_ID 
				  LEFT OUTER JOIN WAA_DB_SCH E
				    ON C.DB_SCH_ID = E.DB_SCH_ID
				   AND E.REG_TYP_CD IN ('C','U')
				   AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
				  LEFT OUTER JOIN 
				  (
					SELECT B.DBC_TBL_NM, B.DBC_TBL_KOR_NM, B.DB_SCH_ID, BB.DBC_COL_NM
						 , BB.DBC_COL_KOR_NM, BB.PK_YN, BB.DATA_TYPE, BB.DATA_LEN
						 , BB.DATA_PNT, BB.ORD, BB.NULL_YN, BB.DEFLT_VAL
					  FROM WAT_DBC_TBL B
					 INNER JOIN WAT_DBC_COL BB
				    	ON B.DB_SCH_ID = BB.DB_SCH_ID 
				       AND B.DBC_TBL_NM = BB.DBC_TBL_NM 
				  ) D
				   ON D.DBC_TBL_NM = A.TBL_PNM
				  AND D.DBC_TBL_KOR_NM = A.TBL_LNM
				  AND C.DB_SCH_ID = D.DB_SCH_ID 
				  AND A.COL_PNM = D.DBC_COL_NM 
				WHERE 1=1
				<if test="dbSchId != null and dbSchId != ''" >
					AND E.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
				</if>
		)
		
	)  AA
</select>

<select id="selectGovDbcTblList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT TBL_NM
		 , CASE WHEN DETAIL_STATUS IS NULL THEN '일치' ELSE '불일치' END AS STATE
		 , DETAIL_STATUS
	  FROM (
	  		SELECT D.DB_SCH_PNM||'.'||A.DBC_TBL_NM AS TBL_NM
	  		     , CASE WHEN B.TBL_ID IS NULL THEN '개별모델 미존재' END AS DETAIL_STATUS
	  		  FROM WAT_DBC_TBL A
	  		  LEFT OUTER JOIN WAA_DB_SCH D
	  		    ON A.DB_SCH_ID = D.DB_SCH_ID
	  		   AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	  		  LEFT OUTER JOIN GOV_TBL B
	  		    ON A.DBC_TBL_NM = B.TBL_PNM
	  		 WHERE 1=1
	  		 <if test="dbSchId != null and dbSchId != ''" >
			   AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			 </if>
	  		) AA
	 ORDER BY TBL_NM
</select>

<select id="selectGovDbcColList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT TBL_NM, COL_NM, DATA_TYPE
	     , CASE WHEN DETAIL_STATUS IS NULL THEN '일치' ELSE '불일치' END AS STATE
	     , DETAIL_STATUS
	  FROM (
	  		SELECT E.DB_SCH_PNM||'.'||A.DBC_TBL_NM AS TBL_NM
	  			 , AA.DBC_COL_NM AS COL_NM
	  			 , CASE WHEN AA.DATA_LEN IS NULL THEN AA.DATA_TYPE ELSE (
	  			 						CASE WHEN AA.DATA_PNT IS NOT NULL AND AA.DATA_PNT != 0
	  			 							THEN (AA.DATA_TYPE||'('||AA.DATA_LEN||','||AA.DATA_PNT||')')
	  			 							ELSE (AA.DATA_TYPE||'('||AA.DATA_LEN||')')
	  			 							END )
	  			   END AS DATA_TYPE
	  			 , CASE WHEN D.TBL_PNM IS NULL THEN '물리모델 미존재'
	  			 		WHEN D.COL_PNM IS NULL THEN '물리모델 컬럼 미존재'
	  			 		WHEN NVL(D.COL_LNM,'_') != NVL(AA.DBC_COL_KOR_NM,'_') THEN '컬럼한글명불일치'
	  			 		WHEN NVL(D.PK_YN,'N') != NVL(AA.PK_YN,'N') THEN 'PK여부불일치'
	  			 		WHEN RTRIM(D.DATA_TYPE,'2') != RTRIM(AA.DATA_TYPE,'2') THEN '데이터타입불일치'
	  			 		WHEN NVL(D.DATA_LEN,0) != NVL(AA.DATA_LEN,0) THEN '데이터길이불일치'
	  			 		WHEN NVL(D.SCAL,0) != NVL(AA.DATA_PNT,0) THEN '소수점불일치'
	  			 		WHEN D.COL_ORD != AA.ORD THEN '컬럼순서불일치'
	  			 		WHEN NVL(D.NULL_YN,'N') != (CASE WHEN AA.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) THEN 'NOT NULL여부불일치'
	  			   END AS DETAIL_STATUS
	  		  FROM WAT_DBC_TBL A
	  		  LEFT OUTER JOIN WAA_DB_SCH E
	  		    ON A.DB_SCH_ID = E.DB_SCH_ID
	  		   AND E.REG_TYP_CD IN('C','U')
	  		   AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	  		 INNER JOIN WAT_DBC_COL AA
	  		    ON A.DB_SCH_ID = AA.DB_SCH_ID
	  		   AND A.DBC_TBL_NM = AA.DBC_TBL_NM
	  		  LEFT OUTER JOIN
	  		  ( SELECT TBL_PNM, TBL_LNM
	  		  		 , COL_PNM, COL_LNM, PK_YN
	  		  		 , DATA_TYPE, DATA_LEN, SCAL
	  		  		 , NULL_YN, COL_ORD
	  		  	  FROM GOV_TBL B
	  		   ) D
	  		    ON A.DBC_TBL_NM = D.TBL_PNM
	  		   AND D.COL_PNM = AA.DBC_COL_NM
			 WHERE 1=1
			 <if test="dbSchId != null and dbSchId != ''" >
			   AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			 </if>
	 		) AA
</select>

<select id="selectGovTblList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT TBL_NM
	     , CASE WHEN DETAIL_STATUS IS NULL THEN '일치' ELSE '불일치' END AS STATE
	     , DETAIL_STATUS
	  FROM (
	  		SELECT D.DB_SCH_PNM||'.'||A.TBL_PNM AS TBL_NM
	  			 , CASE WHEN B.DBC_TBL_NM IS NULL THEN '물리DB에 미존재' END AS DETAIL_STATUS
	  		  FROM GOV_TBL A
	  		 INNER JOIN WAM_DDL_TBL C
	  		    ON C.PDM_TBL_ID = A.TBL_ID
	  		  LEFT OUTER JOIN WAA_DB_SCH D
	  		    ON D.DB_SCH_ID = C.DB_SCH_ID
	  		   AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	  		  LEFT OUTER JOIN WAT_DBC_TBL B
	  		    ON B.DBC_TBL_NM = A.TBL_PNM
	  		 WHERE 1=1
	  		 <if test="dbSchId != null and dbSchId != ''" >
			   AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			 </if>
	       ) AA
	  ORDER BY TBL_NM
</select>

<select id="selectGovColList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
SELECT TBL_NM, COL_NM, DATA_TYPE, DETAIL_STATUS
      ,CASE WHEN DETAIL_STATUS IS NULL THEN '일치' ELSE '불일치' END AS STATE
FROM (
   SELECT E.DB_SCH_PNM||'.'||A.TBL_PNM AS TBL_NM
        , A.COL_PNM AS COL_NM
        , CASE WHEN A.DATA_LEN IS NULL THEN A.DATA_TYPE
          				ELSE (CASE WHEN A.SCAL IS NOT NULL AND A.SCAL!=0
                  		THEN (A.DATA_TYPE||'('||A.DATA_LEN||','||A.SCAL||')' )
                  		ELSE (A.DATA_TYPE||'('||A.DATA_LEN||')')
                  		 END )
          END AS DATA_TYPE
        , CASE WHEN D.DBC_TBL_NM IS NULL THEN '물리DB 테이블 미존재'
         	   WHEN D.DBC_COL_NM IS NULL THEN '물리DB 컬럼 미존재'
         	   WHEN NVL(A.COL_LNM,'_') != NVL(D.DBC_COL_KOR_NM,'_') THEN '컬럼한글명불일치'
         	   WHEN NVL(A.PK_YN,'N') != NVL(D.PK_YN,'N') THEN 'PK여부불일치'
         	   WHEN RTRIM(A.DATA_TYPE ,'2') != RTRIM(D.DATA_TYPE ,'2') THEN '데이터타입불일치'
         	   WHEN NVL(A.DATA_LEN,0) != NVL(D.DATA_LEN,0) THEN '데이터길이불일치'
         	   WHEN NVL(A.SCAL,0) != NVL(D.DATA_PNT,0) THEN '소수점불일치'
         	   WHEN A.COL_ORD != D.ORD THEN '컬럼순서불일치'
         	   WHEN NVL(A.NULL_YN ,'N') != (CASE WHEN D.NULL_YN = 'Y' THEN 'N' ELSE 'Y' END) THEN 'NOT NULL여부불일치'
      	  END AS DETAIL_STATUS
   	 FROM GOV_TBL A
    INNER JOIN WAM_DDL_TBL C
       ON A.TBL_ID = C.PDM_TBL_ID 
     LEFT OUTER JOIN WAA_DB_SCH E
       ON C.DB_SCH_ID = E.DB_SCH_ID 
      AND E.REG_TYP_CD IN ('C','U')
      AND E.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
     LEFT OUTER JOIN
      (
          SELECT B.DBC_TBL_NM, B.DBC_TBL_KOR_NM, B.DB_SCH_ID, BB.DBC_COL_NM
               , BB.DBC_COL_KOR_NM, BB.PK_YN, BB.DATA_TYPE, BB.DATA_LEN 
               , BB.DATA_PNT, BB.ORD, BB.NULL_YN, BB.DEFLT_VAL 
            FROM WAT_DBC_TBL B
           INNER JOIN WAT_DBC_COL BB
              ON B.DB_SCH_ID = BB.DB_SCH_ID 
             AND B.DBC_TBL_NM = BB.DBC_TBL_NM 
       )  D 
       ON D.DBC_TBL_NM = A.TBL_PNM 
      AND D.DB_SCH_ID = C.DB_SCH_ID 
      AND A.COL_PNM = D.DBC_COL_NM
	WHERE 1=1
	<if test="dbSchId != null and dbSchId != ''" >
	  AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
	) AA
      
</select>

<select id="selectTblDdList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT DB_SCH_PNM
		 , PDM_TBL_PNM 
		 , PDM_TBL_LNM
		 , COL_CNT
		 , ERR_CNT
		 , FORMAT((ERR_CNT/COL_CNT)*100,'2') AS GAP_RATE
	  FROM ( SELECT D.DB_SCH_PNM AS DB_SCH_PNM
			 	  , A.PDM_TBL_PNM AS PDM_TBL_PNM
			 	  , A.PDM_TBL_LNM AS PDM_TBL_LNM
			 	  , COUNT(B.PDM_COL_ID) AS COL_CNT
			 	  , SUM(CASE WHEN E.SDITM_PNM IS NULL THEN 1 ELSE 0 END) AS ERR_CNT
			   FROM WAM_PDM_TBL A
		 	  INNER JOIN WAM_PDM_COL B 
		    	 ON A.PDM_TBL_ID =B.PDM_TBL_ID 
	      	   LEFT OUTER JOIN WAA_SUBJ_DB_SCH_MAP C 
	        	 ON A.SUBJ_ID = C.SUBJ_ID 
	       	 	AND C.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d') 
	      	   LEFT OUTER JOIN WAA_DB_SCH D 
	        	 ON C.DB_SCH_ID = D.DB_SCH_ID 
	       	 	AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	      	   LEFT JOIN WAM_SDITM E 
	        	 ON E.SDITM_PNM = B.PDM_COL_PNM 
	       	 	AND E.REG_TYP_CD IN ('U', 'C')
	     	  WHERE 1=1
	     	  <if test="dbSchId != null and dbSchId != ''" >
			    AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			  </if>
		 	  GROUP BY D.DB_SCH_PNM, A.PDM_TBL_PNM, A.PDM_TBL_LNM
			) AA
</select>

<select id="selectColDdList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
SELECT D.DB_SCH_PNM
		 , A.PDM_TBL_PNM
		 , B.PDM_COL_PNM
		 , B.PDM_COL_LNM
		 , B.DATA_TYPE
		 , B.DATA_LEN
		 , B.DATA_SCAL
		 , B.PK_YN
		 , B.PK_ORD
		 , B.NONUL_YN
		 , CASE WHEN H.SDITM_PNM IS NULL THEN '표준용어에 등록되지 않은 영문 약어명으로 컬럼명을 정의하였습니다. 표준을 위배합니다.' 
		 		WHEN B.DATA_TYPE != H.DATA_TYPE THEN '표준용어에 등록되어 있는 영문 약어명으로 컬럼명을 정의하였지만,  데이터 타입이 일치하지 않습니다. 표준을 위배합니다.'
		 		WHEN B.DATA_LEN != H.DATA_LEN THEN '표준용어에 등록되어 있는 영문 약어명으로 컬럼명을 정의하였지만,  데이터 타입의 전체 길이가 일치하지 않습니다. 표준을 위배합니다.'
		 		WHEN NVL(B.DATA_SCAL,0) != NVL(H.DATA_SCAL,0) THEN '표준용어에 등록되어 있는 영문 약어명으로 컬럼명을 정의하였지만,  데이터 타입의 소수점 길이가 일치하지 않습니다. 표준을 위배합니다.'
		 		ELSE '표준용어에 등록되어 있는 영문 약어명으로 컬럼명을 정의하였고, 데이터 타입도 도메인 정보와 일치합니다. 표준을 준수합니다.' END AS DETAIL_STATUS
	 FROM WAM_PDM_TBL A
    INNER JOIN WAM_PDM_COL B 
       ON A.PDM_TBL_ID =B.PDM_TBL_ID 
	 LEFT OUTER JOIN WAA_SUBJ_DB_SCH_MAP C 
	   ON A.SUBJ_ID = C.SUBJ_ID 
	  AND C.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d') 
	 LEFT OUTER JOIN WAA_DB_SCH D 
	   ON C.DB_SCH_ID = D.DB_SCH_ID 
	  AND D.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	 LEFT JOIN (
	 			SELECT E.SDITM_PNM, E.REG_TYP_CD, G.DATA_TYPE, G.DATA_LEN, G.DATA_SCAL
	 			  FROM WAM_SDITM E
	 			   LEFT JOIN WAM_DMN F ON E.DMN_ID = F.DMN_ID AND F.REG_TYP_CD IN ('C', 'U')
	 			   LEFT JOIN WAA_INFO_TYPE G ON F.INFOTP_ID = G.INFOTP_ID AND G.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	 			) H
	   ON H.SDITM_PNM = B.PDM_COL_PNM AND H.REG_TYP_CD IN ('C', 'U')

    WHERE 1=1
	<if test="dbSchId != null and dbSchId != ''" >
	  AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
    GROUP BY D.DB_SCH_PNM, A.PDM_TBL_PNM, B.PDM_COL_PNM, B.PDM_COL_LNM, B.DATA_TYPE, B.DATA_LEN, B.DATA_SCAL, B.PK_YN, B.PK_ORD, B.NONUL_YN, H.SDITM_PNM, H.DATA_TYPE, H.DATA_LEN, H.DATA_SCAL 
</select>

<select id="selectGovTblDdList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
	SELECT DB_SCH_PNM
		 , PDM_TBL_PNM 
		 , PDM_TBL_LNM
		 , COL_CNT
		 , ERR_CNT
		 , FORMAT((ERR_CNT/COL_CNT)*100,'2') AS GAP_RATE
	  FROM ( SELECT B.DB_SCH_PNM AS DB_SCH_PNM
			 	  , A.TBL_PNM AS PDM_TBL_PNM
			 	  , A.TBL_LNM AS PDM_TBL_LNM
			 	  , COUNT(A.COL_ID) AS COL_CNT
			 	  , SUM(CASE WHEN C.SDITM_PNM IS NULL THEN 1 ELSE 0 END) AS ERR_CNT
			   FROM GOV_TBL A
	      	   LEFT OUTER JOIN WAA_DB_SCH B
	        	 ON A.DB_SCH_ID = B.DB_SCH_ID 
	       	 	AND B.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	      	   LEFT JOIN GOV_SDITM C
	        	 ON C.SDITM_PNM = A.COL_PNM 
	     	  WHERE 1=1
	     	  <if test="dbSchId != null and dbSchId != ''" >
			    AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			  </if>
		 	  GROUP BY B.DB_SCH_PNM, A.TBL_PNM, A.TBL_LNM
			) AA
</select>

<select id="selectGovColDdList" resultMap="BaseResultMap" parameterType="kr.wise.meta.result.service.MtResultVO">
SELECT B.DB_SCH_PNM
		 , A.TBL_PNM AS PDM_TBL_PNM
		 , A.COL_PNM AS PDM_COL_PNM
		 , A.COL_LNM AS PDM_COL_LNM
		 , D.DATA_TYPE AS DATA_TYPE
		 , D.DATA_LEN AS DATA_LEN
		 , D.DATA_SCAL AS DATA_SCAL
		 , A.PK_YN AS PK_YN
		 , A.PK_ORD AS PK_ORD
		 , A.NULL_YN AS NONUL_YN
		 , CASE WHEN D.SDITM_PNM IS NULL THEN '표준용어에 등록되지 않은 영문 약어명으로 컬럼명을 정의하였습니다. 표준을 위배합니다.' 
		 		WHEN A.DATA_TYPE != D.DATA_TYPE THEN '표준용어에 등록되어 있는 영문 약어명으로 컬럼명을 정의하였지만,  데이터 타입이 일치하지 않습니다. 표준을 위배합니다.'
		 		WHEN A.DATA_LEN != D.DATA_LEN THEN '표준용어에 등록되어 있는 영문 약어명으로 컬럼명을 정의하였지만,  데이터 타입의 전체 길이가 일치하지 않습니다. 표준을 위배합니다.'
		 		WHEN NVL(A.SCAL,0) != NVL(D.DATA_SCAL,0) THEN '표준용어에 등록되어 있는 영문 약어명으로 컬럼명을 정의하였지만,  데이터 타입의 소수점 길이가 일치하지 않습니다. 표준을 위배합니다.'
		 		ELSE '표준용어에 등록되어 있는 영문 약어명으로 컬럼명을 정의하였고, 데이터 타입도 도메인 정보와 일치합니다. 표준을 준수합니다.' END AS DETAIL_STATUS
	 FROM GOV_TBL A
	 LEFT OUTER JOIN WAA_DB_SCH B
	   ON A.DB_SCH_ID = B.DB_SCH_ID 
	  AND B.EXP_DTM = STR_TO_DATE( '9999-12-31', '%Y-%m-%d')
	 LEFT JOIN (
	 			SELECT C.SDITM_PNM, C.DATA_TYPE, C.DATA_LEN, C.DATA_SCAL
	 			  FROM GOV_SDITM C
	 			) D
	   ON A.COL_PNM = D.SDITM_PNM

    WHERE 1=1
	<if test="dbSchId != null and dbSchId != ''" >
	  AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	</if>
    GROUP BY B.DB_SCH_PNM, A.TBL_PNM, A.COL_PNM, A.COL_LNM, D.DATA_TYPE, D.DATA_LEN, D.DATA_SCAL, A.PK_YN, A.PK_ORD, A.NULL_YN, D.SDITM_PNM, A.DATA_TYPE, A.DATA_LEN, A.SCAL
</select>
</mapper>