<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.meta.symn.service.StructureMapper">
<resultMap id="BaseResultMap" type="kr.wise.meta.symn.service.StructureVO">
	<id column="SRC_DMN_ID" property="dmnId" jdbcType="VARCHAR" />
    <result column="SRC_DMN_KNM" property="dmnLnm" jdbcType="VARCHAR" />
    <result column="SRC_DMN_ENM" property="dmnPnm" jdbcType="VARCHAR" />
    <result column="SRC_DMN_DSCD" property="dmnOrgDs" jdbcType="VARCHAR" />
    <result column="OF_DMNGRP" property="dmngId" jdbcType="VARCHAR" />
    <result column="OF_INFOTYPE" property="infotpId" jdbcType="VARCHAR" />
    <result column="TGT_DMN_ID" property="tgtDmnId" jdbcType="VARCHAR" />
    <result column="TGT_DMN_KNM" property="tgtDmnLnm" jdbcType="VARCHAR" />
    <result column="TGT_DMN_ENM" property="tgtDmnPnm" jdbcType="VARCHAR" />
    <result column="TGT_DMN_DSCD" property="tgtDmnDscd" jdbcType="VARCHAR" />
    <result column="SRC_TRM_CNT" property="srcTrmCnt" jdbcType="VARCHAR" />
    <result column="TGT_TRM_CNT" property="tgtTrmCnt" jdbcType="VARCHAR" />
    <result column="SAM_TRM_CNT" property="samTrmCnt" jdbcType="VARCHAR" />
    <result column="SRC_SAME_RT" property="srcSameRt" jdbcType="VARCHAR" />
    <result column="TGT_SAME_RT" property="tgtSameRt" jdbcType="VARCHAR" />
    <result column="SRC_SAME_ORDER" property="srcSameOrder" jdbcType="VARCHAR" />
    <result column="TGT_SAME_ORDER" property="tgtSameOrder" jdbcType="VARCHAR" />
    
    <result column="SRC_TRM_KNM" property="srcTrmKnm" 	jdbcType="VARCHAR" />
    <result column="SRC_TRM_ENM" property="srcTrmEnm" 	jdbcType="VARCHAR" />
    <result column="TGT_TRM_KNM" property="tgtTrmKnm" 	jdbcType="VARCHAR" />
    <result column="TGT_TRM_ENM" property="tgtTrmEnm" 	jdbcType="VARCHAR" />
    
    <result column="SRC_ITEM_ID" property="srcItemId" 	jdbcType="VARCHAR" />
    <result column="SRC_ITEM_KNM" property="srcItemKnm" jdbcType="VARCHAR" />
    <result column="SRC_ITEM_ENM" property="srcItemEnm" jdbcType="VARCHAR" />
    <result column="DOMAIN_KNM" property="domainKnm" 	jdbcType="VARCHAR" />
    <result column="DMNGRP_NM" property="dmngrpNm" 		jdbcType="VARCHAR" />
    <result column="INFOTYPE_NM" property="infotypeNm" 	jdbcType="VARCHAR" />
    <result column="TGT_ITEM_ID" property="tgtItemId" 	jdbcType="VARCHAR" />
    <result column="TGT_ITEM_KNM" property="tgtItemKnm" jdbcType="VARCHAR" />
    <result column="TGT_ITEM_ENM" property="tgtItemEnm" jdbcType="VARCHAR" />
    
    <result column="SRC_OBJ_ID" property="srcObjId" jdbcType="VARCHAR" />
    <result column="SRC_DATAMODEL_NM" property="srcDatemodelNm" jdbcType="VARCHAR" />
    <result column="SRC_PRIMARY_SUBJ_NM" property="srcPrimarySubjNm" jdbcType="VARCHAR" />
    <result column="SRC_SUBJ_NM" property="srcSubjNm" jdbcType="VARCHAR" />
    <result column="SRC_TBL_KNM" property="srcTblKnm" jdbcType="VARCHAR" />
    <result column="SRC_TBL_ENM" property="srcTblEnm" jdbcType="VARCHAR" />
    <result column="SRC_COL_CNT" property="srcColCnt" jdbcType="VARCHAR" />
    <result column="TGT_OBJ_ID" property="tgtObjId" jdbcType="VARCHAR" />
    <result column="TGT_DATAMODEL_NM" property="tgtDatemodelNm" jdbcType="VARCHAR" />
    <result column="TGT_PRIMARY_SUBJ_NM" property="tgtPrimarySubjNm" jdbcType="VARCHAR" />
    <result column="TGT_SUBJ_NM" property="tgtSubjNm" jdbcType="VARCHAR" />
    <result column="TGT_TBL_KNM" property="tgtTblKnm" jdbcType="VARCHAR" />
    <result column="TGT_TBL_ENM" property="tgtTblEnm" jdbcType="VARCHAR" />
    <result column="TGT_COL_CNT" property="tgtColCnt" jdbcType="VARCHAR" />
    <result column="SAME_COL_CNT" property="sameColCnt" jdbcType="VARCHAR" />
    
    <result column="SRC_COL_KNM" property="srcColKnm" jdbcType="VARCHAR" />
    <result column="SRC_COL_ENM" property="srcColEnm" jdbcType="VARCHAR" />
    <result column="SRC_POSITION" property="srcPosition" jdbcType="VARCHAR" />
    <result column="SRC_PK_YN" property="srcPkYn" jdbcType="VARCHAR" />
    <result column="SRC_NULL_YN" property="srcNullYn" jdbcType="VARCHAR" />
    <result column="SRC_DATA_TYPE" property="srcDataType" jdbcType="VARCHAR" />
    <result column="TGT_COL_KNM" property="tgtColKnm" jdbcType="VARCHAR" />
    <result column="TGT_COL_ENM" property="tgtColEnm" jdbcType="VARCHAR" />
    <result column="TGT_POSITION" property="tgtPosition" jdbcType="VARCHAR" />
    <result column="TGT_PK_YN" property="tgtPkYn" jdbcType="VARCHAR" />
    <result column="TGT_NULL_YN" property="tgtNullYn" jdbcType="VARCHAR" />
    <result column="TGT_DATA_TYPE" property="tgtDataType" jdbcType="VARCHAR" />
    <result column="SRC_TBL_ID" property="srcTblId" jdbcType="VARCHAR" />
    <result column="SRC_COL_ID" property="srcColId" jdbcType="VARCHAR" />
    <result column="TGT_TBL_ID" property="tgtTblId" jdbcType="VARCHAR" />
    <result column="TGT_COL_ID" property="tgtColId" jdbcType="VARCHAR" />
    <result column="SRC_FULL_PATH" property="fullPath" jdbcType="VARCHAR" />
    
    <result column="SRC_CD_CNT" property="srcCdCnt" jdbcType="VARCHAR" />
    <result column="TGT_CD_CNT" property="tgtCdCnt" jdbcType="VARCHAR" />
    <result column="SAM_CD_CNT" property="samCdCnt" jdbcType="VARCHAR" />
    
    <result column="SRC_CD_VAL_NM" property="srcCdValNm" jdbcType="VARCHAR" />
    <result column="SRC_CD_VAL" property="srcCdVal" jdbcType="VARCHAR" />
    <result column="SRC_CD_VAL_ID" property="srcCdValId" jdbcType="VARCHAR" />
    <result column="TGT_CD_VAL_NM" property="tgtCdValNm" jdbcType="VARCHAR" />
    <result column="TGT_CD_VAL"    property="tgtCdVal"   jdbcType="VARCHAR" />
    <result column="TGT_CD_VAL_ID" property="tgtCdValId" jdbcType="VARCHAR" />
    <result column="STND_ASRT"        property="stndAsrt"      jdbcType="VARCHAR" />

    <result column="SRC_FULL_PATH" property="srcFullPath" jdbcType="VARCHAR" />
    <result column="TGT_FULL_PATH" property="tgtFullPath" jdbcType="VARCHAR" />
   
</resultMap>

<select id="getDmnStructure" resultMap="BaseResultMap" parameterType="kr.wise.meta.symn.service.StructureVO">
		 SELECT /* StructureMapper.getDmnStructure */
		 		STND_ASRT
		      , SRC_DMN_ID                                                        
		      , SRC_DMN_KNM                                                       
		      , SRC_DMN_ENM                                                       
		      , SRC_DMN_DSCD                                                      
		      , OF_DMNGRP                                                         
		      , OF_INFOTYPE                                                       
		      , TGT_DMN_ID                                                        
		      , TGT_DMN_KNM                                                       
		      , TGT_DMN_ENM                                                       
		      , TGT_DMN_DSCD                                                      
		      , CONCAT(SRC_TRM_CNT,' 개') AS SRC_TRM_CNT                                 
		      , CONCAT(TGT_TRM_CNT,' 개') AS TGT_TRM_CNT                                 
		      , CONCAT(SAM_TRM_CNT,' 개') AS SAM_TRM_CNT                                 
		      , CONCAT(CASE WHEN (ROUND(SAM_TRM_CNT / SRC_TRM_CNT,2)*100) > 100 THEN 100 ELSE (ROUND(SAM_TRM_CNT / SRC_TRM_CNT,2)*100) END,' %') AS SRC_SAME_RT     
		      , CONCAT(CASE WHEN (ROUND(SAM_TRM_CNT / TGT_TRM_CNT,2)*100) > 100 THEN 100 ELSE (ROUND(SAM_TRM_CNT / TGT_TRM_CNT,2)*100) END,' %') AS TGT_SAME_RT     
		      , (ROUND(SAM_TRM_CNT / SRC_TRM_CNT,2)*100) AS SRC_SAME_ORDER     
		      , (ROUND(SAM_TRM_CNT / TGT_TRM_CNT,2)*100) AS TGT_SAME_ORDER      
		 FROM (           
		  SELECT    A.DMN_ID         AS SRC_DMN_ID                             
		          , A.DMN_LNM        AS SRC_DMN_KNM                               
		          , A.DMN_PNM        AS SRC_DMN_ENM                               
		          , A.DMN_ORG_DS     AS SRC_DMN_DSCD                              
		          , A.DMNG_ID        AS  OF_DMNGRP                                            
		          , A.INFOTP_ID      AS  OF_INFOTYPE                                          
		          , GET_DMN_TRM_CNT(A.DMN_ID) AS SRC_TRM_CNT                      
		          , C.OBJ_ID         AS TGT_DMN_ID                                
		          , D.DMN_LNM        AS TGT_DMN_KNM                               
		          , D.DMN_PNM        AS TGT_DMN_ENM                               
		          , D.DMN_ORG_DS     AS TGT_DMN_DSCD                              
		          , GET_DMN_TRM_CNT(C.OBJ_ID) AS TGT_TRM_CNT                           
		          , SUM(CASE WHEN B.OBJ_ID = C.OBJ_ID THEN 0
		                ELSE 1
		                END)         AS SAM_TRM_CNT                           
		     FROM WAM_DMN A                                                   
		     INNER JOIN WAM_STWD_CNFG B                                             
		     ON A.DMN_ID = B.OBJ_ID                                         
		     INNER JOIN WAM_STWD_CNFG C                                             
		     ON B.STWD_ID = C.STWD_ID                                             
		     INNER JOIN WAM_DMN D                                             
		     ON D.DMN_ID = C.OBJ_ID                
		     WHERE  A.REG_TYP_CD IN ('C','U')                                                                                  
		     GROUP BY A.DMN_ID                                                    
		            , A.DMN_LNM                                                   
		            , A.DMN_PNM                                                   
		            , A.DMN_ORG_DS                                                  
		            , A.DMNG_ID                                                 
		            , A.INFOTP_ID                                               
		            , C.OBJ_ID                                               
		            , D.DMN_LNM                                                   
		            , D.DMN_PNM                                                   
		            , D.DMN_ORG_DS 
		  ) TBL 
		 INNER JOIN V_WAA_DMNG D
             ON TBL.OF_DMNGRP = D.DMNG_ID
		  WHERE SAM_TRM_CNT > 0                                                    
<!-- 		     AND ( ROUND(SAM_TRM_CNT / SRC_TRM_CNT, 2) * 100 >= 50      -->
<!-- 		     AND ROUND(SAM_TRM_CNT / TGT_TRM_CNT, 2) * 100 >= 50 ) -->
			<if test="crlRt != null" >
			   	AND ( ROUND(SAM_TRM_CNT / SRC_TRM_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR}     
		       	AND ROUND(SAM_TRM_CNT / TGT_TRM_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR} )
			</if>
			<if test="dmnLnm != null and dmnLnm != '' ">
				AND (    CONCAT(SRC_DMN_KNM LIKE '%' , #{dmnLnm,jdbcType=VARCHAR} , '%')
					  OR CONCAT(SRC_DMN_KNM LIKE '%' , UPPER( #{dmnLnm,jdbcType=VARCHAR} ) , '%') )
			</if>
			<if test="dmngId != null and dmngId != '' ">
		        AND D.DMNG_ID = #{dmngId,jdbcType=VARCHAR}
		    </if>
			<if test="uppDmngId != null and uppDmngId != '' ">
		        AND D.UPP_DMNG_ID = #{uppDmngId,jdbcType=VARCHAR}
		    </if>
		    <if test="infotpId != null and infotpId != ''" >
		        AND OF_INFOTYPE = #{infotpId,jdbcType=VARCHAR}
		    </if>
		    <if test="stndAsrt != null and stndAsrt != ''" >
		    	AND STND_ASRT =  #{stndAsrt,jdbcType=VARCHAR}
		    </if>
		  ORDER BY SRC_DMN_KNM, SRC_SAME_ORDER desc, TGT_SAME_ORDER desc, TGT_DMN_KNM

</select> 

<select id="getItmStructure" resultMap="BaseResultMap" parameterType="kr.wise.meta.symn.service.StructureVO">
				/* StructureMapper.getItmStructure */
		SELECT STND_ASRT
			 , SRC_ITEM_ID                                                                                                    
		     , SRC_ITEM_KNM                                                                                              
		     , SRC_ITEM_ENM                                                                                                
		     , DOMAIN_KNM                                                                                                   
		     , DMNGRP_NM                                                                                                 
		     , INFOTYPE_NM                                                                                                 
		     , TGT_ITEM_ID                                                                                                 
		     , TGT_ITEM_KNM                                                                                                   
		     , TGT_ITEM_ENM
		     , CONCAT(SRC_TERM_CNT,' 개') AS SRC_TRM_CNT                                                                             
		     , CONCAT(TGT_TERM_CNT,' 개') AS TGT_TRM_CNT                                                                             
		     , CONCAT(SAM_TERM_CNT,' 개') AS SAM_TRM_CNT                                         
		     , CONCAT(CASE WHEN (ROUND(SAM_TERM_CNT/SRC_TERM_CNT,2)*100) > 100 THEN 100 ELSE (ROUND(SAM_TERM_CNT/SRC_TERM_CNT,2)*100) END,' %') AS SRC_SAME_RT                                                  
		     , CONCAT(CASE WHEN (ROUND(SAM_TERM_CNT/TGT_TERM_CNT,2)*100) > 100 THEN 100 ELSE (ROUND(SAM_TERM_CNT/TGT_TERM_CNT,2)*100) END,' %') AS TGT_SAME_RT                                             
		     , (ROUND(SAM_TERM_CNT/SRC_TERM_CNT,2)*100)       AS SRC_SAME_ORDER                                               
		     , (ROUND(SAM_TERM_CNT/TGT_TERM_CNT,2)*100)       AS TGT_SAME_ORDER                                               
		FROM (  
		     SELECT     A.STND_ASRT
		     			, F.DMN_LNM  
		                , A.SDITM_ID     AS SRC_ITEM_ID                                                                         
		                , A.SDITM_LNM    AS SRC_ITEM_KNM                                                                          
		                , A.SDITM_PNM    AS SRC_ITEM_ENM
		                , I.DMN_LNM       AS DOMAIN_KNM                                                                    
		                , G.DMNG_LNM      AS DMNGRP_NM
		                , H.INFOTP_LNM    AS INFOTYPE_NM
		                , C.OBJ_ID      AS TGT_ITEM_ID
		                , D.SDITM_LNM    AS TGT_ITEM_KNM                                                                          
		                , D.SDITM_PNM    AS TGT_ITEM_ENM
		               	, GET_ITEM_TRM_CNT(A.SDITM_ID)  AS SRC_TERM_CNT                                                                
		         		, GET_ITEM_TRM_CNT(C.OBJ_ID) AS TGT_TERM_CNT                                                               
		         		, SUM(CASE WHEN B.OBJ_ID = C.OBJ_ID THEN 0                                                                 
		               		ELSE 1
		               		END ) AS SAM_TERM_CNT  
		       FROM     WAM_SDITM A                                                                                           
		    INNER JOIN  WAM_STWD_CNFG B                                                                                 
		    ON    A.SDITM_ID = B.OBJ_ID
		    LEFT OUTER JOIN WAM_DMN E
		    ON    B.OBJ_ID = E.DMN_ID
		    INNER JOIN WAM_STWD_CNFG C                                                                                
		    ON    B.STWD_ID = C.STWD_ID 
		    LEFT OUTER JOIN WAM_DMN F
		    ON    C.OBJ_ID = F.DMN_ID 
		    INNER JOIN WAM_SDITM D                                                                                     
		    ON    D.SDITM_ID = C.OBJ_ID                                                                                       
		    AND   A.DMN_ID = D.DMN_ID
		    LEFT OUTER JOIN WAA_DMNG G
		    ON  A.DMNG_ID = G.DMNG_ID
		    LEFT OUTER JOIN WAA_INFO_TYPE H
		    ON   A.INFOTP_ID = H.INFOTP_ID
		    LEFT OUTER JOIN WAM_DMN I
		    ON   A.DMN_ID = I.DMN_ID
		    WHERE A.REG_TYP_CD IN ('C','U')    
		    <if test="stndAsrt != null and stndAsrt != '' ">
			  AND A.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}
			</if>
		    <if test="srcItemKnm != null and srcItemKnm != '' ">
		      AND (  A.SDITM_LNM LIKE CONCAT('%' , #{srcItemKnm,jdbcType=VARCHAR} , '%')
				  OR A.SDITM_LNM LIKE CONCAT('%' , UPPER( #{srcItemKnm,jdbcType=VARCHAR} ) , '%') )
		    </if>
		    <if test="dmnLnm != null and dmnLnm != '' ">
		      AND (  I.DMN_LNM LIKE CONCAT('%' , #{dmnLnm,jdbcType=VARCHAR} , '%')
				  OR I.DMN_LNM LIKE CONCAT('%' , UPPER( #{dmnLnm,jdbcType=VARCHAR} ) , '%') )
		    </if>
		    GROUP BY A.SDITM_ID                                                                              
		           , A.SDITM_LNM                                                                             
		           , A.SDITM_PNM
		           , G.DMNG_LNM
		           , I.DMN_LNM                                                                                                                                                    
		           , H.INFOTP_LNM                                                                    
		           , C.OBJ_ID                                                                             
		           , D.SDITM_LNM                                                                            
		           , D.SDITM_PNM
		           , F.DMN_LNM
		  ) TBL                                                                                              
		WHERE SAM_TERM_CNT > 0
			<if test="crlRt != null" >
			   	AND ( ROUND(SAM_TERM_CNT / SRC_TERM_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR}     
		       	AND ROUND(SAM_TERM_CNT / TGT_TERM_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR} )
			</if>                                                                                                                                                                                                                                                                                                                                                                                                                      
		  ORDER BY SRC_ITEM_KNM, SRC_SAME_ORDER desc, TGT_SAME_ORDER desc, TGT_ITEM_KNM
                                                                                                                                                                                                                                                                                                                                                                                                 		 
</select>
   
   
<!-- TODO:: ORACLE SUBSTR, INSTR 수정 -->
<select id="getMdlStructure" resultMap="BaseResultMap" parameterType="kr.wise.meta.symn.service.StructureVO">
			  /* StructureMapper.getMdlStructure */	
		SELECT SRC_OBJ_ID                                                                                                                                                                
		     , SRC_DATAMODEL_NM                                                                           
		     , SRC_PRIMARY_SUBJ_NM                                                                        
		     , SRC_SUBJ_NM                                                                                
		     , SRC_TBL_KNM                                                                                
		     , SRC_TBL_ENM                                                                               
		     , CONCAT(SRC_COL_CNT  , ' 개') AS SRC_COL_CNT                                                       
		     , TGT_OBJ_ID                                                                                                                                                   
		     , TGT_DATAMODEL_NM                                                                      
		     , TGT_PRIMARY_SUBJ_NM                                                                   
		     , TGT_SUBJ_NM                                                                           
		     , TGT_TBL_KNM                                                                          
		     , TGT_TBL_ENM                                                                         
		     , CONCAT(TGT_COL_CNT  , ' 개') AS TGT_COL_CNT                                                 
		     , CONCAT(SAME_COL_CNT , ' 개') AS SAME_COL_CNT                                                
		     , CONCAT((ROUND(SAME_COL_CNT / SRC_COL_CNT, 2) * 100) , ' %') AS SRC_SAME_RT                   
		     , CONCAT((ROUND(SAME_COL_CNT / TGT_COL_CNT, 2) * 100) , ' %') AS TGT_SAME_RT                
		     , (ROUND(SAME_COL_CNT / SRC_COL_CNT, 2) * 100)AS SRC_SAME_ORDER                        
		     , (ROUND(SAME_COL_CNT / TGT_COL_CNT, 2) * 100)AS TGT_SAME_ORDER
		     , SRC_FULL_PATH
		FROM (     
		SELECT    A.PDM_TBL_ID    AS SRC_OBJ_ID
		        , SUBSTR(A.FULL_PATH ,0,INSTR(A.FULL_PATH, '>')-1 ) AS SRC_DATAMODEL_NM
		        , SUBSTR(A.FULL_PATH,INSTR(A.FULL_PATH, '>')+1,INSTR(A.FULL_PATH, '>')+1 ) AS SRC_PRIMARY_SUBJ_NM
		        , SUBSTR(A.FULL_PATH,LOCATE('>', A.FULL_PATH,INSTR(A.FULL_PATH,'>')+1)+1) AS SRC_SUBJ_NM 
		        , A.PDM_TBL_PNM  AS SRC_TBL_ENM
		        , A.PDM_TBL_LNM  AS SRC_TBL_KNM
		        , SUBSTR(D.FULL_PATH ,0,INSTR(A.FULL_PATH, '>')-1 ) AS TGT_DATAMODEL_NM
		        , SUBSTR(D.FULL_PATH,INSTR(A.FULL_PATH, '>')+1,INSTR(D.FULL_PATH, '>')+1 ) AS TGT_PRIMARY_SUBJ_NM
		        , SUBSTR(D.FULL_PATH,LOCATE('>', D.FULL_PATH,INSTR(D.FULL_PATH,'>')+1)+1) AS TGT_SUBJ_NM 
		        , D.PDM_TBL_ID   AS TGT_OBJ_ID
		        , D.PDM_TBL_PNM  AS TGT_TBL_ENM
		        , D.PDM_TBL_LNM  AS TGT_TBL_KNM
		        , GET_PDM_COL_CNT(A.PDM_TBL_ID) AS SRC_COL_CNT
		        , GET_PDM_COL_CNT(C.PDM_TBL_ID)   AS TGT_COL_CNT
		        , SUM(CASE WHEN  B.PDM_TBL_ID = C.PDM_TBL_ID  THEN  NULL ELSE 1 END) AS SAME_COL_CNT
		        , A.FULL_PATH AS SRC_FULL_PATH          
		FROM WAM_PDM_TBL A                                                                            
		INNER JOIN WAM_PDM_COL B                                                                     
		ON    A.PDM_TBL_ID = B.PDM_TBL_ID                                                                 
		INNER JOIN  WAM_PDM_COL C                                                                   
		ON    B.PDM_COL_LNM = C.PDM_COL_LNM                                                                  
		INNER  JOIN  WAM_PDM_TBL D                                                                  
		ON   C.PDM_TBL_ID = D.PDM_TBL_ID                                                                  
		WHERE  A.REG_TYP_CD IN ('C','U')                                                                                                  
		AND   B.REG_TYP_CD IN ('C','U')
		<if test="srcTblEnm != null and srcTblEnm != '' " >
			AND( (   A.PDM_TBL_LNM LIKE CONCAT('%' , #{srcTblEnm,jdbcType=VARCHAR} , '%')
				  OR A.PDM_TBL_LNM LIKE CONCAT('%' , UPPER( #{srcTblEnm,jdbcType=VARCHAR} ) , '%') )	
			   OR   (A.PDM_TBL_PNM LIKE CONCAT('%' , #{srcTblEnm,jdbcType=VARCHAR} , '%')
				  OR A.PDM_TBL_PNM LIKE CONCAT('%' , UPPER( #{srcTblEnm,jdbcType=VARCHAR} ) , '%'))
			   )	  	  	
		</if>
		<if test="colNm != null and colNm != '' ">	
			 AND (  (B.PDM_COL_PNM LIKE CONCAT('%' , #{colNm,jdbcType=VARCHAR} , '%')
				  OR B.PDM_COL_PNM LIKE CONCAT('%' , UPPER( #{colNm,jdbcType=VARCHAR} ) , '%'))
			  OR    (B.PDM_COL_LNM LIKE CONCAT('%' , #{colNm,jdbcType=VARCHAR} , '%')
				  OR B.PDM_COL_LNM LIKE CONCAT('%' , UPPER( #{colNm,jdbcType=VARCHAR} ) , '%'))
				 )	  	
		</if>
		GROUP BY  A.PDM_TBL_ID
		        , A.PDM_TBL_PNM
		        , A.PDM_TBL_LNM
		        , D.PDM_TBL_PNM
		        , D.PDM_TBL_LNM
		        , C.PDM_TBL_ID
		        , A.FULL_PATH
		        , D.FULL_PATH
		        , D.PDM_TBL_ID
		        , A.FULL_PATH
		)TBL                                                                                       
		WHERE SAME_COL_CNT > 0
		<if test="fullPath != null and fullPath != '' ">
				AND SRC_FULL_PATH LIKE CONCAT('%' , #{fullPath,jdbcType=VARCHAR} , '%')
		</if>
		<if test="crlRt != null" >
			   	AND (     ROUND(SAME_COL_CNT / SRC_COL_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR}     
		       	      AND ROUND(SAME_COL_CNT / TGT_COL_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR} 
		       	    )
		</if>   
		ORDER BY SRC_DATAMODEL_NM, SRC_PRIMARY_SUBJ_NM, SRC_SUBJ_NM, SRC_TBL_KNM, SRC_SAME_ORDER desc, TGT_SAME_ORDER desc    
			  
			  
<!-- 		SELECT 
		       A.STND_ASRT      
		     , A.PDM_TBL_ID        AS SRC_OBJ_ID   
		     , MAX(A.FULL_PATH)    AS SRC_FULL_PATH
		     , MAX(A.PDM_TBL_PNM)  AS SRC_TBL_ENM
		     , MAX(A.PDM_TBL_LNM)  AS SRC_TBL_KNM    
		     , B.PDM_TBL_ID        AS TGT_OBJ_ID
		     , MAX(B.FULL_PATH)    AS TGT_FULL_PATH
		     , MAX(B.PDM_TBL_PNM)  AS TGT_TBL_ENM
		     , MAX(B.PDM_TBL_LNM)  AS TGT_TBL_KNM
		     , MAX(A.COL_CNT)      AS SRC_COL_CNT
		     , MAX(B.COL_CNT)      AS TGT_COL_CNT
		     , CONCAT(ROUND(COUNT(CASE WHEN CONCAT(A.STND_ASRT, A.PDM_COL_LNM) = CONCAT(B.STND_ASRT,B.PDM_COL_LNM) THEN 1 END)  / MAX(A.COL_CNT) * 100 , 2) , ' %') AS SRC_SAME_RT                   
		     , CONCAT(ROUND(COUNT(CASE WHEN CONCAT(A.STND_ASRT, A.PDM_COL_LNM) = CONCAT(B.STND_ASRT,B.PDM_COL_LNM) THEN 1 END)  / MAX(B.COL_CNT) * 100 , 2) , ' %') AS TGT_SAME_RT   
		     , COUNT(CASE WHEN CONCAT(A.STND_ASRT, A.PDM_COL_LNM) = CONCAT(B.STND_ASRT,B.PDM_COL_LNM) THEN 1 END) AS SAME_COL_CNT              
		 FROM (SELECT A.STND_ASRT
		            , A.FULL_PATH
		            , A.PDM_TBL_ID  
		            , A.PDM_TBL_PNM  
		            , A.PDM_TBL_LNM
		            , B.PDM_COL_PNM
		            , B.PDM_COL_LNM
		            , COUNT(B.PDM_COL_ID) OVER(PARTITION BY A.STND_ASRT, A.PDM_TBL_ID) AS COL_CNT 
		         FROM WAM_PDM_TBL A                                                                            
		              INNER JOIN WAM_PDM_COL B                                                                     
		                 ON B.STND_ASRT     = A.STND_ASRT
		                AND B.PDM_TBL_ID = A.PDM_TBL_ID   
		              INNER JOIN WAA_SUBJ C
		                 ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
		                AND C.STND_ASRT  = A.STND_ASRT 
		                AND C.SUBJ_ID = A.SUBJ_ID
		              INNER JOIN WAA_SUBJ D
		                 ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
		                AND D.STND_ASRT  = C.STND_ASRT
		                AND D.SUBJ_ID = C.UPP_SUBJ_ID
		              INNER JOIN WAA_SYS_AREA E
		                 ON E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
		                AND E.STND_ASRT      = D.STND_ASRT
		                AND E.SYS_AREA_ID = D.SYS_AREA_ID
		      WHERE 1 = 1 
		        AND E.LECY_DCD = 'SFG'          
		        AND A.STND_ASRT  = #{stndAsrt,jdbcType=VARCHAR}
		        <if test="srcSubjLvl1 != null and srcSubjLvl1 != '' ">	
					 AND D.STND_ASRT  = #{stndAsrt,jdbcType=VARCHAR}
					 AND D.SUBJ_ID = #{srcSubjLvl1,jdbcType=VARCHAR}
				</if>  
				<if test="srcSubjLvl2 != null and srcSubjLvl2 != '' ">	
					 AND C.STND_ASRT  = #{stndAsrt,jdbcType=VARCHAR}
					 AND C.SUBJ_ID = #{srcSubjLvl2,jdbcType=VARCHAR}
				</if>  				
				<if test="srcTblEnm != null and srcTblEnm != '' ">	
					 AND A.PDM_TBL_PNM  = #{srcTblEnm,jdbcType=VARCHAR}					 
				</if>     
		      ) A
		      LEFT JOIN
		      (SELECT A.STND_ASRT
		            , A.FULL_PATH
		            , A.PDM_TBL_ID  
		            , A.PDM_TBL_PNM  
		            , A.PDM_TBL_LNM  
		            , B.PDM_COL_PNM
		            , B.PDM_COL_LNM
		            , COUNT(B.PDM_COL_ID) OVER(PARTITION BY A.STND_ASRT, A.PDM_TBL_ID) AS COL_CNT 
		         FROM WAM_PDM_TBL A                                                                            
		              INNER JOIN WAM_PDM_COL B                                                                     
		                 ON B.STND_ASRT     = A.STND_ASRT
		                AND B.PDM_TBL_ID = A.PDM_TBL_ID 
		              INNER JOIN WAA_SUBJ C
		                 ON C.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
		                AND C.STND_ASRT  = A.STND_ASRT 
		                AND C.SUBJ_ID = A.SUBJ_ID
		              INNER JOIN WAA_SUBJ D
		                 ON D.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
		                AND D.STND_ASRT  = C.STND_ASRT
		                AND D.SUBJ_ID = C.UPP_SUBJ_ID
		              INNER JOIN WAA_SYS_AREA E
		                 ON E.EXP_DTM = STR_TO_DATE('9999-12-31','%Y-%m-%d')
		                AND E.STND_ASRT      = D.STND_ASRT
		                AND E.SYS_AREA_ID = D.SYS_AREA_ID
		      WHERE 1 = 1
		        AND E.LECY_DCD = 'SFG'          
		        AND E.STND_ASRT      = #{stndAsrt,jdbcType=VARCHAR}
		        AND E.SYS_AREA_ID = #{tgtSysAreaId,jdbcType=VARCHAR} 
		        <if test="tgtSubjLvl1 != null and tgtSubjLvl1 != '' ">	
					 AND D.STND_ASRT  = #{stndAsrt,jdbcType=VARCHAR}
					 AND D.SUBJ_ID = #{tgtSubjLvl1,jdbcType=VARCHAR}
				</if>  
				<if test="tgtSubjLvl2 != null and tgtSubjLvl2 != '' ">	
					 AND C.STND_ASRT  = #{stndAsrt,jdbcType=VARCHAR}
					 AND C.SUBJ_ID = #{tgtSubjLvl2,jdbcType=VARCHAR}
				</if>  
		      ) B                   
		      ON B.STND_ASRT      = A.STND_ASRT
		     AND B.PDM_COL_LNM = A.PDM_COL_LNM 
		 WHERE 1 = 1
		   AND CONCAT(A.STND_ASRT, A.PDM_TBL_ID) != CONCAT(B.STND_ASRT,B.PDM_TBL_ID)
		   AND A.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}
		 GROUP BY A.STND_ASRT      
			    , A.PDM_TBL_ID             
			    , B.PDM_TBL_ID
		 HAVING (     COUNT(CASE WHEN CONCAT(A.STND_ASRT, A.PDM_COL_LNM) = CONCAT(B.STND_ASRT,B.PDM_COL_LNM) THEN 1 END) / MAX(A.COL_CNT) * 100 >= #{crlRt,jdbcType=VARCHAR}     
		          AND COUNT(CASE WHEN CONCAT(A.STND_ASRT, A.PDM_COL_LNM) = CONCAT(B.STND_ASRT,B.PDM_COL_LNM) THEN 1 END) / MAX(B.COL_CNT) * 100 >= #{crlRt,jdbcType=VARCHAR}     
		        )	     -->
		 
</select>

<select id="getCodeStructuer" resultMap="BaseResultMap" parameterType="kr.wise.meta.symn.service.StructureVO">
		<![CDATA[         
		SELECT DISTINCT 
		       CASE WHEN SRC_ITEM_ID < TGT_ITEM_ID THEN SRC_ITEM_ID ELSE TGT_ITEM_ID END   AS SRC_ITEM_ID
		     , CASE WHEN SRC_ITEM_ID < TGT_ITEM_ID THEN SRC_ITEM_KNM ELSE TGT_ITEM_KNM END AS SRC_ITEM_KNM
		     , CASE WHEN SRC_ITEM_ID < TGT_ITEM_ID THEN SRC_ITEM_ENM ELSE TGT_ITEM_ENM END AS SRC_ITEM_ENM
		     , CASE WHEN SRC_ITEM_ID > TGT_ITEM_ID THEN SRC_ITEM_ID ELSE TGT_ITEM_ID END   AS TGT_ITEM_ID
		     , CASE WHEN SRC_ITEM_ID > TGT_ITEM_ID THEN SRC_ITEM_KNM ELSE TGT_ITEM_KNM END AS TGT_ITEM_KNM
		     , CASE WHEN SRC_ITEM_ID > TGT_ITEM_ID THEN SRC_ITEM_ENM ELSE TGT_ITEM_ENM END AS TGT_ITEM_ENM
		     , CONCAT(CASE WHEN SRC_ITEM_ID < TGT_ITEM_ID THEN SRC_CD_CNT ELSE TGT_CD_CNT END,' 개') AS SRC_CD_CNT
		     , CONCAT(CASE WHEN SRC_ITEM_ID > TGT_ITEM_ID THEN SRC_CD_CNT ELSE TGT_CD_CNT END,' 개') AS TGT_CD_CNT
		     , CONCAT(SAM_CD_CNT,' 개') AS SAM_CD_CNT
		     , CONCAT(ROUND(SAM_CD_CNT / CASE WHEN SRC_ITEM_ID < TGT_ITEM_ID THEN SRC_CD_CNT ELSE TGT_CD_CNT END ,2)*100 ,' %') AS SRC_SAME_RT
		     , CONCAT(ROUND(SAM_CD_CNT / CASE WHEN SRC_ITEM_ID > TGT_ITEM_ID THEN SRC_CD_CNT ELSE TGT_CD_CNT END ,2)*100 ,' %') AS TGT_SAME_RT
		     , ROUND(SAM_CD_CNT / CASE WHEN SRC_ITEM_ID < TGT_ITEM_ID THEN SRC_CD_CNT ELSE TGT_CD_CNT END ,2)*100  AS SRC_SAME_ORDER
		     , ROUND(SAM_CD_CNT / CASE WHEN SRC_ITEM_ID > TGT_ITEM_ID THEN SRC_CD_CNT ELSE TGT_CD_CNT END ,2)*100  AS TGT_SAME_ORDER 
		  FROM (
		        SELECT   A.DMN_ID      AS SRC_ITEM_ID
		               , A.DMN_LNM     AS SRC_ITEM_KNM
		               , A.DMN_PNM     AS SRC_ITEM_ENM
		               , D.DMN_ID      AS TGT_ITEM_ID
		               , D.DMN_LNM     AS TGT_ITEM_KNM
		               , D.DMN_PNM     AS TGT_ITEM_ENM
		               , B.SRC_CD_CNT
		               , C.TGT_CD_CNT
		               , COUNT(1)      AS SAM_CD_CNT 
		          FROM WAM_DMN A
		         INNER JOIN 
		             (
		                SELECT   DMN_ID
		                       , REGEXP_REPLACE(CD_VAL_NM,'(\W)|_','') AS SRC_CD_VAL_NM  -- 비문자열 또는 _(언더바)를 찾아 공백으로 치환 하는 정규식
		                       , COUNT(*) OVER (PARTITION BY DMN_ID) AS SRC_CD_CNT
		                  FROM WAM_CD_VAL
		                 WHERE REG_TYP_CD IN('C','U')
		                   AND REGEXP_REPLACE(CD_VAL_NM,'(\W)|_','') IS NOT NULL
		                 GROUP BY DMN_ID, REGEXP_REPLACE(CD_VAL_NM,'(\W)|_',''), CD_VAL_NM
		             ) B
		            ON A.DMN_ID = B.DMN_ID
		           AND A.REG_TYP_CD IN('C','U')
		         INNER JOIN 
		             (
		                SELECT   DMN_ID
		                       , REGEXP_REPLACE(CD_VAL_NM,'(\W)|_','') AS TGT_CD_VAL_NM
		                       , COUNT(*) OVER (PARTITION BY DMN_ID) AS TGT_CD_CNT
		                  FROM WAM_CD_VAL
		                 WHERE REG_TYP_CD IN('C','U')
		                   AND REGEXP_REPLACE(CD_VAL_NM,'(\W)|_','') IS NOT NULL
		                 GROUP BY DMN_ID, REGEXP_REPLACE(CD_VAL_NM,'(\W)|_','')    
		             ) C
		            ON B.SRC_CD_VAL_NM = C.TGT_CD_VAL_NM
		         INNER JOIN WAM_DMN D
		            ON D.DMN_ID = C.DMN_ID
		           AND D.REG_TYP_CD IN('C','U')  
		         WHERE A.DMN_ID <> D.DMN_ID 
		         GROUP BY A.DMN_ID, A.DMN_LNM, A.DMN_PNM, D.DMN_ID, D.DMN_LNM, D.DMN_PNM, B.SRC_CD_CNT, C.TGT_CD_CNT
		            HAVING ROUND(COUNT(1) / SRC_CD_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR} 	--  /* 기준비율 */
             		AND ROUND(COUNT(1) / TGT_CD_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR}   	--  /* 기준비율 */
		        ) FSQ
		     WHERE 1=1   
		     ]]>   
		     <if test="dmnLnm != null and dmnLnm != '' ">
			  AND( ( SRC_ITEM_KNM LIKE CONCAT('%' , #{dmnLnm,jdbcType=VARCHAR} ,'%') OR SRC_ITEM_KNM LIKE CONCAT( '%' , UPPER( #{dmnLnm,jdbcType=VARCHAR}) ,'%') ) 
			     OR( SRC_ITEM_ENM LIKE CONCAT('%' , #{dmnLnm,jdbcType=VARCHAR} ,'%') OR SRC_ITEM_ENM LIKE CONCAT( '%' , UPPER( #{dmnLnm,jdbcType=VARCHAR}) ,'%') )
			  )
			</if>
			<![CDATA[         
		     ORDER BY CASE WHEN SRC_ITEM_ID < TGT_ITEM_ID THEN SRC_ITEM_KNM ELSE TGT_ITEM_KNM END
		            , CASE WHEN SRC_ITEM_ID > TGT_ITEM_ID THEN SRC_ITEM_KNM ELSE TGT_ITEM_KNM END 
       ]]>  
	   
<!-- 	   <![CDATA[         
		SELECT /* StructureMapper.getCodeStructuer */
			   DISTINCT 
			   TBL.STND_ASRT 
		     , TBL.SRC_ITEM_ID
		     , TBL.SRC_ITEM_KNM
		     , TBL.SRC_ITEM_ENM
		     , TBL.TGT_ITEM_ID
		     , TBL.TGT_ITEM_KNM
		     , TBL.TGT_ITEM_ENM
		     , CONCAT(SRC_CD_CNT,' 개') AS SRC_CD_CNT
		     , CONCAT(TGT_CD_CNT,' 개') AS TGT_CD_CNT
		     , CONCAT(SAM_CD_CNT,' 개') AS SAM_CD_CNT
		     , CONCAT(ROUND(SAM_CD_CNT / SRC_CD_CNT, 2)*100 ,' %') AS SRC_SAME_RT
		     , CONCAT(ROUND(SAM_CD_CNT / TGT_CD_CNT, 2)*100 ,' %') AS TGT_SAME_RT
		     , ROUND(SAM_CD_CNT / SRC_CD_CNT, 2)*100  AS SRC_SAME_ORDER
		     , ROUND(SAM_CD_CNT / TGT_CD_CNT, 2)*100  AS TGT_SAME_ORDER 		     
		  FROM (
		          SELECT A.DMN_ID      AS SRC_ITEM_ID
		        	   , A.STND_ASRT	   AS STND_ASRT		
		               , A.DMN_LNM     AS SRC_ITEM_KNM
		               , A.DMN_PNM     AS SRC_ITEM_ENM
		               , B.DMN_ID      AS TGT_ITEM_ID
		               , B.DMN_LNM     AS TGT_ITEM_KNM
		               , B.DMN_PNM     AS TGT_ITEM_ENM
		               , A.SRC_CD_CNT
		               , B.TGT_CD_CNT
		               , COUNT(1)      AS SAM_CD_CNT 
		          FROM ( SELECT B.STND_ASRT
		                      , B.DMN_ID
		                      , B.DMN_LNM
		                      , B.DMN_PNM
		                      , REGEXP_REPLACE(A.CD_VAL_NM,'(\W)|_','')         AS SRC_CD_VAL_NM
		                      , COUNT(*) OVER (PARTITION BY A.STND_ASRT, A.DMN_ID) AS SRC_CD_CNT
		                  FROM WAM_CD_VAL A
		                       INNER JOIN WAM_DMN B
		                          ON B.DMN_ID = A.DMN_ID
		                 WHERE IFNULL(NULLIF(B.SUB_CD_YN,''),'N') = 'N'
		                   AND B.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}    
		                   AND B.DMN_LNM LIKE CONCAT('%' , #{dmnLnm,jdbcType=VARCHAR} , '%')
		                 GROUP BY A.DMN_ID
		                        , A.CD_VAL_NM
		             ) A		            
		             INNER JOIN 
		             (SELECT B.STND_ASRT
		                   , B.DMN_ID
		                   , B.DMN_LNM
		                   , B.DMN_PNM
		                   , REGEXP_REPLACE(A.CD_VAL_NM,'(\W)|_','')         AS TGT_CD_VAL_NM
		                   , COUNT(*) OVER (PARTITION BY A.STND_ASRT, A.DMN_ID) AS TGT_CD_CNT
		                FROM WAM_CD_VAL A
		                     INNER JOIN WAM_DMN B
		                        ON B.DMN_ID = A.DMN_ID
		               WHERE IFNULL(NULLIF(B.SUB_CD_YN,''),'N') = 'N'
		                 AND B.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}    
		               GROUP BY A.DMN_ID
		                      , A.CD_VAL_NM 
		             ) B
		            ON B.STND_ASRT        = A.STND_ASRT
		           AND B.TGT_CD_VAL_NM = A.SRC_CD_VAL_NM		        
		         WHERE 1 = 1
		           AND CONCAT(A.STND_ASRT, A.DMN_ID) != CONCAT(B.STND_ASRT, B.DMN_ID) 		           
		         GROUP BY A.STND_ASRT
		                , A.DMN_ID
		                , A.DMN_LNM
		                , A.DMN_PNM
		                , B.DMN_ID
		                , B.DMN_LNM
		                , B.DMN_PNM
		                , A.SRC_CD_CNT
		                , B.TGT_CD_CNT
		         HAVING ROUND(COUNT(1) / A.SRC_CD_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR} 	
             	    AND ROUND(COUNT(1) / B.TGT_CD_CNT, 2) * 100 >= #{crlRt,jdbcType=VARCHAR} 	   	 		  		         
		    ) TBL
       WHERE 1 = 1 
       ]]>   -->
</select>

<select id="selectDmnInitList" resultMap="BaseResultMap" parameterType="kr.wise.meta.symn.service.StructureVO">
	  SELECT /* StructureMapper.selectDmnInitList */
			   A.DMN_LNM        AS SRC_DMN_KNM                         
		     , A.DMN_PNM        AS SRC_DMN_ENM                         
		     , A.DMN_ORG_DS     AS SRC_DMN_DSCD                        
		     , E.STWD_LNM       AS SRC_TRM_KNM                         
		     , E.STWD_PNM       AS SRC_TRM_ENM                         
		     , D.DMN_LNM        AS TGT_DMN_KNM                         
		     , D.DMN_PNM        AS TGT_DMN_ENM                         
		     , D.DMN_ORG_DS     AS TGT_DMN_DSCD                        
		     , F.STWD_LNM       AS TGT_TRM_KNM                         
		     , F.STWD_PNM       AS TGT_TRM_ENM 
		     , B.WD_SNO												
		FROM WAM_DMN A                                             
		     INNER JOIN WAM_STWD_CNFG B                                       
		        ON B.OBJ_ID = A.DMN_ID
		     LEFT JOIN WAM_STWD E 
		       ON E.STWD_ID = B.STWD_ID
		     LEFT JOIN WAM_STWD_CNFG C
		       ON C.STWD_ID = B.STWD_ID
		      AND C.OBJ_ID  = #{tgtDmnId,jdbcType=VARCHAR}                                   
		     LEFT JOIN WAM_STWD F 
		       ON C.STWD_ID = F.STWD_ID
		     LEFT JOIN WAM_DMN D                                  
		       ON D.DMN_ID = C.OBJ_ID                                          		      
		WHERE 1 = 1
		  AND A.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}
		  AND A.DMN_ID = #{dmnId,jdbcType=VARCHAR} 		 
		UNION 
		SELECT D.DMN_LNM        AS SRC_DMN_KNM                         
		     , D.DMN_PNM        AS SRC_DMN_ENM                         
		     , D.DMN_ORG_DS     AS SRC_DMN_DSCD                        
		     , F.STWD_LNM       AS SRC_TRM_KNM                         
		     , F.STWD_PNM       AS SRC_TRM_ENM                         
		     , A.DMN_LNM        AS TGT_DMN_KNM                         
		     , A.DMN_PNM        AS TGT_DMN_ENM                         
		     , A.DMN_ORG_DS     AS TGT_DMN_DSCD                        
		     , E.STWD_LNM       AS TGT_TRM_KNM                         
		     , E.STWD_PNM       AS TGT_TRM_ENM
		     , C.WD_SNO												
		FROM WAM_DMN A                                             
		     INNER JOIN WAM_STWD_CNFG B                                       
		        ON B.OBJ_ID = A.DMN_ID  
		      LEFT JOIN WAM_STWD E 
		        ON E.STWD_ID = B.STWD_ID  
		     LEFT JOIN WAM_STWD_CNFG C                                  
		       ON C.STWD_ID = B.STWD_ID  
		      AND C.OBJ_ID = #{dmnId,jdbcType=VARCHAR}                                                                      
		     LEFT JOIN WAM_STWD F
		       ON F.STWD_ID = C.STWD_ID  
		     LEFT JOIN WAM_DMN D                                  
		       ON D.DMN_ID = C.OBJ_ID                                          		      
		WHERE 1 = 1
		  AND A.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}
		  AND A.DMN_ID = #{tgtDmnId,jdbcType=VARCHAR}  
		ORDER BY WD_SNO
</select>

<select id="selectItmInitList" resultMap="BaseResultMap" parameterType="kr.wise.meta.symn.service.StructureVO">
		SELECT 	/* StructureMapper.selectItmInitList */
			   A.SDITM_LNM        AS SRC_ITEM_KNM                       
		     , A.SDITM_PNM        AS SRC_ITEM_ENM                                           
		     , D.SDITM_LNM        AS TGT_ITEM_KNM                       
		     , D.SDITM_PNM        AS TGT_ITEM_ENM                                             
		     , E.STWD_LNM        AS SRC_TRM_KNM                         
		     , E.STWD_PNM        AS SRC_TRM_ENM
		     , F.STWD_LNM        AS TGT_TRM_KNM                         
		     , F.STWD_PNM        AS TGT_TRM_ENM 
		     , B.WD_SNO											
		FROM WAM_SDITM A                                      
		     INNER JOIN WAM_STWD_CNFG B                            
		        ON A.SDITM_ID = B.OBJ_ID 
		     LEFT JOIN WAM_STWD E 
		       ON B.STWD_ID = E.STWD_ID
		     LEFT JOIN WAM_STWD_CNFG C                       
		       ON B.STWD_ID = C.STWD_ID                                                          
		      AND C.OBJ_ID = #{tgtItemId,jdbcType=VARCHAR}
		     LEFT JOIN WAM_STWD F 
		       ON C.STWD_ID = F.STWD_ID
		     LEFT JOIN WAM_SDITM D                           
		       ON D.SDITM_ID = C.OBJ_ID                                          
		WHERE A.STND_ASRT   = #{stndAsrt,jdbcType=VARCHAR}                            
		  AND A.SDITM_ID = #{srcItemId,jdbcType=VARCHAR}         
		UNION                                                        
		SELECT D.SDITM_LNM        AS SRC_ITEM_KNM                       
		     , D.SDITM_PNM        AS SRC_ITEM_ENM
		     , A.SDITM_LNM        AS TGT_ITEM_KNM                       
		     , A.SDITM_PNM        AS TGT_ITEM_ENM              
		     , F.STWD_LNM        AS SRC_TRM_KNM                         
		     , F.STWD_PNM        AS SRC_TRM_ENM
		     , E.STWD_LNM        AS TGT_TRM_KNM                         
		     , E.STWD_PNM        AS TGT_TRM_ENM                       
		     , C.WD_SNO                                         
		FROM WAM_SDITM A                                      
		     INNER JOIN WAM_STWD_CNFG B                            
		        ON A.SDITM_ID = B.OBJ_ID
		     LEFT JOIN WAM_STWD E 
		       ON B.STWD_ID = E.STWD_ID
		     LEFT JOIN WAM_STWD_CNFG C                       
		       ON B.STWD_ID = C.STWD_ID                                                                
		      AND C.OBJ_ID = #{srcItemId,jdbcType=VARCHAR}
		     LEFT JOIN WAM_STWD F 
		       ON C.STWD_ID = F.STWD_ID
		     LEFT JOIN WAM_SDITM D                           
		       ON D.SDITM_ID = C.OBJ_ID                                                                          
		WHERE A.STND_ASRT   = #{stndAsrt,jdbcType=VARCHAR}                                 
		  AND A.SDITM_ID = #{tgtItemId,jdbcType=VARCHAR}           
		ORDER BY WD_SNO
</select>
	
	
<select id="selectMdlInitList" resultMap="BaseResultMap" parameterType="kr.wise.meta.symn.service.StructureVO">
		SELECT /* StructureMapper.selectMdlInitList */
		        MAX(T.SRC_FULL_PATH)  AS SRC_FULL_PATH                                                                              
		      , MAX(T.SRC_TBL_KNM)    AS SRC_TBL_KNM                                                                           
		      , MAX(T.SRC_TBL_ENM)    AS SRC_TBL_ENM                                                                    
		      , T.SRC_COL_KNM         AS SRC_COL_KNM                                                                      
		      , MAX(T.SRC_COL_ENM)    AS SRC_COL_ENM                                                                   
		      , MAX(T.SRC_POSITION)   AS SRC_POSITION                                                                     
		      , MAX(T.SRC_PK_YN)      AS SRC_PK_YN                                                                                                                                             
		      , MAX(T.SRC_NULL_YN)    AS SRC_NULL_YN   
		      , MAX(T.SRC_DATA_TYPE)  AS SRC_DATA_TYPE 
		      , MAX(T.SRC_TBL_ID)     AS SRC_TBL_ID                                                                            
		      , MAX(T.SRC_COL_ID)     AS SRC_COL_ID    
		      , MAX(T.TGT_FULL_PATH)  AS TGT_FULL_PATH 
		      , MAX(T.TGT_TBL_KNM)    AS TGT_TBL_KNM                                                                           
		      , MAX(T.TGT_TBL_ENM)    AS TGT_TBL_ENM   
		      , T.TGT_COL_KNM         AS TGT_COL_KNM                                                                      
		      , MAX(T.TGT_COL_ENM)    AS TGT_COL_ENM   
		      , MAX(T.TGT_POSITION)   AS TGT_POSITION                                                                     
		      , MAX(T.TGT_PK_YN)      AS TGT_PK_YN                                                             
		      , MAX(T.TGT_NULL_YN)    AS TGT_NULL_YN                                                                    
		      , MAX(T.TGT_DATA_TYPE)  AS TGT_DATA_TYPE  		                                                                            
		      , MAX(T.TGT_TBL_ID)     AS TGT_TBL_ID                                                                      
		      , MAX(T.TGT_COL_ID)     AS TGT_COL_ID    
		  FROM (
		  
			 SELECT A.FULL_PATH   AS SRC_FULL_PATH                                                                             
			      , A.PDM_TBL_LNM AS SRC_TBL_KNM                                                                            
			      , A.PDM_TBL_PNM AS SRC_TBL_ENM                                                                     
			      , A.PDM_COL_LNM AS SRC_COL_KNM                                                                       
			      , A.PDM_COL_PNM AS SRC_COL_ENM                                                                    
			      , A.COL_ORD     AS SRC_POSITION                                                                      
			      , A.PK_YN       AS SRC_PK_YN                                                                                                                                              
			      , A.NONUL_YN    AS SRC_NULL_YN
			      , A.DATA_TYPE   AS SRC_DATA_TYPE
			      , A.PDM_TBL_ID  AS SRC_TBL_ID                                                                             
			      , A.PDM_COL_ID  AS SRC_COL_ID
			      , B.FULL_PATH   AS TGT_FULL_PATH                                                                             
			      , B.PDM_TBL_LNM AS TGT_TBL_KNM                                                                            
			      , B.PDM_TBL_PNM AS TGT_TBL_ENM                                                                     
			      , B.PDM_COL_LNM AS TGT_COL_KNM                                                                       
			      , B.PDM_COL_PNM AS TGT_COL_ENM                                                                    
			      , B.COL_ORD     AS TGT_POSITION                                                                      
			      , B.PK_YN       AS TGT_PK_YN                                                                                                                                              
			      , B.NONUL_YN    AS TGT_NULL_YN
			      , B.DATA_TYPE   AS TGT_DATA_TYPE
			      , B.PDM_TBL_ID  AS TGT_TBL_ID                                                                             
			      , B.PDM_COL_ID  AS TGT_COL_ID                                                
			 FROM (SELECT A.STND_ASRT
			            , A.PDM_TBL_ID                                                                            
			            , B.PDM_COL_ID  
			            , A.FULL_PATH   
			            , A.PDM_TBL_LNM                                                                           
			            , A.PDM_TBL_PNM                                                                    
			            , B.PDM_COL_LNM                                                                      
			            , B.PDM_COL_PNM                                                                   
			            , B.COL_ORD                                                                          
			            , B.PK_YN                                                                                                                                                 
			            , B.NONUL_YN    
			            , REPLACE(CONCAT(B.DATA_TYPE,'(',IFNULL(B.DATA_LEN,''),',',IFNULL(B.DATA_SCAL,''),')',',)',')')   ,',)','') AS DATA_TYPE
			         FROM WAM_PDM_TBL A                                                                                              
			              INNER JOIN WAM_PDM_COL B                                                                                         
			                 ON B.STND_ASRT     = A.STND_ASRT
			                AND B.PDM_TBL_ID = A.PDM_TBL_ID  
			        WHERE 1 = 1
			          AND A.STND_ASRT     = #{stndAsrt,jdbcType=VARCHAR}
			          AND A.PDM_TBL_ID = #{srcObjId,jdbcType=VARCHAR}            
			       ) A		                                                                                                                                                                                     
			      LEFT JOIN 
			      (SELECT A.STND_ASRT
			            , A.PDM_TBL_ID                                                                               
			            , B.PDM_COL_ID   
			            , A.FULL_PATH    
			            , A.PDM_TBL_LNM                                                                            
			            , A.PDM_TBL_PNM                                                                     
			            , B.PDM_COL_LNM                                                                       
			            , B.PDM_COL_PNM                                                                    
			            , B.COL_ORD                                                                           
			            , B.PK_YN                                                                                                                                                  
			            , B.NONUL_YN     
			            , REPLACE(CONCAT(B.DATA_TYPE,'(',IFNULL(B.DATA_LEN,''),',',IFNULL(B.DATA_SCAL,''),')',',)',')')   ,',)','') AS DATA_TYPE
			         FROM WAM_PDM_TBL A                                                                                              
			              INNER JOIN WAM_PDM_COL B                                                                                         
			                 ON B.STND_ASRT     = A.STND_ASRT
			                AND B.PDM_TBL_ID = A.PDM_TBL_ID  
			        WHERE 1 = 1 
			          AND A.STND_ASRT     = #{stndAsrt,jdbcType=VARCHAR}
			          AND A.PDM_TBL_ID = #{tgtObjId,jdbcType=VARCHAR}                  
			       ) B
			      ON B.STND_ASRT      = A.STND_ASRT
			     AND B.PDM_COL_LNM = A.PDM_COL_LNM                                                                                                                                                                                                                              
			 WHERE 1 = 1  
			                                                                                 		                                                           
			 UNION 
			
			 SELECT A.FULL_PATH   AS SRC_FULL_PATH                                                                             
			      , A.PDM_TBL_LNM AS SRC_TBL_KNM                                                                            
			      , A.PDM_TBL_PNM AS SRC_TBL_ENM                                                                     
			      , A.PDM_COL_LNM AS SRC_COL_KNM                                                                       
			      , A.PDM_COL_PNM AS SRC_COL_ENM                                                                    
			      , A.COL_ORD     AS SRC_POSITION                                                                      
			      , A.PK_YN       AS SRC_PK_YN                                                                                                                                              
			      , A.NONUL_YN    AS SRC_NULL_YN
			      , A.DATA_TYPE   AS SRC_DATA_TYPE
			      , A.PDM_TBL_ID  AS SRC_TBL_ID                                                                             
			      , A.PDM_COL_ID  AS SRC_COL_ID
			      , B.FULL_PATH   AS TGT_FULL_PATH                                                                             
			      , B.PDM_TBL_LNM AS TGT_TBL_KNM                                                                            
			      , B.PDM_TBL_PNM AS TGT_TBL_ENM                                                                     
			      , B.PDM_COL_LNM AS TGT_COL_KNM                                                                       
			      , B.PDM_COL_PNM AS TGT_COL_ENM                                                                    
			      , B.COL_ORD     AS TGT_POSITION                                                                      
			      , B.PK_YN       AS TGT_PK_YN                                                                                                                                              
			      , B.NONUL_YN    AS TGT_NULL_YN
			      , B.DATA_TYPE   AS TGT_DATA_TYPE
			      , B.PDM_TBL_ID  AS TGT_TBL_ID                                                                             
			      , B.PDM_COL_ID  AS TGT_COL_ID                                                
			 FROM (SELECT A.STND_ASRT
			            , A.PDM_TBL_ID                                                                            
			            , B.PDM_COL_ID  
			            , A.FULL_PATH   
			            , A.PDM_TBL_LNM                                                                           
			            , A.PDM_TBL_PNM                                                                    
			            , B.PDM_COL_LNM                                                                      
			            , B.PDM_COL_PNM                                                                   
			            , B.COL_ORD                                                                          
			            , B.PK_YN                                                                                                                                                 
			            , B.NONUL_YN    
			            , REPLACE(CONCAT(B.DATA_TYPE,'(',IFNULL(B.DATA_LEN,''),',',IFNULL(B.DATA_SCAL,''),')',',)',')')   ,',)','') AS DATA_TYPE
			         FROM WAM_PDM_TBL A                                                                                              
			              INNER JOIN WAM_PDM_COL B                                                                                         
			                 ON B.STND_ASRT     = A.STND_ASRT
			                AND B.PDM_TBL_ID = A.PDM_TBL_ID  
			        WHERE 1 = 1
			          AND A.STND_ASRT     = #{stndAsrt,jdbcType=VARCHAR}
			          AND A.PDM_TBL_ID = #{srcObjId,jdbcType=VARCHAR}              
			       ) A		                                                                                                                                                                                     
			      RIGHT JOIN 
			      (SELECT A.STND_ASRT
			            , A.PDM_TBL_ID                                                                               
			            , B.PDM_COL_ID   
			            , A.FULL_PATH    
			            , A.PDM_TBL_LNM                                                                            
			            , A.PDM_TBL_PNM                                                                     
			            , B.PDM_COL_LNM                                                                       
			            , B.PDM_COL_PNM                                                                    
			            , B.COL_ORD                                                                           
			            , B.PK_YN                                                                                                                                                  
			            , B.NONUL_YN     
			            , REPLACE(CONCAT(B.DATA_TYPE,'(',IFNULL(B.DATA_LEN,''),',',IFNULL(B.DATA_SCAL,''),')',',)',')')   ,',)','') AS DATA_TYPE
			         FROM WAM_PDM_TBL A                                                                                              
			              INNER JOIN WAM_PDM_COL B                                                                                         
			                 ON B.STND_ASRT     = A.STND_ASRT
			                AND B.PDM_TBL_ID = A.PDM_TBL_ID  
			        WHERE 1 = 1 
			          AND A.STND_ASRT     = #{stndAsrt,jdbcType=VARCHAR}
			          AND A.PDM_TBL_ID = #{tgtObjId,jdbcType=VARCHAR}                 
			       ) B
			      ON B.STND_ASRT      = A.STND_ASRT
			     AND B.PDM_COL_LNM = A.PDM_COL_LNM                                                                                                                                                                                                                              
			 WHERE 1 = 1  
	  ) T
	  GROUP BY T.SRC_COL_KNM
	         , T.TGT_COL_KNM
	  ORDER BY T.SRC_POSITION      
	
</select>
	

<select id="selectCodeInitList" resultMap="BaseResultMap" parameterType="kr.wise.meta.symn.service.StructureVO">
SELECT /* StructureMapper.selectCodeInitList */
       STND_ASRT
     , SRC_CD_VAL_NM        AS SRC_CD_VAL_NM  
     , MAX(SRC_CD_VAL)      AS SRC_CD_VAL 
     , MAX(SRC_CD_VAL_ID)   AS SRC_CD_VAL_ID 
     , SRC_DMN_ID           AS SRC_DMN_ID 
     , TGT_CD_VAL_NM     	AS TGT_CD_VAL_NM
     , MAX(TGT_CD_VAL) 		AS TGT_CD_VAL
     , MAX(TGT_CD_VAL_ID)   AS TGT_CD_VAL_ID
     , TGT_DMN_ID     		AS TGT_DMN_ID		
  FROM (
        SELECT A.STND_ASRT
            , A.DMN_ID     AS SRC_DMN_ID
            , A.DMN_LNM    AS SRC_DMN_LNM
            , A.DMN_PNM    AS SRC_DMN_PNM
            , A.CD_VAL_ID  AS SRC_CD_VAL_ID
            , A.CD_VAL     AS SRC_CD_VAL
            , A.CD_VAL_NM  AS SRC_CD_VAL_NM
            , B.DMN_ID     AS TGT_DMN_ID
            , B.DMN_LNM    AS TGT_DMN_LNM
            , B.DMN_PNM    AS TGT_DMN_PNM
            , B.CD_VAL_ID  AS TGT_CD_VAL_ID
            , B.CD_VAL     AS TGT_CD_VAL
            , B.CD_VAL_NM  AS TGT_CD_VAL_NM
        FROM (SELECT A.STND_ASRT
                    , A.DMN_ID     
                    , A.DMN_LNM    
                    , A.DMN_PNM    
                    , B.CD_VAL_ID  
                    , B.CD_VAL     
                    , B.CD_VAL_NM  
                FROM WAM_DMN A
                     LEFT JOIN WAM_CD_VAL B
                       ON B.STND_ASRT = A.STND_ASRT
                      AND B.DMN_ID = A.DMN_ID                 
              WHERE IFNULL(NULLIF(A.SUB_CD_YN,''),'N') = 'N'
                AND A.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}  
                AND A.DMN_ID = #{srcDmnId,jdbcType=VARCHAR} 
              ) A
              LEFT JOIN
              (SELECT A.STND_ASRT
                    , A.DMN_ID     
                    , A.DMN_LNM    
                    , A.DMN_PNM    
                    , B.CD_VAL_ID  
                    , B.CD_VAL     
                    , B.CD_VAL_NM  
                FROM WAM_DMN A
                     LEFT JOIN WAM_CD_VAL B
                       ON B.STND_ASRT = A.STND_ASRT
                      AND B.DMN_ID = A.DMN_ID               
              WHERE IFNULL(NULLIF(A.SUB_CD_YN,''),'N') = 'N'
                AND A.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}  
                AND A.DMN_ID = #{tgtDmnId,jdbcType=VARCHAR} 
              ) B
              ON B.STND_ASRT    = A.STND_ASRT
             AND B.CD_VAL_NM = A.CD_VAL_NM 
        WHERE 1 = 1     
        UNION ALL
        SELECT A.STND_ASRT
            , A.DMN_ID     AS SRC_DMN_ID
            , A.DMN_LNM    AS SRC_DMN_LNM
            , A.DMN_PNM    AS SRC_DMN_PNM
            , A.CD_VAL_ID  AS SRC_CD_VAL_ID
            , A.CD_VAL     AS SRC_CD_VAL
            , A.CD_VAL_NM  AS SRC_CD_VAL_NM
            , B.DMN_ID     AS TGT_DMN_ID
            , B.DMN_LNM    AS TGT_DMN_LNM
            , B.DMN_PNM    AS TGT_DMN_PNM
            , B.CD_VAL_ID  AS TGT_CD_VAL_ID
            , B.CD_VAL     AS TGT_CD_VAL
            , B.CD_VAL_NM  AS TGT_CD_VAL_NM
        FROM (SELECT A.STND_ASRT
                    , A.DMN_ID     
                    , A.DMN_LNM    
                    , A.DMN_PNM    
                    , B.CD_VAL_ID  
                    , B.CD_VAL     
                    , B.CD_VAL_NM  
                FROM WAM_DMN A
                     LEFT JOIN WAM_CD_VAL B
                       ON B.STND_ASRT = A.STND_ASRT
                      AND B.DMN_ID = A.DMN_ID                 
              WHERE IFNULL(NULLIF(A.SUB_CD_YN,''),'N') = 'N'
                AND A.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}  
                AND A.DMN_ID = #{srcDmnId,jdbcType=VARCHAR}
              ) A
              RIGHT JOIN
              (SELECT A.STND_ASRT
                    , A.DMN_ID     
                    , A.DMN_LNM    
                    , A.DMN_PNM    
                    , B.CD_VAL_ID  
                    , B.CD_VAL     
                    , B.CD_VAL_NM  
                FROM WAM_DMN A
                     LEFT JOIN WAM_CD_VAL B
                       ON B.STND_ASRT = A.STND_ASRT
                      AND B.DMN_ID = A.DMN_ID               
              WHERE IFNULL(NULLIF(A.SUB_CD_YN,''),'N') = 'N'
                AND A.STND_ASRT = #{stndAsrt,jdbcType=VARCHAR}  
                AND A.DMN_ID = #{tgtDmnId,jdbcType=VARCHAR} 
              ) B
              ON B.STND_ASRT        = A.STND_ASRT
             AND B.CD_VAL_NM = A.CD_VAL_NM 
        WHERE 1 = 1      
) A
GROUP BY STND_ASRT
       , SRC_CD_VAL_NM        
       , SRC_DMN_ID           
       , TGT_CD_VAL_NM     	
       , TGT_DMN_ID     		

</select>

   
</mapper>