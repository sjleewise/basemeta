<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.meta.ddl.service.WaqDdlSeqMapper" >
  <resultMap id="BaseResultMap" type="kr.wise.meta.ddl.service.WaqDdlSeq" extends="kr.wise.commons.cmm.service.CommonMapper.BaseResultMap" >
    <id column="RQST_NO" property="rqstNo" jdbcType="VARCHAR" />
    <id column="RQST_SNO" property="rqstSno" jdbcType="DECIMAL" />
    <result column="DDL_SEQ_ID" property="ddlSeqId" jdbcType="VARCHAR" />
    <result column="DDL_SEQ_PNM" property="ddlSeqPnm" jdbcType="VARCHAR" />
    <result column="DDL_SEQ_LNM" property="ddlSeqLnm" jdbcType="VARCHAR" />
<!--     <result column="RQST_DCD" property="rqstDcd" jdbcType="VARCHAR" /> -->
<!--     <result column="RVW_STS_CD" property="rvwStsCd" jdbcType="VARCHAR" /> -->
<!--     <result column="RVW_CONTS" property="rvwConts" jdbcType="VARCHAR" /> -->
<!--     <result column="VRF_CD" property="vrfCd" jdbcType="VARCHAR" /> -->
<!--     <result column="VRF_RMK" property="vrfRmk" jdbcType="VARCHAR" /> -->
    <result column="DB_CONN_TRG_PNM" property="dbConnTrgPnm" jdbcType="VARCHAR" />
    <result column="DB_SCH_ID" property="dbSchId" jdbcType="VARCHAR" />
    <result column="DB_SCH_PNM" property="dbSchPnm" jdbcType="VARCHAR" />
    <result column="INCBY" property="incby" jdbcType="VARCHAR" />
    <result column="STRTWT" property="strtwt" jdbcType="VARCHAR" />
    <result column="MAXVAL" property="maxval" jdbcType="VARCHAR" />
    <result column="MINVAL" property="minval" jdbcType="VARCHAR" />
    <result column="CYC_YN" property="cycYn" jdbcType="VARCHAR" />
    <result column="CACHE_SZ" property="cacheSz" jdbcType="VARCHAR" />
    <result column="ORD_YN" property="ordYn" jdbcType="VARCHAR" />
    <result column="NM_RL_TYP_CD" property="nmRlTypCd" jdbcType="VARCHAR" />
    <result column="US_TYP_CD" property="usTypCd" jdbcType="VARCHAR" />
    <result column="PDM_TBL_PNM" property="pdmTblPnm" jdbcType="VARCHAR" />
    <result column="PDM_COL_PNM" property="pdmColPnm" jdbcType="VARCHAR" />
    <result column="L1CD_PNM" property="l1cdPnm" jdbcType="VARCHAR" />
    <result column="L3CD_PNM" property="l3cdPnm" jdbcType="VARCHAR" />
    <result column="GRT_LST" property="grtLst" jdbcType="VARCHAR" />
    <result column="DDL_TRG_DCD" property="ddlTrgDcd" jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_ID" property="srcDbSchId" jdbcType="VARCHAR" />
    <result column="SRC_DDL_SEQ_ID" property="srcDdlSeqId" jdbcType="VARCHAR" />
    <!--      DDL적용요청코드, 일자 -->
    <result column="APL_REQ_TYP_CD" property="aplReqTypCd" jdbcType="VARCHAR" />
    <result column="APL_REQ_DT" property="aplReqdt" jdbcType="VARCHAR" />
    <result column="PRJ_MNG_NO"     property="prjMngNo"    jdbcType="VARCHAR" />
    <result column="SR_MNG_NO"      property="srMngNo"     jdbcType="VARCHAR" />
    
    <result column="PCKG_NM"      property="pckgNm"     jdbcType="VARCHAR" />
    <result column="SEQ_CLAS_CD"      property="seqClasCd"     jdbcType="VARCHAR" />
    <result column="SEQ_INIT_CD"      property="seqInitCd"     jdbcType="VARCHAR" />
    <result column="BIZ_IFNC"      property="bizIfnc"     jdbcType="VARCHAR" />
    
    <result column="SRC_DDL_TRG_DCD"     property="srcDdlTrgDcd"    jdbcType="VARCHAR" />
    <result column="SRC_DB_CONN_TRG_PNM" property="srcDbConnTrgPnm" jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_PNM"      property="srcDbSchPnm"     jdbcType="VARCHAR" />
    <result column="SRC_DB_SCH_ID"       property="srcDbSchId"      jdbcType="VARCHAR" />
   
    <result column="TGT_DDL_TRG_DCD"      property="tgtDdlTrgDcd"    jdbcType="VARCHAR" />
    <result column="TGT_DB_CONN_TRG_ID"   property="tgtDbConnTrgId"  jdbcType="VARCHAR" />
    <result column="TGT_DB_CONN_TRG_PNM"  property="tgtDbConnTrgPnm" jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_PNM"       property="tgtDbSchPnm"     jdbcType="VARCHAR" />
    <result column="TGT_DB_SCH_ID"        property="tgtDbSchId"      jdbcType="VARCHAR" />
    
  </resultMap>
  
  <resultMap id="ResultMapWithBLOBs" type="kr.wise.meta.ddl.service.WaqDdlSeq" extends="BaseResultMap" >
    <result column="SCRT_INFO" property="scrtInfo" jdbcType="CLOB" />
  </resultMap>
  <sql id="Base_Column_List" >
         RQST_NO            
	    ,RQST_SNO           
	    ,DDL_SEQ_ID         
	    ,DDL_SEQ_PNM        
	    ,DDL_SEQ_LNM        
	    ,RQST_DCD           
	    ,RVW_STS_CD         
	    ,RVW_CONTS          
	    ,VRF_CD             
	    ,VRF_RMK            
	    ,DB_CONN_TRG_PNM    
	    ,DB_SCH_ID          
	    ,DB_SCH_PNM         
	    ,INCBY              
	    ,STRTWT             
	    ,MAXVAL             
	    ,MINVAL             
	    ,CYC_YN             
	    ,CACHE_SZ           
	    ,ORD_YN             
	    ,NM_RL_TYP_CD       
	    ,US_TYP_CD          
	    ,PDM_TBL_PNM        
	    ,PDM_COL_PNM        
	    ,L1CD_PNM           
	    ,L3CD_PNM           
	    ,GRT_LST            
	    ,SCRT_INFO          
	    ,OBJ_DESCN          
	    ,OBJ_VERS           
	    ,REG_TYP_CD         
	    ,FRS_RQST_DTM       
	    ,FRS_RQST_USER_ID   
	    ,RQST_DTM           
	    ,RQST_USER_ID       
	    ,APRV_DTM           
	    ,APRV_USER_ID       
	    ,DDL_TRG_DCD        
	    ,SRC_DB_SCH_ID      
	    ,SRC_DDL_SEQ_ID     
	    ,RQST_RESN  
	    ,APL_REQ_TYP_CD
        ,APL_REQ_DT 
        ,PRJ_MNG_NO
        ,SR_MNG_NO
        ,PCKG_NM
		,SEQ_CLAS_CD   
		,SEQ_INIT_CD
		,BIZ_IFNC
  </sql>
  
  <sql id="waq_Column_List" >
    A.RQST_NO, A.RQST_SNO, A.DDL_SEQ_ID, A.DDL_SEQ_PNM, A.DDL_SEQ_LNM, A.RQST_DCD, A.RVW_STS_CD, A.RVW_CONTS, 
    A.VRF_CD, A.VRF_RMK, A.DB_CONN_TRG_PNM, A.DB_SCH_ID, A.DB_SCH_PNM, A.INCBY, A.STRTWT, A.MAXVAL, A.MINVAL, 
    A.CYC_YN, A.CACHE_SZ, A.ORD_YN, A.NM_RL_TYP_CD, A.US_TYP_CD, A.PDM_TBL_PNM, A.PDM_COL_PNM, A.L1CD_PNM, 
    A.L3CD_PNM, A.GRT_LST, A.DDL_TRG_DCD , A.SRC_DB_SCH_ID , A.SRC_DDL_SEQ_ID, A.OBJ_DESCN, A.OBJ_VERS, A.REG_TYP_CD, A.FRS_RQST_DTM, A.FRS_RQST_USER_ID, 
    A.RQST_DTM, A.RQST_USER_ID, A.APRV_DTM, A.APRV_USER_ID , A.SCRT_INFO , A.RQST_RESN, A.APL_REQ_TYP_CD, A.APL_REQ_DT
    ,A.PRJ_MNG_NO, A.SR_MNG_NO
    ,A.RQST_RESN
	,A.PCKG_NM
	,A.SEQ_CLAS_CD   
	,A.SEQ_INIT_CD
	,A.BIZ_IFNC  
	, SRC_DDL_TRG_DCD       
	, SRC_DB_CONN_TRG_PNM   
	, SRC_DB_SCH_ID         
	, SRC_DB_SCH_PNM        
	, TGT_DDL_TRG_DCD       
	, TGT_DB_CONN_TRG_PNM   
	, TGT_DB_SCH_ID         
	, TGT_DB_SCH_PNM      
  </sql>
  
  
  <sql id="Blob_Column_List" >
    SCRT_INFO
  </sql>
  
   <sql id="wam_col">
    ,DDL_SEQ_PNM ,DDL_SEQ_LNM  ,DB_SCH_ID ,INCBY	,STRTWT ,MAXVAL ,MINVAL ,CYC_YN ,CACHE_SZ  ,ORD_YN                        
    ,NM_RL_TYP_CD  ,US_TYP_CD ,PDM_TBL_PNM ,PDM_COL_PNM	,L1CD_PNM, L3CD_PNM ,GRT_LST, DDL_TRG_DCD, SRC_DDL_SEQ_ID    				             
	,SCRT_INFO ,RQST_NO ,RQST_SNO ,OBJ_DESCN ,OBJ_VERS ,REG_TYP_CD ,FRS_RQST_DTM 
	,FRS_RQST_USER_ID  ,RQST_DTM  ,RQST_USER_ID  ,APRV_DTM ,APRV_USER_ID
	,APL_REQ_TYP_CD, APL_REQ_DT,RQST_RESN
	,PRJ_MNG_NO, SR_MNG_NO 
	,PCKG_NM
	,SEQ_CLAS_CD   
	,SEQ_INIT_CD
	,BIZ_IFNC
	, SRC_DDL_TRG_DCD       
	, SRC_DB_CONN_TRG_PNM   
	, SRC_DB_SCH_ID         
	, SRC_DB_SCH_PNM        
	, TGT_DDL_TRG_DCD       
	, TGT_DB_CONN_TRG_PNM   
	, TGT_DB_SCH_ID         
	, TGT_DB_SCH_PNM     
   </sql>
   
   
  <select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs" parameterType="map" >
    select 
    <include refid="Base_Column_List" />
    from WAQ_DDL_SEQ
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="map" >
    delete from WAQ_DDL_SEQ
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    insert into WAQ_DDL_SEQ (RQST_NO, RQST_SNO, DDL_SEQ_ID, 
      DDL_SEQ_PNM, DDL_SEQ_LNM, RQST_DCD, 
      RVW_STS_CD, RVW_CONTS, VRF_CD, 
      VRF_RMK, DB_CONN_TRG_PNM, DB_SCH_ID, 
      DB_SCH_PNM, INCBY, STRTWT, 
      MAXVAL, MINVAL, CYC_YN, 
      CACHE_SZ, ORD_YN, NM_RL_TYP_CD, 
      US_TYP_CD, PDM_TBL_PNM, PDM_COL_PNM, 
      L1CD_PNM, L3CD_PNM, GRT_LST, 
      OBJ_DESCN, OBJ_VERS, REG_TYP_CD, 
      FRS_RQST_DTM, FRS_RQST_USER_ID, RQST_DTM, 
      RQST_USER_ID, APRV_DTM, APRV_USER_ID, 
      SCRT_INFO)
    values (#{rqstNo,jdbcType=VARCHAR}, #{rqstSno,jdbcType=DECIMAL}, #{ddlSeqId,jdbcType=VARCHAR}, 
      #{ddlSeqPnm,jdbcType=VARCHAR}, #{ddlSeqLnm,jdbcType=VARCHAR}, #{rqstDcd,jdbcType=VARCHAR}, 
      #{rvwStsCd,jdbcType=VARCHAR}, #{rvwConts,jdbcType=VARCHAR}, #{vrfCd,jdbcType=VARCHAR}, 
      #{vrfRmk,jdbcType=VARCHAR}, #{dbConnTrgPnm,jdbcType=VARCHAR}, #{dbSchId,jdbcType=VARCHAR}, 
      #{dbSchPnm,jdbcType=VARCHAR}, #{incby,jdbcType=VARCHAR}, #{strtwt,jdbcType=VARCHAR}, 
      #{maxval,jdbcType=VARCHAR}, #{minval,jdbcType=VARCHAR}, #{cycYn,jdbcType=VARCHAR}, 
      #{cacheSz,jdbcType=VARCHAR}, #{ordYn,jdbcType=VARCHAR}, #{nmRlTypCd,jdbcType=VARCHAR}, 
      #{usTypCd,jdbcType=VARCHAR}, #{pdmTblPnm,jdbcType=VARCHAR}, #{pdmColPnm,jdbcType=VARCHAR}, 
      #{l1cdPnm,jdbcType=VARCHAR}, #{l3cdPnm,jdbcType=VARCHAR}, #{grtLst,jdbcType=VARCHAR}, 
      #{objDescn,jdbcType=VARCHAR}, #{objVers,jdbcType=DECIMAL}, #{regTypCd,jdbcType=VARCHAR}, 
      #{frsRqstDtm,jdbcType=TIMESTAMP}, #{frsRqstUserId,jdbcType=VARCHAR}, #{rqstDtm,jdbcType=TIMESTAMP}, 
      #{rqstUserId,jdbcType=VARCHAR}, #{aprvDtm,jdbcType=TIMESTAMP}, #{aprvUserId,jdbcType=VARCHAR}, 
      #{scrtInfo,jdbcType=CLOB})
  </insert>
  <insert id="insertSelective" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    <selectKey keyProperty="rqstSno" resultType="int" statementType="PREPARED" order="BEFORE">
		SELECT NVL(MAX(RQST_SNO), 0) + 1 FROM WAQ_DDL_SEQ WHERE RQST_NO = #{rqstNo}
  	</selectKey>
    insert into WAQ_DDL_SEQ
    <trim prefix="(" suffix=")" suffixOverrides="," >
        RQST_NO,
        RQST_SNO,
        DDL_SEQ_ID,
        DDL_SEQ_PNM,
        DDL_SEQ_LNM,
        RQST_DCD,
        RVW_STS_CD,
        RVW_CONTS,
        VRF_CD,
        VRF_RMK,
        DB_CONN_TRG_PNM,
        DB_SCH_ID,
        DB_SCH_PNM,
        INCBY,
        STRTWT,
        MAXVAL,
        MINVAL,
        CYC_YN,
        CACHE_SZ,
        ORD_YN,
        NM_RL_TYP_CD,
        US_TYP_CD,
        PDM_TBL_PNM,
        PDM_COL_PNM,
        L1CD_PNM,
        L3CD_PNM,
        GRT_LST,
        DDL_TRG_DCD,
        SRC_DDL_SEQ_ID,
        OBJ_DESCN,
        OBJ_VERS,
        REG_TYP_CD,
        FRS_RQST_DTM,
        FRS_RQST_USER_ID,
        RQST_DTM,
        RQST_USER_ID,
        RQST_RESN,
        APL_REQ_TYP_CD,
        <if test ="aplReqdt != null and aplReqdt != ''">
        APL_REQ_DT, --ㅅㅂ
        </if>
      PRJ_MNG_NO,
      SR_MNG_NO,
      PCKG_NM,
      SEQ_CLAS_CD,
      SEQ_INIT_CD,
      BIZ_IFNC,
       <if test="srcDdlTrgDcd != null" >
        SRC_DDL_TRG_DCD,
      </if>
       <if test="srcDbSchId != null" >
        SRC_DB_SCH_ID,
      </if>
      <if test="srcDbSchPnm != null" >
        SRC_DB_SCH_PNM,
      </if>
      <if test="srcDbConnTrgPnm != null" >
        SRC_DB_CONN_TRG_PNM,
      </if>
      <if test="tgtDdlTrgDcd != null" >
        TGT_DDL_TRG_DCD,
      </if>
       <if test="tgtDbSchId != null" >
        TGT_DB_SCH_ID,
      </if>
      <if test="tgtDbSchPnm != null" >
        TGT_DB_SCH_PNM,
      </if>
      <if test="tgtDbConnTrgPnm != null" >
        TGT_DB_CONN_TRG_PNM,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
        #{rqstNo,jdbcType=VARCHAR},
        #{rqstSno,jdbcType=DECIMAL},
        #{ddlSeqId,jdbcType=VARCHAR},
        #{ddlSeqPnm,jdbcType=VARCHAR},
        #{ddlSeqLnm,jdbcType=VARCHAR},
        #{rqstDcd,jdbcType=VARCHAR},
        #{rvwStsCd,jdbcType=VARCHAR},
        #{rvwConts,jdbcType=VARCHAR},
        #{vrfCd,jdbcType=VARCHAR},
        #{vrfRmk,jdbcType=VARCHAR},
        #{dbConnTrgPnm,jdbcType=VARCHAR},
        #{dbSchId,jdbcType=VARCHAR},
        #{dbSchPnm,jdbcType=VARCHAR},
        #{incby,jdbcType=VARCHAR},
        #{strtwt,jdbcType=VARCHAR},
        #{maxval,jdbcType=VARCHAR},
        #{minval,jdbcType=VARCHAR},
        #{cycYn,jdbcType=VARCHAR},
        #{cacheSz,jdbcType=VARCHAR},
        #{ordYn,jdbcType=VARCHAR},
        #{nmRlTypCd,jdbcType=VARCHAR},
        #{usTypCd,jdbcType=VARCHAR},
        #{pdmTblPnm,jdbcType=VARCHAR},
        #{pdmColPnm,jdbcType=VARCHAR},
        #{l1cdPnm,jdbcType=VARCHAR},
        #{l3cdPnm,jdbcType=VARCHAR},
        #{grtLst,jdbcType=VARCHAR},
        #{ddlTrgDcd,jdbcType=VARCHAR},
        #{srcDdlSeqId,jdbcType=VARCHAR},
        #{objDescn,jdbcType=VARCHAR},
        1 ,
        #{regTypCd,jdbcType=VARCHAR},
        SYSDATETIME ,
        #{frsRqstUserId,jdbcType=VARCHAR},
        SYSDATETIME ,
        #{rqstUserId,jdbcType=VARCHAR},
        #{rqstResn,jdbcType=VARCHAR},
        #{aplReqTypCd,jdbcType=VARCHAR},
        <if test ="aplReqdt != null and aplReqdt != ''">
        TO_CHAR(TO_DATE(#{aplReqdt,jdbcType=VARCHAR}, 'YYYY-MM-DD'), 'YYYY-MM-DD'),
        </if>
      #{prjMngNo,jdbcType=VARCHAR},
      #{srMngNo,jdbcType=VARCHAR},
      
      #{pckgNm,jdbcType=VARCHAR},
      #{seqClasCd,jdbcType=VARCHAR},
      #{seqInitCd,jdbcType=VARCHAR},
      #{bizIfnc,jdbcType=VARCHAR},
      <if test="srcDdlTrgDcd != null" >
        #{srcDdlTrgDcd,jdbcType=VARCHAR},
      </if>
       <if test="srcDbSchId != null" >
        #{srcDbSchId,jdbcType=VARCHAR},
      </if>
      <if test="srcDbSchPnm != null" >
        #{srcDbSchPnm,jdbcType=VARCHAR},
      </if>
      <if test="srcDbConnTrgPnm != null" >
        #{srcDbConnTrgPnm,jdbcType=VARCHAR},
      </if>
      <if test="tgtDdlTrgDcd != null" >
        #{tgtDdlTrgDcd,jdbcType=VARCHAR},
      </if>
       <if test="tgtDbSchId != null" >
        #{tgtDbSchId,jdbcType=VARCHAR},
      </if>
      <if test="tgtDbSchPnm != null" >
        #{tgtDbSchPnm,jdbcType=VARCHAR},
      </if>
      <if test="tgtDbConnTrgPnm != null" >
        #{tgtDbConnTrgPnm,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    update WAQ_DDL_SEQ
    <set >
    <if test="ddlSeqId != null" >
        DDL_SEQ_ID = #{ddlSeqId,jdbcType=VARCHAR},
    </if>
    <if test="ddlSeqPnm != null" >
        DDL_SEQ_PNM = #{ddlSeqPnm,jdbcType=VARCHAR},
    </if>
    <if test="ddlSeqLnm != null" >
        DDL_SEQ_LNM = #{ddlSeqLnm,jdbcType=VARCHAR},
    </if>
    <if test="rqstDcd != null" >
        RQST_DCD = #{rqstDcd,jdbcType=VARCHAR},
    </if>
    <if test="rvwStsCd != null" >
        RVW_STS_CD = #{rvwStsCd,jdbcType=VARCHAR},
    </if>
    <if test="rvwConts != null" >
        RVW_CONTS = #{rvwConts,jdbcType=VARCHAR},
    </if>
    <if test="vrfCd != null" >
        VRF_CD = #{vrfCd,jdbcType=VARCHAR},
    </if>
    <if test="vrfRmk != null" >
        VRF_RMK = #{vrfRmk,jdbcType=VARCHAR},
    </if>
    <if test="dbConnTrgPnm != null" >
        DB_CONN_TRG_PNM = #{dbConnTrgPnm,jdbcType=VARCHAR},
    </if>
    <if test="dbSchId != null" >
        DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR},
    </if>
    <if test="dbSchPnm != null" >
        DB_SCH_PNM = #{dbSchPnm,jdbcType=VARCHAR},
    </if>
    <if test="incby != null" >
        INCBY = #{incby,jdbcType=VARCHAR},
    </if>
    <if test="strtwt != null" >
        STRTWT = #{strtwt,jdbcType=VARCHAR},
    </if>
    <if test="maxval != null" >
        MAXVAL = #{maxval,jdbcType=VARCHAR},
    </if>
    <if test="minval != null" >
        MINVAL = #{minval,jdbcType=VARCHAR},
    </if>
    <if test="cycYn != null" >
        CYC_YN = #{cycYn,jdbcType=VARCHAR},
    </if>
    <if test="cacheSz != null" >
        CACHE_SZ = #{cacheSz,jdbcType=VARCHAR},
    </if>
    <if test="ordYn != null" >
        ORD_YN = #{ordYn,jdbcType=VARCHAR},
    </if>
    <if test="nmRlTypCd != null" >
        NM_RL_TYP_CD = #{nmRlTypCd,jdbcType=VARCHAR},
    </if>
    <if test="usTypCd != null" >
        US_TYP_CD = #{usTypCd,jdbcType=VARCHAR},
    </if>
    <if test="pdmTblPnm != null" >
        PDM_TBL_PNM = #{pdmTblPnm,jdbcType=VARCHAR},
    </if>
    <if test="pdmColPnm != null" >
        PDM_COL_PNM = #{pdmColPnm,jdbcType=VARCHAR},
    </if>
    <if test="l1cdPnm != null" >
        L1CD_PNM = #{l1cdPnm,jdbcType=VARCHAR},
    </if>
    <if test="l3cdPnm != null" >
        L3CD_PNM = #{l3cdPnm,jdbcType=VARCHAR},
    </if>
    <if test="grtLst != null" >
        GRT_LST = #{grtLst,jdbcType=VARCHAR},
    </if>
    <if test="ddlTrgDcd != null" >
        DDL_TRG_DCD = #{ddlTrgDcd,jdbcType=VARCHAR},
    </if>
    <if test="srcDdlSeqId != null" >
        SRC_DDL_SEQ_ID = #{srcDdlSeqId,jdbcType=VARCHAR},
    </if>
    <if test="objDescn != null" >
        OBJ_DESCN = #{objDescn,jdbcType=VARCHAR},
    </if>
    <if test="objVers != null" >
        OBJ_VERS = #{objVers,jdbcType=DECIMAL},
    </if>
    <if test="regTypCd != null" >
        REG_TYP_CD = #{regTypCd,jdbcType=VARCHAR},
    </if>
    <if test="frsRqstDtm != null" >
        FRS_RQST_DTM = #{frsRqstDtm,jdbcType=TIMESTAMP},
    </if>
    <if test="frsRqstUserId != null" >
        FRS_RQST_USER_ID = #{frsRqstUserId,jdbcType=VARCHAR},
    </if>
    <if test="rqstDtm != null" >
        RQST_DTM = #{rqstDtm,jdbcType=TIMESTAMP},
    </if>
    <if test="rqstUserId != null" >
        RQST_USER_ID = #{rqstUserId,jdbcType=VARCHAR},
    </if>
    <if test="aprvDtm != null" >
        APRV_DTM = #{aprvDtm,jdbcType=TIMESTAMP},
    </if>
    <if test="aprvUserId != null" >
        APRV_USER_ID = #{aprvUserId,jdbcType=VARCHAR},
    </if>
    <if test="scrtInfo != null" >
        SCRT_INFO = #{scrtInfo,jdbcType=CLOB},
    </if>
    <if test="rqstResn != null" >
        RQST_RESN = #{rqstResn,jdbcType=VARCHAR},
    </if>
    <if test="aplReqTypCd != null" >
        APL_REQ_TYP_CD = #{aplReqTypCd,jdbcType=VARCHAR},
    </if>
    <if test="aplReqdt != null" >
        APL_REQ_DT = TO_CHAR(TO_DATE(#{aplReqdt,jdbcType=VARCHAR}, 'YYYY-MM-DD'), 'YYYY-MM-DD'),
    </if>
    <if test="prjMngNo != null" >
      PRJ_MNG_NO = #{prjMngNo,jdbcType=VARCHAR},
    </if>
    <if test="srMngNo != null" >
      SR_MNG_NO = #{srMngNo,jdbcType=VARCHAR},   
    </if>
    <if test="pckgNm != null" >
      PCKG_NM = #{pckgNm,jdbcType=VARCHAR},
    </if>
    <if test="seqClasCd != null" >
      SEQ_CLAS_CD = #{seqClasCd,jdbcType=VARCHAR},
    </if>
    <if test="seqInitCd != null" >
      SEQ_INIT_CD = #{seqInitCd,jdbcType=VARCHAR},
    </if>
    <if test="bizIfnc != null" >
      BIZ_IFNC = #{bizIfnc,jdbcType=VARCHAR},
    </if>
      <if test="srcDdlTrgDcd != null" >
        SRC_DDL_TRG_DCD = #{srcDdlTrgDcd,jdbcType=VARCHAR},
      </if>
      <if test="srcDbSchId != null" >
        SRC_DB_SCH_ID = #{srcDbSchId,jdbcType=VARCHAR},
      </if>
      <if test="srcDbSchPnm != null" >
        SRC_DB_SCH_PNM = #{srcDbSchPnm,jdbcType=VARCHAR},
      </if>
      <if test="srcDbConnTrgPnm != null" >
        SRC_DB_CONN_TRG_PNM = #{srcDbConnTrgPnm,jdbcType=VARCHAR},
      </if>
      <if test="tgtDdlTrgDcd != null" >
        TGT_DDL_TRG_DCD = #{tgtDdlTrgDcd,jdbcType=VARCHAR},
      </if>
      <if test="tgtDbSchId != null" >
        TGT_DB_SCH_ID = #{tgtDbSchId,jdbcType=VARCHAR},
      </if>
      <if test="tgtDbSchPnm != null" >
        TGT_DB_SCH_PNM = #{tgtDbSchPnm,jdbcType=VARCHAR},
      </if>
      <if test="tgtDbConnTrgPnm != null" >
        TGT_DB_CONN_TRG_PNM = #{tgtDbConnTrgPnm,jdbcType=VARCHAR},   
      </if>   
      </set>   
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    update WAQ_DDL_SEQ
    set DDL_SEQ_ID = #{ddlSeqId,jdbcType=VARCHAR},
      DDL_SEQ_PNM = #{ddlSeqPnm,jdbcType=VARCHAR},
      DDL_SEQ_LNM = #{ddlSeqLnm,jdbcType=VARCHAR},
      RQST_DCD = #{rqstDcd,jdbcType=VARCHAR},
      RVW_STS_CD = #{rvwStsCd,jdbcType=VARCHAR},
      RVW_CONTS = #{rvwConts,jdbcType=VARCHAR},
      VRF_CD = #{vrfCd,jdbcType=VARCHAR},
      VRF_RMK = #{vrfRmk,jdbcType=VARCHAR},
      DB_CONN_TRG_PNM = #{dbConnTrgPnm,jdbcType=VARCHAR},
      DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR},
      DB_SCH_PNM = #{dbSchPnm,jdbcType=VARCHAR},
      INCBY = #{incby,jdbcType=VARCHAR},
      STRTWT = #{strtwt,jdbcType=VARCHAR},
      MAXVAL = #{maxval,jdbcType=VARCHAR},
      MINVAL = #{minval,jdbcType=VARCHAR},
      CYC_YN = #{cycYn,jdbcType=VARCHAR},
      CACHE_SZ = #{cacheSz,jdbcType=VARCHAR},
      ORD_YN = #{ordYn,jdbcType=VARCHAR},
      NM_RL_TYP_CD = #{nmRlTypCd,jdbcType=VARCHAR},
      US_TYP_CD = #{usTypCd,jdbcType=VARCHAR},
      PDM_TBL_PNM = #{pdmTblPnm,jdbcType=VARCHAR},
      PDM_COL_PNM = #{pdmColPnm,jdbcType=VARCHAR},
      L1CD_PNM = #{l1cdPnm,jdbcType=VARCHAR},
      L3CD_PNM = #{l3cdPnm,jdbcType=VARCHAR},
      GRT_LST = #{grtLst,jdbcType=VARCHAR},      
      DDL_TRG_DCD = #{ddlTrgDcd,jdbcType=VARCHAR},
      SRC_DB_SCH_ID = #{srcDbSchId,jdbcType=VARCHAR},
      SRC_DDL_SEQ_ID = #{srcDdlSeqId,jdbcType=VARCHAR},      
      OBJ_DESCN = #{objDescn,jdbcType=VARCHAR},
      OBJ_VERS = #{objVers,jdbcType=DECIMAL},
      REG_TYP_CD = #{regTypCd,jdbcType=VARCHAR},
      FRS_RQST_DTM = #{frsRqstDtm,jdbcType=TIMESTAMP},
      FRS_RQST_USER_ID = #{frsRqstUserId,jdbcType=VARCHAR},
      RQST_DTM = #{rqstDtm,jdbcType=TIMESTAMP},
      RQST_USER_ID = #{rqstUserId,jdbcType=VARCHAR},
      APRV_DTM = #{aprvDtm,jdbcType=TIMESTAMP},
      APRV_USER_ID = #{aprvUserId,jdbcType=VARCHAR},
      SCRT_INFO = #{scrtInfo,jdbcType=CLOB}
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    update WAQ_DDL_SEQ
    set DDL_SEQ_ID = #{ddlSeqId,jdbcType=VARCHAR},
      DDL_SEQ_PNM = #{ddlSeqPnm,jdbcType=VARCHAR},
      DDL_SEQ_LNM = #{ddlSeqLnm,jdbcType=VARCHAR},
      RQST_DCD = #{rqstDcd,jdbcType=VARCHAR},
      RVW_STS_CD = #{rvwStsCd,jdbcType=VARCHAR},
      RVW_CONTS = #{rvwConts,jdbcType=VARCHAR},
      VRF_CD = #{vrfCd,jdbcType=VARCHAR},
      VRF_RMK = #{vrfRmk,jdbcType=VARCHAR},
      DB_CONN_TRG_PNM = #{dbConnTrgPnm,jdbcType=VARCHAR},
      DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR},
      DB_SCH_PNM = #{dbSchPnm,jdbcType=VARCHAR},
      INCBY = #{incby,jdbcType=VARCHAR},
      STRTWT = #{strtwt,jdbcType=VARCHAR},
      MAXVAL = #{maxval,jdbcType=VARCHAR},
      MINVAL = #{minval,jdbcType=VARCHAR},
      CYC_YN = #{cycYn,jdbcType=VARCHAR},
      CACHE_SZ = #{cacheSz,jdbcType=VARCHAR},
      ORD_YN = #{ordYn,jdbcType=VARCHAR},
      NM_RL_TYP_CD = #{nmRlTypCd,jdbcType=VARCHAR},
      US_TYP_CD = #{usTypCd,jdbcType=VARCHAR},
      PDM_TBL_PNM = #{pdmTblPnm,jdbcType=VARCHAR},
      PDM_COL_PNM = #{pdmColPnm,jdbcType=VARCHAR},
      L1CD_PNM = #{l1cdPnm,jdbcType=VARCHAR},
      L3CD_PNM = #{l3cdPnm,jdbcType=VARCHAR},
      GRT_LST = #{grtLst,jdbcType=VARCHAR},      
      DDL_TRG_DCD = #{ddlTrgDcd,jdbcType=VARCHAR},
      SRC_DB_SCH_ID = #{srcDbSchId,jdbcType=VARCHAR},
      SRC_DDL_SEQ_ID = #{srcDdlSeqId,jdbcType=VARCHAR},      
      OBJ_DESCN = #{objDescn,jdbcType=VARCHAR},
      OBJ_VERS = #{objVers,jdbcType=DECIMAL},
      REG_TYP_CD = #{regTypCd,jdbcType=VARCHAR},
      FRS_RQST_DTM = #{frsRqstDtm,jdbcType=TIMESTAMP},
      FRS_RQST_USER_ID = #{frsRqstUserId,jdbcType=VARCHAR},
      RQST_DTM = #{rqstDtm,jdbcType=TIMESTAMP},
      RQST_USER_ID = #{rqstUserId,jdbcType=VARCHAR},
      APRV_DTM = #{aprvDtm,jdbcType=TIMESTAMP},
      APRV_USER_ID = #{aprvUserId,jdbcType=VARCHAR}
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </update>
  
  <select id="selectDdlSeqListbyMst" parameterType="kr.wise.commons.rqstmst.service.WaqMstr" resultMap="BaseResultMap" >
  	--DDL 시퀀스 요청서 리스트 조회
  	SELECT 
  	 A.RQST_NO, A.RQST_SNO, A.DDL_SEQ_ID, A.DDL_SEQ_PNM, A.DDL_SEQ_LNM, A.RQST_DCD, A.RVW_CONTS, 
    A.VRF_CD, A.VRF_RMK, A.DB_CONN_TRG_PNM, A.DB_SCH_ID, A.DB_SCH_PNM, A.INCBY, A.STRTWT, A.MAXVAL, A.MINVAL, 
    A.CYC_YN, A.CACHE_SZ, A.ORD_YN, A.NM_RL_TYP_CD, A.US_TYP_CD, A.PDM_TBL_PNM, A.PDM_COL_PNM, A.L1CD_PNM, 
    A.L3CD_PNM, A.GRT_LST, A.DDL_TRG_DCD , A.SRC_DB_SCH_ID , A.SRC_DDL_SEQ_ID, A.OBJ_DESCN, A.OBJ_VERS, A.REG_TYP_CD, A.FRS_RQST_DTM, A.FRS_RQST_USER_ID, 
    A.RQST_DTM, A.RQST_USER_ID, A.APRV_DTM, A.APRV_USER_ID
	, A.RQST_RESN
     <choose>
		<when test='rqstStepCd == "Q" '>
			, CASE WHEN A.RVW_STS_CD = '2' THEN '2' ELSE '0' END AS RVW_STS_CD
		</when>
		<otherwise>
			, A.RVW_STS_CD
		</otherwise>
	  </choose>
     
	 , CASE WHEN A.VRF_CD = '2' THEN '#FF0000' ELSE CASE WHEN A.VRF_CD = '5' THEN '#0000FF'  END END AS FontColor 
     , U.USER_NM AS RQST_USER_NM
	 , A.APL_REQ_TYP_CD
     , A.APL_REQ_DT 
     , A.PRJ_MNG_NO
	 , A.SR_MNG_NO  
	 , A.PCKG_NM
	 , A.SEQ_CLAS_CD   
	 , A.SEQ_INIT_CD
	 , A.BIZ_IFNC
 	 , C.DB_CONN_TRG_PNM AS SRC_DB_CONN_TRG_PNM
     , B.DB_SCH_PNM      AS SRC_DB_SCH_PNM
     , E.DB_CONN_TRG_ID  AS TGT_DB_CONN_TRG_ID 
     , E.DB_CONN_TRG_PNM AS TGT_DB_CONN_TRG_PNM
     , D.DB_SCH_PNM      AS TGT_DB_SCH_PNM
    FROM WAQ_DDL_SEQ A
   	LEFT JOIN WAA_DB_SCH B
        ON B.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')
       AND B.DB_SCH_ID = A.SRC_DB_SCH_ID
      LEFT JOIN WAA_DB_CONN_TRG C
        ON C.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')   
       AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID
      LEFT JOIN WAA_DB_SCH D
        ON D.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')
       AND D.DB_SCH_ID = A.TGT_DB_SCH_ID
      LEFT JOIN WAA_DB_CONN_TRG E
        ON E.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')
       AND E.DB_CONN_TRG_ID = D.DB_CONN_TRG_ID  
    LEFT JOIN WAA_USER U
      ON A.RQST_USER_ID = U.USER_ID
     AND U.REG_TYP_CD IN ('C', 'U')
     AND U.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD') 
    WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
    <if test='rqstStepCd == "Q" or rqstStepCd == "A" '>
    	AND A.VRF_CD = '1'
    </if>
    ORDER BY A.RQST_SNO  	  	
  </select>
  
  <select id="selectDdlSeqDetail" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" resultMap="ResultMapWithBLOBs">
  	-- DDL 시퀀스 요청서 상세조회
  	SELECT
      	  <include refid="waq_Column_List" />
      FROM WAQ_DDL_SEQ A 
     WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
       AND A.RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </select>
  
  <delete id="deleteByrqstSno" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
    delete from WAQ_DDL_SEQ
    where RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      and RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </delete>
  
  <update id="updateDbmsId" parameterType="string">
  --DBMS 스키마 ID 업데이트
  UPDATE WAQ_DDL_SEQ A
     SET A.DB_SCH_ID =  (
     		SELECT C.DB_SCH_ID 
     		  FROM WAA_DB_SCH C 
     		  INNER JOIN WAA_DB_CONN_TRG D
				ON D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
			   AND D.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
			   AND D.REG_TYP_CD IN ('C', 'U')
			 WHERE C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
			   AND C.REG_TYP_CD IN ('C', 'U')
			   AND C.DB_SCH_PNM   = A.DB_SCH_PNM
               AND D.DB_CONN_TRG_PNM = A.DB_CONN_TRG_PNM
     )
   WHERE A.DB_SCH_ID IS NULL
     AND A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
     
  </update>
  
  <update id="updateTsfInfo" parameterType="map">
     --이관정보 업데이트(변경 삭제대상일 경우)
     UPDATE WAQ_DDL_SEQ A 
     SET ( A.DDL_TRG_DCD , A.SRC_DB_SCH_ID , A.SRC_DDL_SEQ_ID ) 
       = (      SELECT B.DDL_TRG_DCD , B.SRC_DB_SCH_ID , B.SRC_DDL_SEQ_ID
		        FROM WAM_DDL_SEQ B
		        WHERE A.DDL_SEQ_PNM = B.DDL_SEQ_PNM
		        AND A.DB_SCH_ID   = B.DB_SCH_ID
		 )
  	 WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
  	   AND A.REG_TYP_CD IN ('U', 'D')
   	</update>
  
  <update id="updateCheckInit" parameterType="string">
  	--요청구분 업데이트
    UPDATE WAQ_DDL_SEQ A
      SET A.REG_TYP_CD = (
    					SELECT CASE WHEN A.RQST_DCD = 'DD' THEN 'D' ELSE CASE WHEN MAX(B.DDL_SEQ_ID ) IS NULL THEN 'C' ELSE 'U' END END
                          FROM WAM_DDL_SEQ B 
                           INNER JOIN WAA_DB_SCH C
                            ON B.DB_SCH_ID = C.DB_SCH_ID
                           AND C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
					   	   AND C.REG_TYP_CD IN ('C', 'U')
					   	   INNER JOIN WAA_DB_CONN_TRG D
					   	    ON D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
					   	   AND D.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
					   	   AND D.REG_TYP_CD IN ('C', 'U')
                         WHERE B.REG_TYP_CD IN ('C','U')
                           AND B.DDL_SEQ_PNM = A.DDL_SEQ_PNM
                           AND C.DB_SCH_PNM   = A.DB_SCH_PNM
                           AND D.DB_CONN_TRG_PNM = A.DB_CONN_TRG_PNM
                       )
       ,A.VRF_CD = '4'
    WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}  	
  </update>
  
  <insert id="checkDupSeq" parameterType="map">
  	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
  	--검증쿼리 : 요청서내 중복(DS001)
    AND EXISTS ( SELECT 1
	             FROM WAQ_DDL_SEQ D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DDL_SEQ_PNM = D.DDL_SEQ_PNM
	               AND A.DB_CONN_TRG_PNM	= D.DB_CONN_TRG_PNM
	               AND A.DB_SCH_PNM = D.DB_SCH_PNM
	               AND A.RQST_SNO != D.RQST_SNO
                )
  </insert>
  
  <insert id="checkNotExistSeq" parameterType="map">
  	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
      --검증쿼리 : 삭제대상 시퀀스 미존재(DS002)
      AND A.RQST_DCD = 'DD'
      AND NOT EXISTS ( SELECT 1
	                   FROM WAM_DDL_SEQ D
	                   WHERE A.DDL_SEQ_PNM = D.DDL_SEQ_PNM
	               		 AND A.DB_SCH_ID  = D.DB_SCH_ID
                      )  
  </insert>
  
  <insert id="checkNonDbmsID" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : DBMS 스키마 ID 미존재 (DS003)
	  AND A.DB_SCH_ID IS NULL
  </insert>  
  
  <insert id="checkRequestSeq" parameterType="map">
  	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
  	--검증쿼리 : 요청중인 시퀀스 (DS004)
    AND EXISTS (
	    		 SELECT 1 
	    		  FROM WAQ_MSTR E
	             INNER JOIN WAQ_DDL_SEQ D
	             	ON E.RQST_NO = D.RQST_NO
	             WHERE E.RQST_NO != #{rqstNo}
	               AND E.RQST_STEP_CD = 'Q'
	               AND A.DDL_SEQ_PNM = D.DDL_SEQ_PNM
	               AND A.DB_CONN_TRG_PNM	= D.DB_CONN_TRG_PNM
	               AND A.DB_SCH_PNM = D.DB_SCH_PNM
	               AND D.VRF_CD = '1'
				   AND NVL(D.RVW_STS_CD, '0') != '2'
               )
  </insert>
  
  <insert id="checkSeqPnmEnt" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : 시퀀스 명명규칙(엔티티기반) 위반 (DS005)
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'E'
      --테이블명+_+S+X(사용용도유형1자리(일반:G/일별:D/일중:E))+##(일련번호2자리)
      AND A.PDM_TBL_PNM || '_S' || A.US_TYP_CD || '00' 
      	  != SUBSTR(A.DDL_SEQ_PNM, 1, LENGTH(A.PDM_TBL_PNM) + 3 )
      	     || TRANSLATE(SUBSTR(A.DDL_SEQ_PNM, LENGTH(A.PDM_TBL_PNM) + 4),'1234567890', '0000000000') 
	  -- 20180524 우동원 차장 표준적용여부 Y 일경우만 체크
	  AND EXISTS (SELECT 1 
	                FROM WAM_PDM_TBL Y
	                       /*
	                     INNER JOIN WAA_SUBJ Z
	                        ON Y.SUBJ_ID = Z.SUBJ_ID
	                       AND Z.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
	                       AND Z.REG_TYP_CD IN ('C','U')
	                       AND NVL(Z.STD_APL_CD, 'N') = 'Y'
	                       */
	               WHERE NVL(A.PDM_TBL_PNM,'_') = Y.PDM_TBL_PNM
	                 AND NVL(Y.STD_APL_CD, 'N') IN ('S','A') )  
      	        		
  </insert>
  
  <insert id="checkSeqPnmCol" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : 시퀀스 명명규칙(컬럼기반) 위반 (DS006)
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'C'
      --컬럼명+_+S+X(사용용도유형1자리(일반:G/일별:D/일중:E))+#(일련번호1자리)
      AND A.PDM_COL_PNM || '_S' || A.US_TYP_CD || '0' 
      	  != SUBSTR(A.DDL_SEQ_PNM, 1, LENGTH(A.PDM_COL_PNM) + 3 )
      	     || TRANSLATE(SUBSTR(A.DDL_SEQ_PNM, LENGTH(A.PDM_COL_PNM) + 4),'1234567890', '0000000000')
  </insert>
  
    <insert id="checkSeqPnmSubj" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : 시퀀스 명명규칙(주제영역기반) 위반 (DS007)
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'S'
      --L1코드+L3코드+###(일련번호3자리)+N+_+##(자릿수2자리)+_(옵션)+YYYYMMDD(일자,옵션)_+S+X(사용용도유형1자리(일반:G/일별:D/일중:E))
      AND  A.L1CD_PNM || A.L3CD_PNM || '000' || 'N_' || '00' || '_S' || A.US_TYP_CD
      	   != REGEXP_REPLACE(REGEXP_REPLACE(A.DDL_SEQ_PNM, '_[0-9]{8}_S', '_S'), '[0-9]', '0') 
           --!= TRANSLATE(SUBSTR(A.DDL_SEQ_PNM,1,14),'1234567890', '0000000000')
  </insert>
  
   <insert id="checkExistsTbl" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : 미존재테이블 (DS008)
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'E'
      AND NOT EXISTS ( SELECT 1
                         FROM WAM_DDL_TBL T
                        WHERE A.PDM_TBL_PNM = NVL(T.DDL_TBL_PNM, '_')
                          AND A.DB_SCH_ID = T.DB_SCH_ID
                        UNION ALL
                       SELECT 1
                         FROM WAQ_DDL_TBL DT
                        WHERE A.RQST_NO = DT.RQST_NO
                          AND A.PDM_TBL_PNM = NVL(DT.DDL_TBL_PNM, '_')
                          AND A.DB_SCH_ID = DT.DB_SCH_ID
                          AND DT.VRF_CD = '1' --등록가능
                     ) 
  </insert>
  
  <insert id="checkExistsCol" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : 미존재컬럼 (DS009)
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'C'
      AND NOT EXISTS ( SELECT 1
                         FROM WAM_DDL_TBL T
                              INNER JOIN WAM_DDL_COL C
                                 ON T.DDL_TBL_ID = C.DDL_TBL_ID
                        WHERE A.PDM_COL_PNM = NVL(C.DDL_COL_PNM, '_')
                          AND A.DB_SCH_ID = T.DB_SCH_ID
                        UNION ALL
                       SELECT 1
                         FROM WAQ_DDL_TBL RT
                              INNER JOIN WAQ_DDL_COL RC
                                 ON RT.RQST_NO = RC.RQST_NO
                                AND RT.RQST_SNO = RC.RQST_SNO
                        WHERE A.PDM_COL_PNM = NVL(RC.DDL_COL_PNM, '_')
                          AND A.DB_SCH_ID = RT.DB_SCH_ID
                     ) 
  </insert>
  
  <insert id="checkExistsL1L3Cd" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : 미존재 L1코드 또는 L3코드 (DS010)
      AND A.RQST_DCD = 'CU'
      AND A.NM_RL_TYP_CD = 'S'
      AND ( NOT EXISTS ( SELECT 1
<!-- 	                       FROM WAA_APP_CODE CD -->
	                       FROM (SELECT    A.SUBJ_PNM AS L3CD_PNM
								        , DECODE(B.L1CD_PNM, NULL, C.SYS_AREA_PNM, B.L1CD_PNM) AS L1CD_PNM
								   FROM WAA_SUBJ A
								   		INNER JOIN WAA_SYS_AREA C
								           ON A.SYS_AREA_ID = C.SYS_AREA_ID
								          AND C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
								          AND C.REG_TYP_CD  IN ('C','U')
								   		LEFT OUTER JOIN ( SELECT C.L1CD_PNM, C.L3CD_PNM
										                     FROM WAA_APP_CODE C
										                     GROUP BY C.L1CD_PNM, C.L3CD_PNM
										                   )B
								   		  ON A.SUBJ_PNM = B.L3CD_PNM
								   WHERE A.SUBJ_LVL = 0
								    AND A.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
								    AND A.REG_TYP_CD  IN ('C','U') 
	                       ) CD
	                      WHERE CD.L1CD_PNM = NVL(A.L1CD_PNM, '_')
	                   ) 
	        OR
	        NOT EXISTS ( SELECT 1
<!-- 	                     FROM WAA_APP_CODE CD -->
	                     FROM (SELECT    A.SUBJ_PNM AS L3CD_PNM
								        , DECODE(B.L1CD_PNM, NULL, C.SYS_AREA_PNM, B.L1CD_PNM) AS L1CD_PNM
								   FROM WAA_SUBJ A
								   		INNER JOIN WAA_SYS_AREA C
								           ON A.SYS_AREA_ID = C.SYS_AREA_ID
								          AND C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
								          AND C.REG_TYP_CD  IN ('C','U')
								   		LEFT OUTER JOIN ( SELECT C.L1CD_PNM, C.L3CD_PNM
										                     FROM WAA_APP_CODE C
										                     GROUP BY C.L1CD_PNM, C.L3CD_PNM
										                   )B
								   		  ON A.SUBJ_PNM = B.L3CD_PNM
								   WHERE A.SUBJ_LVL = 0
								    AND A.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
								    AND A.REG_TYP_CD  IN ('C','U') 
	                       ) CD	                     
	                     WHERE CD.L3CD_PNM = NVL(A.L3CD_PNM, '_')
	                   ) 
	      )
  </insert>
  
  <insert id="checkExistsGrtLst" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : 미존재 권한 포함 (DS011)
      AND A.RQST_DCD = 'CU'
      AND A.GRT_LST IS NOT NULL
      <![CDATA[
      AND EXISTS (  SELECT 1
                    FROM ( SELECT REGEXP_SUBSTR(E.TXT, '[^;]+', 1,LEVEL) AS GRT, E.RQST_NO, E.RQST_SNO
                            FROM (  SELECT GRT_LST AS TXT, D.RQST_NO, D.RQST_SNO
                                    FROM WAQ_DDL_SEQ D
                                    WHERE D.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
                                 ) E
                            CONNECT BY LEVEL <= LENGTH(REGEXP_REPLACE(E.TXT, '[^;]+',''))+1
                            AND REGEXP_SUBSTR(E.TXT, '[^;]+', 1,LEVEL) IS NOT NULL
                         ) F
                    WHERE F.RQST_NO = A.RQST_NO
                      AND F.RQST_SNO = A.RQST_SNO
                      AND NOT EXISTS ( SELECT 1
                                    --   FROM WAA_APP_CODE G
                                       	 FROM (SELECT    A.SUBJ_PNM AS L3CD_PNM
											        , DECODE(B.L1CD_PNM, NULL, C.SYS_AREA_PNM, B.L1CD_PNM) AS L1CD_PNM
											   FROM WAA_SUBJ A
											   		INNER JOIN WAA_SYS_AREA C
											           ON A.SYS_AREA_ID = C.SYS_AREA_ID
											          AND C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
											          AND C.REG_TYP_CD  IN ('C','U')
											   		LEFT OUTER JOIN ( SELECT C.L1CD_PNM, C.L3CD_PNM
													                     FROM WAA_APP_CODE C
													                     GROUP BY C.L1CD_PNM, C.L3CD_PNM
													                   )B
											   		  ON A.SUBJ_PNM = B.L3CD_PNM
											   WHERE A.SUBJ_LVL = 0
											    AND A.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
											    AND A.REG_TYP_CD  IN ('C','U') 
				                       ) G                                       
                                       WHERE G.L3CD_PNM = F.GRT
                                     )                                         
                 )
      ]]>
  </insert>
  
  <insert id="checkAplRegDd" parameterType="map">
  -- 검증쿼리 : 적용예정일자 오늘날자보다 작은지 체크 (DS012)
  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
<!--   AND A.RQST_DCD = 'CU' -->
  AND A.APL_REQ_DT IS NOT NULL
  <![CDATA[
  AND A.APL_REQ_DT < TO_CHAR(SYSDATETIME, 'YYYY-MM-DD')
   ]]>
   </insert>  
  
  
  <insert id="checkNotChgData" parameterType="map">
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --검증쿼리 : 변경일 때 변경된 데이터가 없을 경우 (DS000)
      AND A.REG_TYP_CD = 'U'
      AND EXISTS (
      		SELECT 1 FROM WAM_DDL_SEQ D
      		 WHERE A.DDL_SEQ_PNM = D.DDL_SEQ_PNM
               AND A.DB_SCH_ID  = D.DB_SCH_ID
      		   AND NVL(A.INCBY, '_') 		= NVL(D.INCBY, '_')
      		   AND NVL(A.STRTWT, '_') 		= NVL(D.STRTWT, '_')
      		   AND NVL(A.MAXVAL, '_') 		= NVL(D.MAXVAL, '_')
      		   AND NVL(A.MINVAL, '_') 		= NVL(D.MINVAL, '_')
      		   AND NVL(A.CYC_YN, '_') 		= NVL(D.CYC_YN, '_')
      		   AND NVL(A.CACHE_SZ, '_') 	= NVL(D.CACHE_SZ, '_')
      		   AND NVL(A.ORD_YN, '_') 		= NVL(D.ORD_YN, '_')
      		   AND NVL(A.GRT_LST, '_') 		= NVL(D.GRT_LST, '_')
      		   AND NVL(A.PCKG_NM, '_') 		= NVL(D.PCKG_NM, '_')
      		   AND NVL(A.SEQ_CLAS_CD, '_') 	= NVL(D.SEQ_CLAS_CD, '_')
      		   AND NVL(A.SEQ_INIT_CD, '_') 	= NVL(D.SEQ_INIT_CD, '_')
      		   AND NVL(A.BIZ_IFNC, '_') 	= NVL(D.BIZ_IFNC, '_')
      		   AND NVL(A.OBJ_DESCN, '_')	= NVL(D.OBJ_DESCN, '_')
      		)
  </insert>
  
  <update id="updateDdlScriptWaq" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq">
  	--DDL 스크립트 업데이트...
  	UPDATE WAQ_DDL_SEQ
  	   SET SCRT_INFO = #{scrtInfo,jdbcType=VARCHAR}
  	 WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
       AND RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
  </update>
  
  <!-- 승인/반려 업데이트 -->
  <update id="updatervwStsCd" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
  	UPDATE WAQ_DDL_SEQ
  	<set>
  	    RVW_STS_CD 	= #{rvwStsCd} , 
  		RVW_CONTS 	= #{rvwConts} , 
  		APRV_DTM	= SYSDATETIME ,
  		APRV_USER_ID = #{aprvUserId} ,
  	</set>
    WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      AND RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
      AND VRF_CD = '1'
      AND NVL(RVW_STS_CD, '_') != '2'
  </update> 
  
<update id="updatervwStsCdByTbl" parameterType="kr.wise.meta.ddl.service.WaqDdlIdx" >
  	UPDATE WAQ_DDL_SEQ S
  	<set>
  	    S.RVW_STS_CD 	= #{rvwStsCd} , 
  		S.RVW_CONTS 	= #{rvwConts} , 
  		S.APRV_DTM	= SYSDATETIME ,
  		S.APRV_USER_ID = #{aprvUserId} ,
  	</set>
    WHERE S.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
      AND S.PDM_TBL_PNM IN (SELECT T.DDL_TBL_PNM
                              FROM WAQ_DDL_TBL T
                             WHERE T.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
                               AND T.RQST_SNO = #{rqstSno,jdbcType=VARCHAR}
                               AND T.RVW_STS_CD = '2' --반려인것만
                               AND T.REG_TYP_CD = 'C' --신규중
                               AND T.VRF_CD = '1' --등록가능
                            ) 
<!--       AND RQST_SNO = #{rqstSno,jdbcType=DECIMAL} -->
      AND S.VRF_CD = '1'
      AND NVL(S.RVW_STS_CD, '_') != '2'
      AND S.NM_RL_TYP_CD = 'E' --엔티티기반
  </update>  
  
     <update id="updateidByKey" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq">
     --신규 적재 대상 ID 업데이트
     UPDATE WAQ_DDL_SEQ SET DDL_SEQ_ID = #{ddlSeqId,jdbcType=VARCHAR}
  	 WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
       AND RQST_SNO = #{rqstSno,jdbcType=DECIMAL}
   </update>
   
   <select id="selectWaqC" parameterType="map" resultMap="BaseResultMap">
   	--신규 적재 대상 추출
   	SELECT * FROM WAQ_DDL_SEQ
   	WHERE RQST_NO = #{rqstNo}
   	  AND RVW_STS_CD = '1'  --승인
   	  AND REG_TYP_CD = 'C'
   </select>  
   
   <update id="updateWaqCUD" parameterType="map">
   	--WAQ ID, VERS 등을 업데이트...
	UPDATE WAQ_DDL_SEQ A
	SET (DDL_SEQ_ID, OBJ_VERS, FRS_RQST_DTM, FRS_RQST_USER_ID) = (
	    SELECT 
	          B.DDL_SEQ_ID AS DDL_SEQ_ID
	        , NVL(B.OBJ_VERS, 0) + 1 AS OBJ_VERS
	        , B.FRS_RQST_DTM
	        , B.FRS_RQST_USER_ID
	    FROM WAM_DDL_SEQ B
	    WHERE B.DDL_SEQ_PNM = A.DDL_SEQ_PNM
	      AND B.DB_SCH_ID = A.DB_SCH_ID
	)
	WHERE A.RQST_NO = #{rqstNo}
	AND A.RVW_STS_CD = '1'  --승인
	AND EXISTS (
		SELECT 1 FROM WAM_DDL_SEQ B
	     WHERE B.DDL_SEQ_PNM = A.DDL_SEQ_PNM
	      AND B.DB_SCH_ID = A.DB_SCH_ID
	)
   </update>
   
    <delete id="deleteWAM" parameterType="map">
    --WAM 삭제 (등록유형코드가REG_TYP_CD 변경, 삭제일 경우)
	DELETE FROM WAM_DDL_SEQ A
	WHERE EXISTS (
	    SELECT 1 FROM WAQ_DDL_SEQ B
	     WHERE B.RQST_NO = #{rqstNo}
	       AND B.RVW_STS_CD = '1'
	       AND B.DB_SCH_ID = A.DB_SCH_ID
	       AND B.DDL_SEQ_ID = A.DDL_SEQ_ID
	)
   </delete>   

   <insert id="insertWAM" parameterType="map">
   	--WAM 추가 (WAQ 내용을 추가, REG_TYP_CD 가 신규,변경일 경우)
	INSERT INTO WAM_DDL_SEQ (DDL_SEQ_ID <include refid="wam_col"/> )
	SELECT 
		DDL_SEQ_ID 	
	<include refid="wam_col"/>
	
	FROM WAQ_DDL_SEQ A
	WHERE A.RQST_NO = #{rqstNo}
	AND A.RVW_STS_CD = '1'
	AND A.REG_TYP_CD IN ('C', 'U')
   </insert>  
   
   <update id="updateWAH"  parameterType="map">
   	--WAH 이력 만료...
	UPDATE WAH_DDL_SEQ A
	SET EXP_DTM = SYSDATETIME
	WHERE EXISTS (
	   SELECT 1 FROM WAQ_DDL_SEQ B
	    WHERE B.RQST_NO = #{rqstNo}
	      AND B.RVW_STS_CD = '1'
	      AND B.DB_SCH_ID = A.DB_SCH_ID
	      AND B.DDL_SEQ_ID = A.DDL_SEQ_ID
	    )
	AND EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
   </update>  

   <insert id="insertWAH"  parameterType="map">
   	--WAH이력 적재...
	INSERT INTO WAH_DDL_SEQ (DDL_SEQ_ID, EXP_DTM, STR_DTM <include refid="wam_col"/>)
	SELECT
	    A.DDL_SEQ_ID AS DDL_SEQ_ID
	    , TO_DATE( '9999-12-31', 'YYYY-MM-DD') AS EXP_DTM
	    , SYSDATETIME AS STR_DTM 
	
	<include refid="wam_col"/>
   
	 FROM WAQ_DDL_SEQ A
	WHERE A.RQST_NO = #{rqstNo}
	  AND A.RVW_STS_CD = '1'
	  AND A.DDL_SEQ_ID IS NOT NULL
   </insert> 
   
   <select id="selectwamseqlist" parameterType="map" resultMap="BaseResultMap">
  	--DDL 시퀀스 추가대상 조회...
   		SELECT 
  		      'I' AS IBS_STATUS
		  	, #{reqmst.rqstDcd} AS RQST_DCD 
            , A.DDL_SEQ_ID, A.DDL_SEQ_PNM, A.DDL_SEQ_LNM
		    , A.DB_SCH_ID
		    , S.DB_SCH_PNM
		    , DB.DB_CONN_TRG_PNM
		    , A.INCBY, A.STRTWT, A.MAXVAL, A.MINVAL 
		    , A.CYC_YN, A.CACHE_SZ, A.ORD_YN, A.NM_RL_TYP_CD, A.US_TYP_CD, A.PDM_TBL_PNM, A.PDM_COL_PNM
		    , A.L1CD_PNM, A.L3CD_PNM, A.GRT_LST
		    , A.DDL_TRG_DCD , A.SRC_DB_SCH_ID , A.SRC_DDL_SEQ_ID
		    , A.OBJ_DESCN
		    , A.PRJ_MNG_NO
			, A.SR_MNG_NO  
			, A.PCKG_NM
			, A.SEQ_CLAS_CD   
			, A.SEQ_INIT_CD
			, A.BIZ_IFNC
	  FROM WAM_DDL_SEQ A
	 INNER JOIN WAA_DB_SCH S
	    ON A.DB_SCH_ID = S.DB_SCH_ID
	   AND S.REG_TYP_CD IN ('C', 'U')
	   AND S.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	 INNER JOIN WAA_DB_CONN_TRG DB
	    ON S.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
	   AND DB.REG_TYP_CD IN ('C', 'U')
	   AND DB.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	  LEFT OUTER JOIN WAA_USER U
	    ON A.FRS_RQST_USER_ID = U.USER_ID
	   AND U.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	   AND U.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_USER U1
	    ON A.RQST_USER_ID = U1.USER_ID
	   AND U1.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	   AND U1.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_USER U2
	    ON A.APRV_USER_ID = U2.USER_ID
	   AND U2.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	   AND U2.REG_TYP_CD IN ('C', 'U')
	  <where>
	  	 AND S.DDL_TRG_DCD = 'D'
	  	 AND  A.DDL_SEQ_ID IN 
		 <foreach collection="list" item="item" open="(" separator="," close=")">
		  	#{item.ddlSeqId}
		 </foreach>	  
	  </where>  

  </select>     
  
  
  <select id="selectDdlTsfList" parameterType="map" resultMap="BaseResultMap">
  	--DDL시퀀스 이관 대상 조회...
	SELECT 
<!--   			((SELECT NVL(MAX(RQST_SNO), 0) FROM WAQ_PDM_TBL WHERE RQST_NO = #{reqmst.rqstNo}) + ROWNUM) AS RQST_SNO -->
  		   'I' AS IBS_STATUS
		  , A.DDL_SEQ_PNM
		  , A.DDL_SEQ_LNM
		  , #{reqmst.rqstDcd} AS RQST_DCD 
		  , A.OBJ_DESCN
		  , TSC.DDL_TRG_DCD AS DDL_TRG_DCD
		  , TDB.DB_CONN_TRG_PNM
		  , TSC.DB_SCH_PNM AS DB_SCH_PNM
		  , TSC.DB_SCH_ID AS DB_SCH_ID			  
		  , A.DB_SCH_ID AS SRC_DB_SCH_ID	
		  <if test='reqmst.rqstDcd == "CU" '>
          , NULL AS DDL_SEQ_ID
          , A.DDL_SEQ_ID AS SRC_DDL_SEQ_ID
      	  </if>
	      <if test='reqmst.rqstDcd == "DD" '>
          ,A.DDL_SEQ_ID
          ,A.SRC_DDL_SEQ_ID
          </if>
          ,A.INCBY 
          ,A.STRTWT 
          ,A.MAXVAL 
          ,A.MINVAL 
          ,A.CYC_YN 
          ,A.CACHE_SZ 
          ,A.ORD_YN 
          ,A.NM_RL_TYP_CD
          ,A.US_TYP_CD  
          ,A.PDM_TBL_PNM 
          ,A.PDM_COL_PNM
          ,A.L1CD_PNM 
          ,A.L3CD_PNM 
          ,A.GRT_LST 
	      <if test="dbmsInfo.prjMngNo != null">
		  , #{dbmsInfo.prjMngNo,jdbcType=VARCHAR} AS PRJ_MNG_NO
		  </if>
	      <if test="dbmsInfo.srMngNo != null">
		  , #{dbmsInfo.srMngNo,jdbcType=VARCHAR} AS SR_MNG_NO
		  </if>
	      <if test="dbmsInfo.prjMngNo == null">
		  , A.PRJ_MNG_NO
		  </if>
	      <if test="dbmsInfo.srMngNo == null">
		  , A.SR_MNG_NO
		  </if>  
			, A.PCKG_NM
			, A.SEQ_CLAS_CD   
			, A.SEQ_INIT_CD
			, A.BIZ_IFNC		  
	  FROM WAM_DDL_SEQ A
	  INNER JOIN WAA_DB_SCH C
	     ON A.DB_SCH_ID = C.DB_SCH_ID
	    AND C.REG_TYP_CD IN ('C', 'U')
		AND C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
      INNER JOIN WAA_DB_CONN_TRG DB
	     ON C.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
	    AND DB.REG_TYP_CD IN ('C', 'U')
	    AND DB.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	  INNER JOIN WAA_DB_MAP M
	  <if test='reqmst.rqstDcd == "CU" '>
         ON M.SRC_DB_SCH_ID = C.DB_SCH_ID
        AND M.TGT_DB_SCH_ID = #{dbmsInfo.tgtDbSchId,jdbcType=VARCHAR} 
      </if>
	  <if test='reqmst.rqstDcd == "DD" '>
         ON M.TGT_DB_SCH_ID = C.DB_SCH_ID
        AND M.SRC_DB_SCH_ID = A.SRC_DB_SCH_ID
      </if>	 
        AND M.REG_TYP_CD IN ('C', 'U')
        AND M.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')    
      INNER JOIN WAA_DB_SCH TSC
	     ON M.TGT_DB_SCH_ID = TSC.DB_SCH_ID
	    AND TSC.REG_TYP_CD IN ('C', 'U')
	    AND TSC.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	  INNER JOIN WAA_DB_CONN_TRG TDB
	     ON TSC.DB_CONN_TRG_ID = TDB.DB_CONN_TRG_ID
	    AND TDB.REG_TYP_CD IN ('C', 'U')
	    AND TDB.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	    --템프 테이블 이용
	  INNER JOIN WAQ_OBJ_ID TQ
	     ON A.DDL_SEQ_ID =  TQ.OBJ_ID
	    AND TQ.RQST_NO = #{reqmst.rqstNo}	    
<!-- 	  WHERE  A.DDL_SEQ_ID IN  -->
<!-- 	 <foreach collection="list" item="item" open="(" separator="," close=")"> -->
<!-- 	  	<choose> -->
<!-- 			<when test='item.objDcd == "SEQ"'> -->
<!-- 				#{item.ddlObjId} -->
<!-- 			</when> -->
<!-- 			<otherwise> -->
<!-- 				NULL -->
<!-- 			</otherwise> -->
<!-- 		</choose> -->
<!-- 	 </foreach> -->
    WHERE NOT EXISTS (SELECT 1 
                        FROM WAQ_DDL_SEQ X
                       WHERE X.RQST_NO = #{reqmst.rqstNo}
                         AND TDB.DB_CONN_TRG_PNM = X.DB_CONN_TRG_PNM
                         AND TSC.DB_SCH_PNM = X.DB_SCH_PNM 
                         AND A.DDL_SEQ_PNM = X.DDL_SEQ_PNM 
                        )

	 	  
  </select> 
  
  <select id="selectDdlTsfListByTbl" parameterType="map" resultMap="BaseResultMap">
  	--DDL시퀀스 이관 대상 조회...
	SELECT DISTINCT 
  		   'I' AS IBS_STATUS
		  , A.DDL_SEQ_PNM
		  , A.DDL_SEQ_LNM
		  , #{reqmst.rqstDcd} AS RQST_DCD 
		  , A.OBJ_DESCN
		  , TSC.DDL_TRG_DCD AS DDL_TRG_DCD
		  , TDB.DB_CONN_TRG_PNM
		  , TSC.DB_SCH_PNM AS DB_SCH_PNM
		  , TSC.DB_SCH_ID AS DB_SCH_ID			  
		  , A.DB_SCH_ID AS SRC_DB_SCH_ID	
		  <if test='reqmst.rqstDcd == "CU" '>
          , NULL AS DDL_SEQ_ID
          , A.DDL_SEQ_ID AS SRC_DDL_SEQ_ID
      	  </if>
	      <if test='reqmst.rqstDcd == "DD" '>
          ,A.DDL_SEQ_ID
          ,A.SRC_DDL_SEQ_ID
          </if>
          ,A.INCBY 
          ,A.STRTWT 
          ,A.MAXVAL 
          ,A.MINVAL 
          ,A.CYC_YN 
          ,A.CACHE_SZ 
          ,A.ORD_YN 
          ,A.NM_RL_TYP_CD
          ,A.US_TYP_CD  
          ,A.PDM_TBL_PNM 
          ,A.PDM_COL_PNM
          ,A.L1CD_PNM 
          ,A.L3CD_PNM 
          ,A.GRT_LST 
 	      <if test="dbmsInfo.prjMngNo != null">
		  , #{dbmsInfo.prjMngNo,jdbcType=VARCHAR} AS PRJ_MNG_NO
		  </if>
	      <if test="dbmsInfo.srMngNo != null">
		  , #{dbmsInfo.srMngNo,jdbcType=VARCHAR} AS SR_MNG_NO
		  </if>
	      <if test="dbmsInfo.prjMngNo == null">
		  , A.PRJ_MNG_NO
		  </if>
	      <if test="dbmsInfo.srMngNo == null">
		  , A.SR_MNG_NO
		  </if>         
	  FROM WAQ_DDL_TBL Q
		  INNER JOIN WAM_DDL_SEQ A
		     ON Q.DDL_TBL_PNM = A.PDM_TBL_PNM
		  INNER JOIN WAA_DB_SCH C
		  <if test='reqmst.rqstDcd == "CU" '>
	         ON Q.SRC_DB_SCH_ID = C.DB_SCH_ID
		    AND A.DB_SCH_ID = C.DB_SCH_ID
	      </if>
		  <if test='reqmst.rqstDcd == "DD" '>
	         ON Q.DB_SCH_ID = C.DB_SCH_ID
	      </if>	 
		    AND C.REG_TYP_CD IN ('C', 'U')
			AND C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
	      INNER JOIN WAA_DB_CONN_TRG DB
		     ON C.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
		    AND DB.REG_TYP_CD IN ('C', 'U')
		    AND DB.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
		  INNER JOIN WAA_DB_MAP M
		  <if test='reqmst.rqstDcd == "CU" '>
	         ON M.SRC_DB_SCH_ID = C.DB_SCH_ID
	        AND M.TGT_DB_SCH_ID = #{dbmsInfo.tgtDbSchId,jdbcType=VARCHAR} 
	      </if>
		  <if test='reqmst.rqstDcd == "DD" '>
	         ON M.TGT_DB_SCH_ID = C.DB_SCH_ID
	        AND M.SRC_DB_SCH_ID = A.SRC_DB_SCH_ID
	      </if>	 
	        AND M.REG_TYP_CD IN ('C', 'U')
	        AND M.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')    
	      INNER JOIN WAA_DB_SCH TSC
		     ON M.TGT_DB_SCH_ID = TSC.DB_SCH_ID
		    AND TSC.REG_TYP_CD IN ('C', 'U')
		    AND TSC.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
		  INNER JOIN WAA_DB_CONN_TRG TDB
		     ON TSC.DB_CONN_TRG_ID = TDB.DB_CONN_TRG_ID
		    AND TDB.REG_TYP_CD IN ('C', 'U')
		    AND TDB.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
  WHERE Q.RQST_NO = #{reqmst.rqstNo} 
    AND NOT EXISTS (SELECT 1 
                     FROM WAQ_DDL_SEQ RQ
                    WHERE Q.RQST_NO = RQ.RQST_NO
                      AND TDB.DB_CONN_TRG_PNM = RQ.DB_CONN_TRG_PNM
                      AND TSC.DB_SCH_PNM = RQ.DB_SCH_PNM
                      AND A.DDL_SEQ_PNM = RQ.DDL_SEQ_PNM )
  </select> 
 
 
   <insert id="insertWaqRejected" parameterType="map">
   --반려 재상신 : 시퀀스
   INSERT INTO WAQ_DDL_SEQ (<include refid="Base_Column_List"/>)
   SELECT
	     #{reqmst.rqstNo,jdbcType=VARCHAR}            
	    ,RQST_SNO           
	    ,DDL_SEQ_ID         
	    ,DDL_SEQ_PNM        
	    ,DDL_SEQ_LNM        
	    ,RQST_DCD           
	    ,NULL AS RVW_STS_CD         
	    ,NULL AS RVW_CONTS          
	    ,NULL AS VRF_CD             
	    ,NULL AS VRF_RMK            
	    ,DB_CONN_TRG_PNM    
	    ,DB_SCH_ID          
	    ,DB_SCH_PNM         
	    ,INCBY              
	    ,STRTWT             
	    ,MAXVAL             
	    ,MINVAL             
	    ,CYC_YN             
	    ,CACHE_SZ           
	    ,ORD_YN             
	    ,NM_RL_TYP_CD       
	    ,US_TYP_CD          
	    ,PDM_TBL_PNM        
	    ,PDM_COL_PNM        
	    ,L1CD_PNM           
	    ,L3CD_PNM           
	    ,GRT_LST            
	    ,SCRT_INFO          
	    ,OBJ_DESCN          
	    ,OBJ_VERS           
	    ,REG_TYP_CD         
	    ,FRS_RQST_DTM       
	    ,FRS_RQST_USER_ID   
   		,SYSDATETIME 
   		,#{reqmst.rqstUserId,jdbcType=VARCHAR} AS RQST_USER_ID        
	    ,NULL AS APRV_DTM           
	    ,NULL AS APRV_USER_ID       
	    ,DDL_TRG_DCD        
	    ,SRC_DB_SCH_ID      
	    ,SRC_DDL_SEQ_ID     
	    ,RQST_RESN  
	    ,APL_REQ_TYP_CD
        ,APL_REQ_DT   
        ,PRJ_MNG_NO
        ,SR_MNG_NO
        ,PCKG_NM
		,SEQ_CLAS_CD   
		,SEQ_INIT_CD
		,BIZ_IFNC
   	 FROM WAQ_DDL_SEQ
   	WHERE RQST_NO = #{oldRqstNo,jdbcType=VARCHAR}
  	  AND RVW_STS_CD = '2'
   </insert>   
   
   <insert id="checkExistsTsfSeq" parameterType="map">
  	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
  	--검증쿼리 : 등록요청에서 테스트,운영DB신청시(DS013) 이관아닐때
    AND A.DB_SCH_ID IN (SELECT DB_SCH_ID
                      FROM WAA_DB_SCH 
                      WHERE EXP_DTM = TO_DATE('99991231', 'YYYYMMDD')
                      AND REG_TYP_CD IN ('C', 'U')
                      AND DDL_TRG_DCD IN ('T','R')
                      )
  </insert>
  
   <insert id="checkRealSrMngNo" parameterType="map"> 
	  -- 검증쿼리 : 운영반영시 SR번호 필수 체크 (DT014)
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  AND A.DDL_TRG_DCD = 'R'
	  AND (A.SR_MNG_NO IS NULL OR A.PRJ_MNG_NO IS NULL)	  	  
  </insert>	 


 <insert id="checkAplReqDtByDdlTrgDcd" parameterType="map"> 
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	-- 검증쿼리 : 운영이관 시 체크카드여부 테이블의 적용요청일자 는 매월둘째주금요일 임(DT018)
	AND A.DDL_TRG_DCD = 'R' --운영이관
	-- AND A.REG_TYP_CD = 'U' -- 변경
	AND A.NM_RL_TYP_CD = 'E' --엔티티기반
	AND NVL(A.APL_REQ_DT, 'YYYY')
	    != NVL((SELECT TO_CHAR(TRUNC(TRUNC(TO_DATE(A.APL_REQ_DT, 'YYYY-MM-DD'), 'MONTH'), 'd')+12, 'YYYY-MM-DD') FROM DUAL),'XXXX')
	AND EXISTS (SELECT 1
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               -- AND D.VRF_CD = '1'		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' --운영이관 	                
	              )	
</insert>   
  
   <insert id="checkAplInfoByDdlTrgDcd" parameterType="map"> 
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  -- 검증쿼리 : 운영이관시 적용요청구분,적용요청일자 필수 (DT019)
	  -- AND A.DDL_TRG_DCD = 'R' --운영이관
	  -- AND A.REG_TYP_CD = 'U' -- 변경
<!-- 	  AND (A.APL_REQ_TYP_CD IS NULL OR A.APL_REQ_DT IS NULL) -->
<!-- 201803015 우동원차장 요청으로 개발,테스트, 운영 구분 없이 적용요청일자는 필수로 변경 -->
	     AND A.APL_REQ_DT IS NULL
  </insert> 
  
  <insert id="checkAplReqDtByDdlTrgDcdReal" parameterType="map"> 
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  -- 검증쿼리 : 적용요청구분이 정기 이고 계정계이고 운영이관일 경우 적용요청일자는 매주 금요일(DT020)
	  AND A.DDL_TRG_DCD = 'R' --운영이관
	  -- AND A.REG_TYP_CD = 'U' -- 변경
	  AND NVL(A.APL_REQ_TYP_CD, 'F') != 'U' --적용요청구분 긴급이 아닐경우 F:정기, U:긴급
	  AND A.NM_RL_TYP_CD != 'E' --엔티티기반
	  AND A.APL_REQ_DT IS NOT NULL
	  AND EXISTS (SELECT 1
	                FROM WAA_DB_CONN_TRG DB
	                     INNER JOIN WAA_DB_SCH S
	                        ON DB.DB_CONN_TRG_ID = S.DB_CONN_TRG_ID
	                       AND S.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
	                       AND S.REG_TYP_CD IN ('C','U')
	               WHERE DB.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
	                 AND DB.REG_TYP_CD IN ('C','U') 
	                 AND A.DB_SCH_ID = S.DB_SCH_ID )
	  AND NVL(A.APL_REQ_DT, 'YYYY')
	      != NVL((SELECT TO_CHAR(TRUNC(TRUNC(TO_DATE(A.APL_REQ_DT, 'YYYY-MM-DD'), 'IW'), 'd')+5, 'YYYY-MM-DD') FROM DUAL),'XXXX')	
  </insert>  
  
   <insert id="checkSeqInitCdExists" parameterType="map"> 
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  -- 검증쿼리 : INIT유형 사용용도 일별(D) 일경우 필수  체크 DS014
	   AND A.RQST_DCD = 'CU'
	   AND A.US_TYP_CD = 'D' --일별
	   AND A.SEQ_INIT_CD IS NULL
  </insert> 
   <insert id="checkSeqBizIfncByInitCd" parameterType="map"> 
	  <include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  -- 검증쿼리 : INIT유형 8, 9 일경우 업무영향도 필수 체크 DS015
	   AND A.RQST_DCD = 'CU'
	   AND A.SEQ_INIT_CD IN ('8','9')
	   AND A.BIZ_IFNC IS NULL  
  </insert> 
  
  
<select id="selectSrMngNoPrjMngNo" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" resultMap="BaseResultMap">
-- SR번호 및 프로젝트번호 UPDATE 대상 추출
SELECT D.DB_SCH_ID AS SRC_DB_SCH_ID
     , D.DDL_SEQ_ID AS SRC_DDL_SEQ_ID
     , D.DDL_TRG_DCD     
     , T.DB_SCH_ID AS TGT_DB_SCH_ID
     , T.DDL_SEQ_ID AS TGT_DDL_SEQ_ID
     , R.SR_MNG_NO
     , R.PRJ_MNG_NO
 FROM (SELECT DB_SCH_ID 
             , DDL_SEQ_ID
             , DDL_TRG_DCD
             , SRC_DB_SCH_ID
             , SRC_DDL_SEQ_ID
             , SR_MNG_NO
             , PRJ_MNG_NO
         FROM WAH_DDL_SEQ
        WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
          AND DDL_TRG_DCD = 'R'
          AND EXP_DTM = TO_DATE('99991231','YYYYMMDD') ) R
       INNER JOIN WAH_DDL_SEQ T
        ON R.SRC_DB_SCH_ID = T.DB_SCH_ID
       AND R.SRC_DDL_SEQ_ID = T.DDL_SEQ_ID
       AND T.DDL_TRG_DCD = 'T'
       AND T.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
      INNER JOIN WAH_DDL_SEQ D
        ON T.SRC_DB_SCH_ID = D.DB_SCH_ID
       AND T.SRC_DDL_SEQ_ID = D.DDL_SEQ_ID
       AND D.DDL_TRG_DCD = 'D'  
       AND D.EXP_DTM = TO_DATE('99991231','YYYYMMDD')    
UNION ALL 
SELECT T.DB_SCH_ID AS SRC_DB_SCH_ID
     , T.DDL_SEQ_ID AS SRC_DDL_SEQ_ID
     , T.DDL_TRG_DCD 
     , R.DB_SCH_ID AS TGT_DB_SCH_ID
     , R.DDL_SEQ_ID AS TGT_DDL_SEQ_ID
     , R.SR_MNG_NO
     , R.PRJ_MNG_NO
 FROM (SELECT DB_SCH_ID 
             , DDL_SEQ_ID
             , DDL_TRG_DCD
             , SRC_DB_SCH_ID
             , SRC_DDL_SEQ_ID
             , SR_MNG_NO
             , PRJ_MNG_NO             
         FROM WAH_DDL_SEQ
        WHERE RQST_NO = #{rqstNo,jdbcType=VARCHAR}
          AND DDL_TRG_DCD = 'R'
          AND EXP_DTM = TO_DATE('99991231','YYYYMMDD') ) R
       INNER JOIN WAH_DDL_SEQ T
        ON R.SRC_DB_SCH_ID = T.DB_SCH_ID
       AND R.SRC_DDL_SEQ_ID = T.DDL_SEQ_ID
       AND T.DDL_TRG_DCD = 'T'
       AND T.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
</select>  

  <update id="updateWamSrMngNoPrjMngNoByKey" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq">
  	  -- 운영이관시 WAM_DDL_TBL 개발,테스트 sr번호, 프로젝트번호 update  
	  	UPDATE WAM_DDL_SEQ
	  	   SET  SR_MNG_NO = #{srMngNo,jdbcType=VARCHAR}
	  	       ,PRJ_MNG_NO = #{prjMngNo,jdbcType=VARCHAR}
	  	 WHERE DB_SCH_ID = #{srcDbSchId,jdbcType=VARCHAR}
	  	   AND DDL_SEQ_ID = #{srcDdlSeqId,jdbcType=VARCHAR}
  </update> 
  
  <update id="updateWahSrMngNoPrjMngNoByKey" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq">
  	  -- 운영이관시 WAM_DDL_TBL 개발,테스트 sr번호, 프로젝트번호 update  
	  	UPDATE WAH_DDL_SEQ
	  	   SET  SR_MNG_NO = #{srMngNo,jdbcType=VARCHAR}
	  	       ,PRJ_MNG_NO = #{prjMngNo,jdbcType=VARCHAR}
	  	 WHERE DB_SCH_ID = #{srcDbSchId,jdbcType=VARCHAR}
	  	   AND DDL_SEQ_ID = #{srcDdlSeqId,jdbcType=VARCHAR}
	  	   AND EXP_DTM = TO_DATE('99991231','YYYYMMDD')
  </update>  
  
  
   <update id="checkAplReqDt" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	--검증쿼리 : 운영이관시 적용요청일자는 항상 금요일 이다. 화 목도 추가 될수 있다?(DT022)
	 AND A.NM_RL_TYP_CD = 'E' --엔티티기반
	 AND A.DDL_TRG_DCD = 'R' --운영이관
	 AND NVL(A.APL_REQ_TYP_CD, 'F') != 'U' -- 긴급제외 --적용요청구분 긴급이 아닐경우 F:정기, U:긴급	 
	 AND EXISTS (SELECT 1  -- 체크카드여부 제외 DT018 참조
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               -- AND D.VRF_CD = '1'		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' --운영이관 	                
	              )		 
     AND TO_CHAR(TO_DATE(A.APL_REQ_DT, 'YYYY-MM-DD'), 'D') != (SELECT MAX(X.APL_REQ_WKD) 
                                                                FROM V_WAA_SUBJ X
                                                                     INNER JOIN WAH_PDM_TBL Y
                                                                        ON X.SUBJ_ID = Y.SUBJ_ID
                                                                       AND Y.EXP_DTM = TO_DATE('99991231','YYYYMMDD')                                                                      
                                                               WHERE A.PDM_TBL_PNM = Y.PDM_TBL_PNM)
  </update>
  
  
  <update id="checkAplReqDt2" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	--검증쿼리 : 운영이관시 적용요청일자가 수, 목, 금 일경우 차주 금요일이다...(DT023)
	<![CDATA[
	 AND A.NM_RL_TYP_CD = 'E' --엔티티기반
	 AND A.DDL_TRG_DCD = 'R' --운영이관
	 AND NVL(A.APL_REQ_TYP_CD, 'F') != 'U' -- 긴급제외 --적용요청구분 긴급이 아닐경우 F:정기, U:긴급	 
	 AND EXISTS (SELECT 1  -- 체크카드여부 제외 DT018 참조
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               -- AND D.VRF_CD = '1'		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' --운영이관 
	              )		 
	 AND TO_CHAR(TO_DATE(TO_CHAR(A.RQST_DTM, 'YYYY-MM-DD'), 'YYYY-MM-DD'), 'D') >= (SELECT MAX(X.APL_REQ_CHK_WKD) 
					                                                                FROM V_WAA_SUBJ X
					                                                                     INNER JOIN WAH_PDM_TBL Y
					                                                                        ON X.SUBJ_ID = Y.SUBJ_ID
					                                                                       AND Y.EXP_DTM = TO_DATE('99991231','YYYYMMDD')                                                                     
					                                                               WHERE A.PDM_TBL_PNM = Y.PDM_TBL_PNM)
     AND A.APL_REQ_DT
         = (SELECT TO_CHAR(TRUNC(TO_DATE(TO_CHAR(SYSDATETIME, 'YYYY-MM-DD'), 'YYYY-MM-DD'), 'IW') + (MAX(X.APL_REQ_WKD) -2 ), 'YYYY-MM-DD') AS APL_REQ_DT 
              FROM WAQ_DDL_SEQ B
                   INNER JOIN WAH_PDM_TBL Y
                      ON B.PDM_TBL_PNM = Y.PDM_TBL_PNM
                     AND Y.EXP_DTM = TO_DATE('99991231','YYYYMMDD')
                   INNER JOIN V_WAA_SUBJ X
                      ON X.SUBJ_ID = Y.SUBJ_ID
              WHERE 1 = 1
                AND B.NM_RL_TYP_CD = 'E' --엔티티기반
                AND A.RQST_NO = B.RQST_NO
                AND A.RQST_SNO = B.RQST_SNO) 
     ]]> 
  </update>  
	
   <update id="checkAplReqDt3" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	--검증쿼리 : 엔티티기반 아닐경우 운영이관시 적용요청일자는 항상 금요일 이다. 화 목도 추가 될수 있다?(DT024)
	 AND A.NM_RL_TYP_CD != 'E' --엔티티기반
	 AND A.DDL_TRG_DCD = 'R' --운영이관
	 AND NVL(A.APL_REQ_TYP_CD, 'F') != 'U' -- 긴급제외 --적용요청구분 긴급이 아닐경우 F:정기, U:긴급	 
	 AND EXISTS (SELECT 1  -- 체크카드여부 제외 DT018 참조
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               -- AND D.VRF_CD = '1'		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' --운영이관
	              )		 
     AND TO_CHAR(TO_DATE(A.APL_REQ_DT, 'YYYY-MM-DD'), 'D') != '6' --금요일
  </update>
  
  <update id="checkAplReqDt4" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	--검증쿼리 : 엔티티기반 아닐경우 운영이관시 적용요청일자가 수, 목, 금 일경우 차주 금요일이다...(DT025)
	<![CDATA[
	 AND A.NM_RL_TYP_CD != 'E' --엔티티기반
	 AND A.DDL_TRG_DCD = 'R' --운영이관
	 AND NVL(A.APL_REQ_TYP_CD, 'F') != 'U' -- 긴급제외 --적용요청구분 긴급이 아닐경우 F:정기, U:긴급	 
	 AND EXISTS (SELECT 1  -- 체크카드여부 제외 DT018 참조
	              FROM WAQ_DDL_TBL D
	             WHERE A.RQST_NO = D.RQST_NO
	               AND A.DB_SCH_ID = D.DB_SCH_ID
	               AND A.PDM_TBL_PNM = D.DDL_TBL_PNM
	               -- AND D.VRF_CD = '1'		                
	             UNION ALL
	             SELECT 1
	               FROM WAM_DDL_TBL B
	              WHERE A.DB_SCH_ID = B.DB_SCH_ID
	                AND A.PDM_TBL_PNM = B.DDL_TBL_PNM
	                AND B.DDL_TRG_DCD = 'R' --운영이관 
	              )		 
	 AND TO_CHAR(TO_DATE(TO_CHAR(A.RQST_DTM, 'YYYY-MM-DD'), 'YYYY-MM-DD'), 'D') >= '4' --수요일
     AND A.APL_REQ_DT =  TO_CHAR(TRUNC(TO_DATE(TO_CHAR(SYSDATETIME, 'YYYY-MM-DD'), 'YYYY-MM-DD'), 'IW') + 4, 'YYYY-MM-DD') -- 금요일
     ]]> 
  </update>    

  <insert id="checkSeqPnm" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --시퀀스명명규칙 위반 (DS016)
      AND A.REG_TYP_CD IN ('C','U')
	  AND SUBSTR(DDL_SEQ_PNM,1,3) != 'SQ_'
  </insert>
  
  <insert id="checkSeqTblPnm" parameterType="map">
	<include refid="kr.wise.commons.rqstmst.service.WaqRqstVrfDtlsMapper.insertVrfDtlSql"/>
	  --시퀀스명명규칙 위반 (DS027)
      AND A.REG_TYP_CD IN ('C','U')
	  AND SUBSTR(DDL_SEQ_PNM, 4, 7) NOT IN (
      		SELECT SUBSTR(PDM_TBL_PNM,4)
      		FROM WAM_PDM_TBL D
      		WHERE REG_TYP_CD IN ('C','U')
	  	)
  </insert>
  
  
  <select id="selectDelDdlTsfSeqListForRqst" resultMap="BaseResultMap" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
      SELECT 'DD'  AS RQST_DCD 
            , 'SEQ' AS OBJ_DCD
            , C.DB_CONN_TRG_ID
            , C.DB_CONN_TRG_PNM
            , A.DB_SCH_ID
            , B.DB_SCH_PNM
            , A.DDL_SEQ_ID
            , A.DDL_SEQ_PNM
            , A.DDL_SEQ_LNM
            , A.OBJ_DESCN
            , A.PDM_TBL_PNM  
         FROM WAM_DDL_SEQ A
              INNER JOIN WAA_DB_SCH B
                 ON B.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')
                AND B.DB_SCH_ID = A.DB_SCH_ID
              INNER JOIN WAA_DB_CONN_TRG C
                 ON C.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')
                AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID         
        WHERE 1 = 1         
          AND EXISTS (SELECT 1
                            FROM WAH_DDL_SEQ X
                           WHERE X.SRC_DB_SCH_ID   = #{srcDbSchId,jdbcType=VARCHAR}
                             AND X.TGT_DB_SCH_ID   = #{tgtDbSchId,jdbcType=VARCHAR}
                             AND X.DDL_SEQ_PNM = A.DDL_SEQ_PNM 
                          )
          AND A.DB_SCH_ID   = #{tgtDbSchId,jdbcType=VARCHAR}    
          <if test="ddlSeqPnm !=null ">
			 AND (A.DDL_SEQ_PNM LIKE UPPER(#{ddlSeqPnm, jdbcType=VARCHAR}) || '%' 
			 	OR A.DDL_SEQ_LNM LIKE UPPER(#{ddlSeqPnm, jdbcType=VARCHAR}) || '%')
		  </if>
  </select> 
  
  <select id="selectDdlTsfSeqListForRqst" resultMap="BaseResultMap" parameterType="kr.wise.meta.ddl.service.WaqDdlSeq" >
       SELECT 'SEQ' AS OBJ_DCD
            , C.DB_CONN_TRG_ID
            , C.DB_CONN_TRG_PNM
            , A.DB_SCH_ID
            , B.DB_SCH_PNM
            , A.DDL_SEQ_ID
            , A.DDL_SEQ_PNM
            , A.DDL_SEQ_LNM
            , A.OBJ_DESCN
            , A.PDM_TBL_PNM   
         FROM WAH_DDL_SEQ A
              INNER JOIN WAA_DB_SCH B
                 ON A.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')
                 AND B.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')
                AND B.DB_SCH_ID = A.DB_SCH_ID
              INNER JOIN WAA_DB_CONN_TRG C
                 ON C.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')
                AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID         
        WHERE 1 = 1            
          AND A.DB_SCH_ID   = #{srcDbSchId,jdbcType=VARCHAR}    
         <if test="ddlSeqPnm !=null ">
			AND (    A.DDL_SEQ_PNM LIKE '%'|| UPPER(#{ddlSeqPnm, jdbcType=VARCHAR}) || '%'
			     OR  A.DDL_SEQ_LNM LIKE '%'|| UPPER(#{ddlSeqPnm, jdbcType=VARCHAR}) || '%'
			    )     
		 </if>
		
  </select> 
  
  <select id="selectTsfDdlSeqList" parameterType="map" resultMap="BaseResultMap">
  	--DDL 시퀀스 추가대상 조회...
   	 SELECT  'I' AS IBS_STATUS
		  , '' AS DDL_SEQ_ID
		  , 'SEQ' AS OBJ_DCD
		  , #{reqmst.tgtDbSchId,jdbcType=VARCHAR}  AS DB_SCH_ID 
		  , #{reqmst.tgtDbSchPnm,jdbcType=VARCHAR} AS DB_SCH_PNM
		  , A.DDL_SEQ_PNM AS DDL_SEQ_PNM
		  , A.DDL_SEQ_LNM AS DDL_SEQ_LNM
		  , D.DDL_TRG_DCD AS DDL_TRG_DCD 
		  , #{reqmst.rqstDcd,jdbcType=VARCHAR} AS RQST_DCD  
		  , A.PDM_TBL_PNM
		  , A.OBJ_DESCN		  
		  , B.DDL_TRG_DCD      AS SRC_DDL_TRG_DCD 
		  , B.DB_SCH_ID        AS SRC_DB_SCH_ID
		  , B.DB_SCH_PNM       AS SRC_DB_SCH_PNM		 
		  , C.DB_CONN_TRG_PNM  AS SRC_DB_CONN_TRG_PNM 
		  , D.DDL_TRG_DCD      AS TGT_DDL_TRG_DCD
		  , D.DB_SCH_ID        AS TGT_DB_SCH_ID 
		  , D.DB_SCH_PNM       AS TGT_DB_SCH_PNM
		  , E.DB_CONN_TRG_PNM AS TGT_DB_CONN_TRG_PNM
		  , A.INCBY            AS INCBY   
		  , A.STRTWT           AS STRTWT  
		  , A.MAXVAL           AS MAXVAL  
		  , A.MINVAL           AS MINVAL  
		  , A.CYC_YN           AS CYC_YN  
		  , A.CACHE_SZ         AS CACHE_SZ
		  , A.ORD_YN           AS ORD_YN  
		  , A.SCRT_INFO		   AS SCRT_INFO
	   FROM WAM_DDL_SEQ A  
	        INNER JOIN WAA_DB_SCH B
	          ON B.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')         
	         AND B.DB_SCH_ID = A.DB_SCH_ID  	         
	       INNER JOIN WAA_DB_CONN_TRG C
	          ON C.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD') 
	         AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID   
	       INNER JOIN WAA_DB_SCH D
	          ON D.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD')         
	         AND D.DB_SCH_ID = #{reqmst.tgtDbSchId,jdbcType=VARCHAR} 
	       INNER JOIN WAA_DB_CONN_TRG E
	          ON E.EXP_DTM = TO_DATE('9999-12-31','YYYY-MM-DD') 
	         AND E.DB_CONN_TRG_ID = D.DB_CONN_TRG_ID                	       
	  WHERE 1 = 1
	    AND A.DDL_SEQ_ID IN 
	 <foreach collection="list" item="item" open="(" separator="," close=")">
	  	#{item.ddlSeqId}
	 </foreach> 
	
  </select>
  
  <update id="updateDbmsPnm" parameterType="string">
	  --DBMS, 스키마 물리명 ID 업데이트
	  UPDATE WAQ_DDL_SEQ A
	     SET (DB_CONN_TRG_PNM, DB_SCH_PNM) = (
	     			SELECT C.DB_CONN_TRG_PNM, B.DB_SCH_PNM  
	     			  FROM WAA_DB_SCH B 
	     			       INNER JOIN WAA_DB_CONN_TRG C 
	     			          ON C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
				   	         AND C.REG_TYP_CD IN ('C', 'U')
				   	         AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID
				   	 WHERE B.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
				   	   AND B.REG_TYP_CD IN ('C', 'U')
				   	   AND B.DB_SCH_ID = A.DB_SCH_ID				   	   
	     	)
	   WHERE A.RQST_NO = #{rqstNo,jdbcType=VARCHAR}
	     AND EXISTS (SELECT 1
	     			  FROM WAA_DB_SCH B 
	     			       INNER JOIN WAA_DB_CONN_TRG C 
	     			          ON C.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
				   	         AND C.REG_TYP_CD IN ('C', 'U')
				   	         AND C.DB_CONN_TRG_ID = B.DB_CONN_TRG_ID
				   	 WHERE B.EXP_DTM = TO_DATE('9999-12-31', 'YYYY-MM-DD')
				   	   AND B.REG_TYP_CD IN ('C', 'U')
				   	   AND B.DB_SCH_ID = A.DB_SCH_ID	
	                )
  </update>
</mapper>